import{z as f,g as U,r as p,u as x,o as N,b as m,c as g,d as j,e as n,t as h,f as P,F as z,i as B}from"./index-KsuzF6eC.js";import{_ as T,H as L}from"./Header-D0GM5Lpy.js";const _=f(),i=new U;i.setOptions({headers:{authorization:_.getToken()}});function O(l){return i.post({url:"/api/user/login",data:l}).then(e=>e.json())}function D(l){var e;return(e=_.getUser())!=null&&e.user_id?!l.name||!l.password?new Promise((r,o)=>{r({message:"name or password cannot be empty"})}):i.post({url:"/api/user/add",data:l}).then(r=>r.json()):new Promise((r,o)=>{r({message:"user not login"})})}function F(l){return i.post({url:"/api/user/remove",data:l}).then(e=>e.json())}function I(l){return i.post({url:"/api/user/update",data:l}).then(e=>e.json())}function J(l){return i.get({url:"/api/user/find",data:l}).then(e=>e.json())}function M(l){return i.get({url:"/api/user/findById",data:{_id:l}}).then(e=>e.json())}function R(l){return i.get({url:"/api/user/findByToken",data:{token:l}}).then(e=>e.json())}const d={add:D,remove:F,update:I,login:O,findById:M,findByToken:R,find:J},H={class:"wrap"},V={class:"content"},A={style:{display:"flex","flex-wrap":"wrap",gap:"10px",padding:"10px"}},E={class:"item"},q=["value"],G=["value"],K={class:"item"},Q=["value"],W=["value"],X=["value"],Y={class:"item"},Z=["value"],$=["value"],ee=["value"],se={class:"item"},ne=["value"],ae=["value"],ue=["value"],le={class:"item"},oe=["value"],te=["value"],re={style:{margin:"0 10px",padding:"10px","background-color":"#fff"}},ie={style:{margin:"0 10px",padding:"10px","background-color":"#f2f2f2"}},de={__name:"Demo",setup(l){const e=p({userList:[],id:"",name:"",password:"",searchName:"",currentPage:1,pageSize:10});x();const r=p(null),o=p(null),t=f();function k(){d.add({name:e.value.name,password:e.value.password}).then(u=>{u.code===200?(o.value.show("add user success"),v()):o.value.show(u.message)})}function C(){d.remove({id:e.value.id,name:e.value.name,password:e.value.password}).then(u=>{u.code===200?(o.value.show("remove user success"),v()):o.value.show(u.message)})}function y(){d.update({id:e.value.id,name:e.value.name,password:e.value.password}).then(u=>{u.code===200?(o.value.show("update user success"),v()):o.value.show(u.message)})}function b(){d.login({name:e.value.name,password:e.value.password}).then(u=>{u.code===200?(o.value.show("login success"),t.setUser(u.data),t.setToken(JSON.stringify(u.data))):o.value.show(u.message)})}function S(){t.reset(),o.value.show("logout success")}function v(){e.value.currentPage<=1&&(e.value.currentPage=1),d.find({currentPage:e.value.currentPage-1,pageSize:e.value.pageSize,name:e.value.searchName}).then(u=>{u.code===200?e.value.userList=u.data:o.value.show(u.message)})}return N(u=>{if(v(),t.getToken())try{t.setUser(JSON.parse(t.getToken())),d.login({name:t.getUser().user_name,password:t.getUser().user_password}).then(s=>{s.code===200?(o.value.show("login success"),t.setUser(s.data),t.setToken(JSON.stringify(s.data))):(o.value.show(s.message),t.reset())})}catch{t.reset()}else t.reset()}),(u,s)=>(m(),g("div",{class:"wcp-container",onClick:s[13]||(s[13]=(...a)=>{var c,w;return((c=r.value)==null?void 0:c.hideMenu)&&((w=r.value)==null?void 0:w.hideMenu(...a))})},[j(L,{ref_key:"headerRef",ref:r},null,512),n("div",H,[n("div",V,[n("div",A,[n("w-msg",{ref_key:"msg",ref:o},null,512),n("div",E,[n("w-input",{value:e.value.name,placeholder:"name",onChange:s[0]||(s[0]=a=>{e.value.name=a.detail.value})},null,40,q),n("w-input",{value:e.value.password,placeholder:"password",onChange:s[1]||(s[1]=a=>{e.value.password=a.detail.value})},null,40,G),n("w-btn",{onClick:k},"add user")]),n("div",K,[n("w-input",{value:e.value.id,placeholder:"id",onChange:s[2]||(s[2]=a=>{e.value.id=a.detail.value})},null,40,Q),n("w-input",{value:e.value.name,placeholder:"name",onChange:s[3]||(s[3]=a=>{e.value.name=a.detail.value})},null,40,W),n("w-input",{value:e.value.password,placeholder:"password",onChange:s[4]||(s[4]=a=>{e.value.password=a.detail.value})},null,40,X),n("w-btn",{onClick:C},"remove user")]),n("div",Y,[n("w-input",{value:e.value.id,placeholder:"id",onChange:s[5]||(s[5]=a=>{e.value.id=a.detail.value})},null,40,Z),n("w-input",{value:e.value.name,placeholder:"name",onChange:s[6]||(s[6]=a=>{e.value.name=a.detail.value})},null,40,$),n("w-input",{value:e.value.password,placeholder:"password",onChange:s[7]||(s[7]=a=>{e.value.password=a.detail.value})},null,40,ee),n("w-btn",{onClick:y},"update user")]),n("div",se,[n("w-input",{value:e.value.searchName,placeholder:"searchName",onChange:s[8]||(s[8]=a=>{e.value.searchName=a.detail.value})},null,40,ne),n("w-input",{type:"number",min:"1",value:e.value.currentPage,onChange:s[9]||(s[9]=a=>{e.value.currentPage=a.detail.value})},null,40,ae),n("w-input",{type:"number",value:e.value.pageSize,onChange:s[10]||(s[10]=a=>{e.value.pageSize=a.detail.value})},null,40,ue),n("w-btn",{onClick:v},"find user")]),n("div",le,[n("w-input",{value:e.value.name,placeholder:"name",onChange:s[11]||(s[11]=a=>{e.value.name=a.detail.value})},null,40,oe),n("w-input",{value:e.value.password,placeholder:"password",onChange:s[12]||(s[12]=a=>{e.value.password=a.detail.value})},null,40,te),n("w-btn",{onClick:b},"login"),n("w-btn",{onClick:S},"logout")])]),n("div",re," 当前登录用户："+h(P(t).getUser()),1),n("div",ie,[(m(!0),g(z,null,B(e.value.userList,a=>(m(),g("div",null,h(a),1))),256))])])])]))}},me=T(de,[["__scopeId","data-v-1b36888d"]]);export{me as default};
