import{r as p,q as U,s as x,v as N,u as j,o as P,a as w,c as f,b as T,d as n,t as k,x as B,F as z,g as I}from"./index-CFGOa6zj.js";import{_ as D,H as L}from"./Header-DKrwM1oh.js";p({base:"#1abc8c"});const C=U("user",()=>{const t=p(""),e=p(null);function r(d){t.value=d,localStorage.setItem("token",d)}function o(){return t.value=localStorage.getItem("token")||"",t.value}function l(){t.value="",e.value=null,localStorage.removeItem("token")}function g(d){e.value=d}function m(){return x.cloneDeep({},e.value)}return{getToken:o,setToken:r,reset:l,getUser:m,setUser:g}}),y=C(),i=new N;i.setOptions({headers:{authorization:y.getToken()}});function O(t){return i.post({url:"/api/user/login",data:t}).then(e=>e.json())}function F(t){var e;return(e=y.getUser())!=null&&e.user_id?!t.name||!t.password?new Promise((r,o)=>{r({message:"name or password cannot be empty"})}):i.post({url:"/api/user/add",data:t}).then(r=>r.json()):new Promise((r,o)=>{r({message:"user not login"})})}function J(t){return i.post({url:"/api/user/remove",data:t}).then(e=>e.json())}function M(t){return i.post({url:"/api/user/update",data:t}).then(e=>e.json())}function R(t){return i.get({url:"/api/user/find",data:t}).then(e=>e.json())}function H(t){return i.get({url:"/api/user/findById",data:{_id:t}}).then(e=>e.json())}function V(t){return i.get({url:"/api/user/findByToken",data:{token:t}}).then(e=>e.json())}const v={add:F,remove:J,update:M,login:O,findById:H,findByToken:V,find:R},q={class:"wrap"},A={class:"content"},E={style:{display:"flex","flex-wrap":"wrap",gap:"10px",padding:"10px"}},G={class:"item"},K=["value"],Q=["value"],W={class:"item"},X=["value"],Y=["value"],Z=["value"],$={class:"item"},ee=["value"],se=["value"],ne=["value"],ae={class:"item"},te=["value"],ue=["value"],oe=["value"],le={class:"item"},re=["value"],ie=["value"],de={style:{margin:"0 10px",padding:"10px","background-color":"#fff"}},ve={style:{margin:"0 10px",padding:"10px","background-color":"#f2f2f2"}},pe={__name:"Demo",setup(t){const e=p({userList:[],id:"",name:"",password:"",searchName:"",currentPage:1,pageSize:10});j();const r=p(null),o=p(null),l=C();function g(){v.add({name:e.value.name,password:e.value.password}).then(u=>{u.code===200?(o.value.show("add user success"),c()):o.value.show(u.message)})}function m(){v.remove({id:e.value.id,name:e.value.name,password:e.value.password}).then(u=>{u.code===200?(o.value.show("remove user success"),c()):o.value.show(u.message)})}function d(){v.update({id:e.value.id,name:e.value.name,password:e.value.password}).then(u=>{u.code===200?(o.value.show("update user success"),c()):o.value.show(u.message)})}function S(){v.login({name:e.value.name,password:e.value.password}).then(u=>{u.code===200?(o.value.show("login success"),l.setUser(u.data),l.setToken(JSON.stringify(u.data))):o.value.show(u.message)})}function b(){l.reset(),o.value.show("logout success")}function c(){e.value.currentPage<=1&&(e.value.currentPage=1),v.find({currentPage:e.value.currentPage-1,pageSize:e.value.pageSize,name:e.value.searchName}).then(u=>{u.code===200?e.value.userList=u.data:o.value.show(u.message)})}return P(u=>{if(c(),l.getToken())try{l.setUser(JSON.parse(l.getToken())),v.login({name:l.getUser().user_name,password:l.getUser().user_password}).then(s=>{s.code===200?(o.value.show("login success"),l.setUser(s.data),l.setToken(JSON.stringify(s.data))):(o.value.show(s.message),l.reset())})}catch{l.reset()}else l.reset()}),(u,s)=>(w(),f("div",{class:"wcp-container",onClick:s[13]||(s[13]=(...a)=>{var h,_;return((h=r.value)==null?void 0:h.hideMenu)&&((_=r.value)==null?void 0:_.hideMenu(...a))})},[T(L,{ref_key:"headerRef",ref:r},null,512),n("div",q,[n("div",A,[n("div",E,[n("w-msg",{ref_key:"msg",ref:o},null,512),n("div",G,[n("w-input",{value:e.value.name,placeholder:"name",onChange:s[0]||(s[0]=a=>{e.value.name=a.detail.value})},null,40,K),n("w-input",{value:e.value.password,placeholder:"password",onChange:s[1]||(s[1]=a=>{e.value.password=a.detail.value})},null,40,Q),n("w-btn",{onClick:g},"add user")]),n("div",W,[n("w-input",{value:e.value.id,placeholder:"id",onChange:s[2]||(s[2]=a=>{e.value.id=a.detail.value})},null,40,X),n("w-input",{value:e.value.name,placeholder:"name",onChange:s[3]||(s[3]=a=>{e.value.name=a.detail.value})},null,40,Y),n("w-input",{value:e.value.password,placeholder:"password",onChange:s[4]||(s[4]=a=>{e.value.password=a.detail.value})},null,40,Z),n("w-btn",{onClick:m},"remove user")]),n("div",$,[n("w-input",{value:e.value.id,placeholder:"id",onChange:s[5]||(s[5]=a=>{e.value.id=a.detail.value})},null,40,ee),n("w-input",{value:e.value.name,placeholder:"name",onChange:s[6]||(s[6]=a=>{e.value.name=a.detail.value})},null,40,se),n("w-input",{value:e.value.password,placeholder:"password",onChange:s[7]||(s[7]=a=>{e.value.password=a.detail.value})},null,40,ne),n("w-btn",{onClick:d},"update user")]),n("div",ae,[n("w-input",{value:e.value.searchName,placeholder:"searchName",onChange:s[8]||(s[8]=a=>{e.value.searchName=a.detail.value})},null,40,te),n("w-input",{type:"number",min:"1",value:e.value.currentPage,onChange:s[9]||(s[9]=a=>{e.value.currentPage=a.detail.value})},null,40,ue),n("w-input",{type:"number",value:e.value.pageSize,onChange:s[10]||(s[10]=a=>{e.value.pageSize=a.detail.value})},null,40,oe),n("w-btn",{onClick:c},"find user")]),n("div",le,[n("w-input",{value:e.value.name,placeholder:"name",onChange:s[11]||(s[11]=a=>{e.value.name=a.detail.value})},null,40,re),n("w-input",{value:e.value.password,placeholder:"password",onChange:s[12]||(s[12]=a=>{e.value.password=a.detail.value})},null,40,ie),n("w-btn",{onClick:S},"login"),n("w-btn",{onClick:b},"logout")])]),n("div",de," 当前登录用户："+k(B(l).getUser()),1),n("div",ve,[(w(!0),f(z,null,I(e.value.userList,a=>(w(),f("div",null,k(a),1))),256))])])])]))}},me=D(pe,[["__scopeId","data-v-1b36888d"]]);export{me as default};
