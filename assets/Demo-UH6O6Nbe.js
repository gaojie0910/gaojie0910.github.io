import{z as f,g as S,r as p,u as b,o as U,b as c,c as g,d as N,e as n,t as h,f as j,F as z,i as B}from"./index-lFAYgTCE.js";import{_ as P,H as T}from"./Header-C98-QkLU.js";const L=f(),o=new S;o.setOptions({headers:{authorization:L.getToken()}});function O(t){return o.post({url:"/api/user/login",data:t}).then(e=>e.json())}function D(t){return o.post({url:"/api/user/add",data:t}).then(e=>e.json())}function F(t){return o.post({url:"/api/user/remove",data:t}).then(e=>e.json())}function I(t){return o.post({url:"/api/user/update",data:t}).then(e=>e.json())}function J(t){return o.get({url:"/api/user/find",data:t}).then(e=>e.json())}function M(t){return o.get({url:"/api/user/findById",data:{_id:t}}).then(e=>e.json())}function R(t){return o.get({url:"/api/user/findByToken",data:{token:t}}).then(e=>e.json())}const i={add:D,remove:F,update:I,login:O,findById:M,findByToken:R,find:J},H={class:"wrap"},V={class:"content"},A={style:{display:"flex","flex-wrap":"wrap",gap:"10px",padding:"10px"}},E={class:"item"},q=["value"],G=["value"],K={class:"item"},Q=["value"],W=["value"],X=["value"],Y={class:"item"},Z=["value"],$=["value"],ee=["value"],se={class:"item"},ne=["value"],ue=["value"],ae=["value"],le={class:"item"},re=["value"],te=["value"],oe={style:{margin:"0 10px",padding:"10px","background-color":"#fff"}},ie={style:{margin:"0 10px",padding:"10px","background-color":"#f2f2f2"}},de={__name:"Demo",setup(t){const e=p({userList:[],id:"",name:"",password:"",searchName:"",currentPage:1,pageSize:10});b();const v=p(null),l=p(null),r=f();function _(){i.add({name:e.value.name,password:e.value.password}).then(a=>{a.success===!0?(l.value.show("add user success"),d()):l.value.show(a.errors[0].message)})}function k(){i.remove({id:e.value.id,name:e.value.name,password:e.value.password}).then(a=>{a.success===!0?(a.result[0].meta.changes>0?l.value.show("remove user success"):l.value.show("user not exist"),d()):l.value.show(a.errors[0].message)})}function C(){i.update({id:e.value.id,name:e.value.name,password:e.value.password}).then(a=>{a.success===!0?(l.value.show("update user success"),d()):l.value.show(a.errors[0].message)})}function y(){i.login({name:e.value.name,password:e.value.password}).then(a=>{a.success===!0?a.result[0].results[0]?(l.value.show("login success"),r.setUser(a.result[0].results[0]),r.setToken(JSON.stringify(a.result[0].results[0]))):l.value.show("name or password not correct"):l.value.show(a.errors[0].message)})}function x(){r.reset(),l.value.show("logout success")}function d(){e.value.currentPage<=1&&(e.value.currentPage=1),i.find({currentPage:e.value.currentPage-1,pageSize:e.value.pageSize,name:e.value.searchName}).then(a=>{a.success===!0?e.value.userList=a.result[0].results:l.value.show(a.errors[0].message)})}return U(a=>{if(d(),r.getToken())try{r.setUser(JSON.parse(r.getToken())),i.login({name:r.getUser().user_name,password:r.getUser().user_password}).then(s=>{s.success===!0?s.result[0].results[0]?(l.value.show("login success"),r.setUser(s.result[0].results[0]),r.setToken(JSON.stringify(s.result[0].results[0]))):(l.value.show("name or password not correct please login again"),r.reset()):(l.value.show(s.errors[0].message),r.reset())})}catch{r.reset()}else r.reset()}),(a,s)=>(c(),g("div",{class:"wcp-container",onClick:s[13]||(s[13]=(...u)=>{var m,w;return((m=v.value)==null?void 0:m.hideMenu)&&((w=v.value)==null?void 0:w.hideMenu(...u))})},[N(T,{ref_key:"headerRef",ref:v},null,512),n("div",H,[n("div",V,[n("div",A,[n("w-msg",{ref_key:"msg",ref:l},null,512),n("div",E,[n("w-input",{value:e.value.name,placeholder:"name",onChange:s[0]||(s[0]=u=>{e.value.name=u.detail.value})},null,40,q),n("w-input",{value:e.value.password,placeholder:"password",onChange:s[1]||(s[1]=u=>{e.value.password=u.detail.value})},null,40,G),n("w-btn",{onClick:_},"add user")]),n("div",K,[n("w-input",{value:e.value.id,placeholder:"id",onChange:s[2]||(s[2]=u=>{e.value.id=u.detail.value})},null,40,Q),n("w-input",{value:e.value.name,placeholder:"name",onChange:s[3]||(s[3]=u=>{e.value.name=u.detail.value})},null,40,W),n("w-input",{value:e.value.password,placeholder:"password",onChange:s[4]||(s[4]=u=>{e.value.password=u.detail.value})},null,40,X),n("w-btn",{onClick:k},"remove user")]),n("div",Y,[n("w-input",{value:e.value.id,placeholder:"id",onChange:s[5]||(s[5]=u=>{e.value.id=u.detail.value})},null,40,Z),n("w-input",{value:e.value.name,placeholder:"name",onChange:s[6]||(s[6]=u=>{e.value.name=u.detail.value})},null,40,$),n("w-input",{value:e.value.password,placeholder:"password",onChange:s[7]||(s[7]=u=>{e.value.password=u.detail.value})},null,40,ee),n("w-btn",{onClick:C},"update user")]),n("div",se,[n("w-input",{value:e.value.searchName,placeholder:"searchName",onChange:s[8]||(s[8]=u=>{e.value.searchName=u.detail.value})},null,40,ne),n("w-input",{type:"number",min:"1",value:e.value.currentPage,onChange:s[9]||(s[9]=u=>{e.value.currentPage=u.detail.value})},null,40,ue),n("w-input",{type:"number",value:e.value.pageSize,onChange:s[10]||(s[10]=u=>{e.value.pageSize=u.detail.value})},null,40,ae),n("w-btn",{onClick:d},"find user")]),n("div",le,[n("w-input",{value:e.value.name,placeholder:"name",onChange:s[11]||(s[11]=u=>{e.value.name=u.detail.value})},null,40,re),n("w-input",{value:e.value.password,placeholder:"password",onChange:s[12]||(s[12]=u=>{e.value.password=u.detail.value})},null,40,te),n("w-btn",{onClick:y},"login"),n("w-btn",{onClick:x},"logout")])]),n("div",oe," 当前登录用户："+h(j(r).getUser()),1),n("div",ie,[(c(!0),g(z,null,B(e.value.userList,u=>(c(),g("div",null,h(u),1))),256))])])])]))}},ce=P(de,[["__scopeId","data-v-7a47dd3d"]]);export{ce as default};
