import{r as Le,u as Ws,o as ht,b as ke,c as st,e as Ce,h as Mt,y as la,d as Hn,v as Bt,w as xt,F as ca,k as ha}from"./index-2p4fj2DR.js";import{_ as ut,H as ua}from"./Header-BQdfTEQB.js";import{D as da,H as Un,F as dr,a as qn,L as ei,b as Zn,P as dt,S as vt,c as yi,d as ki,M as kt,e as Te,W as mt,f as Yn,B as Jt,O as Kt,g as Wn,h as Li,i as pa,G as Zi,V as gi,j as Gs,k as Hs,A as lr,C as xi,l as Ai,N as Us,m as qs,n as Ke,o as zi,p as rn,q as Xr,r as fa,E as va,s as Yr,t as Ln,u as ma,v as ga,w as An,x as At,y as ya,z as bn,I as Ki,J as $s,K as wa,Q as Xs,R as Ys,U as _a,X as xa,Y as Aa,Z as Ft,_ as ba,$ as js,a0 as Ta,a1 as Ks,a2 as Ea,a3 as Mr,a4 as Qs,a5 as Mn,a6 as bi,a7 as jr,a8 as Jn,a9 as Sa,aa as Ca,ab as Zs,ac as Ma,ad as Ra,ae as Js,af as pr,ag as Pa,ah as Ba,ai as La,aj as Fa,ak as Ia,al as ka,am as za,an as Na,ao as eo,ap as ps,aq as to,ar as Oa,as as Va,at as Da,au as Wa,av as Ga,aw as Ha,ax as Ua,ay as qa,az as fs,aA as vs,aB as ms,aC as gs,aD as $a,aE as Xa,aF as Ya,aG as ja,aH as Ka,T as Qa}from"./ThreeMaterials-bjDRf6CO.js";class ys extends da{constructor(e){super(e),this.type=Un}parse(e){const i=function(A,T){switch(A){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(T||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(T||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(T||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(T||""))}},l=`
`,c=function(A,T,R){T=T||1024;let F=A.pos,I=-1,D=0,G="",Y=String.fromCharCode.apply(null,new Uint16Array(A.subarray(F,F+128)));for(;0>(I=Y.indexOf(l))&&D<T&&F<A.byteLength;)G+=Y,D+=Y.length,F+=128,Y+=String.fromCharCode.apply(null,new Uint16Array(A.subarray(F,F+128)));return-1<I?(A.pos+=D+I+1,G+Y.slice(0,I)):!1},u=function(A){const T=/^#\?(\S+)/,R=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,C=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,F=/^\s*FORMAT=(\S+)\s*$/,I=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,D={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let G,Y;for((A.pos>=A.byteLength||!(G=c(A)))&&i(1,"no header found"),(Y=G.match(T))||i(3,"bad initial token"),D.valid|=1,D.programtype=Y[1],D.string+=G+`
`;G=c(A),G!==!1;){if(D.string+=G+`
`,G.charAt(0)==="#"){D.comments+=G+`
`;continue}if((Y=G.match(R))&&(D.gamma=parseFloat(Y[1])),(Y=G.match(C))&&(D.exposure=parseFloat(Y[1])),(Y=G.match(F))&&(D.valid|=2,D.format=Y[1]),(Y=G.match(I))&&(D.valid|=4,D.height=parseInt(Y[1],10),D.width=parseInt(Y[2],10)),D.valid&2&&D.valid&4)break}return D.valid&2||i(3,"missing format specifier"),D.valid&4||i(3,"missing image size specifier"),D},d=function(A,T,R){const C=T;if(C<8||C>32767||A[0]!==2||A[1]!==2||A[2]&128)return new Uint8Array(A);C!==(A[2]<<8|A[3])&&i(3,"wrong scanline width");const F=new Uint8Array(4*T*R);F.length||i(4,"unable to allocate buffer space");let I=0,D=0;const G=4*C,Y=new Uint8Array(4),z=new Uint8Array(G);let B=R;for(;B>0&&D<A.byteLength;){D+4>A.byteLength&&i(1),Y[0]=A[D++],Y[1]=A[D++],Y[2]=A[D++],Y[3]=A[D++],(Y[0]!=2||Y[1]!=2||(Y[2]<<8|Y[3])!=C)&&i(3,"bad rgbe scanline format");let H=0,W;for(;H<G&&D<A.byteLength;){W=A[D++];const k=W>128;if(k&&(W-=128),(W===0||H+W>G)&&i(3,"bad scanline data"),k){const M=A[D++];for(let S=0;S<W;S++)z[H++]=M}else z.set(A.subarray(D,D+W),H),H+=W,D+=W}const P=C;for(let k=0;k<P;k++){let M=0;F[I]=z[k+M],M+=C,F[I+1]=z[k+M],M+=C,F[I+2]=z[k+M],M+=C,F[I+3]=z[k+M],I+=4}B--}return F},p=function(A,T,R,C){const F=A[T+3],I=Math.pow(2,F-128)/255;R[C+0]=A[T+0]*I,R[C+1]=A[T+1]*I,R[C+2]=A[T+2]*I,R[C+3]=1},f=function(A,T,R,C){const F=A[T+3],I=Math.pow(2,F-128)/255;R[C+0]=qn.toHalfFloat(Math.min(A[T+0]*I,65504)),R[C+1]=qn.toHalfFloat(Math.min(A[T+1]*I,65504)),R[C+2]=qn.toHalfFloat(Math.min(A[T+2]*I,65504)),R[C+3]=qn.toHalfFloat(1)},v=new Uint8Array(e);v.pos=0;const m=u(v),y=m.width,_=m.height,w=d(v.subarray(v.pos),y,_);let x,E,L;switch(this.type){case dr:L=w.length/4;const A=new Float32Array(L*4);for(let R=0;R<L;R++)p(w,R*4,A,R*4);x=A,E=dr;break;case Un:L=w.length/4;const T=new Uint16Array(L*4);for(let R=0;R<L;R++)f(w,R*4,T,R*4);x=T,E=Un;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:y,height:_,data:x,header:m.string,gamma:m.gamma,exposure:m.exposure,type:E}}setDataType(e){return this.type=e,this}load(e,t,n,r){function s(i,o){switch(i.type){case dr:case Un:i.colorSpace=ei,i.minFilter=Zn,i.magFilter=Zn,i.generateMipmaps=!1,i.flipY=!0;break}t&&t(i,o)}return super.load(e,s,n,r)}}const Za={class:"wcp-demo-container"},Ja={__name:"ThreePanoramic",setup(g){Le({}),Ws();let e,t,n,r=0,s=0,i=0,o=0,a=0,h=0,l=0,c=0;const u=Le(null),d=Le(null);function p(){e=new dt(75,window.innerWidth/window.innerHeight,1,1100),t=new vt;const E=new yi(500,60,40);E.scale(1,1,-1);const L=new ys().load("/hdirs/symmetrical_garden_02_2k.hdr"),A=new ys().load("/hdirs/rostock_laage_airport_2k.hdr");L.colorSpace=ki;const T=new kt({map:L}),R=new Te(E,T);t.add(R),n=new mt({canvas:d.value});const C={width:+getComputedStyle(u.value).width.split("px")[0],height:+getComputedStyle(u.value).height.split("px")[0]};n.setPixelRatio(window.devicePixelRatio),n.setSize(C.width,C.height),u.value.style.touchAction="none",u.value.addEventListener("pointerdown",v),u.value.addEventListener("wheel",_),u.value.addEventListener("dblclick",F=>{console.log(T),T.map==L?T.map=A:T.map=L,i=0,a=0}),document.addEventListener("dragover",function(F){F.preventDefault(),F.dataTransfer.dropEffect="copy"}),document.addEventListener("dragenter",function(){document.body.style.opacity=.5}),document.addEventListener("dragleave",function(){document.body.style.opacity=1}),document.addEventListener("drop",function(F){F.preventDefault();const I=new FileReader;I.addEventListener("load",function(D){T.map.image.src=D.target.result,T.map.needsUpdate=!0}),I.readAsDataURL(F.dataTransfer.files[0]),document.body.style.opacity=1}),window.addEventListener("resize",f)}function f(){e.aspect=sizes.width/sizes.height,e.updateProjectionMatrix(),n.setSize(sizes.width,sizes.height)}function v(E){E.isPrimary!==!1&&(r=E.clientX,s=E.clientY,o=i,h=a,document.addEventListener("pointermove",m),document.addEventListener("pointerup",y))}function m(E){E.isPrimary!==!1&&(i=(r-E.clientX)*.1+o,a=(E.clientY-s)*.1+h)}function y(E){E.isPrimary!==!1&&(document.removeEventListener("pointermove",m),document.removeEventListener("pointerup",y))}function _(E){E.preventDefault();const L=e.fov+E.deltaY*.05;e.fov=Yn.clamp(L,10,75),e.updateProjectionMatrix()}function w(){requestAnimationFrame(w),x()}function x(){a=Math.max(-85,Math.min(85,a)),l=Yn.degToRad(90-a),c=Yn.degToRad(i);const E=500*Math.sin(l)*Math.cos(c),L=500*Math.cos(l),A=500*Math.sin(l)*Math.sin(c);e.lookAt(E,L,A),n.render(t,e)}return ht(E=>{p(),w()}),(E,L)=>(ke(),st("div",Za,[Ce("div",{ref_key:"canvasContainer",ref:u,class:"canvas-container"},[Ce("canvas",{ref_key:"canvas",ref:d},null,512)],512)]))}},el=ut(Ja,[["__scopeId","data-v-c3ea009b"]]);function vi(g){if(g===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g}function io(g,e){g.prototype=Object.create(e.prototype),g.prototype.constructor=g,g.__proto__=e}/*!
 * GSAP 3.12.5
 * https://gsap.com
 *
 * @license Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Nt={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},gn={duration:.5,overwrite:!1,delay:0},Kr,lt,qe,Xt=1e8,We=1/Xt,Rr=Math.PI*2,tl=Rr/4,il=0,no=Math.sqrt,nl=Math.cos,rl=Math.sin,nt=function(e){return typeof e=="string"},je=function(e){return typeof e=="function"},wi=function(e){return typeof e=="number"},Qr=function(e){return typeof e>"u"},li=function(e){return typeof e=="object"},bt=function(e){return e!==!1},Zr=function(){return typeof window<"u"},$n=function(e){return je(e)||nt(e)},ro=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},ct=Array.isArray,Pr=/(?:-?\.?\d|\.)+/gi,so=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,un=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,fr=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,oo=/[+-]=-?[.\d]+/,ao=/[^,'"\[\]\s]+/gi,sl=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,$e,ni,Br,Jr,Ot={},er={},lo,co=function(e){return(er=sn(e,Ot))&&Ct},es=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},Fn=function(e,t){return!t&&console.warn(e)},ho=function(e,t){return e&&(Ot[e]=t)&&er&&(er[e]=t)||Ot},In=function(){return 0},ol={suppressEvents:!0,isStart:!0,kill:!1},jn={suppressEvents:!0,kill:!1},al={suppressEvents:!0},ts={},Fi=[],Lr={},uo,Lt={},vr={},ws=30,Kn=[],is="",ns=function(e){var t=e[0],n,r;if(li(t)||je(t)||(e=[e]),!(n=(t._gsap||{}).harness)){for(r=Kn.length;r--&&!Kn[r].targetTest(t););n=Kn[r]}for(r=e.length;r--;)e[r]&&(e[r]._gsap||(e[r]._gsap=new zo(e[r],n)))||e.splice(r,1);return e},Ji=function(e){return e._gsap||ns(Yt(e))[0]._gsap},po=function(e,t,n){return(n=e[t])&&je(n)?e[t]():Qr(n)&&e.getAttribute&&e.getAttribute(t)||n},Tt=function(e,t){return(e=e.split(",")).forEach(t)||e},Qe=function(e){return Math.round(e*1e5)/1e5||0},it=function(e){return Math.round(e*1e7)/1e7||0},pn=function(e,t){var n=t.charAt(0),r=parseFloat(t.substr(2));return e=parseFloat(e),n==="+"?e+r:n==="-"?e-r:n==="*"?e*r:e/r},ll=function(e,t){for(var n=t.length,r=0;e.indexOf(t[r])<0&&++r<n;);return r<n},tr=function(){var e=Fi.length,t=Fi.slice(0),n,r;for(Lr={},Fi.length=0,n=0;n<e;n++)r=t[n],r&&r._lazy&&(r.render(r._lazy[0],r._lazy[1],!0)._lazy=0)},fo=function(e,t,n,r){Fi.length&&!lt&&tr(),e.render(t,n,lt&&t<0&&(e._initted||e._startAt)),Fi.length&&!lt&&tr()},vo=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(ao).length<2?t:nt(e)?e.trim():e},mo=function(e){return e},jt=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},cl=function(e){return function(t,n){for(var r in n)r in t||r==="duration"&&e||r==="ease"||(t[r]=n[r])}},sn=function(e,t){for(var n in t)e[n]=t[n];return e},_s=function g(e,t){for(var n in t)n!=="__proto__"&&n!=="constructor"&&n!=="prototype"&&(e[n]=li(t[n])?g(e[n]||(e[n]={}),t[n]):t[n]);return e},ir=function(e,t){var n={},r;for(r in e)r in t||(n[r]=e[r]);return n},Rn=function(e){var t=e.parent||$e,n=e.keyframes?cl(ct(e.keyframes)):jt;if(bt(e.inherit))for(;t;)n(e,t.vars.defaults),t=t.parent||t._dp;return e},hl=function(e,t){for(var n=e.length,r=n===t.length;r&&n--&&e[n]===t[n];);return n<0},go=function(e,t,n,r,s){var i=e[r],o;if(s)for(o=t[s];i&&i[s]>o;)i=i._prev;return i?(t._next=i._next,i._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[r]=t,t._prev=i,t.parent=t._dp=e,t},cr=function(e,t,n,r){n===void 0&&(n="_first"),r===void 0&&(r="_last");var s=t._prev,i=t._next;s?s._next=i:e[n]===t&&(e[n]=i),i?i._prev=s:e[r]===t&&(e[r]=s),t._next=t._prev=t.parent=null},Ni=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},en=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},ul=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},Fr=function(e,t,n,r){return e._startAt&&(lt?e._startAt.revert(jn):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,r))},dl=function g(e){return!e||e._ts&&g(e.parent)},xs=function(e){return e._repeat?yn(e._tTime,e=e.duration()+e._rDelay)*e:0},yn=function(e,t){var n=Math.floor(e/=t);return e&&n===e?n-1:n},nr=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},hr=function(e){return e._end=it(e._start+(e._tDur/Math.abs(e._ts||e._rts||We)||0))},ur=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=it(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),hr(e),n._dirty||en(n,e)),e},yo=function(e,t){var n;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(n=nr(e.rawTime(),t),(!t._dur||Gn(0,t.totalDuration(),n)-t._tTime>We)&&t.render(n,!0)),en(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-We}},ri=function(e,t,n,r){return t.parent&&Ni(t),t._start=it((wi(n)?n:n||e!==$e?qt(e,n,t):e._time)+t._delay),t._end=it(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),go(e,t,"_first","_last",e._sort?"_start":0),Ir(t)||(e._recent=t),r||yo(e,t),e._ts<0&&ur(e,e._tTime),e},wo=function(e,t){return(Ot.ScrollTrigger||es("scrollTrigger",t))&&Ot.ScrollTrigger.create(t,e)},_o=function(e,t,n,r,s){if(ss(e,t,s),!e._initted)return 1;if(!n&&e._pt&&!lt&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&uo!==It.frame)return Fi.push(e),e._lazy=[s,r],1},pl=function g(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||g(t))},Ir=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},fl=function(e,t,n,r){var s=e.ratio,i=t<0||!t&&(!e._start&&pl(e)&&!(!e._initted&&Ir(e))||(e._ts<0||e._dp._ts<0)&&!Ir(e))?0:1,o=e._rDelay,a=0,h,l,c;if(o&&e._repeat&&(a=Gn(0,e._tDur,t),l=yn(a,o),e._yoyo&&l&1&&(i=1-i),l!==yn(e._tTime,o)&&(s=1-i,e.vars.repeatRefresh&&e._initted&&e.invalidate())),i!==s||lt||r||e._zTime===We||!t&&e._zTime){if(!e._initted&&_o(e,t,r,n,a))return;for(c=e._zTime,e._zTime=t||(n?We:0),n||(n=t&&!c),e.ratio=i,e._from&&(i=1-i),e._time=0,e._tTime=a,h=e._pt;h;)h.r(i,h.d),h=h._next;t<0&&Fr(e,t,n,!0),e._onUpdate&&!n&&zt(e,"onUpdate"),a&&e._repeat&&!n&&e.parent&&zt(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===i&&(i&&Ni(e,1),!n&&!lt&&(zt(e,i?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},vl=function(e,t,n){var r;if(n>t)for(r=e._first;r&&r._start<=n;){if(r.data==="isPause"&&r._start>t)return r;r=r._next}else for(r=e._last;r&&r._start>=n;){if(r.data==="isPause"&&r._start<t)return r;r=r._prev}},wn=function(e,t,n,r){var s=e._repeat,i=it(t)||0,o=e._tTime/e._tDur;return o&&!r&&(e._time*=i/e._dur),e._dur=i,e._tDur=s?s<0?1e10:it(i*(s+1)+e._rDelay*s):i,o>0&&!r&&ur(e,e._tTime=e._tDur*o),e.parent&&hr(e),n||en(e.parent,e),e},As=function(e){return e instanceof ft?en(e):wn(e,e._dur)},ml={_start:0,endTime:In,totalDuration:In},qt=function g(e,t,n){var r=e.labels,s=e._recent||ml,i=e.duration()>=Xt?s.endTime(!1):e._dur,o,a,h;return nt(t)&&(isNaN(t)||t in r)?(a=t.charAt(0),h=t.substr(-1)==="%",o=t.indexOf("="),a==="<"||a===">"?(o>=0&&(t=t.replace(/=/,"")),(a==="<"?s._start:s.endTime(s._repeat>=0))+(parseFloat(t.substr(1))||0)*(h?(o<0?s:n).totalDuration()/100:1)):o<0?(t in r||(r[t]=i),r[t]):(a=parseFloat(t.charAt(o-1)+t.substr(o+1)),h&&n&&(a=a/100*(ct(n)?n[0]:n).totalDuration()),o>1?g(e,t.substr(0,o-1),n)+a:i+a)):t==null?i:+t},Pn=function(e,t,n){var r=wi(t[1]),s=(r?2:1)+(e<2?0:1),i=t[s],o,a;if(r&&(i.duration=t[1]),i.parent=n,e){for(o=i,a=n;a&&!("immediateRender"in o);)o=a.vars.defaults||{},a=bt(a.vars.inherit)&&a.parent;i.immediateRender=bt(o.immediateRender),e<2?i.runBackwards=1:i.startAt=t[s-1]}return new Ze(t[0],i,t[s+1])},Vi=function(e,t){return e||e===0?t(e):t},Gn=function(e,t,n){return n<e?e:n>t?t:n},at=function(e,t){return!nt(e)||!(t=sl.exec(e))?"":t[1]},gl=function(e,t,n){return Vi(n,function(r){return Gn(e,t,r)})},kr=[].slice,xo=function(e,t){return e&&li(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&li(e[0]))&&!e.nodeType&&e!==ni},yl=function(e,t,n){return n===void 0&&(n=[]),e.forEach(function(r){var s;return nt(r)&&!t||xo(r,1)?(s=n).push.apply(s,Yt(r)):n.push(r)})||n},Yt=function(e,t,n){return qe&&!t&&qe.selector?qe.selector(e):nt(e)&&!n&&(Br||!_n())?kr.call((t||Jr).querySelectorAll(e),0):ct(e)?yl(e,n):xo(e)?kr.call(e,0):e?[e]:[]},zr=function(e){return e=Yt(e)[0]||Fn("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return Yt(t,n.querySelectorAll?n:n===e?Fn("Invalid scope")||Jr.createElement("div"):e)}},Ao=function(e){return e.sort(function(){return .5-Math.random()})},bo=function(e){if(je(e))return e;var t=li(e)?e:{each:e},n=tn(t.ease),r=t.from||0,s=parseFloat(t.base)||0,i={},o=r>0&&r<1,a=isNaN(r)||o,h=t.axis,l=r,c=r;return nt(r)?l=c={center:.5,edges:.5,end:1}[r]||0:!o&&a&&(l=r[0],c=r[1]),function(u,d,p){var f=(p||t).length,v=i[f],m,y,_,w,x,E,L,A,T;if(!v){if(T=t.grid==="auto"?0:(t.grid||[1,Xt])[1],!T){for(L=-Xt;L<(L=p[T++].getBoundingClientRect().left)&&T<f;);T<f&&T--}for(v=i[f]=[],m=a?Math.min(T,f)*l-.5:r%T,y=T===Xt?0:a?f*c/T-.5:r/T|0,L=0,A=Xt,E=0;E<f;E++)_=E%T-m,w=y-(E/T|0),v[E]=x=h?Math.abs(h==="y"?w:_):no(_*_+w*w),x>L&&(L=x),x<A&&(A=x);r==="random"&&Ao(v),v.max=L-A,v.min=A,v.v=f=(parseFloat(t.amount)||parseFloat(t.each)*(T>f?f-1:h?h==="y"?f/T:T:Math.max(T,f/T))||0)*(r==="edges"?-1:1),v.b=f<0?s-f:s,v.u=at(t.amount||t.each)||0,n=n&&f<0?Fo(n):n}return f=(v[u]-v.min)/v.max||0,it(v.b+(n?n(f):f)*v.v)+v.u}},Nr=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(n){var r=it(Math.round(parseFloat(n)/e)*e*t);return(r-r%1)/t+(wi(n)?0:at(n))}},To=function(e,t){var n=ct(e),r,s;return!n&&li(e)&&(r=n=e.radius||Xt,e.values?(e=Yt(e.values),(s=!wi(e[0]))&&(r*=r)):e=Nr(e.increment)),Vi(t,n?je(e)?function(i){return s=e(i),Math.abs(s-i)<=r?s:i}:function(i){for(var o=parseFloat(s?i.x:i),a=parseFloat(s?i.y:0),h=Xt,l=0,c=e.length,u,d;c--;)s?(u=e[c].x-o,d=e[c].y-a,u=u*u+d*d):u=Math.abs(e[c]-o),u<h&&(h=u,l=c);return l=!r||h<=r?e[l]:i,s||l===i||wi(i)?l:l+at(i)}:Nr(e))},Eo=function(e,t,n,r){return Vi(ct(e)?!t:n===!0?!!(n=0):!r,function(){return ct(e)?e[~~(Math.random()*e.length)]:(n=n||1e-5)&&(r=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+n*.99))/n)*n*r)/r})},wl=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(r){return t.reduce(function(s,i){return i(s)},r)}},_l=function(e,t){return function(n){return e(parseFloat(n))+(t||at(n))}},xl=function(e,t,n){return Co(e,t,0,1,n)},So=function(e,t,n){return Vi(n,function(r){return e[~~t(r)]})},Al=function g(e,t,n){var r=t-e;return ct(e)?So(e,g(0,e.length),t):Vi(n,function(s){return(r+(s-e)%r)%r+e})},bl=function g(e,t,n){var r=t-e,s=r*2;return ct(e)?So(e,g(0,e.length-1),t):Vi(n,function(i){return i=(s+(i-e)%s)%s||0,e+(i>r?s-i:i)})},kn=function(e){for(var t=0,n="",r,s,i,o;~(r=e.indexOf("random(",t));)i=e.indexOf(")",r),o=e.charAt(r+7)==="[",s=e.substr(r+7,i-r-7).match(o?ao:Pr),n+=e.substr(t,r-t)+Eo(o?s:+s[0],o?0:+s[1],+s[2]||1e-5),t=i+1;return n+e.substr(t,e.length-t)},Co=function(e,t,n,r,s){var i=t-e,o=r-n;return Vi(s,function(a){return n+((a-e)/i*o||0)})},Tl=function g(e,t,n,r){var s=isNaN(e+t)?0:function(d){return(1-d)*e+d*t};if(!s){var i=nt(e),o={},a,h,l,c,u;if(n===!0&&(r=1)&&(n=null),i)e={p:e},t={p:t};else if(ct(e)&&!ct(t)){for(l=[],c=e.length,u=c-2,h=1;h<c;h++)l.push(g(e[h-1],e[h]));c--,s=function(p){p*=c;var f=Math.min(u,~~p);return l[f](p-f)},n=t}else r||(e=sn(ct(e)?[]:{},e));if(!l){for(a in t)rs.call(o,e,a,"get",t[a]);s=function(p){return ls(p,o)||(i?e.p:e)}}}return Vi(n,s)},bs=function(e,t,n){var r=e.labels,s=Xt,i,o,a;for(i in r)o=r[i]-t,o<0==!!n&&o&&s>(o=Math.abs(o))&&(a=i,s=o);return a},zt=function(e,t,n){var r=e.vars,s=r[t],i=qe,o=e._ctx,a,h,l;if(s)return a=r[t+"Params"],h=r.callbackScope||e,n&&Fi.length&&tr(),o&&(qe=o),l=a?s.apply(h,a):s.call(h),qe=i,l},Sn=function(e){return Ni(e),e.scrollTrigger&&e.scrollTrigger.kill(!!lt),e.progress()<1&&zt(e,"onInterrupt"),e},dn,Mo=[],Ro=function(e){if(e)if(e=!e.name&&e.default||e,Zr()||e.headless){var t=e.name,n=je(e),r=t&&!n&&e.init?function(){this._props=[]}:e,s={init:In,render:ls,add:rs,kill:Dl,modifier:Vl,rawVars:0},i={targetTest:0,get:0,getSetter:as,aliases:{},register:0};if(_n(),e!==r){if(Lt[t])return;jt(r,jt(ir(e,s),i)),sn(r.prototype,sn(s,ir(e,i))),Lt[r.prop=t]=r,e.targetTest&&(Kn.push(r),ts[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}ho(t,r),e.register&&e.register(Ct,r,Et)}else Mo.push(e)},Ve=255,Cn={aqua:[0,Ve,Ve],lime:[0,Ve,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Ve],navy:[0,0,128],white:[Ve,Ve,Ve],olive:[128,128,0],yellow:[Ve,Ve,0],orange:[Ve,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Ve,0,0],pink:[Ve,192,203],cyan:[0,Ve,Ve],transparent:[Ve,Ve,Ve,0]},mr=function(e,t,n){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(n-t)*e*6:e<.5?n:e*3<2?t+(n-t)*(2/3-e)*6:t)*Ve+.5|0},Po=function(e,t,n){var r=e?wi(e)?[e>>16,e>>8&Ve,e&Ve]:0:Cn.black,s,i,o,a,h,l,c,u,d,p;if(!r){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),Cn[e])r=Cn[e];else if(e.charAt(0)==="#"){if(e.length<6&&(s=e.charAt(1),i=e.charAt(2),o=e.charAt(3),e="#"+s+s+i+i+o+o+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return r=parseInt(e.substr(1,6),16),[r>>16,r>>8&Ve,r&Ve,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),r=[e>>16,e>>8&Ve,e&Ve]}else if(e.substr(0,3)==="hsl"){if(r=p=e.match(Pr),!t)a=+r[0]%360/360,h=+r[1]/100,l=+r[2]/100,i=l<=.5?l*(h+1):l+h-l*h,s=l*2-i,r.length>3&&(r[3]*=1),r[0]=mr(a+1/3,s,i),r[1]=mr(a,s,i),r[2]=mr(a-1/3,s,i);else if(~e.indexOf("="))return r=e.match(so),n&&r.length<4&&(r[3]=1),r}else r=e.match(Pr)||Cn.transparent;r=r.map(Number)}return t&&!p&&(s=r[0]/Ve,i=r[1]/Ve,o=r[2]/Ve,c=Math.max(s,i,o),u=Math.min(s,i,o),l=(c+u)/2,c===u?a=h=0:(d=c-u,h=l>.5?d/(2-c-u):d/(c+u),a=c===s?(i-o)/d+(i<o?6:0):c===i?(o-s)/d+2:(s-i)/d+4,a*=60),r[0]=~~(a+.5),r[1]=~~(h*100+.5),r[2]=~~(l*100+.5)),n&&r.length<4&&(r[3]=1),r},Bo=function(e){var t=[],n=[],r=-1;return e.split(Ii).forEach(function(s){var i=s.match(un)||[];t.push.apply(t,i),n.push(r+=i.length+1)}),t.c=n,t},Ts=function(e,t,n){var r="",s=(e+r).match(Ii),i=t?"hsla(":"rgba(",o=0,a,h,l,c;if(!s)return e;if(s=s.map(function(u){return(u=Po(u,t,1))&&i+(t?u[0]+","+u[1]+"%,"+u[2]+"%,"+u[3]:u.join(","))+")"}),n&&(l=Bo(e),a=n.c,a.join(r)!==l.c.join(r)))for(h=e.replace(Ii,"1").split(un),c=h.length-1;o<c;o++)r+=h[o]+(~a.indexOf(o)?s.shift()||i+"0,0,0,0)":(l.length?l:s.length?s:n).shift());if(!h)for(h=e.split(Ii),c=h.length-1;o<c;o++)r+=h[o]+s[o];return r+h[c]},Ii=function(){var g="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in Cn)g+="|"+e+"\\b";return new RegExp(g+")","gi")}(),El=/hsl[a]?\(/,Lo=function(e){var t=e.join(" "),n;if(Ii.lastIndex=0,Ii.test(t))return n=El.test(t),e[1]=Ts(e[1],n),e[0]=Ts(e[0],n,Bo(e[1])),!0},zn,It=function(){var g=Date.now,e=500,t=33,n=g(),r=n,s=1e3/240,i=s,o=[],a,h,l,c,u,d,p=function f(v){var m=g()-r,y=v===!0,_,w,x,E;if((m>e||m<0)&&(n+=m-t),r+=m,x=r-n,_=x-i,(_>0||y)&&(E=++c.frame,u=x-c.time*1e3,c.time=x=x/1e3,i+=_+(_>=s?4:s-_),w=1),y||(a=h(f)),w)for(d=0;d<o.length;d++)o[d](x,u,E,v)};return c={time:0,frame:0,tick:function(){p(!0)},deltaRatio:function(v){return u/(1e3/(v||60))},wake:function(){lo&&(!Br&&Zr()&&(ni=Br=window,Jr=ni.document||{},Ot.gsap=Ct,(ni.gsapVersions||(ni.gsapVersions=[])).push(Ct.version),co(er||ni.GreenSockGlobals||!ni.gsap&&ni||{}),Mo.forEach(Ro)),l=typeof requestAnimationFrame<"u"&&requestAnimationFrame,a&&c.sleep(),h=l||function(v){return setTimeout(v,i-c.time*1e3+1|0)},zn=1,p(2))},sleep:function(){(l?cancelAnimationFrame:clearTimeout)(a),zn=0,h=In},lagSmoothing:function(v,m){e=v||1/0,t=Math.min(m||33,e)},fps:function(v){s=1e3/(v||240),i=c.time*1e3+s},add:function(v,m,y){var _=m?function(w,x,E,L){v(w,x,E,L),c.remove(_)}:v;return c.remove(v),o[y?"unshift":"push"](_),_n(),_},remove:function(v,m){~(m=o.indexOf(v))&&o.splice(m,1)&&d>=m&&d--},_listeners:o},c}(),_n=function(){return!zn&&It.wake()},Me={},Sl=/^[\d.\-M][\d.\-,\s]/,Cl=/["']/g,Ml=function(e){for(var t={},n=e.substr(1,e.length-3).split(":"),r=n[0],s=1,i=n.length,o,a,h;s<i;s++)a=n[s],o=s!==i-1?a.lastIndexOf(","):a.length,h=a.substr(0,o),t[r]=isNaN(h)?h.replace(Cl,"").trim():+h,r=a.substr(o+1).trim();return t},Rl=function(e){var t=e.indexOf("(")+1,n=e.indexOf(")"),r=e.indexOf("(",t);return e.substring(t,~r&&r<n?e.indexOf(")",n+1):n)},Pl=function(e){var t=(e+"").split("("),n=Me[t[0]];return n&&t.length>1&&n.config?n.config.apply(null,~e.indexOf("{")?[Ml(t[1])]:Rl(e).split(",").map(vo)):Me._CE&&Sl.test(e)?Me._CE("",e):n},Fo=function(e){return function(t){return 1-e(1-t)}},Io=function g(e,t){for(var n=e._first,r;n;)n instanceof ft?g(n,t):n.vars.yoyoEase&&(!n._yoyo||!n._repeat)&&n._yoyo!==t&&(n.timeline?g(n.timeline,t):(r=n._ease,n._ease=n._yEase,n._yEase=r,n._yoyo=t)),n=n._next},tn=function(e,t){return e&&(je(e)?e:Me[e]||Pl(e))||t},an=function(e,t,n,r){n===void 0&&(n=function(a){return 1-t(1-a)}),r===void 0&&(r=function(a){return a<.5?t(a*2)/2:1-t((1-a)*2)/2});var s={easeIn:t,easeOut:n,easeInOut:r},i;return Tt(e,function(o){Me[o]=Ot[o]=s,Me[i=o.toLowerCase()]=n;for(var a in s)Me[i+(a==="easeIn"?".in":a==="easeOut"?".out":".inOut")]=Me[o+"."+a]=s[a]}),s},ko=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},gr=function g(e,t,n){var r=t>=1?t:1,s=(n||(e?.3:.45))/(t<1?t:1),i=s/Rr*(Math.asin(1/r)||0),o=function(l){return l===1?1:r*Math.pow(2,-10*l)*rl((l-i)*s)+1},a=e==="out"?o:e==="in"?function(h){return 1-o(1-h)}:ko(o);return s=Rr/s,a.config=function(h,l){return g(e,h,l)},a},yr=function g(e,t){t===void 0&&(t=1.70158);var n=function(i){return i?--i*i*((t+1)*i+t)+1:0},r=e==="out"?n:e==="in"?function(s){return 1-n(1-s)}:ko(n);return r.config=function(s){return g(e,s)},r};Tt("Linear,Quad,Cubic,Quart,Quint,Strong",function(g,e){var t=e<5?e+1:e;an(g+",Power"+(t-1),e?function(n){return Math.pow(n,t)}:function(n){return n},function(n){return 1-Math.pow(1-n,t)},function(n){return n<.5?Math.pow(n*2,t)/2:1-Math.pow((1-n)*2,t)/2})});Me.Linear.easeNone=Me.none=Me.Linear.easeIn;an("Elastic",gr("in"),gr("out"),gr());(function(g,e){var t=1/e,n=2*t,r=2.5*t,s=function(o){return o<t?g*o*o:o<n?g*Math.pow(o-1.5/e,2)+.75:o<r?g*(o-=2.25/e)*o+.9375:g*Math.pow(o-2.625/e,2)+.984375};an("Bounce",function(i){return 1-s(1-i)},s)})(7.5625,2.75);an("Expo",function(g){return g?Math.pow(2,10*(g-1)):0});an("Circ",function(g){return-(no(1-g*g)-1)});an("Sine",function(g){return g===1?1:-nl(g*tl)+1});an("Back",yr("in"),yr("out"),yr());Me.SteppedEase=Me.steps=Ot.SteppedEase={config:function(e,t){e===void 0&&(e=1);var n=1/e,r=e+(t?0:1),s=t?1:0,i=1-We;return function(o){return((r*Gn(0,i,o)|0)+s)*n}}};gn.ease=Me["quad.out"];Tt("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(g){return is+=g+","+g+"Params,"});var zo=function(e,t){this.id=il++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:po,this.set=t?t.getSetter:as},Nn=function(){function g(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,wn(this,+t.duration,1,1),this.data=t.data,qe&&(this._ctx=qe,qe.data.push(this)),zn||It.wake()}var e=g.prototype;return e.delay=function(n){return n||n===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+n-this._delay),this._delay=n,this):this._delay},e.duration=function(n){return arguments.length?this.totalDuration(this._repeat>0?n+(n+this._rDelay)*this._repeat:n):this.totalDuration()&&this._dur},e.totalDuration=function(n){return arguments.length?(this._dirty=0,wn(this,this._repeat<0?n:(n-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(n,r){if(_n(),!arguments.length)return this._tTime;var s=this._dp;if(s&&s.smoothChildTiming&&this._ts){for(ur(this,n),!s._dp||s.parent||yo(s,this);s&&s.parent;)s.parent._time!==s._start+(s._ts>=0?s._tTime/s._ts:(s.totalDuration()-s._tTime)/-s._ts)&&s.totalTime(s._tTime,!0),s=s.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&n<this._tDur||this._ts<0&&n>0||!this._tDur&&!n)&&ri(this._dp,this,this._start-this._delay)}return(this._tTime!==n||!this._dur&&!r||this._initted&&Math.abs(this._zTime)===We||!n&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=n),fo(this,n,r)),this},e.time=function(n,r){return arguments.length?this.totalTime(Math.min(this.totalDuration(),n+xs(this))%(this._dur+this._rDelay)||(n?this._dur:0),r):this._time},e.totalProgress=function(n,r){return arguments.length?this.totalTime(this.totalDuration()*n,r):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>0?1:0},e.progress=function(n,r){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-n:n)+xs(this),r):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(n,r){var s=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(n-1)*s,r):this._repeat?yn(this._tTime,s)+1:1},e.timeScale=function(n,r){if(!arguments.length)return this._rts===-We?0:this._rts;if(this._rts===n)return this;var s=this.parent&&this._ts?nr(this.parent._time,this):this._tTime;return this._rts=+n||0,this._ts=this._ps||n===-We?0:this._rts,this.totalTime(Gn(-Math.abs(this._delay),this._tDur,s),r!==!1),hr(this),ul(this)},e.paused=function(n){return arguments.length?(this._ps!==n&&(this._ps=n,n?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(_n(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==We&&(this._tTime-=We)))),this):this._ps},e.startTime=function(n){if(arguments.length){this._start=n;var r=this.parent||this._dp;return r&&(r._sort||!this.parent)&&ri(r,this,n-this._delay),this}return this._start},e.endTime=function(n){return this._start+(bt(n)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(n){var r=this.parent||this._dp;return r?n&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?nr(r.rawTime(n),this):this._tTime:this._tTime},e.revert=function(n){n===void 0&&(n=al);var r=lt;return lt=n,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(n),this.totalTime(-.01,n.suppressEvents)),this.data!=="nested"&&n.kill!==!1&&this.kill(),lt=r,this},e.globalTime=function(n){for(var r=this,s=arguments.length?n:r.rawTime();r;)s=r._start+s/(Math.abs(r._ts)||1),r=r._dp;return!this.parent&&this._sat?this._sat.globalTime(n):s},e.repeat=function(n){return arguments.length?(this._repeat=n===1/0?-2:n,As(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(n){if(arguments.length){var r=this._time;return this._rDelay=n,As(this),r?this.time(r):this}return this._rDelay},e.yoyo=function(n){return arguments.length?(this._yoyo=n,this):this._yoyo},e.seek=function(n,r){return this.totalTime(qt(this,n),bt(r))},e.restart=function(n,r){return this.play().totalTime(n?-this._delay:0,bt(r))},e.play=function(n,r){return n!=null&&this.seek(n,r),this.reversed(!1).paused(!1)},e.reverse=function(n,r){return n!=null&&this.seek(n||this.totalDuration(),r),this.reversed(!0).paused(!1)},e.pause=function(n,r){return n!=null&&this.seek(n,r),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(n){return arguments.length?(!!n!==this.reversed()&&this.timeScale(-this._rts||(n?-We:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-We,this},e.isActive=function(){var n=this.parent||this._dp,r=this._start,s;return!!(!n||this._ts&&this._initted&&n.isActive()&&(s=n.rawTime(!0))>=r&&s<this.endTime(!0)-We)},e.eventCallback=function(n,r,s){var i=this.vars;return arguments.length>1?(r?(i[n]=r,s&&(i[n+"Params"]=s),n==="onUpdate"&&(this._onUpdate=r)):delete i[n],this):i[n]},e.then=function(n){var r=this;return new Promise(function(s){var i=je(n)?n:mo,o=function(){var h=r.then;r.then=null,je(i)&&(i=i(r))&&(i.then||i===r)&&(r.then=h),s(i),r.then=h};r._initted&&r.totalProgress()===1&&r._ts>=0||!r._tTime&&r._ts<0?o():r._prom=o})},e.kill=function(){Sn(this)},g}();jt(Nn.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-We,_prom:0,_ps:!1,_rts:1});var ft=function(g){io(e,g);function e(n,r){var s;return n===void 0&&(n={}),s=g.call(this,n)||this,s.labels={},s.smoothChildTiming=!!n.smoothChildTiming,s.autoRemoveChildren=!!n.autoRemoveChildren,s._sort=bt(n.sortChildren),$e&&ri(n.parent||$e,vi(s),r),n.reversed&&s.reverse(),n.paused&&s.paused(!0),n.scrollTrigger&&wo(vi(s),n.scrollTrigger),s}var t=e.prototype;return t.to=function(r,s,i){return Pn(0,arguments,this),this},t.from=function(r,s,i){return Pn(1,arguments,this),this},t.fromTo=function(r,s,i,o){return Pn(2,arguments,this),this},t.set=function(r,s,i){return s.duration=0,s.parent=this,Rn(s).repeatDelay||(s.repeat=0),s.immediateRender=!!s.immediateRender,new Ze(r,s,qt(this,i),1),this},t.call=function(r,s,i){return ri(this,Ze.delayedCall(0,r,s),i)},t.staggerTo=function(r,s,i,o,a,h,l){return i.duration=s,i.stagger=i.stagger||o,i.onComplete=h,i.onCompleteParams=l,i.parent=this,new Ze(r,i,qt(this,a)),this},t.staggerFrom=function(r,s,i,o,a,h,l){return i.runBackwards=1,Rn(i).immediateRender=bt(i.immediateRender),this.staggerTo(r,s,i,o,a,h,l)},t.staggerFromTo=function(r,s,i,o,a,h,l,c){return o.startAt=i,Rn(o).immediateRender=bt(o.immediateRender),this.staggerTo(r,s,o,a,h,l,c)},t.render=function(r,s,i){var o=this._time,a=this._dirty?this.totalDuration():this._tDur,h=this._dur,l=r<=0?0:it(r),c=this._zTime<0!=r<0&&(this._initted||!h),u,d,p,f,v,m,y,_,w,x,E,L;if(this!==$e&&l>a&&r>=0&&(l=a),l!==this._tTime||i||c){if(o!==this._time&&h&&(l+=this._time-o,r+=this._time-o),u=l,w=this._start,_=this._ts,m=!_,c&&(h||(o=this._zTime),(r||!s)&&(this._zTime=r)),this._repeat){if(E=this._yoyo,v=h+this._rDelay,this._repeat<-1&&r<0)return this.totalTime(v*100+r,s,i);if(u=it(l%v),l===a?(f=this._repeat,u=h):(f=~~(l/v),f&&f===l/v&&(u=h,f--),u>h&&(u=h)),x=yn(this._tTime,v),!o&&this._tTime&&x!==f&&this._tTime-x*v-this._dur<=0&&(x=f),E&&f&1&&(u=h-u,L=1),f!==x&&!this._lock){var A=E&&x&1,T=A===(E&&f&1);if(f<x&&(A=!A),o=A?0:l%h?h:l,this._lock=1,this.render(o||(L?0:it(f*v)),s,!h)._lock=0,this._tTime=l,!s&&this.parent&&zt(this,"onRepeat"),this.vars.repeatRefresh&&!L&&(this.invalidate()._lock=1),o&&o!==this._time||m!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(h=this._dur,a=this._tDur,T&&(this._lock=2,o=A?h:-1e-4,this.render(o,!0),this.vars.repeatRefresh&&!L&&this.invalidate()),this._lock=0,!this._ts&&!m)return this;Io(this,L)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(y=vl(this,it(o),it(u)),y&&(l-=u-(u=y._start))),this._tTime=l,this._time=u,this._act=!_,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=r,o=0),!o&&u&&!s&&!f&&(zt(this,"onStart"),this._tTime!==l))return this;if(u>=o&&r>=0)for(d=this._first;d;){if(p=d._next,(d._act||u>=d._start)&&d._ts&&y!==d){if(d.parent!==this)return this.render(r,s,i);if(d.render(d._ts>0?(u-d._start)*d._ts:(d._dirty?d.totalDuration():d._tDur)+(u-d._start)*d._ts,s,i),u!==this._time||!this._ts&&!m){y=0,p&&(l+=this._zTime=-We);break}}d=p}else{d=this._last;for(var R=r<0?r:u;d;){if(p=d._prev,(d._act||R<=d._end)&&d._ts&&y!==d){if(d.parent!==this)return this.render(r,s,i);if(d.render(d._ts>0?(R-d._start)*d._ts:(d._dirty?d.totalDuration():d._tDur)+(R-d._start)*d._ts,s,i||lt&&(d._initted||d._startAt)),u!==this._time||!this._ts&&!m){y=0,p&&(l+=this._zTime=R?-We:We);break}}d=p}}if(y&&!s&&(this.pause(),y.render(u>=o?0:-We)._zTime=u>=o?1:-1,this._ts))return this._start=w,hr(this),this.render(r,s,i);this._onUpdate&&!s&&zt(this,"onUpdate",!0),(l===a&&this._tTime>=this.totalDuration()||!l&&o)&&(w===this._start||Math.abs(_)!==Math.abs(this._ts))&&(this._lock||((r||!h)&&(l===a&&this._ts>0||!l&&this._ts<0)&&Ni(this,1),!s&&!(r<0&&!o)&&(l||o||!a)&&(zt(this,l===a&&r>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(l<a&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(r,s){var i=this;if(wi(s)||(s=qt(this,s,r)),!(r instanceof Nn)){if(ct(r))return r.forEach(function(o){return i.add(o,s)}),this;if(nt(r))return this.addLabel(r,s);if(je(r))r=Ze.delayedCall(0,r);else return this}return this!==r?ri(this,r,s):this},t.getChildren=function(r,s,i,o){r===void 0&&(r=!0),s===void 0&&(s=!0),i===void 0&&(i=!0),o===void 0&&(o=-Xt);for(var a=[],h=this._first;h;)h._start>=o&&(h instanceof Ze?s&&a.push(h):(i&&a.push(h),r&&a.push.apply(a,h.getChildren(!0,s,i)))),h=h._next;return a},t.getById=function(r){for(var s=this.getChildren(1,1,1),i=s.length;i--;)if(s[i].vars.id===r)return s[i]},t.remove=function(r){return nt(r)?this.removeLabel(r):je(r)?this.killTweensOf(r):(cr(this,r),r===this._recent&&(this._recent=this._last),en(this))},t.totalTime=function(r,s){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=it(It.time-(this._ts>0?r/this._ts:(this.totalDuration()-r)/-this._ts))),g.prototype.totalTime.call(this,r,s),this._forcing=0,this):this._tTime},t.addLabel=function(r,s){return this.labels[r]=qt(this,s),this},t.removeLabel=function(r){return delete this.labels[r],this},t.addPause=function(r,s,i){var o=Ze.delayedCall(0,s||In,i);return o.data="isPause",this._hasPause=1,ri(this,o,qt(this,r))},t.removePause=function(r){var s=this._first;for(r=qt(this,r);s;)s._start===r&&s.data==="isPause"&&Ni(s),s=s._next},t.killTweensOf=function(r,s,i){for(var o=this.getTweensOf(r,i),a=o.length;a--;)Ri!==o[a]&&o[a].kill(r,s);return this},t.getTweensOf=function(r,s){for(var i=[],o=Yt(r),a=this._first,h=wi(s),l;a;)a instanceof Ze?ll(a._targets,o)&&(h?(!Ri||a._initted&&a._ts)&&a.globalTime(0)<=s&&a.globalTime(a.totalDuration())>s:!s||a.isActive())&&i.push(a):(l=a.getTweensOf(o,s)).length&&i.push.apply(i,l),a=a._next;return i},t.tweenTo=function(r,s){s=s||{};var i=this,o=qt(i,r),a=s,h=a.startAt,l=a.onStart,c=a.onStartParams,u=a.immediateRender,d,p=Ze.to(i,jt({ease:s.ease||"none",lazy:!1,immediateRender:!1,time:o,overwrite:"auto",duration:s.duration||Math.abs((o-(h&&"time"in h?h.time:i._time))/i.timeScale())||We,onStart:function(){if(i.pause(),!d){var v=s.duration||Math.abs((o-(h&&"time"in h?h.time:i._time))/i.timeScale());p._dur!==v&&wn(p,v,0,1).render(p._time,!0,!0),d=1}l&&l.apply(p,c||[])}},s));return u?p.render(0):p},t.tweenFromTo=function(r,s,i){return this.tweenTo(s,jt({startAt:{time:qt(this,r)}},i))},t.recent=function(){return this._recent},t.nextLabel=function(r){return r===void 0&&(r=this._time),bs(this,qt(this,r))},t.previousLabel=function(r){return r===void 0&&(r=this._time),bs(this,qt(this,r),1)},t.currentLabel=function(r){return arguments.length?this.seek(r,!0):this.previousLabel(this._time+We)},t.shiftChildren=function(r,s,i){i===void 0&&(i=0);for(var o=this._first,a=this.labels,h;o;)o._start>=i&&(o._start+=r,o._end+=r),o=o._next;if(s)for(h in a)a[h]>=i&&(a[h]+=r);return en(this)},t.invalidate=function(r){var s=this._first;for(this._lock=0;s;)s.invalidate(r),s=s._next;return g.prototype.invalidate.call(this,r)},t.clear=function(r){r===void 0&&(r=!0);for(var s=this._first,i;s;)i=s._next,this.remove(s),s=i;return this._dp&&(this._time=this._tTime=this._pTime=0),r&&(this.labels={}),en(this)},t.totalDuration=function(r){var s=0,i=this,o=i._last,a=Xt,h,l,c;if(arguments.length)return i.timeScale((i._repeat<0?i.duration():i.totalDuration())/(i.reversed()?-r:r));if(i._dirty){for(c=i.parent;o;)h=o._prev,o._dirty&&o.totalDuration(),l=o._start,l>a&&i._sort&&o._ts&&!i._lock?(i._lock=1,ri(i,o,l-o._delay,1)._lock=0):a=l,l<0&&o._ts&&(s-=l,(!c&&!i._dp||c&&c.smoothChildTiming)&&(i._start+=l/i._ts,i._time-=l,i._tTime-=l),i.shiftChildren(-l,!1,-1/0),a=0),o._end>s&&o._ts&&(s=o._end),o=h;wn(i,i===$e&&i._time>s?i._time:s,1,1),i._dirty=0}return i._tDur},e.updateRoot=function(r){if($e._ts&&(fo($e,nr(r,$e)),uo=It.frame),It.frame>=ws){ws+=Nt.autoSleep||120;var s=$e._first;if((!s||!s._ts)&&Nt.autoSleep&&It._listeners.length<2){for(;s&&!s._ts;)s=s._next;s||It.sleep()}}},e}(Nn);jt(ft.prototype,{_lock:0,_hasPause:0,_forcing:0});var Bl=function(e,t,n,r,s,i,o){var a=new Et(this._pt,e,t,0,1,Go,null,s),h=0,l=0,c,u,d,p,f,v,m,y;for(a.b=n,a.e=r,n+="",r+="",(m=~r.indexOf("random("))&&(r=kn(r)),i&&(y=[n,r],i(y,e,t),n=y[0],r=y[1]),u=n.match(fr)||[];c=fr.exec(r);)p=c[0],f=r.substring(h,c.index),d?d=(d+1)%5:f.substr(-5)==="rgba("&&(d=1),p!==u[l++]&&(v=parseFloat(u[l-1])||0,a._pt={_next:a._pt,p:f||l===1?f:",",s:v,c:p.charAt(1)==="="?pn(v,p)-v:parseFloat(p)-v,m:d&&d<4?Math.round:0},h=fr.lastIndex);return a.c=h<r.length?r.substring(h,r.length):"",a.fp=o,(oo.test(r)||m)&&(a.e=0),this._pt=a,a},rs=function(e,t,n,r,s,i,o,a,h,l){je(r)&&(r=r(s||0,e,i));var c=e[t],u=n!=="get"?n:je(c)?h?e[t.indexOf("set")||!je(e["get"+t.substr(3)])?t:"get"+t.substr(3)](h):e[t]():c,d=je(c)?h?zl:Do:os,p;if(nt(r)&&(~r.indexOf("random(")&&(r=kn(r)),r.charAt(1)==="="&&(p=pn(u,r)+(at(u)||0),(p||p===0)&&(r=p))),!l||u!==r||Or)return!isNaN(u*r)&&r!==""?(p=new Et(this._pt,e,t,+u||0,r-(u||0),typeof c=="boolean"?Ol:Wo,0,d),h&&(p.fp=h),o&&p.modifier(o,this,e),this._pt=p):(!c&&!(t in e)&&es(t,r),Bl.call(this,e,t,u,r,d,a||Nt.stringFilter,h))},Ll=function(e,t,n,r,s){if(je(e)&&(e=Bn(e,s,t,n,r)),!li(e)||e.style&&e.nodeType||ct(e)||ro(e))return nt(e)?Bn(e,s,t,n,r):e;var i={},o;for(o in e)i[o]=Bn(e[o],s,t,n,r);return i},No=function(e,t,n,r,s,i){var o,a,h,l;if(Lt[e]&&(o=new Lt[e]).init(s,o.rawVars?t[e]:Ll(t[e],r,s,i,n),n,r,i)!==!1&&(n._pt=a=new Et(n._pt,s,e,0,1,o.render,o,0,o.priority),n!==dn))for(h=n._ptLookup[n._targets.indexOf(s)],l=o._props.length;l--;)h[o._props[l]]=a;return o},Ri,Or,ss=function g(e,t,n){var r=e.vars,s=r.ease,i=r.startAt,o=r.immediateRender,a=r.lazy,h=r.onUpdate,l=r.runBackwards,c=r.yoyoEase,u=r.keyframes,d=r.autoRevert,p=e._dur,f=e._startAt,v=e._targets,m=e.parent,y=m&&m.data==="nested"?m.vars.targets:v,_=e._overwrite==="auto"&&!Kr,w=e.timeline,x,E,L,A,T,R,C,F,I,D,G,Y,z;if(w&&(!u||!s)&&(s="none"),e._ease=tn(s,gn.ease),e._yEase=c?Fo(tn(c===!0?s:c,gn.ease)):0,c&&e._yoyo&&!e._repeat&&(c=e._yEase,e._yEase=e._ease,e._ease=c),e._from=!w&&!!r.runBackwards,!w||u&&!r.stagger){if(F=v[0]?Ji(v[0]).harness:0,Y=F&&r[F.prop],x=ir(r,ts),f&&(f._zTime<0&&f.progress(1),t<0&&l&&o&&!d?f.render(-1,!0):f.revert(l&&p?jn:ol),f._lazy=0),i){if(Ni(e._startAt=Ze.set(v,jt({data:"isStart",overwrite:!1,parent:m,immediateRender:!0,lazy:!f&&bt(a),startAt:null,delay:0,onUpdate:h&&function(){return zt(e,"onUpdate")},stagger:0},i))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(lt||!o&&!d)&&e._startAt.revert(jn),o&&p&&t<=0&&n<=0){t&&(e._zTime=t);return}}else if(l&&p&&!f){if(t&&(o=!1),L=jt({overwrite:!1,data:"isFromStart",lazy:o&&!f&&bt(a),immediateRender:o,stagger:0,parent:m},x),Y&&(L[F.prop]=Y),Ni(e._startAt=Ze.set(v,L)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(lt?e._startAt.revert(jn):e._startAt.render(-1,!0)),e._zTime=t,!o)g(e._startAt,We,We);else if(!t)return}for(e._pt=e._ptCache=0,a=p&&bt(a)||a&&!p,E=0;E<v.length;E++){if(T=v[E],C=T._gsap||ns(v)[E]._gsap,e._ptLookup[E]=D={},Lr[C.id]&&Fi.length&&tr(),G=y===v?E:y.indexOf(T),F&&(I=new F).init(T,Y||x,e,G,y)!==!1&&(e._pt=A=new Et(e._pt,T,I.name,0,1,I.render,I,0,I.priority),I._props.forEach(function(B){D[B]=A}),I.priority&&(R=1)),!F||Y)for(L in x)Lt[L]&&(I=No(L,x,e,G,T,y))?I.priority&&(R=1):D[L]=A=rs.call(e,T,L,"get",x[L],G,y,0,r.stringFilter);e._op&&e._op[E]&&e.kill(T,e._op[E]),_&&e._pt&&(Ri=e,$e.killTweensOf(T,D,e.globalTime(t)),z=!e.parent,Ri=0),e._pt&&a&&(Lr[C.id]=1)}R&&Ho(e),e._onInit&&e._onInit(e)}e._onUpdate=h,e._initted=(!e._op||e._pt)&&!z,u&&t<=0&&w.render(Xt,!0,!0)},Fl=function(e,t,n,r,s,i,o,a){var h=(e._pt&&e._ptCache||(e._ptCache={}))[t],l,c,u,d;if(!h)for(h=e._ptCache[t]=[],u=e._ptLookup,d=e._targets.length;d--;){if(l=u[d][t],l&&l.d&&l.d._pt)for(l=l.d._pt;l&&l.p!==t&&l.fp!==t;)l=l._next;if(!l)return Or=1,e.vars[t]="+=0",ss(e,o),Or=0,a?Fn(t+" not eligible for reset"):1;h.push(l)}for(d=h.length;d--;)c=h[d],l=c._pt||c,l.s=(r||r===0)&&!s?r:l.s+(r||0)+i*l.c,l.c=n-l.s,c.e&&(c.e=Qe(n)+at(c.e)),c.b&&(c.b=l.s+at(c.b))},Il=function(e,t){var n=e[0]?Ji(e[0]).harness:0,r=n&&n.aliases,s,i,o,a;if(!r)return t;s=sn({},t);for(i in r)if(i in s)for(a=r[i].split(","),o=a.length;o--;)s[a[o]]=s[i];return s},kl=function(e,t,n,r){var s=t.ease||r||"power1.inOut",i,o;if(ct(t))o=n[e]||(n[e]=[]),t.forEach(function(a,h){return o.push({t:h/(t.length-1)*100,v:a,e:s})});else for(i in t)o=n[i]||(n[i]=[]),i==="ease"||o.push({t:parseFloat(e),v:t[i],e:s})},Bn=function(e,t,n,r,s){return je(e)?e.call(t,n,r,s):nt(e)&&~e.indexOf("random(")?kn(e):e},Oo=is+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",Vo={};Tt(Oo+",id,stagger,delay,duration,paused,scrollTrigger",function(g){return Vo[g]=1});var Ze=function(g){io(e,g);function e(n,r,s,i){var o;typeof r=="number"&&(s.duration=r,r=s,s=null),o=g.call(this,i?r:Rn(r))||this;var a=o.vars,h=a.duration,l=a.delay,c=a.immediateRender,u=a.stagger,d=a.overwrite,p=a.keyframes,f=a.defaults,v=a.scrollTrigger,m=a.yoyoEase,y=r.parent||$e,_=(ct(n)||ro(n)?wi(n[0]):"length"in r)?[n]:Yt(n),w,x,E,L,A,T,R,C;if(o._targets=_.length?ns(_):Fn("GSAP target "+n+" not found. https://gsap.com",!Nt.nullTargetWarn)||[],o._ptLookup=[],o._overwrite=d,p||u||$n(h)||$n(l)){if(r=o.vars,w=o.timeline=new ft({data:"nested",defaults:f||{},targets:y&&y.data==="nested"?y.vars.targets:_}),w.kill(),w.parent=w._dp=vi(o),w._start=0,u||$n(h)||$n(l)){if(L=_.length,R=u&&bo(u),li(u))for(A in u)~Oo.indexOf(A)&&(C||(C={}),C[A]=u[A]);for(x=0;x<L;x++)E=ir(r,Vo),E.stagger=0,m&&(E.yoyoEase=m),C&&sn(E,C),T=_[x],E.duration=+Bn(h,vi(o),x,T,_),E.delay=(+Bn(l,vi(o),x,T,_)||0)-o._delay,!u&&L===1&&E.delay&&(o._delay=l=E.delay,o._start+=l,E.delay=0),w.to(T,E,R?R(x,T,_):0),w._ease=Me.none;w.duration()?h=l=0:o.timeline=0}else if(p){Rn(jt(w.vars.defaults,{ease:"none"})),w._ease=tn(p.ease||r.ease||"none");var F=0,I,D,G;if(ct(p))p.forEach(function(Y){return w.to(_,Y,">")}),w.duration();else{E={};for(A in p)A==="ease"||A==="easeEach"||kl(A,p[A],E,p.easeEach);for(A in E)for(I=E[A].sort(function(Y,z){return Y.t-z.t}),F=0,x=0;x<I.length;x++)D=I[x],G={ease:D.e,duration:(D.t-(x?I[x-1].t:0))/100*h},G[A]=D.v,w.to(_,G,F),F+=G.duration;w.duration()<h&&w.to({},{duration:h-w.duration()})}}h||o.duration(h=w.duration())}else o.timeline=0;return d===!0&&!Kr&&(Ri=vi(o),$e.killTweensOf(_),Ri=0),ri(y,vi(o),s),r.reversed&&o.reverse(),r.paused&&o.paused(!0),(c||!h&&!p&&o._start===it(y._time)&&bt(c)&&dl(vi(o))&&y.data!=="nested")&&(o._tTime=-We,o.render(Math.max(0,-l)||0)),v&&wo(vi(o),v),o}var t=e.prototype;return t.render=function(r,s,i){var o=this._time,a=this._tDur,h=this._dur,l=r<0,c=r>a-We&&!l?a:r<We?0:r,u,d,p,f,v,m,y,_,w;if(!h)fl(this,r,s,i);else if(c!==this._tTime||!r||i||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==l){if(u=c,_=this.timeline,this._repeat){if(f=h+this._rDelay,this._repeat<-1&&l)return this.totalTime(f*100+r,s,i);if(u=it(c%f),c===a?(p=this._repeat,u=h):(p=~~(c/f),p&&p===it(c/f)&&(u=h,p--),u>h&&(u=h)),m=this._yoyo&&p&1,m&&(w=this._yEase,u=h-u),v=yn(this._tTime,f),u===o&&!i&&this._initted&&p===v)return this._tTime=c,this;p!==v&&(_&&this._yEase&&Io(_,m),this.vars.repeatRefresh&&!m&&!this._lock&&this._time!==f&&this._initted&&(this._lock=i=1,this.render(it(f*p),!0).invalidate()._lock=0))}if(!this._initted){if(_o(this,l?r:u,i,s,c))return this._tTime=0,this;if(o!==this._time&&!(i&&this.vars.repeatRefresh&&p!==v))return this;if(h!==this._dur)return this.render(r,s,i)}if(this._tTime=c,this._time=u,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=y=(w||this._ease)(u/h),this._from&&(this.ratio=y=1-y),u&&!o&&!s&&!p&&(zt(this,"onStart"),this._tTime!==c))return this;for(d=this._pt;d;)d.r(y,d.d),d=d._next;_&&_.render(r<0?r:_._dur*_._ease(u/this._dur),s,i)||this._startAt&&(this._zTime=r),this._onUpdate&&!s&&(l&&Fr(this,r,s,i),zt(this,"onUpdate")),this._repeat&&p!==v&&this.vars.onRepeat&&!s&&this.parent&&zt(this,"onRepeat"),(c===this._tDur||!c)&&this._tTime===c&&(l&&!this._onUpdate&&Fr(this,r,!0,!0),(r||!h)&&(c===this._tDur&&this._ts>0||!c&&this._ts<0)&&Ni(this,1),!s&&!(l&&!o)&&(c||o||m)&&(zt(this,c===a?"onComplete":"onReverseComplete",!0),this._prom&&!(c<a&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(r){return(!r||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(r),g.prototype.invalidate.call(this,r)},t.resetTo=function(r,s,i,o,a){zn||It.wake(),this._ts||this.play();var h=Math.min(this._dur,(this._dp._time-this._start)*this._ts),l;return this._initted||ss(this,h),l=this._ease(h/this._dur),Fl(this,r,s,i,o,l,h,a)?this.resetTo(r,s,i,o,1):(ur(this,0),this.parent||go(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(r,s){if(s===void 0&&(s="all"),!r&&(!s||s==="all"))return this._lazy=this._pt=0,this.parent?Sn(this):this;if(this.timeline){var i=this.timeline.totalDuration();return this.timeline.killTweensOf(r,s,Ri&&Ri.vars.overwrite!==!0)._first||Sn(this),this.parent&&i!==this.timeline.totalDuration()&&wn(this,this._dur*this.timeline._tDur/i,0,1),this}var o=this._targets,a=r?Yt(r):o,h=this._ptLookup,l=this._pt,c,u,d,p,f,v,m;if((!s||s==="all")&&hl(o,a))return s==="all"&&(this._pt=0),Sn(this);for(c=this._op=this._op||[],s!=="all"&&(nt(s)&&(f={},Tt(s,function(y){return f[y]=1}),s=f),s=Il(o,s)),m=o.length;m--;)if(~a.indexOf(o[m])){u=h[m],s==="all"?(c[m]=s,p=u,d={}):(d=c[m]=c[m]||{},p=s);for(f in p)v=u&&u[f],v&&((!("kill"in v.d)||v.d.kill(f)===!0)&&cr(this,v,"_pt"),delete u[f]),d!=="all"&&(d[f]=1)}return this._initted&&!this._pt&&l&&Sn(this),this},e.to=function(r,s){return new e(r,s,arguments[2])},e.from=function(r,s){return Pn(1,arguments)},e.delayedCall=function(r,s,i,o){return new e(s,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:r,onComplete:s,onReverseComplete:s,onCompleteParams:i,onReverseCompleteParams:i,callbackScope:o})},e.fromTo=function(r,s,i){return Pn(2,arguments)},e.set=function(r,s){return s.duration=0,s.repeatDelay||(s.repeat=0),new e(r,s)},e.killTweensOf=function(r,s,i){return $e.killTweensOf(r,s,i)},e}(Nn);jt(Ze.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Tt("staggerTo,staggerFrom,staggerFromTo",function(g){Ze[g]=function(){var e=new ft,t=kr.call(arguments,0);return t.splice(g==="staggerFromTo"?5:4,0,0),e[g].apply(e,t)}});var os=function(e,t,n){return e[t]=n},Do=function(e,t,n){return e[t](n)},zl=function(e,t,n,r){return e[t](r.fp,n)},Nl=function(e,t,n){return e.setAttribute(t,n)},as=function(e,t){return je(e[t])?Do:Qr(e[t])&&e.setAttribute?Nl:os},Wo=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},Ol=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},Go=function(e,t){var n=t._pt,r="";if(!e&&t.b)r=t.b;else if(e===1&&t.e)r=t.e;else{for(;n;)r=n.p+(n.m?n.m(n.s+n.c*e):Math.round((n.s+n.c*e)*1e4)/1e4)+r,n=n._next;r+=t.c}t.set(t.t,t.p,r,t)},ls=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},Vl=function(e,t,n,r){for(var s=this._pt,i;s;)i=s._next,s.p===r&&s.modifier(e,t,n),s=i},Dl=function(e){for(var t=this._pt,n,r;t;)r=t._next,t.p===e&&!t.op||t.op===e?cr(this,t,"_pt"):t.dep||(n=1),t=r;return!n},Wl=function(e,t,n,r){r.mSet(e,t,r.m.call(r.tween,n,r.mt),r)},Ho=function(e){for(var t=e._pt,n,r,s,i;t;){for(n=t._next,r=s;r&&r.pr>t.pr;)r=r._next;(t._prev=r?r._prev:i)?t._prev._next=t:s=t,(t._next=r)?r._prev=t:i=t,t=n}e._pt=s},Et=function(){function g(t,n,r,s,i,o,a,h,l){this.t=n,this.s=s,this.c=i,this.p=r,this.r=o||Wo,this.d=a||this,this.set=h||os,this.pr=l||0,this._next=t,t&&(t._prev=this)}var e=g.prototype;return e.modifier=function(n,r,s){this.mSet=this.mSet||this.set,this.set=Wl,this.m=n,this.mt=s,this.tween=r},g}();Tt(is+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(g){return ts[g]=1});Ot.TweenMax=Ot.TweenLite=Ze;Ot.TimelineLite=Ot.TimelineMax=ft;$e=new ft({sortChildren:!1,defaults:gn,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});Nt.stringFilter=Lo;var nn=[],Qn={},Gl=[],Es=0,Hl=0,wr=function(e){return(Qn[e]||Gl).map(function(t){return t()})},Vr=function(){var e=Date.now(),t=[];e-Es>2&&(wr("matchMediaInit"),nn.forEach(function(n){var r=n.queries,s=n.conditions,i,o,a,h;for(o in r)i=ni.matchMedia(r[o]).matches,i&&(a=1),i!==s[o]&&(s[o]=i,h=1);h&&(n.revert(),a&&t.push(n))}),wr("matchMediaRevert"),t.forEach(function(n){return n.onMatch(n,function(r){return n.add(null,r)})}),Es=e,wr("matchMedia"))},Uo=function(){function g(t,n){this.selector=n&&zr(n),this.data=[],this._r=[],this.isReverted=!1,this.id=Hl++,t&&this.add(t)}var e=g.prototype;return e.add=function(n,r,s){je(n)&&(s=r,r=n,n=je);var i=this,o=function(){var h=qe,l=i.selector,c;return h&&h!==i&&h.data.push(i),s&&(i.selector=zr(s)),qe=i,c=r.apply(i,arguments),je(c)&&i._r.push(c),qe=h,i.selector=l,i.isReverted=!1,c};return i.last=o,n===je?o(i,function(a){return i.add(null,a)}):n?i[n]=o:o},e.ignore=function(n){var r=qe;qe=null,n(this),qe=r},e.getTweens=function(){var n=[];return this.data.forEach(function(r){return r instanceof g?n.push.apply(n,r.getTweens()):r instanceof Ze&&!(r.parent&&r.parent.data==="nested")&&n.push(r)}),n},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(n,r){var s=this;if(n?function(){for(var o=s.getTweens(),a=s.data.length,h;a--;)h=s.data[a],h.data==="isFlip"&&(h.revert(),h.getChildren(!0,!0,!1).forEach(function(l){return o.splice(o.indexOf(l),1)}));for(o.map(function(l){return{g:l._dur||l._delay||l._sat&&!l._sat.vars.immediateRender?l.globalTime(0):-1/0,t:l}}).sort(function(l,c){return c.g-l.g||-1/0}).forEach(function(l){return l.t.revert(n)}),a=s.data.length;a--;)h=s.data[a],h instanceof ft?h.data!=="nested"&&(h.scrollTrigger&&h.scrollTrigger.revert(),h.kill()):!(h instanceof Ze)&&h.revert&&h.revert(n);s._r.forEach(function(l){return l(n,s)}),s.isReverted=!0}():this.data.forEach(function(o){return o.kill&&o.kill()}),this.clear(),r)for(var i=nn.length;i--;)nn[i].id===this.id&&nn.splice(i,1)},e.revert=function(n){this.kill(n||{})},g}(),Ul=function(){function g(t){this.contexts=[],this.scope=t,qe&&qe.data.push(this)}var e=g.prototype;return e.add=function(n,r,s){li(n)||(n={matches:n});var i=new Uo(0,s||this.scope),o=i.conditions={},a,h,l;qe&&!i.selector&&(i.selector=qe.selector),this.contexts.push(i),r=i.add("onMatch",r),i.queries=n;for(h in n)h==="all"?l=1:(a=ni.matchMedia(n[h]),a&&(nn.indexOf(i)<0&&nn.push(i),(o[h]=a.matches)&&(l=1),a.addListener?a.addListener(Vr):a.addEventListener("change",Vr)));return l&&r(i,function(c){return i.add(null,c)}),this},e.revert=function(n){this.kill(n||{})},e.kill=function(n){this.contexts.forEach(function(r){return r.kill(n,!0)})},g}(),rr={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(r){return Ro(r)})},timeline:function(e){return new ft(e)},getTweensOf:function(e,t){return $e.getTweensOf(e,t)},getProperty:function(e,t,n,r){nt(e)&&(e=Yt(e)[0]);var s=Ji(e||{}).get,i=n?mo:vo;return n==="native"&&(n=""),e&&(t?i((Lt[t]&&Lt[t].get||s)(e,t,n,r)):function(o,a,h){return i((Lt[o]&&Lt[o].get||s)(e,o,a,h))})},quickSetter:function(e,t,n){if(e=Yt(e),e.length>1){var r=e.map(function(l){return Ct.quickSetter(l,t,n)}),s=r.length;return function(l){for(var c=s;c--;)r[c](l)}}e=e[0]||{};var i=Lt[t],o=Ji(e),a=o.harness&&(o.harness.aliases||{})[t]||t,h=i?function(l){var c=new i;dn._pt=0,c.init(e,n?l+n:l,dn,0,[e]),c.render(1,c),dn._pt&&ls(1,dn)}:o.set(e,a);return i?h:function(l){return h(e,a,n?l+n:l,o,1)}},quickTo:function(e,t,n){var r,s=Ct.to(e,sn((r={},r[t]="+=0.1",r.paused=!0,r),n||{})),i=function(a,h,l){return s.resetTo(t,a,h,l)};return i.tween=s,i},isTweening:function(e){return $e.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=tn(e.ease,gn.ease)),_s(gn,e||{})},config:function(e){return _s(Nt,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,r=e.plugins,s=e.defaults,i=e.extendTimeline;(r||"").split(",").forEach(function(o){return o&&!Lt[o]&&!Ot[o]&&Fn(t+" effect requires "+o+" plugin.")}),vr[t]=function(o,a,h){return n(Yt(o),jt(a||{},s),h)},i&&(ft.prototype[t]=function(o,a,h){return this.add(vr[t](o,li(a)?a:(h=a)&&{},this),h)})},registerEase:function(e,t){Me[e]=tn(t)},parseEase:function(e,t){return arguments.length?tn(e,t):Me},getById:function(e){return $e.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var n=new ft(e),r,s;for(n.smoothChildTiming=bt(e.smoothChildTiming),$e.remove(n),n._dp=0,n._time=n._tTime=$e._time,r=$e._first;r;)s=r._next,(t||!(!r._dur&&r instanceof Ze&&r.vars.onComplete===r._targets[0]))&&ri(n,r,r._start-r._delay),r=s;return ri($e,n,0),n},context:function(e,t){return e?new Uo(e,t):qe},matchMedia:function(e){return new Ul(e)},matchMediaRefresh:function(){return nn.forEach(function(e){var t=e.conditions,n,r;for(r in t)t[r]&&(t[r]=!1,n=1);n&&e.revert()})||Vr()},addEventListener:function(e,t){var n=Qn[e]||(Qn[e]=[]);~n.indexOf(t)||n.push(t)},removeEventListener:function(e,t){var n=Qn[e],r=n&&n.indexOf(t);r>=0&&n.splice(r,1)},utils:{wrap:Al,wrapYoyo:bl,distribute:bo,random:Eo,snap:To,normalize:xl,getUnit:at,clamp:gl,splitColor:Po,toArray:Yt,selector:zr,mapRange:Co,pipe:wl,unitize:_l,interpolate:Tl,shuffle:Ao},install:co,effects:vr,ticker:It,updateRoot:ft.updateRoot,plugins:Lt,globalTimeline:$e,core:{PropTween:Et,globals:ho,Tween:Ze,Timeline:ft,Animation:Nn,getCache:Ji,_removeLinkedListItem:cr,reverting:function(){return lt},context:function(e){return e&&qe&&(qe.data.push(e),e._ctx=qe),qe},suppressOverwrites:function(e){return Kr=e}}};Tt("to,from,fromTo,delayedCall,set,killTweensOf",function(g){return rr[g]=Ze[g]});It.add(ft.updateRoot);dn=rr.to({},{duration:0});var ql=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},$l=function(e,t){var n=e._targets,r,s,i;for(r in t)for(s=n.length;s--;)i=e._ptLookup[s][r],i&&(i=i.d)&&(i._pt&&(i=ql(i,r)),i&&i.modifier&&i.modifier(t[r],e,n[s],r))},_r=function(e,t){return{name:e,rawVars:1,init:function(r,s,i){i._onInit=function(o){var a,h;if(nt(s)&&(a={},Tt(s,function(l){return a[l]=1}),s=a),t){a={};for(h in s)a[h]=t(s[h]);s=a}$l(o,s)}}}},Ct=rr.registerPlugin({name:"attr",init:function(e,t,n,r,s){var i,o,a;this.tween=n;for(i in t)a=e.getAttribute(i)||"",o=this.add(e,"setAttribute",(a||0)+"",t[i],r,s,0,0,i),o.op=i,o.b=a,this._props.push(i)},render:function(e,t){for(var n=t._pt;n;)lt?n.set(n.t,n.p,n.b,n):n.r(e,n.d),n=n._next}},{name:"endArray",init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n],0,0,0,0,0,1)}},_r("roundProps",Nr),_r("modifiers"),_r("snap",To))||rr;Ze.version=ft.version=Ct.version="3.12.5";lo=1;Zr()&&_n();Me.Power0;Me.Power1;Me.Power2;Me.Power3;Me.Power4;Me.Linear;Me.Quad;Me.Cubic;Me.Quart;Me.Quint;Me.Strong;Me.Elastic;Me.Back;Me.SteppedEase;Me.Bounce;Me.Sine;Me.Expo;Me.Circ;/*!
 * CSSPlugin 3.12.5
 * https://gsap.com
 *
 * Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Ss,Pi,fn,cs,Qi,Cs,hs,Xl=function(){return typeof window<"u"},_i={},ji=180/Math.PI,vn=Math.PI/180,hn=Math.atan2,Ms=1e8,us=/([A-Z])/g,Yl=/(left|right|width|margin|padding|x)/i,jl=/[\s,\(]\S/,si={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},Dr=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},Kl=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},Ql=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},Zl=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},qo=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},$o=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},Jl=function(e,t,n){return e.style[t]=n},ec=function(e,t,n){return e.style.setProperty(t,n)},tc=function(e,t,n){return e._gsap[t]=n},ic=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},nc=function(e,t,n,r,s){var i=e._gsap;i.scaleX=i.scaleY=n,i.renderTransform(s,i)},rc=function(e,t,n,r,s){var i=e._gsap;i[t]=n,i.renderTransform(s,i)},Xe="transform",St=Xe+"Origin",sc=function g(e,t){var n=this,r=this.target,s=r.style,i=r._gsap;if(e in _i&&s){if(this.tfm=this.tfm||{},e!=="transform")e=si[e]||e,~e.indexOf(",")?e.split(",").forEach(function(o){return n.tfm[o]=mi(r,o)}):this.tfm[e]=i.x?i[e]:mi(r,e),e===St&&(this.tfm.zOrigin=i.zOrigin);else return si.transform.split(",").forEach(function(o){return g.call(n,o,t)});if(this.props.indexOf(Xe)>=0)return;i.svg&&(this.svgo=r.getAttribute("data-svg-origin"),this.props.push(St,t,"")),e=Xe}(s||t)&&this.props.push(e,t,s[e])},Xo=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},oc=function(){var e=this.props,t=this.target,n=t.style,r=t._gsap,s,i;for(s=0;s<e.length;s+=3)e[s+1]?t[e[s]]=e[s+2]:e[s+2]?n[e[s]]=e[s+2]:n.removeProperty(e[s].substr(0,2)==="--"?e[s]:e[s].replace(us,"-$1").toLowerCase());if(this.tfm){for(i in this.tfm)r[i]=this.tfm[i];r.svg&&(r.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),s=hs(),(!s||!s.isStart)&&!n[Xe]&&(Xo(n),r.zOrigin&&n[St]&&(n[St]+=" "+r.zOrigin+"px",r.zOrigin=0,r.renderTransform()),r.uncache=1)}},Yo=function(e,t){var n={target:e,props:[],revert:oc,save:sc};return e._gsap||Ct.core.getCache(e),t&&t.split(",").forEach(function(r){return n.save(r)}),n},jo,Wr=function(e,t){var n=Pi.createElementNS?Pi.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):Pi.createElement(e);return n&&n.style?n:Pi.createElement(e)},oi=function g(e,t,n){var r=getComputedStyle(e);return r[t]||r.getPropertyValue(t.replace(us,"-$1").toLowerCase())||r.getPropertyValue(t)||!n&&g(e,xn(t)||t,1)||""},Rs="O,Moz,ms,Ms,Webkit".split(","),xn=function(e,t,n){var r=t||Qi,s=r.style,i=5;if(e in s&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);i--&&!(Rs[i]+e in s););return i<0?null:(i===3?"ms":i>=0?Rs[i]:"")+e},Gr=function(){Xl()&&window.document&&(Ss=window,Pi=Ss.document,fn=Pi.documentElement,Qi=Wr("div")||{style:{}},Wr("div"),Xe=xn(Xe),St=Xe+"Origin",Qi.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",jo=!!xn("perspective"),hs=Ct.core.reverting,cs=1)},xr=function g(e){var t=Wr("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),n=this.parentNode,r=this.nextSibling,s=this.style.cssText,i;if(fn.appendChild(t),t.appendChild(this),this.style.display="block",e)try{i=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=g}catch{}else this._gsapBBox&&(i=this._gsapBBox());return n&&(r?n.insertBefore(this,r):n.appendChild(this)),fn.removeChild(t),this.style.cssText=s,i},Ps=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},Ko=function(e){var t;try{t=e.getBBox()}catch{t=xr.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===xr||(t=xr.call(e,!0)),t&&!t.width&&!t.x&&!t.y?{x:+Ps(e,["x","cx","x1"])||0,y:+Ps(e,["y","cy","y1"])||0,width:0,height:0}:t},Qo=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&Ko(e))},on=function(e,t){if(t){var n=e.style,r;t in _i&&t!==St&&(t=Xe),n.removeProperty?(r=t.substr(0,2),(r==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),n.removeProperty(r==="--"?t:t.replace(us,"-$1").toLowerCase())):n.removeAttribute(t)}},Bi=function(e,t,n,r,s,i){var o=new Et(e._pt,t,n,0,1,i?$o:qo);return e._pt=o,o.b=r,o.e=s,e._props.push(n),o},Bs={deg:1,rad:1,turn:1},ac={grid:1,flex:1},Oi=function g(e,t,n,r){var s=parseFloat(n)||0,i=(n+"").trim().substr((s+"").length)||"px",o=Qi.style,a=Yl.test(t),h=e.tagName.toLowerCase()==="svg",l=(h?"client":"offset")+(a?"Width":"Height"),c=100,u=r==="px",d=r==="%",p,f,v,m;if(r===i||!s||Bs[r]||Bs[i])return s;if(i!=="px"&&!u&&(s=g(e,t,n,"px")),m=e.getCTM&&Qo(e),(d||i==="%")&&(_i[t]||~t.indexOf("adius")))return p=m?e.getBBox()[a?"width":"height"]:e[l],Qe(d?s/p*c:s/100*p);if(o[a?"width":"height"]=c+(u?i:r),f=~t.indexOf("adius")||r==="em"&&e.appendChild&&!h?e:e.parentNode,m&&(f=(e.ownerSVGElement||{}).parentNode),(!f||f===Pi||!f.appendChild)&&(f=Pi.body),v=f._gsap,v&&d&&v.width&&a&&v.time===It.time&&!v.uncache)return Qe(s/v.width*c);if(d&&(t==="height"||t==="width")){var y=e.style[t];e.style[t]=c+r,p=e[l],y?e.style[t]=y:on(e,t)}else(d||i==="%")&&!ac[oi(f,"display")]&&(o.position=oi(e,"position")),f===e&&(o.position="static"),f.appendChild(Qi),p=Qi[l],f.removeChild(Qi),o.position="absolute";return a&&d&&(v=Ji(f),v.time=It.time,v.width=f[l]),Qe(u?p*s/c:p&&s?c/p*s:0)},mi=function(e,t,n,r){var s;return cs||Gr(),t in si&&t!=="transform"&&(t=si[t],~t.indexOf(",")&&(t=t.split(",")[0])),_i[t]&&t!=="transform"?(s=Vn(e,r),s=t!=="transformOrigin"?s[t]:s.svg?s.origin:or(oi(e,St))+" "+s.zOrigin+"px"):(s=e.style[t],(!s||s==="auto"||r||~(s+"").indexOf("calc("))&&(s=sr[t]&&sr[t](e,t,n)||oi(e,t)||po(e,t)||(t==="opacity"?1:0))),n&&!~(s+"").trim().indexOf(" ")?Oi(e,t,s,n)+n:s},lc=function(e,t,n,r){if(!n||n==="none"){var s=xn(t,e,1),i=s&&oi(e,s,1);i&&i!==n?(t=s,n=i):t==="borderColor"&&(n=oi(e,"borderTopColor"))}var o=new Et(this._pt,e.style,t,0,1,Go),a=0,h=0,l,c,u,d,p,f,v,m,y,_,w,x;if(o.b=n,o.e=r,n+="",r+="",r==="auto"&&(f=e.style[t],e.style[t]=r,r=oi(e,t)||r,f?e.style[t]=f:on(e,t)),l=[n,r],Lo(l),n=l[0],r=l[1],u=n.match(un)||[],x=r.match(un)||[],x.length){for(;c=un.exec(r);)v=c[0],y=r.substring(a,c.index),p?p=(p+1)%5:(y.substr(-5)==="rgba("||y.substr(-5)==="hsla(")&&(p=1),v!==(f=u[h++]||"")&&(d=parseFloat(f)||0,w=f.substr((d+"").length),v.charAt(1)==="="&&(v=pn(d,v)+w),m=parseFloat(v),_=v.substr((m+"").length),a=un.lastIndex-_.length,_||(_=_||Nt.units[t]||w,a===r.length&&(r+=_,o.e+=_)),w!==_&&(d=Oi(e,t,f,_)||0),o._pt={_next:o._pt,p:y||h===1?y:",",s:d,c:m-d,m:p&&p<4||t==="zIndex"?Math.round:0});o.c=a<r.length?r.substring(a,r.length):""}else o.r=t==="display"&&r==="none"?$o:qo;return oo.test(r)&&(o.e=0),this._pt=o,o},Ls={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},cc=function(e){var t=e.split(" "),n=t[0],r=t[1]||"50%";return(n==="top"||n==="bottom"||r==="left"||r==="right")&&(e=n,n=r,r=e),t[0]=Ls[n]||n,t[1]=Ls[r]||r,t.join(" ")},hc=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n=t.t,r=n.style,s=t.u,i=n._gsap,o,a,h;if(s==="all"||s===!0)r.cssText="",a=1;else for(s=s.split(","),h=s.length;--h>-1;)o=s[h],_i[o]&&(a=1,o=o==="transformOrigin"?St:Xe),on(n,o);a&&(on(n,Xe),i&&(i.svg&&n.removeAttribute("transform"),Vn(n,1),i.uncache=1,Xo(r)))}},sr={clearProps:function(e,t,n,r,s){if(s.data!=="isFromStart"){var i=e._pt=new Et(e._pt,t,n,0,0,hc);return i.u=r,i.pr=-10,i.tween=s,e._props.push(n),1}}},On=[1,0,0,1,0,0],Zo={},Jo=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},Fs=function(e){var t=oi(e,Xe);return Jo(t)?On:t.substr(7).match(so).map(Qe)},ds=function(e,t){var n=e._gsap||Ji(e),r=e.style,s=Fs(e),i,o,a,h;return n.svg&&e.getAttribute("transform")?(a=e.transform.baseVal.consolidate().matrix,s=[a.a,a.b,a.c,a.d,a.e,a.f],s.join(",")==="1,0,0,1,0,0"?On:s):(s===On&&!e.offsetParent&&e!==fn&&!n.svg&&(a=r.display,r.display="block",i=e.parentNode,(!i||!e.offsetParent)&&(h=1,o=e.nextElementSibling,fn.appendChild(e)),s=Fs(e),a?r.display=a:on(e,"display"),h&&(o?i.insertBefore(e,o):i?i.appendChild(e):fn.removeChild(e))),t&&s.length>6?[s[0],s[1],s[4],s[5],s[12],s[13]]:s)},Hr=function(e,t,n,r,s,i){var o=e._gsap,a=s||ds(e,!0),h=o.xOrigin||0,l=o.yOrigin||0,c=o.xOffset||0,u=o.yOffset||0,d=a[0],p=a[1],f=a[2],v=a[3],m=a[4],y=a[5],_=t.split(" "),w=parseFloat(_[0])||0,x=parseFloat(_[1])||0,E,L,A,T;n?a!==On&&(L=d*v-p*f)&&(A=w*(v/L)+x*(-f/L)+(f*y-v*m)/L,T=w*(-p/L)+x*(d/L)-(d*y-p*m)/L,w=A,x=T):(E=Ko(e),w=E.x+(~_[0].indexOf("%")?w/100*E.width:w),x=E.y+(~(_[1]||_[0]).indexOf("%")?x/100*E.height:x)),r||r!==!1&&o.smooth?(m=w-h,y=x-l,o.xOffset=c+(m*d+y*f)-m,o.yOffset=u+(m*p+y*v)-y):o.xOffset=o.yOffset=0,o.xOrigin=w,o.yOrigin=x,o.smooth=!!r,o.origin=t,o.originIsAbsolute=!!n,e.style[St]="0px 0px",i&&(Bi(i,o,"xOrigin",h,w),Bi(i,o,"yOrigin",l,x),Bi(i,o,"xOffset",c,o.xOffset),Bi(i,o,"yOffset",u,o.yOffset)),e.setAttribute("data-svg-origin",w+" "+x)},Vn=function(e,t){var n=e._gsap||new zo(e);if("x"in n&&!t&&!n.uncache)return n;var r=e.style,s=n.scaleX<0,i="px",o="deg",a=getComputedStyle(e),h=oi(e,St)||"0",l,c,u,d,p,f,v,m,y,_,w,x,E,L,A,T,R,C,F,I,D,G,Y,z,B,H,W,P,k,M,S,b;return l=c=u=f=v=m=y=_=w=0,d=p=1,n.svg=!!(e.getCTM&&Qo(e)),a.translate&&((a.translate!=="none"||a.scale!=="none"||a.rotate!=="none")&&(r[Xe]=(a.translate!=="none"?"translate3d("+(a.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(a.rotate!=="none"?"rotate("+a.rotate+") ":"")+(a.scale!=="none"?"scale("+a.scale.split(" ").join(",")+") ":"")+(a[Xe]!=="none"?a[Xe]:"")),r.scale=r.rotate=r.translate="none"),L=ds(e,n.svg),n.svg&&(n.uncache?(B=e.getBBox(),h=n.xOrigin-B.x+"px "+(n.yOrigin-B.y)+"px",z=""):z=!t&&e.getAttribute("data-svg-origin"),Hr(e,z||h,!!z||n.originIsAbsolute,n.smooth!==!1,L)),x=n.xOrigin||0,E=n.yOrigin||0,L!==On&&(C=L[0],F=L[1],I=L[2],D=L[3],l=G=L[4],c=Y=L[5],L.length===6?(d=Math.sqrt(C*C+F*F),p=Math.sqrt(D*D+I*I),f=C||F?hn(F,C)*ji:0,y=I||D?hn(I,D)*ji+f:0,y&&(p*=Math.abs(Math.cos(y*vn))),n.svg&&(l-=x-(x*C+E*I),c-=E-(x*F+E*D))):(b=L[6],M=L[7],W=L[8],P=L[9],k=L[10],S=L[11],l=L[12],c=L[13],u=L[14],A=hn(b,k),v=A*ji,A&&(T=Math.cos(-A),R=Math.sin(-A),z=G*T+W*R,B=Y*T+P*R,H=b*T+k*R,W=G*-R+W*T,P=Y*-R+P*T,k=b*-R+k*T,S=M*-R+S*T,G=z,Y=B,b=H),A=hn(-I,k),m=A*ji,A&&(T=Math.cos(-A),R=Math.sin(-A),z=C*T-W*R,B=F*T-P*R,H=I*T-k*R,S=D*R+S*T,C=z,F=B,I=H),A=hn(F,C),f=A*ji,A&&(T=Math.cos(A),R=Math.sin(A),z=C*T+F*R,B=G*T+Y*R,F=F*T-C*R,Y=Y*T-G*R,C=z,G=B),v&&Math.abs(v)+Math.abs(f)>359.9&&(v=f=0,m=180-m),d=Qe(Math.sqrt(C*C+F*F+I*I)),p=Qe(Math.sqrt(Y*Y+b*b)),A=hn(G,Y),y=Math.abs(A)>2e-4?A*ji:0,w=S?1/(S<0?-S:S):0),n.svg&&(z=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!Jo(oi(e,Xe)),z&&e.setAttribute("transform",z))),Math.abs(y)>90&&Math.abs(y)<270&&(s?(d*=-1,y+=f<=0?180:-180,f+=f<=0?180:-180):(p*=-1,y+=y<=0?180:-180)),t=t||n.uncache,n.x=l-((n.xPercent=l&&(!t&&n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-l)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+i,n.y=c-((n.yPercent=c&&(!t&&n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-c)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+i,n.z=u+i,n.scaleX=Qe(d),n.scaleY=Qe(p),n.rotation=Qe(f)+o,n.rotationX=Qe(v)+o,n.rotationY=Qe(m)+o,n.skewX=y+o,n.skewY=_+o,n.transformPerspective=w+i,(n.zOrigin=parseFloat(h.split(" ")[2])||!t&&n.zOrigin||0)&&(r[St]=or(h)),n.xOffset=n.yOffset=0,n.force3D=Nt.force3D,n.renderTransform=n.svg?dc:jo?ea:uc,n.uncache=0,n},or=function(e){return(e=e.split(" "))[0]+" "+e[1]},Ar=function(e,t,n){var r=at(t);return Qe(parseFloat(t)+parseFloat(Oi(e,"x",n+"px",r)))+r},uc=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,ea(e,t)},$i="0deg",Tn="0px",Xi=") ",ea=function(e,t){var n=t||this,r=n.xPercent,s=n.yPercent,i=n.x,o=n.y,a=n.z,h=n.rotation,l=n.rotationY,c=n.rotationX,u=n.skewX,d=n.skewY,p=n.scaleX,f=n.scaleY,v=n.transformPerspective,m=n.force3D,y=n.target,_=n.zOrigin,w="",x=m==="auto"&&e&&e!==1||m===!0;if(_&&(c!==$i||l!==$i)){var E=parseFloat(l)*vn,L=Math.sin(E),A=Math.cos(E),T;E=parseFloat(c)*vn,T=Math.cos(E),i=Ar(y,i,L*T*-_),o=Ar(y,o,-Math.sin(E)*-_),a=Ar(y,a,A*T*-_+_)}v!==Tn&&(w+="perspective("+v+Xi),(r||s)&&(w+="translate("+r+"%, "+s+"%) "),(x||i!==Tn||o!==Tn||a!==Tn)&&(w+=a!==Tn||x?"translate3d("+i+", "+o+", "+a+") ":"translate("+i+", "+o+Xi),h!==$i&&(w+="rotate("+h+Xi),l!==$i&&(w+="rotateY("+l+Xi),c!==$i&&(w+="rotateX("+c+Xi),(u!==$i||d!==$i)&&(w+="skew("+u+", "+d+Xi),(p!==1||f!==1)&&(w+="scale("+p+", "+f+Xi),y.style[Xe]=w||"translate(0, 0)"},dc=function(e,t){var n=t||this,r=n.xPercent,s=n.yPercent,i=n.x,o=n.y,a=n.rotation,h=n.skewX,l=n.skewY,c=n.scaleX,u=n.scaleY,d=n.target,p=n.xOrigin,f=n.yOrigin,v=n.xOffset,m=n.yOffset,y=n.forceCSS,_=parseFloat(i),w=parseFloat(o),x,E,L,A,T;a=parseFloat(a),h=parseFloat(h),l=parseFloat(l),l&&(l=parseFloat(l),h+=l,a+=l),a||h?(a*=vn,h*=vn,x=Math.cos(a)*c,E=Math.sin(a)*c,L=Math.sin(a-h)*-u,A=Math.cos(a-h)*u,h&&(l*=vn,T=Math.tan(h-l),T=Math.sqrt(1+T*T),L*=T,A*=T,l&&(T=Math.tan(l),T=Math.sqrt(1+T*T),x*=T,E*=T)),x=Qe(x),E=Qe(E),L=Qe(L),A=Qe(A)):(x=c,A=u,E=L=0),(_&&!~(i+"").indexOf("px")||w&&!~(o+"").indexOf("px"))&&(_=Oi(d,"x",i,"px"),w=Oi(d,"y",o,"px")),(p||f||v||m)&&(_=Qe(_+p-(p*x+f*L)+v),w=Qe(w+f-(p*E+f*A)+m)),(r||s)&&(T=d.getBBox(),_=Qe(_+r/100*T.width),w=Qe(w+s/100*T.height)),T="matrix("+x+","+E+","+L+","+A+","+_+","+w+")",d.setAttribute("transform",T),y&&(d.style[Xe]=T)},pc=function(e,t,n,r,s){var i=360,o=nt(s),a=parseFloat(s)*(o&&~s.indexOf("rad")?ji:1),h=a-r,l=r+h+"deg",c,u;return o&&(c=s.split("_")[1],c==="short"&&(h%=i,h!==h%(i/2)&&(h+=h<0?i:-i)),c==="cw"&&h<0?h=(h+i*Ms)%i-~~(h/i)*i:c==="ccw"&&h>0&&(h=(h-i*Ms)%i-~~(h/i)*i)),e._pt=u=new Et(e._pt,t,n,r,h,Kl),u.e=l,u.u="deg",e._props.push(n),u},Is=function(e,t){for(var n in t)e[n]=t[n];return e},fc=function(e,t,n){var r=Is({},n._gsap),s="perspective,force3D,transformOrigin,svgOrigin",i=n.style,o,a,h,l,c,u,d,p;r.svg?(h=n.getAttribute("transform"),n.setAttribute("transform",""),i[Xe]=t,o=Vn(n,1),on(n,Xe),n.setAttribute("transform",h)):(h=getComputedStyle(n)[Xe],i[Xe]=t,o=Vn(n,1),i[Xe]=h);for(a in _i)h=r[a],l=o[a],h!==l&&s.indexOf(a)<0&&(d=at(h),p=at(l),c=d!==p?Oi(n,a,h,p):parseFloat(h),u=parseFloat(l),e._pt=new Et(e._pt,o,a,c,u-c,Dr),e._pt.u=p||0,e._props.push(a));Is(o,r)};Tt("padding,margin,Width,Radius",function(g,e){var t="Top",n="Right",r="Bottom",s="Left",i=(e<3?[t,n,r,s]:[t+s,t+n,r+n,r+s]).map(function(o){return e<2?g+o:"border"+o+g});sr[e>1?"border"+g:g]=function(o,a,h,l,c){var u,d;if(arguments.length<4)return u=i.map(function(p){return mi(o,p,h)}),d=u.join(" "),d.split(u[0]).length===5?u[0]:d;u=(l+"").split(" "),d={},i.forEach(function(p,f){return d[p]=u[f]=u[f]||u[(f-1)/2|0]}),o.init(a,d,c)}});var ta={name:"css",register:Gr,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,r,s){var i=this._props,o=e.style,a=n.vars.startAt,h,l,c,u,d,p,f,v,m,y,_,w,x,E,L,A;cs||Gr(),this.styles=this.styles||Yo(e),A=this.styles.props,this.tween=n;for(f in t)if(f!=="autoRound"&&(l=t[f],!(Lt[f]&&No(f,t,n,r,e,s)))){if(d=typeof l,p=sr[f],d==="function"&&(l=l.call(n,r,e,s),d=typeof l),d==="string"&&~l.indexOf("random(")&&(l=kn(l)),p)p(this,e,f,l,n)&&(L=1);else if(f.substr(0,2)==="--")h=(getComputedStyle(e).getPropertyValue(f)+"").trim(),l+="",Ii.lastIndex=0,Ii.test(h)||(v=at(h),m=at(l)),m?v!==m&&(h=Oi(e,f,h,m)+m):v&&(l+=v),this.add(o,"setProperty",h,l,r,s,0,0,f),i.push(f),A.push(f,0,o[f]);else if(d!=="undefined"){if(a&&f in a?(h=typeof a[f]=="function"?a[f].call(n,r,e,s):a[f],nt(h)&&~h.indexOf("random(")&&(h=kn(h)),at(h+"")||h==="auto"||(h+=Nt.units[f]||at(mi(e,f))||""),(h+"").charAt(1)==="="&&(h=mi(e,f))):h=mi(e,f),u=parseFloat(h),y=d==="string"&&l.charAt(1)==="="&&l.substr(0,2),y&&(l=l.substr(2)),c=parseFloat(l),f in si&&(f==="autoAlpha"&&(u===1&&mi(e,"visibility")==="hidden"&&c&&(u=0),A.push("visibility",0,o.visibility),Bi(this,o,"visibility",u?"inherit":"hidden",c?"inherit":"hidden",!c)),f!=="scale"&&f!=="transform"&&(f=si[f],~f.indexOf(",")&&(f=f.split(",")[0]))),_=f in _i,_){if(this.styles.save(f),w||(x=e._gsap,x.renderTransform&&!t.parseTransform||Vn(e,t.parseTransform),E=t.smoothOrigin!==!1&&x.smooth,w=this._pt=new Et(this._pt,o,Xe,0,1,x.renderTransform,x,0,-1),w.dep=1),f==="scale")this._pt=new Et(this._pt,x,"scaleY",x.scaleY,(y?pn(x.scaleY,y+c):c)-x.scaleY||0,Dr),this._pt.u=0,i.push("scaleY",f),f+="X";else if(f==="transformOrigin"){A.push(St,0,o[St]),l=cc(l),x.svg?Hr(e,l,0,E,0,this):(m=parseFloat(l.split(" ")[2])||0,m!==x.zOrigin&&Bi(this,x,"zOrigin",x.zOrigin,m),Bi(this,o,f,or(h),or(l)));continue}else if(f==="svgOrigin"){Hr(e,l,1,E,0,this);continue}else if(f in Zo){pc(this,x,f,u,y?pn(u,y+l):l);continue}else if(f==="smoothOrigin"){Bi(this,x,"smooth",x.smooth,l);continue}else if(f==="force3D"){x[f]=l;continue}else if(f==="transform"){fc(this,l,e);continue}}else f in o||(f=xn(f)||f);if(_||(c||c===0)&&(u||u===0)&&!jl.test(l)&&f in o)v=(h+"").substr((u+"").length),c||(c=0),m=at(l)||(f in Nt.units?Nt.units[f]:v),v!==m&&(u=Oi(e,f,h,m)),this._pt=new Et(this._pt,_?x:o,f,u,(y?pn(u,y+c):c)-u,!_&&(m==="px"||f==="zIndex")&&t.autoRound!==!1?Zl:Dr),this._pt.u=m||0,v!==m&&m!=="%"&&(this._pt.b=h,this._pt.r=Ql);else if(f in o)lc.call(this,e,f,h,y?y+l:l);else if(f in e)this.add(e,f,h||e[f],y?y+l:l,r,s);else if(f!=="parseTransform"){es(f,l);continue}_||(f in o?A.push(f,0,o[f]):A.push(f,1,h||e[f])),i.push(f)}}L&&Ho(this)},render:function(e,t){if(t.tween._time||!hs())for(var n=t._pt;n;)n.r(e,n.d),n=n._next;else t.styles.revert()},get:mi,aliases:si,getSetter:function(e,t,n){var r=si[t];return r&&r.indexOf(",")<0&&(t=r),t in _i&&t!==St&&(e._gsap.x||mi(e,"x"))?n&&Cs===n?t==="scale"?ic:tc:(Cs=n||{})&&(t==="scale"?nc:rc):e.style&&!Qr(e.style[t])?Jl:~t.indexOf("-")?ec:as(e,t)},core:{_removeProperty:on,_getMatrix:ds}};Ct.utils.checkPrefix=xn;Ct.core.getStyleSaver=Yo;(function(g,e,t,n){var r=Tt(g+","+e+","+t,function(s){_i[s]=1});Tt(e,function(s){Nt.units[s]="deg",Zo[s]=1}),si[r[13]]=g+","+e,Tt(n,function(s){var i=s.split(":");si[i[1]]=r[i[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Tt("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(g){Nt.units[g]="px"});Ct.registerPlugin(ta);var ar=Ct.registerPlugin(ta)||Ct;ar.core.Tween;/**
 * lil-gui
 * https://lil-gui.georgealways.com
 * @version 0.19.2
 * @author George Michael Brower
 * @license MIT
 */class ai{constructor(e,t,n,r,s="div"){this.parent=e,this.object=t,this.property=n,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement(s),this.domElement.classList.add("controller"),this.domElement.classList.add(r),this.$name=document.createElement("div"),this.$name.classList.add("name"),ai.nextNameID=ai.nextNameID||0,this.$name.id=`lil-gui-name-${++ai.nextNameID}`,this.$widget=document.createElement("div"),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.domElement.addEventListener("keydown",i=>i.stopPropagation()),this.domElement.addEventListener("keyup",i=>i.stopPropagation()),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(n)}name(e){return this._name=e,this.$name.textContent=e,this}onChange(e){return this._onChange=e,this}_callOnChange(){this.parent._callOnChange(this),this._onChange!==void 0&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(e){return this._onFinishChange=e,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),this._onFinishChange!==void 0&&this._onFinishChange.call(this,this.getValue())),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(e=!0){return this.disable(!e)}disable(e=!0){return e===this._disabled?this:(this._disabled=e,this.domElement.classList.toggle("disabled",e),this.$disable.toggleAttribute("disabled",e),this)}show(e=!0){return this._hidden=!e,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(e){const t=this.parent.add(this.object,this.property,e);return t.name(this._name),this.destroy(),t}min(e){return this}max(e){return this}step(e){return this}decimals(e){return this}listen(e=!0){return this._listening=e,this._listenCallbackID!==void 0&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const e=this.save();e!==this._listenPrevValue&&this.updateDisplay(),this._listenPrevValue=e}getValue(){return this.object[this.property]}setValue(e){return this.getValue()!==e&&(this.object[this.property]=e,this._callOnChange(),this.updateDisplay()),this}updateDisplay(){return this}load(e){return this.setValue(e),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class vc extends ai{constructor(e,t,n){super(e,t,n,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",()=>{this.setValue(this.$input.checked),this._callOnFinishChange()}),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function Ur(g){let e,t;return(e=g.match(/(#|0x)?([a-f0-9]{6})/i))?t=e[2]:(e=g.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?t=parseInt(e[1]).toString(16).padStart(2,0)+parseInt(e[2]).toString(16).padStart(2,0)+parseInt(e[3]).toString(16).padStart(2,0):(e=g.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(t=e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),t?"#"+t:!1}const mc={isPrimitive:!0,match:g=>typeof g=="string",fromHexString:Ur,toHexString:Ur},Dn={isPrimitive:!0,match:g=>typeof g=="number",fromHexString:g=>parseInt(g.substring(1),16),toHexString:g=>"#"+g.toString(16).padStart(6,0)},gc={isPrimitive:!1,match:g=>Array.isArray(g),fromHexString(g,e,t=1){const n=Dn.fromHexString(g);e[0]=(n>>16&255)/255*t,e[1]=(n>>8&255)/255*t,e[2]=(n&255)/255*t},toHexString([g,e,t],n=1){n=255/n;const r=g*n<<16^e*n<<8^t*n<<0;return Dn.toHexString(r)}},yc={isPrimitive:!1,match:g=>Object(g)===g,fromHexString(g,e,t=1){const n=Dn.fromHexString(g);e.r=(n>>16&255)/255*t,e.g=(n>>8&255)/255*t,e.b=(n&255)/255*t},toHexString({r:g,g:e,b:t},n=1){n=255/n;const r=g*n<<16^e*n<<8^t*n<<0;return Dn.toHexString(r)}},wc=[mc,Dn,gc,yc];function _c(g){return wc.find(e=>e.match(g))}class xc extends ai{constructor(e,t,n,r){super(e,t,n,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=_c(this.initialValue),this._rgbScale=r,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",()=>{this._setValueFromHexString(this.$input.value)}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$text.addEventListener("input",()=>{const s=Ur(this.$text.value);s&&this._setValueFromHexString(s)}),this.$text.addEventListener("focus",()=>{this._textFocused=!0,this.$text.select()}),this.$text.addEventListener("blur",()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()}),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(e){if(this._format.isPrimitive){const t=this._format.fromHexString(e);this.setValue(t)}else this._format.fromHexString(e,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(e){return this._setValueFromHexString(e),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class br extends ai{constructor(e,t,n){super(e,t,n,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",r=>{r.preventDefault(),this.getValue().call(this.object),this._callOnChange()}),this.$button.addEventListener("touchstart",()=>{},{passive:!0}),this.$disable=this.$button}}class Ac extends ai{constructor(e,t,n,r,s,i){super(e,t,n,"number"),this._initInput(),this.min(r),this.max(s);const o=i!==void 0;this.step(o?i:this._getImplicitStep(),o),this.updateDisplay()}decimals(e){return this._decimals=e,this.updateDisplay(),this}min(e){return this._min=e,this._onUpdateMinMax(),this}max(e){return this._max=e,this._onUpdateMinMax(),this}step(e,t=!0){return this._step=e,this._stepExplicit=t,this}updateDisplay(){const e=this.getValue();if(this._hasSlider){let t=(e-this._min)/(this._max-this._min);t=Math.max(0,Math.min(t,1)),this.$fill.style.width=t*100+"%"}return this._inputFocused||(this.$input.value=this._decimals===void 0?e:e.toFixed(this._decimals)),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),window.matchMedia("(pointer: coarse)").matches&&(this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any")),this.$widget.appendChild(this.$input),this.$disable=this.$input;const t=()=>{let y=parseFloat(this.$input.value);isNaN(y)||(this._stepExplicit&&(y=this._snap(y)),this.setValue(this._clamp(y)))},n=y=>{const _=parseFloat(this.$input.value);isNaN(_)||(this._snapClampSetValue(_+y),this.$input.value=this.getValue())},r=y=>{y.key==="Enter"&&this.$input.blur(),y.code==="ArrowUp"&&(y.preventDefault(),n(this._step*this._arrowKeyMultiplier(y))),y.code==="ArrowDown"&&(y.preventDefault(),n(this._step*this._arrowKeyMultiplier(y)*-1))},s=y=>{this._inputFocused&&(y.preventDefault(),n(this._step*this._normalizeMouseWheel(y)))};let i=!1,o,a,h,l,c;const u=5,d=y=>{o=y.clientX,a=h=y.clientY,i=!0,l=this.getValue(),c=0,window.addEventListener("mousemove",p),window.addEventListener("mouseup",f)},p=y=>{if(i){const _=y.clientX-o,w=y.clientY-a;Math.abs(w)>u?(y.preventDefault(),this.$input.blur(),i=!1,this._setDraggingStyle(!0,"vertical")):Math.abs(_)>u&&f()}if(!i){const _=y.clientY-h;c-=_*this._step*this._arrowKeyMultiplier(y),l+c>this._max?c=this._max-l:l+c<this._min&&(c=this._min-l),this._snapClampSetValue(l+c)}h=y.clientY},f=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",p),window.removeEventListener("mouseup",f)},v=()=>{this._inputFocused=!0},m=()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()};this.$input.addEventListener("input",t),this.$input.addEventListener("keydown",r),this.$input.addEventListener("wheel",s,{passive:!1}),this.$input.addEventListener("mousedown",d),this.$input.addEventListener("focus",v),this.$input.addEventListener("blur",m)}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const e=(m,y,_,w,x)=>(m-y)/(_-y)*(x-w)+w,t=m=>{const y=this.$slider.getBoundingClientRect();let _=e(m,y.left,y.right,this._min,this._max);this._snapClampSetValue(_)},n=m=>{this._setDraggingStyle(!0),t(m.clientX),window.addEventListener("mousemove",r),window.addEventListener("mouseup",s)},r=m=>{t(m.clientX)},s=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",s)};let i=!1,o,a;const h=m=>{m.preventDefault(),this._setDraggingStyle(!0),t(m.touches[0].clientX),i=!1},l=m=>{m.touches.length>1||(this._hasScrollBar?(o=m.touches[0].clientX,a=m.touches[0].clientY,i=!0):h(m),window.addEventListener("touchmove",c,{passive:!1}),window.addEventListener("touchend",u))},c=m=>{if(i){const y=m.touches[0].clientX-o,_=m.touches[0].clientY-a;Math.abs(y)>Math.abs(_)?h(m):(window.removeEventListener("touchmove",c),window.removeEventListener("touchend",u))}else m.preventDefault(),t(m.touches[0].clientX)},u=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",c),window.removeEventListener("touchend",u)},d=this._callOnFinishChange.bind(this),p=400;let f;const v=m=>{if(Math.abs(m.deltaX)<Math.abs(m.deltaY)&&this._hasScrollBar)return;m.preventDefault();const _=this._normalizeMouseWheel(m)*this._step;this._snapClampSetValue(this.getValue()+_),this.$input.value=this.getValue(),clearTimeout(f),f=setTimeout(d,p)};this.$slider.addEventListener("mousedown",n),this.$slider.addEventListener("touchstart",l,{passive:!1}),this.$slider.addEventListener("wheel",v,{passive:!1})}_setDraggingStyle(e,t="horizontal"){this.$slider&&this.$slider.classList.toggle("active",e),document.body.classList.toggle("lil-gui-dragging",e),document.body.classList.toggle(`lil-gui-${t}`,e)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(e){let{deltaX:t,deltaY:n}=e;return Math.floor(e.deltaY)!==e.deltaY&&e.wheelDelta&&(t=0,n=-e.wheelDelta/120,n*=this._stepExplicit?1:10),t+-n}_arrowKeyMultiplier(e){let t=this._stepExplicit?1:10;return e.shiftKey?t*=10:e.altKey&&(t/=10),t}_snap(e){const t=Math.round(e/this._step)*this._step;return parseFloat(t.toPrecision(15))}_clamp(e){return e<this._min&&(e=this._min),e>this._max&&(e=this._max),e}_snapClampSetValue(e){this.setValue(this._clamp(this._snap(e)))}get _hasScrollBar(){const e=this.parent.root.$children;return e.scrollHeight>e.clientHeight}get _hasMin(){return this._min!==void 0}get _hasMax(){return this._max!==void 0}}class bc extends ai{constructor(e,t,n,r){super(e,t,n,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$select.addEventListener("change",()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()}),this.$select.addEventListener("focus",()=>{this.$display.classList.add("focus")}),this.$select.addEventListener("blur",()=>{this.$display.classList.remove("focus")}),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.options(r)}options(e){return this._values=Array.isArray(e)?e:Object.values(e),this._names=Array.isArray(e)?e:Object.keys(e),this.$select.replaceChildren(),this._names.forEach(t=>{const n=document.createElement("option");n.textContent=t,this.$select.appendChild(n)}),this.updateDisplay(),this}updateDisplay(){const e=this.getValue(),t=this._values.indexOf(e);return this.$select.selectedIndex=t,this.$display.textContent=t===-1?e:this._names[t],this}}class Tc extends ai{constructor(e,t,n){super(e,t,n,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("spellcheck","false"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",()=>{this.setValue(this.$input.value)}),this.$input.addEventListener("keydown",r=>{r.code==="Enter"&&this.$input.blur()}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}const Ec=`.lil-gui {
  font-family: var(--font-family);
  font-size: var(--font-size);
  line-height: 1;
  font-weight: normal;
  font-style: normal;
  text-align: left;
  color: var(--text-color);
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
  --background-color: #1f1f1f;
  --text-color: #ebebeb;
  --title-background-color: #111111;
  --title-text-color: #ebebeb;
  --widget-color: #424242;
  --hover-color: #4f4f4f;
  --focus-color: #595959;
  --number-color: #2cc9ff;
  --string-color: #a2db3c;
  --font-size: 11px;
  --input-font-size: 11px;
  --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  --font-family-mono: Menlo, Monaco, Consolas, "Droid Sans Mono", monospace;
  --padding: 4px;
  --spacing: 4px;
  --widget-height: 20px;
  --title-height: calc(var(--widget-height) + var(--spacing) * 1.25);
  --name-width: 45%;
  --slider-knob-width: 2px;
  --slider-input-width: 27%;
  --color-input-width: 27%;
  --slider-input-min-width: 45px;
  --color-input-min-width: 45px;
  --folder-indent: 7px;
  --widget-padding: 0 0 0 3px;
  --widget-border-radius: 2px;
  --checkbox-size: calc(0.75 * var(--widget-height));
  --scrollbar-width: 5px;
}
.lil-gui, .lil-gui * {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
.lil-gui.root {
  width: var(--width, 245px);
  display: flex;
  flex-direction: column;
  background: var(--background-color);
}
.lil-gui.root > .title {
  background: var(--title-background-color);
  color: var(--title-text-color);
}
.lil-gui.root > .children {
  overflow-x: hidden;
  overflow-y: auto;
}
.lil-gui.root > .children::-webkit-scrollbar {
  width: var(--scrollbar-width);
  height: var(--scrollbar-width);
  background: var(--background-color);
}
.lil-gui.root > .children::-webkit-scrollbar-thumb {
  border-radius: var(--scrollbar-width);
  background: var(--focus-color);
}
@media (pointer: coarse) {
  .lil-gui.allow-touch-styles, .lil-gui.allow-touch-styles .lil-gui {
    --widget-height: 28px;
    --padding: 6px;
    --spacing: 6px;
    --font-size: 13px;
    --input-font-size: 16px;
    --folder-indent: 10px;
    --scrollbar-width: 7px;
    --slider-input-min-width: 50px;
    --color-input-min-width: 65px;
  }
}
.lil-gui.force-touch-styles, .lil-gui.force-touch-styles .lil-gui {
  --widget-height: 28px;
  --padding: 6px;
  --spacing: 6px;
  --font-size: 13px;
  --input-font-size: 16px;
  --folder-indent: 10px;
  --scrollbar-width: 7px;
  --slider-input-min-width: 50px;
  --color-input-min-width: 65px;
}
.lil-gui.autoPlace {
  max-height: 100%;
  position: fixed;
  top: 0;
  right: 15px;
  z-index: 1001;
}

.lil-gui .controller {
  display: flex;
  align-items: center;
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
}
.lil-gui .controller.disabled {
  opacity: 0.5;
}
.lil-gui .controller.disabled, .lil-gui .controller.disabled * {
  pointer-events: none !important;
}
.lil-gui .controller > .name {
  min-width: var(--name-width);
  flex-shrink: 0;
  white-space: pre;
  padding-right: var(--spacing);
  line-height: var(--widget-height);
}
.lil-gui .controller .widget {
  position: relative;
  display: flex;
  align-items: center;
  width: 100%;
  min-height: var(--widget-height);
}
.lil-gui .controller.string input {
  color: var(--string-color);
}
.lil-gui .controller.boolean {
  cursor: pointer;
}
.lil-gui .controller.color .display {
  width: 100%;
  height: var(--widget-height);
  border-radius: var(--widget-border-radius);
  position: relative;
}
@media (hover: hover) {
  .lil-gui .controller.color .display:hover:before {
    content: " ";
    display: block;
    position: absolute;
    border-radius: var(--widget-border-radius);
    border: 1px solid #fff9;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
}
.lil-gui .controller.color input[type=color] {
  opacity: 0;
  width: 100%;
  height: 100%;
  cursor: pointer;
}
.lil-gui .controller.color input[type=text] {
  margin-left: var(--spacing);
  font-family: var(--font-family-mono);
  min-width: var(--color-input-min-width);
  width: var(--color-input-width);
  flex-shrink: 0;
}
.lil-gui .controller.option select {
  opacity: 0;
  position: absolute;
  width: 100%;
  max-width: 100%;
}
.lil-gui .controller.option .display {
  position: relative;
  pointer-events: none;
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  line-height: var(--widget-height);
  max-width: 100%;
  overflow: hidden;
  word-break: break-all;
  padding-left: 0.55em;
  padding-right: 1.75em;
  background: var(--widget-color);
}
@media (hover: hover) {
  .lil-gui .controller.option .display.focus {
    background: var(--focus-color);
  }
}
.lil-gui .controller.option .display.active {
  background: var(--focus-color);
}
.lil-gui .controller.option .display:after {
  font-family: "lil-gui";
  content: "↕";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  padding-right: 0.375em;
}
.lil-gui .controller.option .widget,
.lil-gui .controller.option select {
  cursor: pointer;
}
@media (hover: hover) {
  .lil-gui .controller.option .widget:hover .display {
    background: var(--hover-color);
  }
}
.lil-gui .controller.number input {
  color: var(--number-color);
}
.lil-gui .controller.number.hasSlider input {
  margin-left: var(--spacing);
  width: var(--slider-input-width);
  min-width: var(--slider-input-min-width);
  flex-shrink: 0;
}
.lil-gui .controller.number .slider {
  width: 100%;
  height: var(--widget-height);
  background: var(--widget-color);
  border-radius: var(--widget-border-radius);
  padding-right: var(--slider-knob-width);
  overflow: hidden;
  cursor: ew-resize;
  touch-action: pan-y;
}
@media (hover: hover) {
  .lil-gui .controller.number .slider:hover {
    background: var(--hover-color);
  }
}
.lil-gui .controller.number .slider.active {
  background: var(--focus-color);
}
.lil-gui .controller.number .slider.active .fill {
  opacity: 0.95;
}
.lil-gui .controller.number .fill {
  height: 100%;
  border-right: var(--slider-knob-width) solid var(--number-color);
  box-sizing: content-box;
}

.lil-gui-dragging .lil-gui {
  --hover-color: var(--widget-color);
}
.lil-gui-dragging * {
  cursor: ew-resize !important;
}

.lil-gui-dragging.lil-gui-vertical * {
  cursor: ns-resize !important;
}

.lil-gui .title {
  height: var(--title-height);
  line-height: calc(var(--title-height) - 4px);
  font-weight: 600;
  padding: 0 var(--padding);
  -webkit-tap-highlight-color: transparent;
  cursor: pointer;
  outline: none;
  text-decoration-skip: objects;
}
.lil-gui .title:before {
  font-family: "lil-gui";
  content: "▾";
  padding-right: 2px;
  display: inline-block;
}
.lil-gui .title:active {
  background: var(--title-background-color);
  opacity: 0.75;
}
@media (hover: hover) {
  body:not(.lil-gui-dragging) .lil-gui .title:hover {
    background: var(--title-background-color);
    opacity: 0.85;
  }
  .lil-gui .title:focus {
    text-decoration: underline var(--focus-color);
  }
}
.lil-gui.root > .title:focus {
  text-decoration: none !important;
}
.lil-gui.closed > .title:before {
  content: "▸";
}
.lil-gui.closed > .children {
  transform: translateY(-7px);
  opacity: 0;
}
.lil-gui.closed:not(.transition) > .children {
  display: none;
}
.lil-gui.transition > .children {
  transition-duration: 300ms;
  transition-property: height, opacity, transform;
  transition-timing-function: cubic-bezier(0.2, 0.6, 0.35, 1);
  overflow: hidden;
  pointer-events: none;
}
.lil-gui .children:empty:before {
  content: "Empty";
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
  display: block;
  height: var(--widget-height);
  font-style: italic;
  line-height: var(--widget-height);
  opacity: 0.5;
}
.lil-gui.root > .children > .lil-gui > .title {
  border: 0 solid var(--widget-color);
  border-width: 1px 0;
  transition: border-color 300ms;
}
.lil-gui.root > .children > .lil-gui.closed > .title {
  border-bottom-color: transparent;
}
.lil-gui + .controller {
  border-top: 1px solid var(--widget-color);
  margin-top: 0;
  padding-top: var(--spacing);
}
.lil-gui .lil-gui .lil-gui > .title {
  border: none;
}
.lil-gui .lil-gui .lil-gui > .children {
  border: none;
  margin-left: var(--folder-indent);
  border-left: 2px solid var(--widget-color);
}
.lil-gui .lil-gui .controller {
  border: none;
}

.lil-gui label, .lil-gui input, .lil-gui button {
  -webkit-tap-highlight-color: transparent;
}
.lil-gui input {
  border: 0;
  outline: none;
  font-family: var(--font-family);
  font-size: var(--input-font-size);
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  background: var(--widget-color);
  color: var(--text-color);
  width: 100%;
}
@media (hover: hover) {
  .lil-gui input:hover {
    background: var(--hover-color);
  }
  .lil-gui input:active {
    background: var(--focus-color);
  }
}
.lil-gui input:disabled {
  opacity: 1;
}
.lil-gui input[type=text],
.lil-gui input[type=number] {
  padding: var(--widget-padding);
  -moz-appearance: textfield;
}
.lil-gui input[type=text]:focus,
.lil-gui input[type=number]:focus {
  background: var(--focus-color);
}
.lil-gui input[type=checkbox] {
  appearance: none;
  width: var(--checkbox-size);
  height: var(--checkbox-size);
  border-radius: var(--widget-border-radius);
  text-align: center;
  cursor: pointer;
}
.lil-gui input[type=checkbox]:checked:before {
  font-family: "lil-gui";
  content: "✓";
  font-size: var(--checkbox-size);
  line-height: var(--checkbox-size);
}
@media (hover: hover) {
  .lil-gui input[type=checkbox]:focus {
    box-shadow: inset 0 0 0 1px var(--focus-color);
  }
}
.lil-gui button {
  outline: none;
  cursor: pointer;
  font-family: var(--font-family);
  font-size: var(--font-size);
  color: var(--text-color);
  width: 100%;
  height: var(--widget-height);
  text-transform: none;
  background: var(--widget-color);
  border-radius: var(--widget-border-radius);
  border: none;
}
@media (hover: hover) {
  .lil-gui button:hover {
    background: var(--hover-color);
  }
  .lil-gui button:focus {
    box-shadow: inset 0 0 0 1px var(--focus-color);
  }
}
.lil-gui button:active {
  background: var(--focus-color);
}

@font-face {
  font-family: "lil-gui";
  src: url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff");
}`;function Sc(g){const e=document.createElement("style");e.innerHTML=g;const t=document.querySelector("head link[rel=stylesheet], head style");t?document.head.insertBefore(e,t):document.head.appendChild(e)}let ks=!1;class Ti{constructor({parent:e,autoPlace:t=e===void 0,container:n,width:r,title:s="Controls",closeFolders:i=!1,injectStyles:o=!0,touchStyles:a=!0}={}){if(this.parent=e,this.root=e?e.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("div"),this.$title.classList.add("title"),this.$title.setAttribute("role","button"),this.$title.setAttribute("aria-expanded",!0),this.$title.setAttribute("tabindex",0),this.$title.addEventListener("click",()=>this.openAnimated(this._closed)),this.$title.addEventListener("keydown",h=>{(h.code==="Enter"||h.code==="Space")&&(h.preventDefault(),this.$title.click())}),this.$title.addEventListener("touchstart",()=>{},{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(s),this.parent){this.parent.children.push(this),this.parent.folders.push(this),this.parent.$children.appendChild(this.domElement);return}this.domElement.classList.add("root"),a&&this.domElement.classList.add("allow-touch-styles"),!ks&&o&&(Sc(Ec),ks=!0),n?n.appendChild(this.domElement):t&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),r&&this.domElement.style.setProperty("--width",r+"px"),this._closeFolders=i}add(e,t,n,r,s){if(Object(n)===n)return new bc(this,e,t,n);const i=e[t];switch(typeof i){case"number":return new Ac(this,e,t,n,r,s);case"boolean":return new vc(this,e,t);case"string":return new Tc(this,e,t);case"function":return new br(this,e,t)}console.error(`gui.add failed
	property:`,t,`
	object:`,e,`
	value:`,i)}addColor(e,t,n=1){return new xc(this,e,t,n)}addFolder(e){const t=new Ti({parent:this,title:e});return this.root._closeFolders&&t.close(),t}load(e,t=!0){return e.controllers&&this.controllers.forEach(n=>{n instanceof br||n._name in e.controllers&&n.load(e.controllers[n._name])}),t&&e.folders&&this.folders.forEach(n=>{n._title in e.folders&&n.load(e.folders[n._title])}),this}save(e=!0){const t={controllers:{},folders:{}};return this.controllers.forEach(n=>{if(!(n instanceof br)){if(n._name in t.controllers)throw new Error(`Cannot save GUI with duplicate property "${n._name}"`);t.controllers[n._name]=n.save()}}),e&&this.folders.forEach(n=>{if(n._title in t.folders)throw new Error(`Cannot save GUI with duplicate folder "${n._title}"`);t.folders[n._title]=n.save()}),t}open(e=!0){return this._setClosed(!e),this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}_setClosed(e){this._closed!==e&&(this._closed=e,this._callOnOpenClose(this))}show(e=!0){return this._hidden=!e,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(e=!0){return this._setClosed(!e),this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame(()=>{const t=this.$children.clientHeight;this.$children.style.height=t+"px",this.domElement.classList.add("transition");const n=s=>{s.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",n))};this.$children.addEventListener("transitionend",n);const r=e?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!e),requestAnimationFrame(()=>{this.$children.style.height=r+"px"})}),this}title(e){return this._title=e,this.$title.textContent=e,this}reset(e=!0){return(e?this.controllersRecursive():this.controllers).forEach(n=>n.reset()),this}onChange(e){return this._onChange=e,this}_callOnChange(e){this.parent&&this.parent._callOnChange(e),this._onChange!==void 0&&this._onChange.call(this,{object:e.object,property:e.property,value:e.getValue(),controller:e})}onFinishChange(e){return this._onFinishChange=e,this}_callOnFinishChange(e){this.parent&&this.parent._callOnFinishChange(e),this._onFinishChange!==void 0&&this._onFinishChange.call(this,{object:e.object,property:e.property,value:e.getValue(),controller:e})}onOpenClose(e){return this._onOpenClose=e,this}_callOnOpenClose(e){this.parent&&this.parent._callOnOpenClose(e),this._onOpenClose!==void 0&&this._onOpenClose.call(this,e)}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach(e=>e.destroy())}controllersRecursive(){let e=Array.from(this.controllers);return this.folders.forEach(t=>{e=e.concat(t.controllersRecursive())}),e}foldersRecursive(){let e=Array.from(this.folders);return this.folders.forEach(t=>{e=e.concat(t.foldersRecursive())}),e}}const Cc={class:"wcp-demo-container"},Mc={__name:"ThreeDebugUI",setup(g){const e=new Ti,t=Le(null),n=Le(null);return ht(()=>{const r=new vt,s=new Jt(1,1,1),i=new kt({color:"#ff0000"}),o=new Te(s,i);r.add(o),o.position.y=2;const a={color:i.color.getHex(),spin:()=>{ar.to(o.rotation,{duration:1,y:o.rotation.y+2*Math.PI})}};e.add(o.position,"y").min(-3).max(3).step(.01).name("elevation"),e.add(o,"visible"),e.add(a,"spin"),e.addColor(a,"color"),e.add(i,"wireframe"),e.onChange(()=>{i.color.set(a.color)});const h={width:+getComputedStyle(n.value).width.split("px")[0],height:+getComputedStyle(n.value).height.split("px")[0]},l=new dt(75,h.width/h.height);l.position.z=5,l.position.y=1,r.add(l);const c=new Kt(l,t.value);c.enableDamping=!0;const u=new mt({canvas:t.value});u.setSize(h.width,h.height);function d(){requestAnimationFrame(d),c.update(),u.render(r,l)}d()}),Mt(()=>{e.destroy()}),(r,s)=>(ke(),st("div",Cc,[Ce("div",{ref_key:"canvasContainer",ref:n,class:"canvas-container"},[Ce("canvas",{ref_key:"canvas",ref:t},null,512)],512)]))}},Rc=ut(Mc,[["__scopeId","data-v-dec477f9"]]),Pc={class:"wcp-demo-container"},Bc={__name:"ThreeGeometries",setup(g){const e=Le(null),t=Le(null);return ht(()=>{const n=new vt,r=new Wn,s=5,i=new Float32Array(s*3*3);for(let f=0;f<s*3*3;f++)i[f]=Math.random()*2-1;const o=new Li(i,3),a=new kt({color:"red",wireframe:!0});r.setAttribute("position",o);const h=new Te(r,a);n.add(h);const l={width:+getComputedStyle(e.value).width.split("px")[0],height:600},c=new dt(75,l.width/l.height,.1,1e3);c.position.z=2,c.position.x=.1,n.add(c);const u=new Kt(c,t.value);u.enableDamping=!0;const d=new mt({canvas:t.value});d.setSize(l.width,l.height),d.setPixelRatio(Math.min(window.devicePixelRatio,2));function p(){requestAnimationFrame(p),u.update(),c.lookAt(h.position),d.render(n,c)}p(),window.addEventListener("mousemove",f=>{f.clientX/l.width-.5,-(f.clientY/l.height-.5)}),window.addEventListener("resize",f=>{l.width=+getComputedStyle(e.value).width.split("px")[0],c.aspect=l.width/l.height,c.updateProjectionMatrix(),d.setSize(l.width,l.height),d.setPixelRatio(Math.min(window.devicePixelRatio,2))}),window.addEventListener("dblclick",f=>{document.fullscreenElement?document.exitFullscreen():e.value.requestFullscreen()})}),Mt(()=>{}),(n,r)=>(ke(),st("div",Pc,[Ce("div",{ref_key:"canvasContainer",ref:e},[Ce("canvas",{ref_key:"canvas",ref:t},null,512)],512)]))}},Lc=ut(Bc,[["__scopeId","data-v-32765b23"]]),Fc={class:"wcp-demo-container"},Ic={__name:"ThreeCamera",setup(g){const e=Le(null),t=Le(null);return ht(()=>{const n=new vt,r=new Te(new Jt(1,1,1),new kt({color:"green"}));n.add(r);const s={width:+getComputedStyle(e.value).width.split("px")[0],height:+getComputedStyle(e.value).height.split("px")[0]},i=new dt(75,s.width/s.height,.1,1e3);i.position.z=2,i.position.x=.1,n.add(i);const o=new Kt(i,t.value);o.enableDamping=!0;const a=new mt({canvas:t.value});a.setSize(s.width,s.height),a.setPixelRatio(Math.min(window.devicePixelRatio,2));function h(){requestAnimationFrame(h),o.update(),i.lookAt(r.position),a.render(n,i)}h(),window.addEventListener("mousemove",l=>{l.clientX/s.width-.5,-(l.clientY/s.height-.5)}),window.addEventListener("resize",l=>{s.width=+getComputedStyle(e.value).width.split("px")[0],i.aspect=s.width/s.height,i.updateProjectionMatrix(),a.setSize(s.width,s.height),a.setPixelRatio(Math.min(window.devicePixelRatio,2))}),window.addEventListener("dblclick",l=>{document.fullscreenElement?document.exitFullscreen():e.value.requestFullscreen()})}),Mt(()=>{}),(n,r)=>(ke(),st("div",Fc,[Ce("div",{ref_key:"canvasContainer",ref:e},[Ce("canvas",{ref_key:"canvas",ref:t},null,512)],512)]))}},kc=ut(Ic,[["__scopeId","data-v-e3ec3a77"]]),zc={class:"wcp-demo-container"},Nc={__name:"ThreeTransform",setup(g){const e=Le(null),t=Le(null);return ht(()=>{console.log(pa);const n=new vt,r=new Jt(1,1,1),s=new kt({color:"green"}),i=new Te(r,s);i.position.set(.7,-.6,1),i.scale.set(2,.5,.5),i.rotation.reorder("YXZ"),i.rotation.x=Math.PI*.25,i.rotation.y=Math.PI*.25,n.add(i);const o=new Zi;n.add(o);const a=new Te(new Jt(1,1,1),new kt({color:"red"})),h=new Te(new Jt(1,1,1),new kt({color:"blue"})),l=[];l.push(new gi(-3,0,0)),l.push(new gi(0,3,0)),l.push(new gi(3,0,0));const c=new Gs(new Wn().setFromPoints(l),new Hs({color:"green"}));o.add(c),o.add(a),h.position.x=-2,o.add(h),o.position.y=-2;const u=new lr(3);n.add(u);const d={width:+getComputedStyle(t.value).width.split("px")[0],height:+getComputedStyle(t.value).height.split("px")[0]},p=new dt(75,d.width/d.height,.1,1e3),f=new mt({canvas:e.value});f.setSize(d.width,d.height),p.position.z=5,p.position.x=1,p.position.y=1,ar.to(i.position,{duration:1,delay:1,x:2}),ar.to(i.position,{duration:1,delay:2,x:0});const v=new xi;function m(){requestAnimationFrame(m);const y=v.getElapsedTime();i.rotation.y=y*2*Math.PI,p.lookAt(i.position),f.render(n,p)}m()}),Mt(()=>{}),(n,r)=>(ke(),st("div",zc,[Ce("div",{ref_key:"canvasContainer",ref:t,class:"canvas-container"},[Ce("canvas",{ref_key:"canvas",ref:e},null,512)],512)]))}},Oc=ut(Nc,[["__scopeId","data-v-ffe71aca"]]),Vc={class:"wcp-demo-container"},Dc={__name:"ThreeBasic",setup(g){const e=Le(null),t=Le(null);return ht(()=>{const n=new vt,r=new Jt(1,1,1),s=new kt({color:"red"}),i=new Te(r,s);i.position.x=1,n.add(i);const o={width:+getComputedStyle(e.value).width.split("px")[0],height:+getComputedStyle(e.value).height.split("px")[0]},a=new dt(75,o.width/o.height);a.position.z=5,a.position.y=1,n.add(a);const h=new mt({canvas:t.value});h.setSize(o.width,o.height),h.render(n,a)}),Mt(()=>{}),(n,r)=>(ke(),st("div",Vc,[Ce("div",{ref_key:"canvasContainer",ref:e,class:"canvas-container"},[Ce("canvas",{ref_key:"canvas",ref:t},null,512)],512)]))}},Wc=ut(Dc,[["__scopeId","data-v-2475db1a"]]),Gc={class:"wcp-demo-container"},Hc={__name:"ThreeMaterials2",setup(g){const e=Le(null),t=Le(null);return ht(()=>{const n=new fa;n.onStart=()=>{console.log("onStart")},n.onLoad=()=>{console.log("onLoad")},n.onProgress=()=>{console.log("onProgress")},n.onError=()=>{console.log("onError")};const s=new Ai(n).load("/textures/matcap1.png");s.repeat.x=2,s.repeat.y=3,s.rotation=Math.PI/4,s.center.x=.5,s.center.y=.5,s.generateMipmaps=!1,s.minFilter=Us;const o=new qs().load(["/textures/wall.png","/textures/wall.png","/textures/wall.png","/textures/wall.png","/textures/wall.png","/textures/wall.png"]),a=new vt,h=new Ke;h.metalness=.7,h.roughness=.1,h.side=zi,h.envMap=o;const l=new Te(new yi(.5,16,16),h);l.position.x=-1.5;const c=new Te(new rn(1,1),h),u=new Te(new Xr(.3,.2,16,32),h);u.position.x=1.5,a.add(l),a.add(c),a.add(u);const d={width:+getComputedStyle(e.value).width.split("px")[0],height:+getComputedStyle(e.value).height.split("px")[0]},p=new dt(75,d.width/d.height,.1,1e3);p.position.z=5,a.add(p);const f=new Kt(p,t.value);f.enableDamping=!0;const v=new mt({canvas:t.value});v.setSize(d.width,d.height),v.setPixelRatio(Math.min(window.devicePixelRatio,2));const m=new xi;function y(){const _=m.getElapsedTime();l.rotation.y=.1*_,c.rotation.y=.1*_,u.rotation.y=.1*_,l.rotation.x=.15*_,c.rotation.x=.15*_,f.update(),v.render(a,p),requestAnimationFrame(y)}y(),window.addEventListener("resize",_=>{d.width=+getComputedStyle(e.value).width.split("px")[0],d.height=+getComputedStyle(e.value).height.split("px")[0],p.aspect=d.width/d.height,p.updateProjectionMatrix(),v.setSize(d.width,d.height),v.setPixelRatio(Math.min(window.devicePixelRatio,2))}),t.value.addEventListener("dblclick",_=>{document.fullscreenElement?document.exitFullscreen():e.value.requestFullscreen()})}),Mt(()=>{}),(n,r)=>(ke(),st("div",Gc,[Ce("div",{ref_key:"canvasContainer",ref:e,class:"canvas-container"},[Ce("canvas",{ref_key:"canvas",ref:t},null,512)],512)]))}},Uc=ut(Hc,[["__scopeId","data-v-244dbb3a"]]);class qc extends va{constructor(e,t={}){const n=t.font;if(n===void 0)super();else{const r=n.generateShapes(e,t.size);t.depth===void 0&&t.height!==void 0&&console.warn("THREE.TextGeometry: .height is now depreciated. Please use .depth instead"),t.depth=t.depth!==void 0?t.depth:t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),super(r,t)}this.type="TextGeometry"}}class $c extends Yr{constructor(e){super(e)}load(e,t,n,r){const s=this,i=new Ln(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,function(o){const a=s.parse(JSON.parse(o));t&&t(a)},n,r)}parse(e){return new Xc(e)}}class Xc{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100){const n=[],r=Yc(e,t,this.data);for(let s=0,i=r.length;s<i;s++)n.push(...r[s].toShapes());return n}}function Yc(g,e,t){const n=Array.from(g),r=e/t.resolution,s=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*r,i=[];let o=0,a=0;for(let h=0;h<n.length;h++){const l=n[h];if(l===`
`)o=0,a-=s;else{const c=jc(l,r,o,a,t);o+=c.offsetX,i.push(c.path)}}return i}function jc(g,e,t,n,r){const s=r.glyphs[g]||r.glyphs["?"];if(!s){console.error('THREE.Font: character "'+g+'" does not exists in font family '+r.familyName+".");return}const i=new ma;let o,a,h,l,c,u,d,p;if(s.o){const f=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let v=0,m=f.length;v<m;)switch(f[v++]){case"m":o=f[v++]*e+t,a=f[v++]*e+n,i.moveTo(o,a);break;case"l":o=f[v++]*e+t,a=f[v++]*e+n,i.lineTo(o,a);break;case"q":h=f[v++]*e+t,l=f[v++]*e+n,c=f[v++]*e+t,u=f[v++]*e+n,i.quadraticCurveTo(c,u,h,l);break;case"b":h=f[v++]*e+t,l=f[v++]*e+n,c=f[v++]*e+t,u=f[v++]*e+n,d=f[v++]*e+t,p=f[v++]*e+n,i.bezierCurveTo(c,u,d,p,h,l);break}}return{offsetX:s.ha*e,path:i}}const Kc={class:"wcp-demo-container"},Qc={__name:"ThreeMaterialsText",setup(g){const e=new Ti,t=Le(null),n=Le(null);return ht(()=>{const r=new vt,i=new Ai().load("/textures/matcap1.png");new $c().load("fonts/helvetiker_regular.typeface.json",function(p){const f=new qc("Hello Three.js",{font:p,size:.5,depth:.2,curveSegments:6,bevelEnabled:!0,bevelThickness:.03,bevelSize:.02,bevelOffset:0,bevelSegments:5});f.computeBoundingBox(),f.center();const v=new ga({matcap:i}),m=new Te(f,v);r.add(m);const y=new Xr(.5,.1,20,45);for(let _=0;_<100;_++){const w=new Te(y,v);w.position.x=(Math.random()-.5)*10,w.position.y=(Math.random()-.5)*10,w.position.z=(Math.random()-.5)*10,w.rotation.x=Math.random()*Math.PI,w.rotation.y=Math.random()*Math.PI;const x=Math.random();w.scale.set(x,x,x),r.add(w)}});const a={width:+getComputedStyle(t.value).width.split("px")[0],height:+getComputedStyle(t.value).height.split("px")[0]},h=new dt(75,a.width/a.height,.1,1e3);h.position.z=5,r.add(h);const l=new Kt(h,n.value);l.enableDamping=!0;const c=new mt({canvas:n.value});c.setSize(a.width,a.height),c.setPixelRatio(Math.min(window.devicePixelRatio,2));const u=new xi;function d(){u.getElapsedTime(),l.update(),c.render(r,h),requestAnimationFrame(d)}d(),window.addEventListener("resize",p=>{a.width=+getComputedStyle(t.value).width.split("px")[0],a.height=+getComputedStyle(t.value).height.split("px")[0],h.aspect=a.width/a.height,h.updateProjectionMatrix(),c.setSize(a.width,a.height),c.setPixelRatio(Math.min(window.devicePixelRatio,2))}),n.value.addEventListener("dblclick",p=>{document.fullscreenElement?document.exitFullscreen():t.value.requestFullscreen()})}),Mt(()=>{e.destroy()}),(r,s)=>(ke(),st("div",Kc,[Ce("div",{ref_key:"canvasContainer",ref:t,class:"canvasContainer"},[Ce("canvas",{ref_key:"canvas",ref:n},null,512)],512)]))}},Zc=ut(Qc,[["__scopeId","data-v-3a489362"]]),Jc={class:"wcp-demo-container"},eh={__name:"ThreeLight",setup(g){const e=Le(null),t=Le(null),n=new Ti;return ht(()=>{const r=new vt,s=new lr(3);r.add(s);const i=new An;i.color=new At("#ffffff"),i.intensity=.3,r.add(i);const o=new ya(16711680,255,.3);r.add(o);const a=new bn;a.color=new At("#00fffc"),a.intensity=1,a.position.set(1,.25,0),r.add(a);const h=new Ki(16748544,.5,10,2);h.position.set(.2,-.3,.5),r.add(h);const l=new $s("#78ff00",.5,2,Math.PI*.1,.25,1);l.position.set(0,1,0),r.add(l),n.add(i,"intensity").min(0).max(1).step(.01);const c=new wa(o,.2);r.add(c);const u=new Xs(a,.2);r.add(u);const d=new Ys(h,.2);r.add(d);const p=new _a(l);r.add(p);const f=new Ke;f.roughness=.4,f.side=zi;const v=new Te(new Jt(.5,.5,.5),f);v.position.x=-.6;const m=new Te(new Xr(.2,.1,16,100),f),y=new Te(new rn(3,2,1,1),f);y.position.x=-.5,y.position.y=-.5,y.rotation.x=Math.PI*.5,r.add(v),r.add(m),r.add(y);const _={width:+getComputedStyle(e.value).width.split("px")[0],height:+getComputedStyle(e.value).height.split("px")[0]},w=new dt(75,_.width/_.height,.1,1e3);w.position.z=2,r.add(w);const x=new Kt(w,t.value);x.enableDamping=!0;const E=new mt({canvas:t.value});E.setSize(_.width,_.height),E.setPixelRatio(Math.min(window.devicePixelRatio,2));function L(){requestAnimationFrame(L),l.angle=Math.PI/8+Math.sin(Date.now()*.001)*Math.PI/8,x.update(),w.lookAt(v.position),E.render(r,w)}L(),window.addEventListener("resize",A=>{_.width=+getComputedStyle(e.value).width.split("px")[0],_.height=+getComputedStyle(e.value).height.split("px")[0],w.aspect=_.width/_.height,w.updateProjectionMatrix(),E.setSize(_.width,_.height),E.setPixelRatio(Math.min(window.devicePixelRatio,2))}),t.value.addEventListener("dblclick",A=>{document.fullscreenElement?document.exitFullscreen():e.value.requestFullscreen()})}),Mt(()=>{n.destroy()}),(r,s)=>(ke(),st("div",Jc,[Ce("div",{ref_key:"canvasContainer",ref:e,class:"canvas-container"},[Ce("canvas",{ref_key:"canvas",ref:t},null,512)],512)]))}},th=ut(eh,[["__scopeId","data-v-92540add"]]),ih={class:"wcp-demo-container"},nh={__name:"ThreeShadows",setup(g){const e=Le(null),t=Le(null),n=new Ti;return ht(()=>{const r=new vt,s=new lr(3);r.add(s);const i=new An;i.color=new At("#ffffff"),i.intensity=.3,r.add(i);const o=new bn;o.color=new At("#00fffc"),o.intensity=1,o.position.set(0,2,0),o.castShadow=!0,r.add(o);const a=new Ki("00fffc");a.castShadow=!0,a.position.set(0,1,0),r.add(a);const h=new Xs(o,.2);o.shadow.mapSize.width=1024,o.shadow.mapSize.height=1024,o.shadow.camera.near=.1,o.shadow.camera.far=6,r.add(h);const l=new xa(o.shadow.camera);r.add(l);const c=new Ys(a,.2);a.shadow.mapSize.width=1024,a.shadow.mapSize.height=1024,a.shadow.camera.near=.1,a.shadow.camera.far=5,r.add(c);const u=new Ke;u.roughness=.4,u.side=zi,u.color=new At("#00fffc");const d=new Ai,p=new Ke,f=d.load("/textures/bg.png");p.side=zi,p.map=f;const v=new yi(.3,32,16),m=new Te(v,p),y=new Te(new rn(5,5,1,1),u);m.castShadow=!0,y.rotation.x=Math.PI*.5,y.position.y=-.3,y.receiveShadow=!0,r.add(m),r.add(y),n.add(o,"intensity").min(0).max(1).step(.001),n.add(o.position,"x").min(-5).max(5).step(.001),n.add(o.position,"y").min(-5).max(5).step(.001),n.add(o.position,"z").min(-5).max(5).step(.001),n.add(a,"intensity").min(0).max(1).step(.001),n.add(a.position,"x").min(-5).max(5).step(.001),n.add(a.position,"y").min(-5).max(5).step(.001),n.add(a.position,"z").min(-5).max(5).step(.001);const _={width:+getComputedStyle(e.value).width.split("px")[0],height:+getComputedStyle(e.value).height.split("px")[0]},w=new dt(75,_.width/_.height,.1,1e3);w.position.z=2,w.position.y=1.5,r.add(w);const x=new Kt(w,t.value);x.enableDamping=!0;const E=new mt({canvas:t.value});E.setSize(_.width,_.height),E.setPixelRatio(Math.min(window.devicePixelRatio,2)),E.shadowMap.enabled=!0;const L=new xi;function A(){requestAnimationFrame(A);const T=L.getElapsedTime();m.position.x=Math.cos(T)*1,m.position.z=Math.sin(T)*1,m.position.y=Math.abs(Math.sin(T*3)),m.rotation.x+=.01,m.rotation.y+=.01,m.rotation.z+=.01,x.update(),E.render(r,w)}A(),window.addEventListener("resize",T=>{_.width=+getComputedStyle(e.value).width.split("px")[0],_.height=+getComputedStyle(e.value).height.split("px")[0],w.aspect=_.width/_.height,w.updateProjectionMatrix(),E.setSize(_.width,_.height),E.setPixelRatio(Math.min(window.devicePixelRatio,2))}),t.value.addEventListener("dblclick",T=>{document.fullscreenElement?document.exitFullscreen():e.value.requestFullscreen()})}),Mt(()=>{n.destroy(),console.log("unmounted")}),(r,s)=>(ke(),st("div",ih,[Ce("div",{ref_key:"canvasContainer",ref:e,class:"canvas-container"},[Ce("canvas",{ref_key:"canvas",ref:t},null,512)],512)]))}},rh=ut(nh,[["__scopeId","data-v-a4264e7a"]]),sh={class:"wcp-demo-container"},oh={__name:"ThreeHouse",setup(g){const e=Le(null),t=Le(null),n=new Ti;return ht(()=>{const r=new vt;r.fog=new Aa("#262837",1,100),new lr(6);const s=new Ai,i=s.load("/textures/football.png"),o=s.load("/textures/door.png"),a=s.load("/textures/wall.png");a.wrapS=Ft,a.wrapT=Ft,a.repeat.set(2,1);const h=s.load("/textures/grass001/Grass001_1K-PNG_Color.png"),l=s.load("/textures/grass001/Grass001_1K-PNG_AmbientOcclusion.png");h.repeat.set(10,10),h.wrapS=Ft,h.wrapT=Ft,l.repeat.set(10,10),l.wrapS=Ft,l.wrapT=Ft;const c=s.load("/textures/bg.png"),u=new Zi;u.position.y=.001,r.add(u);const d=new Te(new Jt(5,3.5,5),new Ke({map:a}));d.position.y=3.5/2,u.add(d);const p=new Te(new ba(4,1,4),new Ke({color:"#b35f45"}));p.position.y=3.5+1/2,p.rotation.y=Math.PI/4,u.add(p);const f=new Te(new rn(2,2,5),new Ke({color:"#aa7b7b",map:o,transparent:!0,displacementMap:o,displacementScale:.1}));f.position.y=2/2,f.position.z=5/2+.001,u.add(f);const v=new Zi;v.position.z=5/2+1,v.position.y=.5,v.position.x=2,r.add(v);const m=new Te(new Jt(1,1,.1),new Ke({map:c})),y=new Te(new Jt(.1,1,.09),new Ke({}));m.position.y=1/2,v.add(m),v.add(y);const _=new yi(1,16,16),w=new Ke({color:"#89c854"}),x=new Te(_,w);x.scale.set(.5,.5,.5),x.position.set(1,.3,5/2);const E=new Te(_,w);E.scale.set(.25,.25,.25),E.position.set(1.6,.2,5/2);const L=new Te(_,w);L.scale.set(.6,.6,.6),L.position.set(-1,.1,5/2);const A=new Te(_,w);A.scale.set(.2,.2,.2),A.position.set(-1.5,.1,5/2+.5),u.add(x,E,L,A);const T=new Zi;r.add(T);const R=new yi(1,18,32),C=new Ke({map:i});for(let b=0;b<50;b++){const N=Math.random()*Math.PI*2,j=4+Math.random()*6,$=Math.sin(N)*j,O=Math.cos(N)*j,q=Math.random()*.2,Q=new Te(R,C);Q.position.set($,q,O),Q.scale.set(q,q,q),Q.castShadow=!0,T.add(Q)}const F=new Te(new rn(20,20),new Ke({color:"#a9c388",side:zi,map:h,aoMap:l}));F.rotation.x=-Math.PI*.5,F.position.y=0,r.add(F);const I=new An("#b9d5ff",.12);r.add(I);const D=new bn("#b9d5ff",.12);D.position.set(15,15,-15),r.add(D);const G=new Ki("#ff7d46",1,7);G.position.set(0,3.5/2,5/2+.4),r.add(G);const Y=new Ki("#ff00ff",2,3);r.add(Y);const z=new Ki("#00ffff",2,3);r.add(z);const B=new Ki("#ffff00",2,3);r.add(B);const H={width:+getComputedStyle(e.value).width.split("px")[0],height:+getComputedStyle(e.value).height.split("px")[0]},W=new dt(75,H.width/H.height,.1,1e3);W.position.z=6,W.position.y=6,W.position.x=6,r.add(W);const P=new Kt(W,t.value);P.enableDamping=!0,n.add(I,"intensity").min(0).max(1).step(.001),n.add(D,"intensity").min(0).max(1).step(.001);const k=new mt({canvas:t.value});k.setSize(H.width,H.height),k.setPixelRatio(Math.min(window.devicePixelRatio,2)),k.setClearColor("#262837"),k.shadowMap.enabled=!0,D.castShadow=!0,G.castShadow=!0,Y.castShadow=!0,z.castShadow=!0,B.castShadow=!0,d.castShadow=!0,x.castShadow=!0,E.castShadow=!0,L.castShadow=!0,A.castShadow=!0,F.receiveShadow=!0;const M=new xi;function S(){requestAnimationFrame(S);const b=M.getElapsedTime(),N=b*.5;Y.position.x=Math.cos(N)*4,Y.position.z=Math.sin(N)*4,Y.position.y=Math.sin(b*3);const j=-b*.32;z.position.x=Math.cos(j)*5,z.position.z=Math.sin(j)*5,z.position.y=Math.sin(b*4)+Math.sin(b*2.5),B.position.x=Math.cos(j)*(7+Math.sin(b*.32)),B.position.z=Math.sin(j)*(7+Math.sin(b*.5)),B.position.y=Math.sin(b*5)+Math.sin(b*2),P.update(),k.render(r,W)}S(),window.addEventListener("resize",b=>{H.width=+getComputedStyle(e.value).width.split("px")[0],H.height=+getComputedStyle(e.value).height.split("px")[0],W.aspect=H.width/H.height,W.updateProjectionMatrix(),k.setSize(H.width,H.height),k.setPixelRatio(Math.min(window.devicePixelRatio,2))}),t.value.addEventListener("dblclick",b=>{document.fullscreenElement?document.exitFullscreen():e.value.requestFullscreen()})}),Mt(()=>{n.destroy(),console.log("unmounted")}),(r,s)=>(ke(),st("div",sh,[Ce("div",{ref_key:"canvasContainer",ref:e,class:"canvas-container"},[Ce("canvas",{ref_key:"canvas",ref:t},null,512)],512)]))}},ah=ut(oh,[["__scopeId","data-v-e565cc0f"]]),lh={class:"wcp-demo-container"},ch={__name:"ThreeParticles",setup(g){const e=Le(null),t=Le(null);return ht(()=>{const n=new vt,s=new Ai().load("/textures/1.png");let i=new Wn;const o=5e3,a=new Float32Array(o*3),h=new Float32Array(o*3);for(let y=0;y<o*3;y++)a[y]=(Math.random()-.5)*10,h[y]=Math.random()*.5;i.setAttribute("position",new Li(a,3)),i.setAttribute("color",new Li(h,3));const l=new js;l.size=.1,l.sizeAttenutation=!0,l.color=new At("#88ccff"),l.map=s,l.transparent=!0,l.depthWrite=!1,l.binding=Ta,l.vertexColors=!0;const c=new Ks(i,l);n.add(c);const u={width:+getComputedStyle(e.value).width.split("px")[0],height:+getComputedStyle(e.value).height.split("px")[0]},d=new dt(75,u.width/u.height,.1,1e3);d.position.z=6,d.position.y=6,d.position.x=6,n.add(d);const p=new Kt(d,t.value);p.enableDamping=!0;const f=new mt({canvas:t.value});f.setSize(u.width,u.height),f.setPixelRatio(Math.min(window.devicePixelRatio,2));const v=new xi;function m(){requestAnimationFrame(m);const y=v.getElapsedTime();c.rotation.y=y*.1,p.update(),f.render(n,d)}m(),window.addEventListener("resize",y=>{u.width=+getComputedStyle(e.value).width.split("px")[0],u.height=+getComputedStyle(e.value).height.split("px")[0],d.aspect=u.width/u.height,d.updateProjectionMatrix(),f.setSize(u.width,u.height),f.setPixelRatio(Math.min(window.devicePixelRatio,2))}),t.value.addEventListener("dblclick",y=>{document.fullscreenElement?document.exitFullscreen():e.value.requestFullscreen()})}),Mt(()=>{console.log("unmounted")}),(n,r)=>(ke(),st("div",lh,[Ce("div",{ref_key:"canvasContainer",ref:e,class:"canvas-container"},[Ce("canvas",{ref_key:"canvas",ref:t},null,512)],512)]))}},hh=ut(ch,[["__scopeId","data-v-30d4acd0"]]);function Xn(g){throw new Error('Could not dynamically require "'+g+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ia={exports:{}};(function(g,e){(function(t){g.exports=t()})(function(){return function t(n,r,s){function i(h,l){if(!r[h]){if(!n[h]){var c=typeof Xn=="function"&&Xn;if(!l&&c)return c(h,!0);if(o)return o(h,!0);throw new Error("Cannot find module '"+h+"'")}var u=r[h]={exports:{}};n[h][0].call(u.exports,function(d){var p=n[h][1][d];return i(p||d)},u,u.exports,t,n,r,s)}return r[h].exports}for(var o=typeof Xn=="function"&&Xn,a=0;a<s.length;a++)i(s[a]);return i}({1:[function(t,n,r){n.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(t,n,r){n.exports={version:t("../package.json").version,AABB:t("./collision/AABB"),ArrayCollisionMatrix:t("./collision/ArrayCollisionMatrix"),Body:t("./objects/Body"),Box:t("./shapes/Box"),Broadphase:t("./collision/Broadphase"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),Narrowphase:t("./world/Narrowphase"),ConeTwistConstraint:t("./constraints/ConeTwistConstraint"),ContactMaterial:t("./material/ContactMaterial"),ConvexPolyhedron:t("./shapes/ConvexPolyhedron"),Cylinder:t("./shapes/Cylinder"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventTarget:t("./utils/EventTarget"),FrictionEquation:t("./equations/FrictionEquation"),GSSolver:t("./solver/GSSolver"),GridBroadphase:t("./collision/GridBroadphase"),Heightfield:t("./shapes/Heightfield"),HingeConstraint:t("./constraints/HingeConstraint"),LockConstraint:t("./constraints/LockConstraint"),Mat3:t("./math/Mat3"),Material:t("./material/Material"),NaiveBroadphase:t("./collision/NaiveBroadphase"),ObjectCollisionMatrix:t("./collision/ObjectCollisionMatrix"),Pool:t("./utils/Pool"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),PointToPointConstraint:t("./constraints/PointToPointConstraint"),Quaternion:t("./math/Quaternion"),Ray:t("./collision/Ray"),RaycastVehicle:t("./objects/RaycastVehicle"),RaycastResult:t("./collision/RaycastResult"),RigidVehicle:t("./objects/RigidVehicle"),RotationalEquation:t("./equations/RotationalEquation"),RotationalMotorEquation:t("./equations/RotationalMotorEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),SPHSystem:t("./objects/SPHSystem"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Sphere:t("./shapes/Sphere"),SplitSolver:t("./solver/SplitSolver"),Spring:t("./objects/Spring"),Trimesh:t("./shapes/Trimesh"),Vec3:t("./math/Vec3"),Vec3Pool:t("./utils/Vec3Pool"),World:t("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(t,n,r){var s=t("../math/Vec3");t("../utils/Utils"),n.exports=i;function i(h){h=h||{},this.lowerBound=new s,h.lowerBound&&this.lowerBound.copy(h.lowerBound),this.upperBound=new s,h.upperBound&&this.upperBound.copy(h.upperBound)}var o=new s;i.prototype.setFromPoints=function(h,l,c,u){var d=this.lowerBound,p=this.upperBound,f=c;d.copy(h[0]),f&&f.vmult(d,d),p.copy(d);for(var v=1;v<h.length;v++){var m=h[v];f&&(f.vmult(m,o),m=o),m.x>p.x&&(p.x=m.x),m.x<d.x&&(d.x=m.x),m.y>p.y&&(p.y=m.y),m.y<d.y&&(d.y=m.y),m.z>p.z&&(p.z=m.z),m.z<d.z&&(d.z=m.z)}return l&&(l.vadd(d,d),l.vadd(p,p)),u&&(d.x-=u,d.y-=u,d.z-=u,p.x+=u,p.y+=u,p.z+=u),this},i.prototype.copy=function(h){return this.lowerBound.copy(h.lowerBound),this.upperBound.copy(h.upperBound),this},i.prototype.clone=function(){return new i().copy(this)},i.prototype.extend=function(h){var l=h.lowerBound.x;this.lowerBound.x>l&&(this.lowerBound.x=l);var c=h.upperBound.x;this.upperBound.x<c&&(this.upperBound.x=c);var l=h.lowerBound.y;this.lowerBound.y>l&&(this.lowerBound.y=l);var c=h.upperBound.y;this.upperBound.y<c&&(this.upperBound.y=c);var l=h.lowerBound.z;this.lowerBound.z>l&&(this.lowerBound.z=l);var c=h.upperBound.z;this.upperBound.z<c&&(this.upperBound.z=c)},i.prototype.overlaps=function(h){var l=this.lowerBound,c=this.upperBound,u=h.lowerBound,d=h.upperBound;return(u.x<=c.x&&c.x<=d.x||l.x<=d.x&&d.x<=c.x)&&(u.y<=c.y&&c.y<=d.y||l.y<=d.y&&d.y<=c.y)&&(u.z<=c.z&&c.z<=d.z||l.z<=d.z&&d.z<=c.z)},i.prototype.contains=function(h){var l=this.lowerBound,c=this.upperBound,u=h.lowerBound,d=h.upperBound;return l.x<=u.x&&c.x>=d.x&&l.y<=u.y&&c.y>=d.y&&l.z<=u.z&&c.z>=d.z},i.prototype.getCorners=function(h,l,c,u,d,p,f,v){var m=this.lowerBound,y=this.upperBound;h.copy(m),l.set(y.x,m.y,m.z),c.set(y.x,y.y,m.z),u.set(m.x,y.y,y.z),d.set(y.x,m.y,m.z),p.set(m.x,y.y,m.z),f.set(m.x,m.y,y.z),v.copy(y)};var a=[new s,new s,new s,new s,new s,new s,new s,new s];i.prototype.toLocalFrame=function(h,l){var c=a,u=c[0],d=c[1],p=c[2],f=c[3],v=c[4],m=c[5],y=c[6],_=c[7];this.getCorners(u,d,p,f,v,m,y,_);for(var w=0;w!==8;w++){var x=c[w];h.pointToLocal(x,x)}return l.setFromPoints(c)},i.prototype.toWorldFrame=function(h,l){var c=a,u=c[0],d=c[1],p=c[2],f=c[3],v=c[4],m=c[5],y=c[6],_=c[7];this.getCorners(u,d,p,f,v,m,y,_);for(var w=0;w!==8;w++){var x=c[w];h.pointToWorld(x,x)}return l.setFromPoints(c)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(t,n,r){n.exports=s;function s(){this.matrix=[]}s.prototype.get=function(i,o){if(i=i.index,o=o.index,o>i){var a=o;o=i,i=a}return this.matrix[(i*(i+1)>>1)+o-1]},s.prototype.set=function(i,o,a){if(i=i.index,o=o.index,o>i){var h=o;o=i,i=h}this.matrix[(i*(i+1)>>1)+o-1]=a?1:0},s.prototype.reset=function(){for(var i=0,o=this.matrix.length;i!==o;i++)this.matrix[i]=0},s.prototype.setNumObjects=function(i){this.matrix.length=i*(i-1)>>1}},{}],5:[function(t,n,r){var s=t("../objects/Body"),i=t("../math/Vec3"),o=t("../math/Quaternion");t("../shapes/Shape"),t("../shapes/Plane"),n.exports=a;function a(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}a.prototype.collisionPairs=function(f,v,m){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var h=s.STATIC|s.KINEMATIC;a.prototype.needBroadphaseCollision=function(f,v){return!(!(f.collisionFilterGroup&v.collisionFilterMask)||!(v.collisionFilterGroup&f.collisionFilterMask)||(f.type&h||f.sleepState===s.SLEEPING)&&(v.type&h||v.sleepState===s.SLEEPING))},a.prototype.intersectionTest=function(f,v,m,y){this.useBoundingBoxes?this.doBoundingBoxBroadphase(f,v,m,y):this.doBoundingSphereBroadphase(f,v,m,y)};var l=new i;new i,new o,new i,a.prototype.doBoundingSphereBroadphase=function(f,v,m,y){var _=l;v.position.vsub(f.position,_);var w=Math.pow(f.boundingRadius+v.boundingRadius,2),x=_.norm2();x<w&&(m.push(f),y.push(v))},a.prototype.doBoundingBoxBroadphase=function(f,v,m,y){f.aabbNeedsUpdate&&f.computeAABB(),v.aabbNeedsUpdate&&v.computeAABB(),f.aabb.overlaps(v.aabb)&&(m.push(f),y.push(v))};var c={keys:[]},u=[],d=[];a.prototype.makePairsUnique=function(f,v){for(var m=c,y=u,_=d,w=f.length,x=0;x!==w;x++)y[x]=f[x],_[x]=v[x];f.length=0,v.length=0;for(var x=0;x!==w;x++){var E=y[x].id,L=_[x].id,A=E<L?E+","+L:L+","+E;m[A]=x,m.keys.push(A)}for(var x=0;x!==m.keys.length;x++){var A=m.keys.pop(),T=m[A];f.push(y[T]),v.push(_[T]),delete m[A]}},a.prototype.setWorld=function(f){};var p=new i;a.boundingSphereCheck=function(f,v){var m=p;return f.position.vsub(v.position,m),Math.pow(f.shape.boundingSphereRadius+v.shape.boundingSphereRadius,2)>m.norm2()},a.prototype.aabbQuery=function(f,v,m){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(t,n,r){n.exports=a;var s=t("./Broadphase"),i=t("../math/Vec3"),o=t("../shapes/Shape");function a(l,c,u,d,p){s.apply(this),this.nx=u||10,this.ny=d||10,this.nz=p||10,this.aabbMin=l||new i(100,100,100),this.aabbMax=c||new i(-100,-100,-100);var f=this.nx*this.ny*this.nz;if(f<=0)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=f,this.binLengths.length=f;for(var v=0;v<f;v++)this.bins[v]=[],this.binLengths[v]=0}a.prototype=new s,a.prototype.constructor=a;var h=new i;new i,a.prototype.collisionPairs=function(l,c,u){var d=l.numObjects(),p=l.bodies,j=this.aabbMax,N=this.aabbMin,f=this.nx,v=this.ny,m=this.nz,y=v*m,_=m,w=1,x=j.x,E=j.y,L=j.z,A=N.x,T=N.y,R=N.z,C=f/(x-A),F=v/(E-T),I=m/(L-R),D=(x-A)/f,G=(E-T)/v,Y=(L-R)/m,z=Math.sqrt(D*D+G*G+Y*Y)*.5,B=o.types,H=B.SPHERE,W=B.PLANE;B.BOX,B.COMPOUND,B.CONVEXPOLYHEDRON;for(var P=this.bins,k=this.binLengths,M=this.bins.length,S=0;S!==M;S++)k[S]=0;var b=Math.ceil,N=Math.min,j=Math.max;function $(ci,Ei,hi,Vt,Dt,Di,Si){var ti=(ci-A)*C|0,Qt=(Ei-T)*F|0,Rt=(hi-R)*I|0,ii=b((Vt-A)*C),Zt=b((Dt-T)*F),pt=b((Di-R)*I);ti<0?ti=0:ti>=f&&(ti=f-1),Qt<0?Qt=0:Qt>=v&&(Qt=v-1),Rt<0?Rt=0:Rt>=m&&(Rt=m-1),ii<0?ii=0:ii>=f&&(ii=f-1),Zt<0?Zt=0:Zt>=v&&(Zt=v-1),pt<0?pt=0:pt>=m&&(pt=m-1),ti*=y,Qt*=_,Rt*=w,ii*=y,Zt*=_,pt*=w;for(var Wi=ti;Wi<=ii;Wi+=y)for(var Gi=Qt;Gi<=Zt;Gi+=_)for(var Hi=Rt;Hi<=pt;Hi+=w){var ln=Wi+Gi+Hi;P[ln][k[ln]++]=Si}}for(var S=0;S!==d;S++){var O=p[S],q=O.shape;switch(q.type){case H:var Q=O.position.x,fe=O.position.y,ue=O.position.z,he=q.radius;$(Q-he,fe-he,ue-he,Q+he,fe+he,ue+he,O);break;case W:q.worldNormalNeedsUpdate&&q.computeWorldNormal(O.quaternion);var K=q.worldNormal,te=A+D*.5-O.position.x,Se=T+G*.5-O.position.y,ge=R+Y*.5-O.position.z,Ne=h;Ne.set(te,Se,ge);for(var pe=0,Fe=0;pe!==f;pe++,Fe+=y,Ne.y=Se,Ne.x+=D)for(var ze=0,Ie=0;ze!==v;ze++,Ie+=_,Ne.z=ge,Ne.y+=G)for(var De=0,Re=0;De!==m;De++,Re+=w,Ne.z+=Y)if(Ne.dot(K)<z){var Ge=Fe+Ie+Re;P[Ge][k[Ge]++]=O}break;default:O.aabbNeedsUpdate&&O.computeAABB(),$(O.aabb.lowerBound.x,O.aabb.lowerBound.y,O.aabb.lowerBound.z,O.aabb.upperBound.x,O.aabb.upperBound.y,O.aabb.upperBound.z,O);break}}for(var S=0;S!==M;S++){var Pe=k[S];if(Pe>1)for(var Je=P[S],pe=0;pe!==Pe;pe++)for(var O=Je[pe],ze=0;ze!==pe;ze++){var gt=Je[ze];this.needBroadphaseCollision(O,gt)&&this.intersectionTest(O,gt,c,u)}}this.makePairsUnique(c,u)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(t,n,r){n.exports=o;var s=t("./Broadphase"),i=t("./AABB");function o(){s.apply(this)}o.prototype=new s,o.prototype.constructor=o,o.prototype.collisionPairs=function(a,h,l){var c=a.bodies,u=c.length,d,p,f,v;for(d=0;d!==u;d++)for(p=0;p!==d;p++)f=c[d],v=c[p],this.needBroadphaseCollision(f,v)&&this.intersectionTest(f,v,h,l)},new i,o.prototype.aabbQuery=function(a,h,l){l=l||[];for(var c=0;c<a.bodies.length;c++){var u=a.bodies[c];u.aabbNeedsUpdate&&u.computeAABB(),u.aabb.overlaps(h)&&l.push(u)}return l}},{"./AABB":3,"./Broadphase":5}],8:[function(t,n,r){n.exports=s;function s(){this.matrix={}}s.prototype.get=function(i,o){if(i=i.id,o=o.id,o>i){var a=o;o=i,i=a}return i+"-"+o in this.matrix},s.prototype.set=function(i,o,a){if(i=i.id,o=o.id,o>i){var h=o;o=i,i=h}a?this.matrix[i+"-"+o]=!0:delete this.matrix[i+"-"+o]},s.prototype.reset=function(){this.matrix={}},s.prototype.setNumObjects=function(i){}},{}],9:[function(t,n,r){n.exports=c;var s=t("../math/Vec3"),i=t("../math/Quaternion"),o=t("../math/Transform");t("../shapes/ConvexPolyhedron"),t("../shapes/Box");var a=t("../collision/RaycastResult"),h=t("../shapes/Shape"),l=t("../collision/AABB");function c(M,S){this.from=M?M.clone():new s,this.to=S?S.clone():new s,this._direction=new s,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=c.ANY,this.result=new a,this.hasHit=!1,this.callback=function(b){}}c.prototype.constructor=c,c.CLOSEST=1,c.ANY=2,c.ALL=4;var u=new l,d=[];c.prototype.intersectWorld=function(M,S){return this.mode=S.mode||c.ANY,this.result=S.result||new a,this.skipBackfaces=!!S.skipBackfaces,this.collisionFilterMask=typeof S.collisionFilterMask<"u"?S.collisionFilterMask:-1,this.collisionFilterGroup=typeof S.collisionFilterGroup<"u"?S.collisionFilterGroup:-1,S.from&&this.from.copy(S.from),S.to&&this.to.copy(S.to),this.callback=S.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(u),d.length=0,M.broadphase.aabbQuery(M,u,d),this.intersectBodies(d),this.hasHit};var p=new s,f=new s;c.pointInTriangle=v;function v(M,S,b,N){N.vsub(S,W),b.vsub(S,p),M.vsub(S,f);var j=W.dot(W),$=W.dot(p),O=W.dot(f),q=p.dot(p),Q=p.dot(f),fe,ue;return(fe=q*O-$*Q)>=0&&(ue=j*Q-$*O)>=0&&fe+ue<j*q-$*$}var m=new s,y=new i;c.prototype.intersectBody=function(M,S){S&&(this.result=S,this._updateDirection());var b=this.checkCollisionResponse;if(!(b&&!M.collisionResponse)&&!(!(this.collisionFilterGroup&M.collisionFilterMask)||!(M.collisionFilterGroup&this.collisionFilterMask)))for(var N=m,j=y,$=0,O=M.shapes.length;$<O;$++){var q=M.shapes[$];if(!(b&&!q.collisionResponse)&&(M.quaternion.mult(M.shapeOrientations[$],j),M.quaternion.vmult(M.shapeOffsets[$],N),N.vadd(M.position,N),this.intersectShape(q,j,N,M),this.result._shouldStop))break}},c.prototype.intersectBodies=function(M,S){S&&(this.result=S,this._updateDirection());for(var b=0,N=M.length;!this.result._shouldStop&&b<N;b++)this.intersectBody(M[b])},c.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},c.prototype.intersectShape=function(M,S,b,N){var j=this.from,$=k(j,this._direction,b);if(!($>M.boundingSphereRadius)){var O=this[M.type];O&&O.call(this,M,S,b,N)}},new s,new s;var _=new s,w=new s,x=new s,E=new s;new s,new a,c.prototype.intersectBox=function(M,S,b,N){return this.intersectConvex(M.convexPolyhedronRepresentation,S,b,N)},c.prototype[h.types.BOX]=c.prototype.intersectBox,c.prototype.intersectPlane=function(M,S,b,N){var j=this.from,$=this.to,O=this._direction,q=new s(0,0,1);S.vmult(q,q);var Q=new s;j.vsub(b,Q);var fe=Q.dot(q);$.vsub(b,Q);var ue=Q.dot(q);if(!(fe*ue>0)&&!(j.distanceTo($)<fe)){var he=q.dot(O);if(!(Math.abs(he)<this.precision)){var K=new s,te=new s,Se=new s;j.vsub(b,K);var ge=-q.dot(K)/he;O.scale(ge,te),j.vadd(te,Se),this.reportIntersection(q,Se,M,N,-1)}}},c.prototype[h.types.PLANE]=c.prototype.intersectPlane,c.prototype.getAABB=function(M){var S=this.to,b=this.from;M.lowerBound.x=Math.min(S.x,b.x),M.lowerBound.y=Math.min(S.y,b.y),M.lowerBound.z=Math.min(S.z,b.z),M.upperBound.x=Math.max(S.x,b.x),M.upperBound.y=Math.max(S.y,b.y),M.upperBound.z=Math.max(S.z,b.z)};var L={faceList:[0]};c.prototype.intersectHeightfield=function(M,S,b,N){M.data,M.elementSize;var j=new s,$=new c(this.from,this.to);o.pointToLocalFrame(b,S,$.from,$.from),o.pointToLocalFrame(b,S,$.to,$.to);var O=[],q=null,Q=null,fe=null,ue=null,he=M.getIndexOfPosition($.from.x,$.from.y,O,!1);if(he&&(q=O[0],Q=O[1],fe=O[0],ue=O[1]),he=M.getIndexOfPosition($.to.x,$.to.y,O,!1),he&&((q===null||O[0]<q)&&(q=O[0]),(fe===null||O[0]>fe)&&(fe=O[0]),(Q===null||O[1]<Q)&&(Q=O[1]),(ue===null||O[1]>ue)&&(ue=O[1])),q!==null){var K=[];M.getRectMinMax(q,Q,fe,ue,K),K[0],K[1];for(var te=q;te<=fe;te++)for(var Se=Q;Se<=ue;Se++){if(this.result._shouldStop||(M.getConvexTrianglePillar(te,Se,!1),o.pointToWorldFrame(b,S,M.pillarOffset,j),this.intersectConvex(M.pillarConvex,S,j,N,L),this.result._shouldStop))return;M.getConvexTrianglePillar(te,Se,!0),o.pointToWorldFrame(b,S,M.pillarOffset,j),this.intersectConvex(M.pillarConvex,S,j,N,L)}}},c.prototype[h.types.HEIGHTFIELD]=c.prototype.intersectHeightfield;var A=new s,T=new s;c.prototype.intersectSphere=function(M,S,b,N){var j=this.from,$=this.to,O=M.radius,q=Math.pow($.x-j.x,2)+Math.pow($.y-j.y,2)+Math.pow($.z-j.z,2),Q=2*(($.x-j.x)*(j.x-b.x)+($.y-j.y)*(j.y-b.y)+($.z-j.z)*(j.z-b.z)),fe=Math.pow(j.x-b.x,2)+Math.pow(j.y-b.y,2)+Math.pow(j.z-b.z,2)-Math.pow(O,2),ue=Math.pow(Q,2)-4*q*fe,he=A,K=T;if(!(ue<0))if(ue===0)j.lerp($,ue,he),he.vsub(b,K),K.normalize(),this.reportIntersection(K,he,M,N,-1);else{var te=(-Q-Math.sqrt(ue))/(2*q),Se=(-Q+Math.sqrt(ue))/(2*q);if(te>=0&&te<=1&&(j.lerp($,te,he),he.vsub(b,K),K.normalize(),this.reportIntersection(K,he,M,N,-1)),this.result._shouldStop)return;Se>=0&&Se<=1&&(j.lerp($,Se,he),he.vsub(b,K),K.normalize(),this.reportIntersection(K,he,M,N,-1))}},c.prototype[h.types.SPHERE]=c.prototype.intersectSphere;var R=new s;new s,new s;var C=new s;c.prototype.intersectConvex=function(S,b,N,j,$){for(var O=R,q=C,Q=$&&$.faceList||null,fe=S.faces,ue=S.vertices,he=S.faceNormals,K=this._direction,te=this.from,Se=this.to,ge=te.distanceTo(Se),Ne=Q?Q.length:fe.length,pe=this.result,Fe=0;!pe._shouldStop&&Fe<Ne;Fe++){var ze=Q?Q[Fe]:Fe,Ie=fe[ze],De=he[ze],Re=b,Ge=N;q.copy(ue[Ie[0]]),Re.vmult(q,q),q.vadd(Ge,q),q.vsub(te,q),Re.vmult(De,O);var Pe=K.dot(O);if(!(Math.abs(Pe)<this.precision)){var Je=O.dot(q)/Pe;if(!(Je<0)){K.mult(Je,_),_.vadd(te,_),w.copy(ue[Ie[0]]),Re.vmult(w,w),Ge.vadd(w,w);for(var gt=1;!pe._shouldStop&&gt<Ie.length-1;gt++){x.copy(ue[Ie[gt]]),E.copy(ue[Ie[gt+1]]),Re.vmult(x,x),Re.vmult(E,E),Ge.vadd(x,x),Ge.vadd(E,E);var ci=_.distanceTo(te);!(v(_,w,x,E)||v(_,x,w,E))||ci>ge||this.reportIntersection(O,_,S,j,ze)}}}}},c.prototype[h.types.CONVEXPOLYHEDRON]=c.prototype.intersectConvex;var F=new s,I=new s,D=new s,G=new s,Y=new s,z=new s;new l;var B=[],H=new o;c.prototype.intersectTrimesh=function(S,b,N,j,$){var O=F,q=B,Q=H,fe=C,ue=I,he=D,K=G,te=z,Se=Y;$&&$.faceList;var ge=S.indices;S.vertices,S.faceNormals;var Ne=this.from,pe=this.to,Fe=this._direction;Q.position.copy(N),Q.quaternion.copy(b),o.vectorToLocalFrame(N,b,Fe,ue),o.pointToLocalFrame(N,b,Ne,he),o.pointToLocalFrame(N,b,pe,K);var ze=he.distanceSquared(K);S.tree.rayQuery(this,Q,q);for(var Ie=0,De=q.length;!this.result._shouldStop&&Ie!==De;Ie++){var Re=q[Ie];S.getNormal(Re,O),S.getVertex(ge[Re*3],w),w.vsub(he,fe);var Ge=ue.dot(O),Pe=O.dot(fe)/Ge;if(!(Pe<0)){ue.scale(Pe,_),_.vadd(he,_),S.getVertex(ge[Re*3+1],x),S.getVertex(ge[Re*3+2],E);var Je=_.distanceSquared(he);!(v(_,x,w,E)||v(_,w,x,E))||Je>ze||(o.vectorToWorldFrame(b,O,Se),o.pointToWorldFrame(N,b,_,te),this.reportIntersection(Se,te,S,j,Re))}}q.length=0},c.prototype[h.types.TRIMESH]=c.prototype.intersectTrimesh,c.prototype.reportIntersection=function(M,S,b,N,j){var $=this.from,O=this.to,q=$.distanceTo(S),Q=this.result;if(!(this.skipBackfaces&&M.dot(this._direction)>0))switch(Q.hitFaceIndex=typeof j<"u"?j:-1,this.mode){case c.ALL:this.hasHit=!0,Q.set($,O,M,S,b,N,q),Q.hasHit=!0,this.callback(Q);break;case c.CLOSEST:(q<Q.distance||!Q.hasHit)&&(this.hasHit=!0,Q.hasHit=!0,Q.set($,O,M,S,b,N,q));break;case c.ANY:this.hasHit=!0,Q.hasHit=!0,Q.set($,O,M,S,b,N,q),Q._shouldStop=!0;break}};var W=new s,P=new s;function k(M,S,b){b.vsub(M,W);var N=W.dot(S);S.mult(N,P),P.vadd(M,P);var j=b.distanceTo(P);return j}},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(t,n,r){var s=t("../math/Vec3");n.exports=i;function i(){this.rayFromWorld=new s,this.rayToWorld=new s,this.hitNormalWorld=new s,this.hitPointWorld=new s,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}i.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},i.prototype.abort=function(){this._shouldStop=!0},i.prototype.set=function(o,a,h,l,c,u,d){this.rayFromWorld.copy(o),this.rayToWorld.copy(a),this.hitNormalWorld.copy(h),this.hitPointWorld.copy(l),this.shape=c,this.body=u,this.distance=d}},{"../math/Vec3":30}],11:[function(t,n,r){t("../shapes/Shape");var s=t("../collision/Broadphase");n.exports=i;function i(o){s.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var a=this.axisList;this._addBodyHandler=function(h){a.push(h.body)},this._removeBodyHandler=function(h){var l=a.indexOf(h.body);l!==-1&&a.splice(l,1)},o&&this.setWorld(o)}i.prototype=new s,i.prototype.setWorld=function(o){this.axisList.length=0;for(var a=0;a<o.bodies.length;a++)this.axisList.push(o.bodies[a]);o.removeEventListener("addBody",this._addBodyHandler),o.removeEventListener("removeBody",this._removeBodyHandler),o.addEventListener("addBody",this._addBodyHandler),o.addEventListener("removeBody",this._removeBodyHandler),this.world=o,this.dirty=!0},i.insertionSortX=function(o){for(var a=1,h=o.length;a<h;a++){for(var l=o[a],c=a-1;c>=0&&!(o[c].aabb.lowerBound.x<=l.aabb.lowerBound.x);c--)o[c+1]=o[c];o[c+1]=l}return o},i.insertionSortY=function(o){for(var a=1,h=o.length;a<h;a++){for(var l=o[a],c=a-1;c>=0&&!(o[c].aabb.lowerBound.y<=l.aabb.lowerBound.y);c--)o[c+1]=o[c];o[c+1]=l}return o},i.insertionSortZ=function(o){for(var a=1,h=o.length;a<h;a++){for(var l=o[a],c=a-1;c>=0&&!(o[c].aabb.lowerBound.z<=l.aabb.lowerBound.z);c--)o[c+1]=o[c];o[c+1]=l}return o},i.prototype.collisionPairs=function(o,a,h){var l=this.axisList,c=l.length,u=this.axisIndex,d,p;for(this.dirty&&(this.sortList(),this.dirty=!1),d=0;d!==c;d++){var f=l[d];for(p=d+1;p<c;p++){var v=l[p];if(this.needBroadphaseCollision(f,v)){if(!i.checkBounds(f,v,u))break;this.intersectionTest(f,v,a,h)}}}},i.prototype.sortList=function(){for(var o=this.axisList,a=this.axisIndex,h=o.length,l=0;l!==h;l++){var c=o[l];c.aabbNeedsUpdate&&c.computeAABB()}a===0?i.insertionSortX(o):a===1?i.insertionSortY(o):a===2&&i.insertionSortZ(o)},i.checkBounds=function(o,a,h){var l,c;h===0?(l=o.position.x,c=a.position.x):h===1?(l=o.position.y,c=a.position.y):h===2&&(l=o.position.z,c=a.position.z);var u=o.boundingRadius,d=a.boundingRadius,p=l+u,f=c-d;return f<p},i.prototype.autoDetectAxis=function(){for(var o=0,a=0,h=0,l=0,c=0,u=0,d=this.axisList,p=d.length,f=1/p,v=0;v!==p;v++){var m=d[v],y=m.position.x;o+=y,a+=y*y;var _=m.position.y;h+=_,l+=_*_;var w=m.position.z;c+=w,u+=w*w}var x=a-o*o*f,E=l-h*h*f,L=u-c*c*f;x>E?x>L?this.axisIndex=0:this.axisIndex=2:E>L?this.axisIndex=1:this.axisIndex=2},i.prototype.aabbQuery=function(o,a,h){h=h||[],this.dirty&&(this.sortList(),this.dirty=!1);var l=this.axisIndex,c="x";l===1&&(c="y"),l===2&&(c="z");var u=this.axisList;a.lowerBound[c],a.upperBound[c];for(var d=0;d<u.length;d++){var p=u[d];p.aabbNeedsUpdate&&p.computeAABB(),p.aabb.overlaps(a)&&h.push(p)}return h}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(t,n,r){n.exports=h,t("./Constraint");var s=t("./PointToPointConstraint"),i=t("../equations/ConeEquation"),o=t("../equations/RotationalEquation");t("../equations/ContactEquation");var a=t("../math/Vec3");function h(l,c,u){u=u||{};var d=typeof u.maxForce<"u"?u.maxForce:1e6,p=u.pivotA?u.pivotA.clone():new a,f=u.pivotB?u.pivotB.clone():new a;this.axisA=u.axisA?u.axisA.clone():new a,this.axisB=u.axisB?u.axisB.clone():new a,s.call(this,l,p,c,f,d),this.collideConnected=!!u.collideConnected,this.angle=typeof u.angle<"u"?u.angle:0;var v=this.coneEquation=new i(l,c,u),m=this.twistEquation=new o(l,c,u);this.twistAngle=typeof u.twistAngle<"u"?u.twistAngle:0,v.maxForce=0,v.minForce=-d,m.maxForce=0,m.minForce=-d,this.equations.push(v,m)}h.prototype=new s,h.constructor=h,new a,new a,h.prototype.update=function(){var l=this.bodyA,c=this.bodyB,u=this.coneEquation,d=this.twistEquation;s.prototype.update.call(this),l.vectorToWorldFrame(this.axisA,u.axisA),c.vectorToWorldFrame(this.axisB,u.axisB),this.axisA.tangents(d.axisA,d.axisA),l.vectorToWorldFrame(d.axisA,d.axisA),this.axisB.tangents(d.axisB,d.axisB),c.vectorToWorldFrame(d.axisB,d.axisB),u.angle=this.angle,d.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(t,n,r){n.exports=i;var s=t("../utils/Utils");function i(o,a,h){h=s.defaults(h,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=o,this.bodyB=a,this.id=i.idCounter++,this.collideConnected=h.collideConnected,h.wakeUpBodies&&(o&&o.wakeUp(),a&&a.wakeUp())}i.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},i.prototype.enable=function(){for(var o=this.equations,a=0;a<o.length;a++)o[a].enabled=!0},i.prototype.disable=function(){for(var o=this.equations,a=0;a<o.length;a++)o[a].enabled=!1},i.idCounter=0},{"../utils/Utils":53}],14:[function(t,n,r){n.exports=o;var s=t("./Constraint"),i=t("../equations/ContactEquation");function o(a,h,l,c){s.call(this,a,h),typeof l>"u"&&(l=a.position.distanceTo(h.position)),typeof c>"u"&&(c=1e6),this.distance=l;var u=this.distanceEquation=new i(a,h);this.equations.push(u),u.minForce=-c,u.maxForce=c}o.prototype=new s,o.prototype.update=function(){var a=this.bodyA,h=this.bodyB,l=this.distanceEquation,c=this.distance*.5,u=l.ni;h.position.vsub(a.position,u),u.normalize(),u.mult(c,l.ri),u.mult(-c,l.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(t,n,r){n.exports=h,t("./Constraint");var s=t("./PointToPointConstraint"),i=t("../equations/RotationalEquation"),o=t("../equations/RotationalMotorEquation");t("../equations/ContactEquation");var a=t("../math/Vec3");function h(u,d,p){p=p||{};var f=typeof p.maxForce<"u"?p.maxForce:1e6,v=p.pivotA?p.pivotA.clone():new a,m=p.pivotB?p.pivotB.clone():new a;s.call(this,u,v,d,m,f);var y=this.axisA=p.axisA?p.axisA.clone():new a(1,0,0);y.normalize();var _=this.axisB=p.axisB?p.axisB.clone():new a(1,0,0);_.normalize();var w=this.rotationalEquation1=new i(u,d,p),x=this.rotationalEquation2=new i(u,d,p),E=this.motorEquation=new o(u,d,f);E.enabled=!1,this.equations.push(w,x,E)}h.prototype=new s,h.constructor=h,h.prototype.enableMotor=function(){this.motorEquation.enabled=!0},h.prototype.disableMotor=function(){this.motorEquation.enabled=!1},h.prototype.setMotorSpeed=function(u){this.motorEquation.targetVelocity=u},h.prototype.setMotorMaxForce=function(u){this.motorEquation.maxForce=u,this.motorEquation.minForce=-u};var l=new a,c=new a;h.prototype.update=function(){var u=this.bodyA,d=this.bodyB,p=this.motorEquation,f=this.rotationalEquation1,v=this.rotationalEquation2,m=l,y=c,_=this.axisA,w=this.axisB;s.prototype.update.call(this),u.quaternion.vmult(_,m),d.quaternion.vmult(w,y),m.tangents(f.axisA,v.axisA),f.axisB.copy(y),v.axisB.copy(y),this.motorEquation.enabled&&(u.quaternion.vmult(this.axisA,p.axisA),d.quaternion.vmult(this.axisB,p.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(t,n,r){n.exports=a,t("./Constraint");var s=t("./PointToPointConstraint"),i=t("../equations/RotationalEquation");t("../equations/RotationalMotorEquation"),t("../equations/ContactEquation");var o=t("../math/Vec3");function a(h,l,c){c=c||{};var u=typeof c.maxForce<"u"?c.maxForce:1e6,d=new o,p=new o,f=new o;h.position.vadd(l.position,f),f.scale(.5,f),l.pointToLocalFrame(f,p),h.pointToLocalFrame(f,d),s.call(this,h,d,l,p,u);var v=this.rotationalEquation1=new i(h,l,c),m=this.rotationalEquation2=new i(h,l,c),y=this.rotationalEquation3=new i(h,l,c);this.equations.push(v,m,y)}a.prototype=new s,a.constructor=a,new o,new o,a.prototype.update=function(){var h=this.bodyA,l=this.bodyB;this.motorEquation;var c=this.rotationalEquation1,u=this.rotationalEquation2,d=this.rotationalEquation3;s.prototype.update.call(this),h.vectorToWorldFrame(o.UNIT_X,c.axisA),l.vectorToWorldFrame(o.UNIT_Y,c.axisB),h.vectorToWorldFrame(o.UNIT_Y,u.axisA),l.vectorToWorldFrame(o.UNIT_Z,u.axisB),h.vectorToWorldFrame(o.UNIT_Z,d.axisA),l.vectorToWorldFrame(o.UNIT_X,d.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(t,n,r){n.exports=a;var s=t("./Constraint"),i=t("../equations/ContactEquation"),o=t("../math/Vec3");function a(h,l,c,u,d){s.call(this,h,c),d=typeof d<"u"?d:1e6,this.pivotA=l?l.clone():new o,this.pivotB=u?u.clone():new o;var p=this.equationX=new i(h,c),f=this.equationY=new i(h,c),v=this.equationZ=new i(h,c);this.equations.push(p,f,v),p.minForce=f.minForce=v.minForce=-d,p.maxForce=f.maxForce=v.maxForce=d,p.ni.set(1,0,0),f.ni.set(0,1,0),v.ni.set(0,0,1)}a.prototype=new s,a.prototype.update=function(){var h=this.bodyA,l=this.bodyB,c=this.equationX,u=this.equationY,d=this.equationZ;h.quaternion.vmult(this.pivotA,c.ri),l.quaternion.vmult(this.pivotB,c.rj),u.ri.copy(c.ri),u.rj.copy(c.rj),d.ri.copy(c.ri),d.rj.copy(c.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(t,n,r){n.exports=o;var s=t("../math/Vec3");t("../math/Mat3");var i=t("./Equation");function o(l,c,u){u=u||{};var d=typeof u.maxForce<"u"?u.maxForce:1e6;i.call(this,l,c,-d,d),this.axisA=u.axisA?u.axisA.clone():new s(1,0,0),this.axisB=u.axisB?u.axisB.clone():new s(0,1,0),this.angle=typeof u.angle<"u"?u.angle:0}o.prototype=new i,o.prototype.constructor=o;var a=new s,h=new s;o.prototype.computeB=function(l){var c=this.a,u=this.b,d=this.axisA,p=this.axisB,f=a,v=h,m=this.jacobianElementA,y=this.jacobianElementB;d.cross(p,f),p.cross(d,v),m.rotational.copy(v),y.rotational.copy(f);var _=Math.cos(this.angle)-d.dot(p),w=this.computeGW(),x=this.computeGiMf(),E=-_*c-w*u-l*x;return E}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(t,n,r){n.exports=o;var s=t("./Equation"),i=t("../math/Vec3");t("../math/Mat3");function o(v,m,y){y=typeof y<"u"?y:1e6,s.call(this,v,m,0,y),this.restitution=0,this.ri=new i,this.rj=new i,this.ni=new i}o.prototype=new s,o.prototype.constructor=o;var a=new i,h=new i,l=new i;o.prototype.computeB=function(v){var m=this.a,y=this.b,_=this.bi,w=this.bj,x=this.ri,E=this.rj,L=a,A=h,T=_.velocity,R=_.angularVelocity;_.force,_.torque;var C=w.velocity,F=w.angularVelocity;w.force,w.torque;var I=l,D=this.jacobianElementA,G=this.jacobianElementB,Y=this.ni;x.cross(Y,L),E.cross(Y,A),Y.negate(D.spatial),L.negate(D.rotational),G.spatial.copy(Y),G.rotational.copy(A),I.copy(w.position),I.vadd(E,I),I.vsub(_.position,I),I.vsub(x,I);var z=Y.dot(I),B=this.restitution+1,H=B*C.dot(Y)-B*T.dot(Y)+F.dot(A)-R.dot(L),W=this.computeGiMf(),P=-z*m-H*y-v*W;return P};var c=new i,u=new i,d=new i,p=new i,f=new i;o.prototype.getImpactVelocityAlongNormal=function(){var v=c,m=u,y=d,_=p,w=f;return this.bi.position.vadd(this.ri,y),this.bj.position.vadd(this.rj,_),this.bi.getVelocityAtWorldPoint(y,v),this.bj.getVelocityAtWorldPoint(_,m),v.vsub(m,w),this.ni.dot(w)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(t,n,r){n.exports=o;var s=t("../math/JacobianElement"),i=t("../math/Vec3");function o(f,v,m,y){this.id=o.id++,this.minForce=typeof m>"u"?-1e6:m,this.maxForce=typeof y>"u"?1e6:y,this.bi=f,this.bj=v,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new s,this.jacobianElementB=new s,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}o.prototype.constructor=o,o.id=0,o.prototype.setSpookParams=function(f,v,m){var y=v,_=f,w=m;this.a=4/(w*(1+4*y)),this.b=4*y/(1+4*y),this.eps=4/(w*w*_*(1+4*y))},o.prototype.computeB=function(f,v,m){var y=this.computeGW(),_=this.computeGq(),w=this.computeGiMf();return-_*f-y*v-w*m},o.prototype.computeGq=function(){var f=this.jacobianElementA,v=this.jacobianElementB,m=this.bi,y=this.bj,_=m.position,w=y.position;return f.spatial.dot(_)+v.spatial.dot(w)};var a=new i;o.prototype.computeGW=function(){var f=this.jacobianElementA,v=this.jacobianElementB,m=this.bi,y=this.bj,_=m.velocity,w=y.velocity,x=m.angularVelocity||a,E=y.angularVelocity||a;return f.multiplyVectors(_,x)+v.multiplyVectors(w,E)},o.prototype.computeGWlambda=function(){var f=this.jacobianElementA,v=this.jacobianElementB,m=this.bi,y=this.bj,_=m.vlambda,w=y.vlambda,x=m.wlambda||a,E=y.wlambda||a;return f.multiplyVectors(_,x)+v.multiplyVectors(w,E)};var h=new i,l=new i,c=new i,u=new i;o.prototype.computeGiMf=function(){var f=this.jacobianElementA,v=this.jacobianElementB,m=this.bi,y=this.bj,_=m.force,w=m.torque,x=y.force,E=y.torque,L=m.invMassSolve,A=y.invMassSolve;return m.invInertiaWorldSolve?m.invInertiaWorldSolve.vmult(w,c):c.set(0,0,0),y.invInertiaWorldSolve?y.invInertiaWorldSolve.vmult(E,u):u.set(0,0,0),_.mult(L,h),x.mult(A,l),f.multiplyVectors(h,c)+v.multiplyVectors(l,u)};var d=new i;o.prototype.computeGiMGt=function(){var f=this.jacobianElementA,v=this.jacobianElementB,m=this.bi,y=this.bj,_=m.invMassSolve,w=y.invMassSolve,x=m.invInertiaWorldSolve,E=y.invInertiaWorldSolve,L=_+w;return x&&(x.vmult(f.rotational,d),L+=d.dot(f.rotational)),E&&(E.vmult(v.rotational,d),L+=d.dot(v.rotational)),L};var p=new i;new i,new i,new i,new i,new i,o.prototype.addToWlambda=function(f){var v=this.jacobianElementA,m=this.jacobianElementB,y=this.bi,_=this.bj,w=p;v.spatial.mult(y.invMassSolve*f,w),y.vlambda.vadd(w,y.vlambda),m.spatial.mult(_.invMassSolve*f,w),_.vlambda.vadd(w,_.vlambda),y.invInertiaWorldSolve&&(y.invInertiaWorldSolve.vmult(v.rotational,w),w.mult(f,w),y.wlambda.vadd(w,y.wlambda)),_.invInertiaWorldSolve&&(_.invInertiaWorldSolve.vmult(m.rotational,w),w.mult(f,w),_.wlambda.vadd(w,_.wlambda))},o.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(t,n,r){n.exports=o;var s=t("./Equation"),i=t("../math/Vec3");t("../math/Mat3");function o(l,c,u){s.call(this,l,c,-u,u),this.ri=new i,this.rj=new i,this.t=new i}o.prototype=new s,o.prototype.constructor=o;var a=new i,h=new i;o.prototype.computeB=function(l){this.a;var c=this.b;this.bi,this.bj;var u=this.ri,d=this.rj,p=a,f=h,v=this.t;u.cross(v,p),d.cross(v,f);var m=this.jacobianElementA,y=this.jacobianElementB;v.negate(m.spatial),p.negate(m.rotational),y.spatial.copy(v),y.rotational.copy(f);var _=this.computeGW(),w=this.computeGiMf(),x=-_*c-l*w;return x}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(t,n,r){n.exports=o;var s=t("../math/Vec3");t("../math/Mat3");var i=t("./Equation");function o(l,c,u){u=u||{};var d=typeof u.maxForce<"u"?u.maxForce:1e6;i.call(this,l,c,-d,d),this.axisA=u.axisA?u.axisA.clone():new s(1,0,0),this.axisB=u.axisB?u.axisB.clone():new s(0,1,0),this.maxAngle=Math.PI/2}o.prototype=new i,o.prototype.constructor=o;var a=new s,h=new s;o.prototype.computeB=function(l){var c=this.a,u=this.b,d=this.axisA,p=this.axisB,f=a,v=h,m=this.jacobianElementA,y=this.jacobianElementB;d.cross(p,f),p.cross(d,v),m.rotational.copy(v),y.rotational.copy(f);var _=Math.cos(this.maxAngle)-d.dot(p),w=this.computeGW(),x=this.computeGiMf(),E=-_*c-w*u-l*x;return E}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(t,n,r){n.exports=o;var s=t("../math/Vec3");t("../math/Mat3");var i=t("./Equation");function o(a,h,l){l=typeof l<"u"?l:1e6,i.call(this,a,h,-l,l),this.axisA=new s,this.axisB=new s,this.targetVelocity=0}o.prototype=new i,o.prototype.constructor=o,o.prototype.computeB=function(a){this.a;var h=this.b;this.bi,this.bj;var l=this.axisA,c=this.axisB,u=this.jacobianElementA,d=this.jacobianElementB;u.rotational.copy(l),c.negate(d.rotational);var p=this.computeGW()-this.targetVelocity,f=this.computeGiMf(),v=-p*h-a*f;return v}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(t,n,r){var s=t("../utils/Utils");n.exports=i;function i(o,a,h){h=s.defaults(h,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=i.idCounter++,this.materials=[o,a],this.friction=h.friction,this.restitution=h.restitution,this.contactEquationStiffness=h.contactEquationStiffness,this.contactEquationRelaxation=h.contactEquationRelaxation,this.frictionEquationStiffness=h.frictionEquationStiffness,this.frictionEquationRelaxation=h.frictionEquationRelaxation}i.idCounter=0},{"../utils/Utils":53}],25:[function(t,n,r){n.exports=s;function s(i){var o="";i=i||{},typeof i=="string"?(o=i,i={}):typeof i=="object"&&(o=""),this.name=o,this.id=s.idCounter++,this.friction=typeof i.friction<"u"?i.friction:-1,this.restitution=typeof i.restitution<"u"?i.restitution:-1}s.idCounter=0},{}],26:[function(t,n,r){n.exports=i;var s=t("./Vec3");function i(){this.spatial=new s,this.rotational=new s}i.prototype.multiplyElement=function(o){return o.spatial.dot(this.spatial)+o.rotational.dot(this.rotational)},i.prototype.multiplyVectors=function(o,a){return o.dot(this.spatial)+a.dot(this.rotational)}},{"./Vec3":30}],27:[function(t,n,r){n.exports=i;var s=t("./Vec3");function i(o){o?this.elements=o:this.elements=[0,0,0,0,0,0,0,0,0]}i.prototype.identity=function(){var o=this.elements;o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=1,o[5]=0,o[6]=0,o[7]=0,o[8]=1},i.prototype.setZero=function(){var o=this.elements;o[0]=0,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=0,o[6]=0,o[7]=0,o[8]=0},i.prototype.setTrace=function(o){var a=this.elements;a[0]=o.x,a[4]=o.y,a[8]=o.z},i.prototype.getTrace=function(a){var a=a||new s,h=this.elements;a.x=h[0],a.y=h[4],a.z=h[8]},i.prototype.vmult=function(o,a){a=a||new s;var h=this.elements,l=o.x,c=o.y,u=o.z;return a.x=h[0]*l+h[1]*c+h[2]*u,a.y=h[3]*l+h[4]*c+h[5]*u,a.z=h[6]*l+h[7]*c+h[8]*u,a},i.prototype.smult=function(o){for(var a=0;a<this.elements.length;a++)this.elements[a]*=o},i.prototype.mmult=function(o,a){for(var h=a||new i,l=0;l<3;l++)for(var c=0;c<3;c++){for(var u=0,d=0;d<3;d++)u+=o.elements[l+d*3]*this.elements[d+c*3];h.elements[l+c*3]=u}return h},i.prototype.scale=function(o,a){a=a||new i;for(var h=this.elements,l=a.elements,c=0;c!==3;c++)l[3*c+0]=o.x*h[3*c+0],l[3*c+1]=o.y*h[3*c+1],l[3*c+2]=o.z*h[3*c+2];return a},i.prototype.solve=function(o,a){a=a||new s;for(var h=3,l=4,c=[],u=0;u<h*l;u++)c.push(0);var u,d;for(u=0;u<3;u++)for(d=0;d<3;d++)c[u+l*d]=this.elements[u+3*d];c[3+4*0]=o.x,c[3+4*1]=o.y,c[3+4*2]=o.z;var p=3,f=p,v,m=4,y;do{if(u=f-p,c[u+l*u]===0){for(d=u+1;d<f;d++)if(c[u+l*d]!==0){v=m;do y=m-v,c[y+l*u]+=c[y+l*d];while(--v);break}}if(c[u+l*u]!==0)for(d=u+1;d<f;d++){var _=c[u+l*d]/c[u+l*u];v=m;do y=m-v,c[y+l*d]=y<=u?0:c[y+l*d]-c[y+l*u]*_;while(--v)}}while(--p);if(a.z=c[2*l+3]/c[2*l+2],a.y=(c[1*l+3]-c[1*l+2]*a.z)/c[1*l+1],a.x=(c[0*l+3]-c[0*l+2]*a.z-c[0*l+1]*a.y)/c[0*l+0],isNaN(a.x)||isNaN(a.y)||isNaN(a.z)||a.x===1/0||a.y===1/0||a.z===1/0)throw"Could not solve equation! Got x=["+a.toString()+"], b=["+o.toString()+"], A=["+this.toString()+"]";return a},i.prototype.e=function(o,a,h){if(h===void 0)return this.elements[a+3*o];this.elements[a+3*o]=h},i.prototype.copy=function(o){for(var a=0;a<o.elements.length;a++)this.elements[a]=o.elements[a];return this},i.prototype.toString=function(){for(var o="",a=",",h=0;h<9;h++)o+=this.elements[h]+a;return o},i.prototype.reverse=function(o){o=o||new i;for(var a=3,h=6,l=[],c=0;c<a*h;c++)l.push(0);var c,u;for(c=0;c<3;c++)for(u=0;u<3;u++)l[c+h*u]=this.elements[c+3*u];l[3+6*0]=1,l[3+6*1]=0,l[3+6*2]=0,l[4+6*0]=0,l[4+6*1]=1,l[4+6*2]=0,l[5+6*0]=0,l[5+6*1]=0,l[5+6*2]=1;var d=3,p=d,f,v=h,m;do{if(c=p-d,l[c+h*c]===0){for(u=c+1;u<p;u++)if(l[c+h*u]!==0){f=v;do m=v-f,l[m+h*c]+=l[m+h*u];while(--f);break}}if(l[c+h*c]!==0)for(u=c+1;u<p;u++){var y=l[c+h*u]/l[c+h*c];f=v;do m=v-f,l[m+h*u]=m<=c?0:l[m+h*u]-l[m+h*c]*y;while(--f)}}while(--d);c=2;do{u=c-1;do{var y=l[c+h*u]/l[c+h*c];f=h;do m=h-f,l[m+h*u]=l[m+h*u]-l[m+h*c]*y;while(--f)}while(u--)}while(--c);c=2;do{var y=1/l[c+h*c];f=h;do m=h-f,l[m+h*c]=l[m+h*c]*y;while(--f)}while(c--);c=2;do{u=2;do{if(m=l[a+u+h*c],isNaN(m)||m===1/0)throw"Could not reverse! A=["+this.toString()+"]";o.e(c,u,m)}while(u--)}while(c--);return o},i.prototype.setRotationFromQuaternion=function(o){var a=o.x,h=o.y,l=o.z,c=o.w,u=a+a,d=h+h,p=l+l,f=a*u,v=a*d,m=a*p,y=h*d,_=h*p,w=l*p,x=c*u,E=c*d,L=c*p,A=this.elements;return A[3*0+0]=1-(y+w),A[3*0+1]=v-L,A[3*0+2]=m+E,A[3*1+0]=v+L,A[3*1+1]=1-(f+w),A[3*1+2]=_-x,A[3*2+0]=m-E,A[3*2+1]=_+x,A[3*2+2]=1-(f+y),this},i.prototype.transpose=function(o){o=o||new i;for(var a=o.elements,h=this.elements,l=0;l!==3;l++)for(var c=0;c!==3;c++)a[3*l+c]=h[3*c+l];return o}},{"./Vec3":30}],28:[function(t,n,r){n.exports=i;var s=t("./Vec3");function i(u,d,p,f){this.x=u!==void 0?u:0,this.y=d!==void 0?d:0,this.z=p!==void 0?p:0,this.w=f!==void 0?f:1}i.prototype.set=function(u,d,p,f){this.x=u,this.y=d,this.z=p,this.w=f},i.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},i.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},i.prototype.setFromAxisAngle=function(u,d){var p=Math.sin(d*.5);this.x=u.x*p,this.y=u.y*p,this.z=u.z*p,this.w=Math.cos(d*.5)},i.prototype.toAxisAngle=function(u){u=u||new s,this.normalize();var d=2*Math.acos(this.w),p=Math.sqrt(1-this.w*this.w);return p<.001?(u.x=this.x,u.y=this.y,u.z=this.z):(u.x=this.x/p,u.y=this.y/p,u.z=this.z/p),[u,d]};var o=new s,a=new s;i.prototype.setFromVectors=function(u,d){if(u.isAntiparallelTo(d)){var p=o,f=a;u.tangents(p,f),this.setFromAxisAngle(p,Math.PI)}else{var v=u.cross(d);this.x=v.x,this.y=v.y,this.z=v.z,this.w=Math.sqrt(Math.pow(u.norm(),2)*Math.pow(d.norm(),2))+u.dot(d),this.normalize()}};var h=new s,l=new s,c=new s;i.prototype.mult=function(u,d){d=d||new i;var p=this.w,f=h,v=l,m=c;return f.set(this.x,this.y,this.z),v.set(u.x,u.y,u.z),d.w=p*u.w-f.dot(v),f.cross(v,m),d.x=p*v.x+u.w*f.x+m.x,d.y=p*v.y+u.w*f.y+m.y,d.z=p*v.z+u.w*f.z+m.z,d},i.prototype.inverse=function(u){var d=this.x,p=this.y,f=this.z,v=this.w;u=u||new i,this.conjugate(u);var m=1/(d*d+p*p+f*f+v*v);return u.x*=m,u.y*=m,u.z*=m,u.w*=m,u},i.prototype.conjugate=function(u){return u=u||new i,u.x=-this.x,u.y=-this.y,u.z=-this.z,u.w=this.w,u},i.prototype.normalize=function(){var u=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);u===0?(this.x=0,this.y=0,this.z=0,this.w=0):(u=1/u,this.x*=u,this.y*=u,this.z*=u,this.w*=u)},i.prototype.normalizeFast=function(){var u=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;u===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=u,this.y*=u,this.z*=u,this.w*=u)},i.prototype.vmult=function(u,d){d=d||new s;var p=u.x,f=u.y,v=u.z,m=this.x,y=this.y,_=this.z,w=this.w,x=w*p+y*v-_*f,E=w*f+_*p-m*v,L=w*v+m*f-y*p,A=-m*p-y*f-_*v;return d.x=x*w+A*-m+E*-_-L*-y,d.y=E*w+A*-y+L*-m-x*-_,d.z=L*w+A*-_+x*-y-E*-m,d},i.prototype.copy=function(u){return this.x=u.x,this.y=u.y,this.z=u.z,this.w=u.w,this},i.prototype.toEuler=function(u,d){d=d||"YZX";var p,f,v,m=this.x,y=this.y,_=this.z,w=this.w;switch(d){case"YZX":var x=m*y+_*w;if(x>.499&&(p=2*Math.atan2(m,w),f=Math.PI/2,v=0),x<-.499&&(p=-2*Math.atan2(m,w),f=-Math.PI/2,v=0),isNaN(p)){var E=m*m,L=y*y,A=_*_;p=Math.atan2(2*y*w-2*m*_,1-2*L-2*A),f=Math.asin(2*x),v=Math.atan2(2*m*w-2*y*_,1-2*E-2*A)}break;default:throw new Error("Euler order "+d+" not supported yet.")}u.y=p,u.z=f,u.x=v},i.prototype.setFromEuler=function(u,d,p,f){f=f||"XYZ";var v=Math.cos(u/2),m=Math.cos(d/2),y=Math.cos(p/2),_=Math.sin(u/2),w=Math.sin(d/2),x=Math.sin(p/2);return f==="XYZ"?(this.x=_*m*y+v*w*x,this.y=v*w*y-_*m*x,this.z=v*m*x+_*w*y,this.w=v*m*y-_*w*x):f==="YXZ"?(this.x=_*m*y+v*w*x,this.y=v*w*y-_*m*x,this.z=v*m*x-_*w*y,this.w=v*m*y+_*w*x):f==="ZXY"?(this.x=_*m*y-v*w*x,this.y=v*w*y+_*m*x,this.z=v*m*x+_*w*y,this.w=v*m*y-_*w*x):f==="ZYX"?(this.x=_*m*y-v*w*x,this.y=v*w*y+_*m*x,this.z=v*m*x-_*w*y,this.w=v*m*y+_*w*x):f==="YZX"?(this.x=_*m*y+v*w*x,this.y=v*w*y+_*m*x,this.z=v*m*x-_*w*y,this.w=v*m*y-_*w*x):f==="XZY"&&(this.x=_*m*y-v*w*x,this.y=v*w*y-_*m*x,this.z=v*m*x+_*w*y,this.w=v*m*y+_*w*x),this},i.prototype.clone=function(){return new i(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(t,n,r){var s=t("./Vec3"),i=t("./Quaternion");n.exports=o;function o(h){h=h||{},this.position=new s,h.position&&this.position.copy(h.position),this.quaternion=new i,h.quaternion&&this.quaternion.copy(h.quaternion)}var a=new i;o.pointToLocalFrame=function(h,l,c,d){var d=d||new s;return c.vsub(h,d),l.conjugate(a),a.vmult(d,d),d},o.prototype.pointToLocal=function(h,l){return o.pointToLocalFrame(this.position,this.quaternion,h,l)},o.pointToWorldFrame=function(h,l,c,d){var d=d||new s;return l.vmult(c,d),d.vadd(h,d),d},o.prototype.pointToWorld=function(h,l){return o.pointToWorldFrame(this.position,this.quaternion,h,l)},o.prototype.vectorToWorldFrame=function(h,c){var c=c||new s;return this.quaternion.vmult(h,c),c},o.vectorToWorldFrame=function(h,l,c){return h.vmult(l,c),c},o.vectorToLocalFrame=function(h,l,c,d){var d=d||new s;return l.w*=-1,l.vmult(c,d),l.w*=-1,d}},{"./Quaternion":28,"./Vec3":30}],30:[function(t,n,r){n.exports=i;var s=t("./Mat3");function i(l,c,u){this.x=l||0,this.y=c||0,this.z=u||0}i.ZERO=new i(0,0,0),i.UNIT_X=new i(1,0,0),i.UNIT_Y=new i(0,1,0),i.UNIT_Z=new i(0,0,1),i.prototype.cross=function(l,c){var u=l.x,d=l.y,p=l.z,f=this.x,v=this.y,m=this.z;return c=c||new i,c.x=v*p-m*d,c.y=m*u-f*p,c.z=f*d-v*u,c},i.prototype.set=function(l,c,u){return this.x=l,this.y=c,this.z=u,this},i.prototype.setZero=function(){this.x=this.y=this.z=0},i.prototype.vadd=function(l,c){if(c)c.x=l.x+this.x,c.y=l.y+this.y,c.z=l.z+this.z;else return new i(this.x+l.x,this.y+l.y,this.z+l.z)},i.prototype.vsub=function(l,c){if(c)c.x=this.x-l.x,c.y=this.y-l.y,c.z=this.z-l.z;else return new i(this.x-l.x,this.y-l.y,this.z-l.z)},i.prototype.crossmat=function(){return new s([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},i.prototype.normalize=function(){var l=this.x,c=this.y,u=this.z,d=Math.sqrt(l*l+c*c+u*u);if(d>0){var p=1/d;this.x*=p,this.y*=p,this.z*=p}else this.x=0,this.y=0,this.z=0;return d},i.prototype.unit=function(l){l=l||new i;var c=this.x,u=this.y,d=this.z,p=Math.sqrt(c*c+u*u+d*d);return p>0?(p=1/p,l.x=c*p,l.y=u*p,l.z=d*p):(l.x=1,l.y=0,l.z=0),l},i.prototype.norm=function(){var l=this.x,c=this.y,u=this.z;return Math.sqrt(l*l+c*c+u*u)},i.prototype.length=i.prototype.norm,i.prototype.norm2=function(){return this.dot(this)},i.prototype.lengthSquared=i.prototype.norm2,i.prototype.distanceTo=function(l){var c=this.x,u=this.y,d=this.z,p=l.x,f=l.y,v=l.z;return Math.sqrt((p-c)*(p-c)+(f-u)*(f-u)+(v-d)*(v-d))},i.prototype.distanceSquared=function(l){var c=this.x,u=this.y,d=this.z,p=l.x,f=l.y,v=l.z;return(p-c)*(p-c)+(f-u)*(f-u)+(v-d)*(v-d)},i.prototype.mult=function(l,c){c=c||new i;var u=this.x,d=this.y,p=this.z;return c.x=l*u,c.y=l*d,c.z=l*p,c},i.prototype.scale=i.prototype.mult,i.prototype.dot=function(l){return this.x*l.x+this.y*l.y+this.z*l.z},i.prototype.isZero=function(){return this.x===0&&this.y===0&&this.z===0},i.prototype.negate=function(l){return l=l||new i,l.x=-this.x,l.y=-this.y,l.z=-this.z,l};var o=new i,a=new i;i.prototype.tangents=function(l,c){var u=this.norm();if(u>0){var d=o,p=1/u;d.set(this.x*p,this.y*p,this.z*p);var f=a;Math.abs(d.x)<.9?(f.set(1,0,0),d.cross(f,l)):(f.set(0,1,0),d.cross(f,l)),d.cross(l,c)}else l.set(1,0,0),c.set(0,1,0)},i.prototype.toString=function(){return this.x+","+this.y+","+this.z},i.prototype.toArray=function(){return[this.x,this.y,this.z]},i.prototype.copy=function(l){return this.x=l.x,this.y=l.y,this.z=l.z,this},i.prototype.lerp=function(l,c,u){var d=this.x,p=this.y,f=this.z;u.x=d+(l.x-d)*c,u.y=p+(l.y-p)*c,u.z=f+(l.z-f)*c},i.prototype.almostEquals=function(l,c){return c===void 0&&(c=1e-6),!(Math.abs(this.x-l.x)>c||Math.abs(this.y-l.y)>c||Math.abs(this.z-l.z)>c)},i.prototype.almostZero=function(l){return l===void 0&&(l=1e-6),!(Math.abs(this.x)>l||Math.abs(this.y)>l||Math.abs(this.z)>l)};var h=new i;i.prototype.isAntiparallelTo=function(l,c){return this.negate(h),h.almostEquals(l,c)},i.prototype.clone=function(){return new i(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(t,n,r){n.exports=c;var s=t("../utils/EventTarget");t("../shapes/Shape");var i=t("../math/Vec3"),o=t("../math/Mat3"),a=t("../math/Quaternion");t("../material/Material");var h=t("../collision/AABB"),l=t("../shapes/Box");function c(C){C=C||{},s.apply(this),this.id=c.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new i,this.collisionFilterGroup=typeof C.collisionFilterGroup=="number"?C.collisionFilterGroup:1,this.collisionFilterMask=typeof C.collisionFilterMask=="number"?C.collisionFilterMask:1,this.collisionResponse=!0,this.position=new i,C.position&&this.position.copy(C.position),this.previousPosition=new i,this.initPosition=new i,this.velocity=new i,C.velocity&&this.velocity.copy(C.velocity),this.initVelocity=new i,this.force=new i;var F=typeof C.mass=="number"?C.mass:0;this.mass=F,this.invMass=F>0?1/F:0,this.material=C.material||null,this.linearDamping=typeof C.linearDamping=="number"?C.linearDamping:.01,this.type=F<=0?c.STATIC:c.DYNAMIC,typeof C.type==typeof c.STATIC&&(this.type=C.type),this.allowSleep=typeof C.allowSleep<"u"?C.allowSleep:!0,this.sleepState=0,this.sleepSpeedLimit=typeof C.sleepSpeedLimit<"u"?C.sleepSpeedLimit:.1,this.sleepTimeLimit=typeof C.sleepTimeLimit<"u"?C.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new i,this.quaternion=new a,C.quaternion&&this.quaternion.copy(C.quaternion),this.initQuaternion=new a,this.angularVelocity=new i,C.angularVelocity&&this.angularVelocity.copy(C.angularVelocity),this.initAngularVelocity=new i,this.interpolatedPosition=new i,this.interpolatedQuaternion=new a,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new i,this.invInertia=new i,this.invInertiaWorld=new o,this.invMassSolve=0,this.invInertiaSolve=new i,this.invInertiaWorldSolve=new o,this.fixedRotation=typeof C.fixedRotation<"u"?C.fixedRotation:!1,this.angularDamping=typeof C.angularDamping<"u"?C.angularDamping:.01,this.aabb=new h,this.aabbNeedsUpdate=!0,this.wlambda=new i,C.shape&&this.addShape(C.shape),this.updateMassProperties()}c.prototype=new s,c.prototype.constructor=c,c.DYNAMIC=1,c.STATIC=2,c.KINEMATIC=4,c.AWAKE=0,c.SLEEPY=1,c.SLEEPING=2,c.idCounter=0,c.prototype.wakeUp=function(){var C=this.sleepState;this.sleepState=0,C===c.SLEEPING&&this.dispatchEvent({type:"wakeup"})},c.prototype.sleep=function(){this.sleepState=c.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},c.sleepyEvent={type:"sleepy"},c.sleepEvent={type:"sleep"},c.prototype.sleepTick=function(C){if(this.allowSleep){var F=this.sleepState,I=this.velocity.norm2()+this.angularVelocity.norm2(),D=Math.pow(this.sleepSpeedLimit,2);F===c.AWAKE&&I<D?(this.sleepState=c.SLEEPY,this.timeLastSleepy=C,this.dispatchEvent(c.sleepyEvent)):F===c.SLEEPY&&I>D?this.wakeUp():F===c.SLEEPY&&C-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(c.sleepEvent))}},c.prototype.updateSolveMassProperties=function(){this.sleepState===c.SLEEPING||this.type===c.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},c.prototype.pointToLocalFrame=function(C,I){var I=I||new i;return C.vsub(this.position,I),this.quaternion.conjugate().vmult(I,I),I},c.prototype.vectorToLocalFrame=function(C,I){var I=I||new i;return this.quaternion.conjugate().vmult(C,I),I},c.prototype.pointToWorldFrame=function(C,I){var I=I||new i;return this.quaternion.vmult(C,I),I.vadd(this.position,I),I},c.prototype.vectorToWorldFrame=function(C,I){var I=I||new i;return this.quaternion.vmult(C,I),I};var u=new i,d=new a;c.prototype.addShape=function(C,F,I){var D=new i,G=new a;return F&&D.copy(F),I&&G.copy(I),this.shapes.push(C),this.shapeOffsets.push(D),this.shapeOrientations.push(G),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},c.prototype.updateBoundingRadius=function(){for(var C=this.shapes,F=this.shapeOffsets,I=C.length,D=0,G=0;G!==I;G++){var Y=C[G];Y.updateBoundingSphereRadius();var z=F[G].norm(),B=Y.boundingSphereRadius;z+B>D&&(D=z+B)}this.boundingRadius=D};var p=new h;c.prototype.computeAABB=function(){for(var C=this.shapes,F=this.shapeOffsets,I=this.shapeOrientations,D=C.length,G=u,Y=d,z=this.quaternion,B=this.aabb,H=p,W=0;W!==D;W++){var P=C[W];I[W].mult(z,Y),Y.vmult(F[W],G),G.vadd(this.position,G),P.calculateWorldAABB(G,Y,H.lowerBound,H.upperBound),W===0?B.copy(H):B.extend(H)}this.aabbNeedsUpdate=!1};var f=new o,v=new o;new o,c.prototype.updateInertiaWorld=function(C){var F=this.invInertia;if(!(F.x===F.y&&F.y===F.z&&!C)){var I=f,D=v;I.setRotationFromQuaternion(this.quaternion),I.transpose(D),I.scale(F,I),I.mmult(D,this.invInertiaWorld)}};var m=new i,y=new i;c.prototype.applyForce=function(C,F){if(this.type===c.DYNAMIC){var I=m;F.vsub(this.position,I);var D=y;I.cross(C,D),this.force.vadd(C,this.force),this.torque.vadd(D,this.torque)}};var _=new i,w=new i;c.prototype.applyLocalForce=function(C,F){if(this.type===c.DYNAMIC){var I=_,D=w;this.vectorToWorldFrame(C,I),this.pointToWorldFrame(F,D),this.applyForce(I,D)}};var x=new i,E=new i,L=new i;c.prototype.applyImpulse=function(C,F){if(this.type===c.DYNAMIC){var I=x;F.vsub(this.position,I);var D=E;D.copy(C),D.mult(this.invMass,D),this.velocity.vadd(D,this.velocity);var G=L;I.cross(C,G),this.invInertiaWorld.vmult(G,G),this.angularVelocity.vadd(G,this.angularVelocity)}};var A=new i,T=new i;c.prototype.applyLocalImpulse=function(C,F){if(this.type===c.DYNAMIC){var I=A,D=T;this.vectorToWorldFrame(C,I),this.pointToWorldFrame(F,D),this.applyImpulse(I,D)}};var R=new i;c.prototype.updateMassProperties=function(){var C=R;this.invMass=this.mass>0?1/this.mass:0;var F=this.inertia,I=this.fixedRotation;this.computeAABB(),C.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),l.calculateInertia(C,this.mass,F),this.invInertia.set(F.x>0&&!I?1/F.x:0,F.y>0&&!I?1/F.y:0,F.z>0&&!I?1/F.z:0),this.updateInertiaWorld(!0)},c.prototype.getVelocityAtWorldPoint=function(C,F){var I=new i;return C.vsub(this.position,I),this.angularVelocity.cross(I,F),this.velocity.vadd(F,F),F}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(t,n,r){t("./Body");var s=t("../math/Vec3"),i=t("../math/Quaternion");t("../collision/RaycastResult");var o=t("../collision/Ray"),a=t("../objects/WheelInfo");n.exports=h;function h(z){this.chassisBody=z.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=typeof z.indexRightAxis<"u"?z.indexRightAxis:1,this.indexForwardAxis=typeof z.indexForwardAxis<"u"?z.indexForwardAxis:0,this.indexUpAxis=typeof z.indexUpAxis<"u"?z.indexUpAxis:2}new s,new s,new s;var l=new s,c=new s,u=new s;new o,h.prototype.addWheel=function(z){z=z||{};var B=new a(z),H=this.wheelInfos.length;return this.wheelInfos.push(B),H},h.prototype.setSteeringValue=function(z,B){var H=this.wheelInfos[B];H.steering=z},new s,h.prototype.applyEngineForce=function(z,B){this.wheelInfos[B].engineForce=z},h.prototype.setBrake=function(z,B){this.wheelInfos[B].brake=z},h.prototype.addToWorld=function(z){this.constraints,z.add(this.chassisBody);var B=this;this.preStepCallback=function(){B.updateVehicle(z.dt)},z.addEventListener("preStep",this.preStepCallback),this.world=z},h.prototype.getVehicleAxisWorld=function(z,B){B.set(z===0?1:0,z===1?1:0,z===2?1:0),this.chassisBody.vectorToWorldFrame(B,B)},h.prototype.updateVehicle=function(z){for(var B=this.wheelInfos,H=B.length,W=this.chassisBody,P=0;P<H;P++)this.updateWheelTransform(P);this.currentVehicleSpeedKmHour=3.6*W.velocity.norm();var k=new s;this.getVehicleAxisWorld(this.indexForwardAxis,k),k.dot(W.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1);for(var P=0;P<H;P++)this.castRay(B[P]);this.updateSuspension(z);for(var M=new s,S=new s,P=0;P<H;P++){var b=B[P],N=b.suspensionForce;N>b.maxSuspensionForce&&(N=b.maxSuspensionForce),b.raycastResult.hitNormalWorld.scale(N*z,M),b.raycastResult.hitPointWorld.vsub(W.position,S),W.applyImpulse(M,b.raycastResult.hitPointWorld)}this.updateFriction(z);var j=new s,$=new s,O=new s;for(P=0;P<H;P++){var b=B[P];W.getVelocityAtWorldPoint(b.chassisConnectionPointWorld,O);var q=1;switch(this.indexUpAxis){case 1:q=-1;break}if(b.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,$);var Q=$.dot(b.raycastResult.hitNormalWorld);b.raycastResult.hitNormalWorld.scale(Q,j),$.vsub(j,$);var fe=$.dot(O);b.deltaRotation=q*fe*z/b.radius}(b.sliding||!b.isInContact)&&b.engineForce!==0&&b.useCustomSlidingRotationalSpeed&&(b.deltaRotation=(b.engineForce>0?1:-1)*b.customSlidingRotationalSpeed*z),Math.abs(b.brake)>Math.abs(b.engineForce)&&(b.deltaRotation=0),b.rotation+=b.deltaRotation,b.deltaRotation*=.99}},h.prototype.updateSuspension=function(z){for(var B=this.chassisBody,H=B.mass,W=this.wheelInfos,P=W.length,k=0;k<P;k++){var M=W[k];if(M.isInContact){var S,b=M.suspensionRestLength,N=M.suspensionLength,j=b-N;S=M.suspensionStiffness*j*M.clippedInvContactDotSuspension;var $=M.suspensionRelativeVelocity,O;$<0?O=M.dampingCompression:O=M.dampingRelaxation,S-=O*$,M.suspensionForce=S*H,M.suspensionForce<0&&(M.suspensionForce=0)}else M.suspensionForce=0}},h.prototype.removeFromWorld=function(z){this.constraints,z.remove(this.chassisBody),z.removeEventListener("preStep",this.preStepCallback),this.world=null};var d=new s,p=new s;h.prototype.castRay=function(z){var B=d,H=p;this.updateWheelTransformWorld(z);var W=this.chassisBody,P=-1,k=z.suspensionRestLength+z.radius;z.directionWorld.scale(k,B);var M=z.chassisConnectionPointWorld;M.vadd(B,H);var S=z.raycastResult;S.reset();var b=W.collisionResponse;W.collisionResponse=!1,this.world.rayTest(M,H,S),W.collisionResponse=b;var N=S.body;if(z.raycastResult.groundObject=0,N){P=S.distance,z.raycastResult.hitNormalWorld=S.hitNormalWorld,z.isInContact=!0;var j=S.distance;z.suspensionLength=j-z.radius;var $=z.suspensionRestLength-z.maxSuspensionTravel,O=z.suspensionRestLength+z.maxSuspensionTravel;z.suspensionLength<$&&(z.suspensionLength=$),z.suspensionLength>O&&(z.suspensionLength=O,z.raycastResult.reset());var q=z.raycastResult.hitNormalWorld.dot(z.directionWorld),Q=new s;W.getVelocityAtWorldPoint(z.raycastResult.hitPointWorld,Q);var fe=z.raycastResult.hitNormalWorld.dot(Q);if(q>=-.1)z.suspensionRelativeVelocity=0,z.clippedInvContactDotSuspension=1/.1;else{var ue=-1/q;z.suspensionRelativeVelocity=fe*ue,z.clippedInvContactDotSuspension=ue}}else z.suspensionLength=z.suspensionRestLength+0*z.maxSuspensionTravel,z.suspensionRelativeVelocity=0,z.directionWorld.scale(-1,z.raycastResult.hitNormalWorld),z.clippedInvContactDotSuspension=1;return P},h.prototype.updateWheelTransformWorld=function(z){z.isInContact=!1;var B=this.chassisBody;B.pointToWorldFrame(z.chassisConnectionPointLocal,z.chassisConnectionPointWorld),B.vectorToWorldFrame(z.directionLocal,z.directionWorld),B.vectorToWorldFrame(z.axleLocal,z.axleWorld)},h.prototype.updateWheelTransform=function(z){var B=l,H=c,W=u,P=this.wheelInfos[z];this.updateWheelTransformWorld(P),P.directionLocal.scale(-1,B),H.copy(P.axleLocal),B.cross(H,W),W.normalize(),H.normalize();var k=P.steering,M=new i;M.setFromAxisAngle(B,k);var S=new i;S.setFromAxisAngle(H,P.rotation);var b=P.worldTransform.quaternion;this.chassisBody.quaternion.mult(M,b),b.mult(S,b),b.normalize();var N=P.worldTransform.position;N.copy(P.directionWorld),N.scale(P.suspensionLength,N),N.vadd(P.chassisConnectionPointWorld,N)};var f=[new s(1,0,0),new s(0,1,0),new s(0,0,1)];h.prototype.getWheelTransformWorld=function(z){return this.wheelInfos[z].worldTransform};var v=new s,m=[],y=[],_=1;h.prototype.updateFriction=function(z){for(var B=v,H=this.wheelInfos,W=H.length,P=this.chassisBody,k=y,M=m,S=0;S<W;S++){var b=H[S],N=b.raycastResult.body;b.sideImpulse=0,b.forwardImpulse=0,k[S]||(k[S]=new s),M[S]||(M[S]=new s)}for(var S=0;S<W;S++){var b=H[S],N=b.raycastResult.body;if(N){var j=M[S],$=this.getWheelTransformWorld(S);$.vectorToWorldFrame(f[this.indexRightAxis],j);var O=b.raycastResult.hitNormalWorld,q=j.dot(O);O.scale(q,B),j.vsub(B,j),j.normalize(),O.cross(j,k[S]),k[S].normalize(),b.sideImpulse=Y(P,b.raycastResult.hitPointWorld,N,b.raycastResult.hitPointWorld,j),b.sideImpulse*=_}}var Q=1,fe=.5;this.sliding=!1;for(var S=0;S<W;S++){var b=H[S],N=b.raycastResult.body,ue=0;if(b.slipInfo=1,N){var he=0,K=b.brake?b.brake:he;ue=L(P,N,b.raycastResult.hitPointWorld,k[S],K),ue+=b.engineForce*z;var te=K/ue;b.slipInfo*=te}if(b.forwardImpulse=0,b.skidInfo=1,N){b.skidInfo=1;var Se=b.suspensionForce*z*b.frictionSlip,ge=Se,Ne=Se*ge;b.forwardImpulse=ue;var pe=b.forwardImpulse*fe,Fe=b.sideImpulse*Q,ze=pe*pe+Fe*Fe;if(b.sliding=!1,ze>Ne){this.sliding=!0,b.sliding=!0;var te=Se/Math.sqrt(ze);b.skidInfo*=te}}}if(this.sliding)for(var S=0;S<W;S++){var b=H[S];b.sideImpulse!==0&&b.skidInfo<1&&(b.forwardImpulse*=b.skidInfo,b.sideImpulse*=b.skidInfo)}for(var S=0;S<W;S++){var b=H[S],Ie=new s;if(Ie.copy(b.raycastResult.hitPointWorld),b.forwardImpulse!==0){var De=new s;k[S].scale(b.forwardImpulse,De),P.applyImpulse(De,Ie)}if(b.sideImpulse!==0){var N=b.raycastResult.body,Re=new s;Re.copy(b.raycastResult.hitPointWorld);var Ge=new s;M[S].scale(b.sideImpulse,Ge),P.pointToLocalFrame(Ie,Ie),Ie["xyz"[this.indexUpAxis]]*=b.rollInfluence,P.pointToWorldFrame(Ie,Ie),P.applyImpulse(Ge,Ie),Ge.scale(-1,Ge),N.applyImpulse(Ge,Re)}}};var w=new s,x=new s,E=new s;function L(z,B,H,W,P){var k=0,M=H,S=w,b=x,N=E;z.getVelocityAtWorldPoint(M,S),B.getVelocityAtWorldPoint(M,b),S.vsub(b,N);var j=W.dot(N),$=F(z,H,W),O=F(B,H,W),q=1,Q=q/($+O);return k=-j*Q,P<k&&(k=P),k<-P&&(k=-P),k}var A=new s,T=new s,R=new s,C=new s;function F(z,B,H){var W=A,P=T,k=R,M=C;return B.vsub(z.position,W),W.cross(H,P),z.invInertiaWorld.vmult(P,M),M.cross(W,k),z.invMass+H.dot(k)}var I=new s,D=new s,G=new s;function Y(z,B,H,W,P,q){var M=P.norm2();if(M>1.1)return 0;var S=I,b=D,N=G;z.getVelocityAtWorldPoint(B,S),H.getVelocityAtWorldPoint(W,b),S.vsub(b,N);var j=P.dot(N),$=.2,O=1/(z.invMass+H.invMass),q=-$*j*O;return q}},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(t,n,r){var s=t("./Body"),i=t("../shapes/Sphere"),o=t("../shapes/Box"),a=t("../math/Vec3"),h=t("../constraints/HingeConstraint");n.exports=l;function l(d){if(this.wheelBodies=[],this.coordinateSystem=typeof d.coordinateSystem>"u"?new a(1,2,3):d.coordinateSystem.clone(),this.chassisBody=d.chassisBody,!this.chassisBody){var p=new o(new a(5,2,.5));this.chassisBody=new s(1,p)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}l.prototype.addWheel=function(d){d=d||{};var p=d.body;p||(p=new s(1,new i(1.2))),this.wheelBodies.push(p),this.wheelForces.push(0),new a;var f=typeof d.position<"u"?d.position.clone():new a,v=new a;this.chassisBody.pointToWorldFrame(f,v),p.position.set(v.x,v.y,v.z);var m=typeof d.axis<"u"?d.axis.clone():new a(0,1,0);this.wheelAxes.push(m);var y=new h(this.chassisBody,p,{pivotA:f,axisA:m,pivotB:a.ZERO,axisB:m,collideConnected:!1});return this.constraints.push(y),this.wheelBodies.length-1},l.prototype.setSteeringValue=function(d,p){var f=this.wheelAxes[p],v=Math.cos(d),m=Math.sin(d),y=f.x,_=f.y;this.constraints[p].axisA.set(v*y-m*_,m*y+v*_,0)},l.prototype.setMotorSpeed=function(d,p){var f=this.constraints[p];f.enableMotor(),f.motorTargetVelocity=d},l.prototype.disableMotor=function(d){var p=this.constraints[d];p.disableMotor()};var c=new a;l.prototype.setWheelForce=function(d,p){this.wheelForces[p]=d},l.prototype.applyWheelForce=function(d,p){var f=this.wheelAxes[p],v=this.wheelBodies[p],m=v.torque;f.scale(d,c),v.vectorToWorldFrame(c,c),m.vadd(c,m)},l.prototype.addToWorld=function(d){for(var p=this.constraints,f=this.wheelBodies.concat([this.chassisBody]),v=0;v<f.length;v++)d.add(f[v]);for(var v=0;v<p.length;v++)d.addConstraint(p[v]);d.addEventListener("preStep",this._update.bind(this))},l.prototype._update=function(){for(var d=this.wheelForces,p=0;p<d.length;p++)this.applyWheelForce(d[p],p)},l.prototype.removeFromWorld=function(d){for(var p=this.constraints,f=this.wheelBodies.concat([this.chassisBody]),v=0;v<f.length;v++)d.remove(f[v]);for(var v=0;v<p.length;v++)d.removeConstraint(p[v])};var u=new a;l.prototype.getWheelSpeed=function(d){var p=this.wheelAxes[d],f=this.wheelBodies[d],v=f.angularVelocity;return this.chassisBody.vectorToWorldFrame(p,u),v.dot(u)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(t,n,r){n.exports=i,t("../shapes/Shape");var s=t("../math/Vec3");t("../math/Quaternion"),t("../shapes/Particle"),t("../objects/Body"),t("../material/Material");function i(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}i.prototype.add=function(p){this.particles.push(p),this.neighbors.length<this.particles.length&&this.neighbors.push([])},i.prototype.remove=function(p){var f=this.particles.indexOf(p);f!==-1&&(this.particles.splice(f,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var o=new s;i.prototype.getNeighbors=function(p,f){for(var v=this.particles.length,m=p.id,y=this.smoothingRadius*this.smoothingRadius,_=o,w=0;w!==v;w++){var x=this.particles[w];x.position.vsub(p.position,_),m!==x.id&&_.norm2()<y&&f.push(x)}};var a=new s,h=new s,l=new s,c=new s,u=new s,d=new s;i.prototype.update=function(){for(var p=this.particles.length,f=a,v=this.speedOfSound,m=this.eps,y=0;y!==p;y++){var _=this.particles[y],w=this.neighbors[y];w.length=0,this.getNeighbors(_,w),w.push(this.particles[y]);for(var x=w.length,E=0,L=0;L!==x;L++){_.position.vsub(w[L].position,f);var A=f.norm(),T=this.w(A);E+=w[L].mass*T}this.densities[y]=E,this.pressures[y]=v*v*(this.densities[y]-this.density)}for(var R=h,C=l,F=c,I=u,D=d,y=0;y!==p;y++){var G=this.particles[y];R.set(0,0,0),C.set(0,0,0);for(var Y,z,w=this.neighbors[y],x=w.length,L=0;L!==x;L++){var B=w[L];G.position.vsub(B.position,I);var H=I.norm();Y=-B.mass*(this.pressures[y]/(this.densities[y]*this.densities[y]+m)+this.pressures[L]/(this.densities[L]*this.densities[L]+m)),this.gradw(I,F),F.mult(Y,F),R.vadd(F,R),B.velocity.vsub(G.velocity,D),D.mult(1/(1e-4+this.densities[y]*this.densities[L])*this.viscosity*B.mass,D),z=this.nablaw(H),D.mult(z,D),C.vadd(D,C)}C.mult(G.mass,C),R.mult(G.mass,R),G.force.vadd(C,G.force),G.force.vadd(R,G.force)}},i.prototype.w=function(p){var f=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(f,9))*Math.pow(f*f-p*p,3)},i.prototype.gradw=function(p,f){var v=p.norm(),m=this.smoothingRadius;p.mult(945/(32*Math.PI*Math.pow(m,9))*Math.pow(m*m-v*v,2),f)},i.prototype.nablaw=function(p){var f=this.smoothingRadius,v=945/(32*Math.PI*Math.pow(f,9))*(f*f-p*p)*(7*p*p-3*f*f);return v}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(t,n,r){var s=t("../math/Vec3");n.exports=i;function i(y,_,w){w=w||{},this.restLength=typeof w.restLength=="number"?w.restLength:1,this.stiffness=w.stiffness||100,this.damping=w.damping||1,this.bodyA=y,this.bodyB=_,this.localAnchorA=new s,this.localAnchorB=new s,w.localAnchorA&&this.localAnchorA.copy(w.localAnchorA),w.localAnchorB&&this.localAnchorB.copy(w.localAnchorB),w.worldAnchorA&&this.setWorldAnchorA(w.worldAnchorA),w.worldAnchorB&&this.setWorldAnchorB(w.worldAnchorB)}i.prototype.setWorldAnchorA=function(y){this.bodyA.pointToLocalFrame(y,this.localAnchorA)},i.prototype.setWorldAnchorB=function(y){this.bodyB.pointToLocalFrame(y,this.localAnchorB)},i.prototype.getWorldAnchorA=function(y){this.bodyA.pointToWorldFrame(this.localAnchorA,y)},i.prototype.getWorldAnchorB=function(y){this.bodyB.pointToWorldFrame(this.localAnchorB,y)};var o=new s,a=new s,h=new s,l=new s,c=new s,u=new s,d=new s,p=new s,f=new s,v=new s,m=new s;i.prototype.applyForce=function(){var y=this.stiffness,_=this.damping,w=this.restLength,x=this.bodyA,E=this.bodyB,L=o,A=a,T=h,R=l,C=m,F=c,I=u,D=d,G=p,Y=f,z=v;this.getWorldAnchorA(F),this.getWorldAnchorB(I),F.vsub(x.position,D),I.vsub(E.position,G),I.vsub(F,L);var B=L.norm();A.copy(L),A.normalize(),E.velocity.vsub(x.velocity,T),E.angularVelocity.cross(G,C),T.vadd(C,T),x.angularVelocity.cross(D,C),T.vsub(C,T),A.mult(-y*(B-w)-_*T.dot(A),R),x.force.vsub(R,x.force),E.force.vadd(R,E.force),D.cross(R,Y),G.cross(R,z),x.torque.vsub(Y,x.torque),E.torque.vadd(z,E.torque)}},{"../math/Vec3":30}],36:[function(t,n,r){var s=t("../math/Vec3"),i=t("../math/Transform"),o=t("../collision/RaycastResult"),a=t("../utils/Utils");n.exports=h;function h(u){u=a.defaults(u,{chassisConnectionPointLocal:new s,chassisConnectionPointWorld:new s,directionLocal:new s,directionWorld:new s,axleLocal:new s,axleWorld:new s,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=u.maxSuspensionTravel,this.customSlidingRotationalSpeed=u.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=u.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=u.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=u.chassisConnectionPointWorld.clone(),this.directionLocal=u.directionLocal.clone(),this.directionWorld=u.directionWorld.clone(),this.axleLocal=u.axleLocal.clone(),this.axleWorld=u.axleWorld.clone(),this.suspensionRestLength=u.suspensionRestLength,this.suspensionMaxLength=u.suspensionMaxLength,this.radius=u.radius,this.suspensionStiffness=u.suspensionStiffness,this.dampingCompression=u.dampingCompression,this.dampingRelaxation=u.dampingRelaxation,this.frictionSlip=u.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=u.rollInfluence,this.maxSuspensionForce=u.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=u.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new o,this.worldTransform=new i,this.isInContact=!1}var c=new s,l=new s,c=new s;h.prototype.updateWheel=function(u){var d=this.raycastResult;if(this.isInContact){var p=d.hitNormalWorld.dot(d.directionWorld);d.hitPointWorld.vsub(u.position,l),u.getVelocityAtWorldPoint(l,c);var f=d.hitNormalWorld.dot(c);if(p>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=1/.1;else{var v=-1/p;this.suspensionRelativeVelocity=f*v,this.clippedInvContactDotSuspension=v}}else d.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,d.directionWorld.scale(-1,d.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(t,n,r){n.exports=a;var s=t("./Shape"),i=t("../math/Vec3"),o=t("./ConvexPolyhedron");function a(c){s.call(this),this.type=s.types.BOX,this.halfExtents=c,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}a.prototype=new s,a.prototype.constructor=a,a.prototype.updateConvexPolyhedronRepresentation=function(){var c=this.halfExtents.x,u=this.halfExtents.y,d=this.halfExtents.z,p=i,f=[new p(-c,-u,-d),new p(c,-u,-d),new p(c,u,-d),new p(-c,u,-d),new p(-c,-u,d),new p(c,-u,d),new p(c,u,d),new p(-c,u,d)],v=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]];new p(0,0,1),new p(0,1,0),new p(1,0,0);var m=new o(f,v);this.convexPolyhedronRepresentation=m,m.material=this.material},a.prototype.calculateLocalInertia=function(c,u){return u=u||new i,a.calculateInertia(this.halfExtents,c,u),u},a.calculateInertia=function(c,u,d){var p=c;d.x=1/12*u*(2*p.y*2*p.y+2*p.z*2*p.z),d.y=1/12*u*(2*p.x*2*p.x+2*p.z*2*p.z),d.z=1/12*u*(2*p.y*2*p.y+2*p.x*2*p.x)},a.prototype.getSideNormals=function(c,u){var d=c,p=this.halfExtents;if(d[0].set(p.x,0,0),d[1].set(0,p.y,0),d[2].set(0,0,p.z),d[3].set(-p.x,0,0),d[4].set(0,-p.y,0),d[5].set(0,0,-p.z),u!==void 0)for(var f=0;f!==d.length;f++)u.vmult(d[f],d[f]);return d},a.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var h=new i;new i,a.prototype.forEachWorldCorner=function(c,u,d){for(var p=this.halfExtents,f=[[p.x,p.y,p.z],[-p.x,p.y,p.z],[-p.x,-p.y,p.z],[-p.x,-p.y,-p.z],[p.x,-p.y,-p.z],[p.x,p.y,-p.z],[-p.x,p.y,-p.z],[p.x,-p.y,p.z]],v=0;v<f.length;v++)h.set(f[v][0],f[v][1],f[v][2]),u.vmult(h,h),c.vadd(h,h),d(h.x,h.y,h.z)};var l=[new i,new i,new i,new i,new i,new i,new i,new i];a.prototype.calculateWorldAABB=function(c,u,d,p){var f=this.halfExtents;l[0].set(f.x,f.y,f.z),l[1].set(-f.x,f.y,f.z),l[2].set(-f.x,-f.y,f.z),l[3].set(-f.x,-f.y,-f.z),l[4].set(f.x,-f.y,-f.z),l[5].set(f.x,f.y,-f.z),l[6].set(-f.x,f.y,-f.z),l[7].set(f.x,-f.y,f.z);var v=l[0];u.vmult(v,v),c.vadd(v,v),p.copy(v),d.copy(v);for(var m=1;m<8;m++){var v=l[m];u.vmult(v,v),c.vadd(v,v);var y=v.x,_=v.y,w=v.z;y>p.x&&(p.x=y),_>p.y&&(p.y=_),w>p.z&&(p.z=w),y<d.x&&(d.x=y),_<d.y&&(d.y=_),w<d.z&&(d.z=w)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(t,n,r){n.exports=a;var s=t("./Shape"),i=t("../math/Vec3");t("../math/Quaternion");var o=t("../math/Transform");function a(P,k,M){s.call(this),this.type=s.types.CONVEXPOLYHEDRON,this.vertices=P||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=k||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=M?M.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}a.prototype=new s,a.prototype.constructor=a;var h=new i;a.prototype.computeEdges=function(){var P=this.faces,k=this.vertices;k.length;var M=this.uniqueEdges;M.length=0;for(var S=h,b=0;b!==P.length;b++)for(var N=P[b],j=N.length,$=0;$!==j;$++){var O=($+1)%j;k[N[$]].vsub(k[N[O]],S),S.normalize();for(var q=!1,Q=0;Q!==M.length;Q++)if(M[Q].almostEquals(S)||M[Q].almostEquals(S)){q=!0;break}q||M.push(S.clone())}},a.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var P=0;P<this.faces.length;P++){for(var k=0;k<this.faces[P].length;k++)if(!this.vertices[this.faces[P][k]])throw new Error("Vertex "+this.faces[P][k]+" not found!");var M=this.faceNormals[P]||new i;this.getFaceNormal(P,M),M.negate(M),this.faceNormals[P]=M;var S=this.vertices[this.faces[P][0]];if(M.dot(S)<0){console.error(".faceNormals["+P+"] = Vec3("+M.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(var k=0;k<this.faces[P].length;k++)console.warn(".vertices["+this.faces[P][k]+"] = Vec3("+this.vertices[this.faces[P][k]].toString()+")")}}};var l=new i,c=new i;a.computeNormal=function(P,k,M,S){k.vsub(P,c),M.vsub(k,l),l.cross(c,S),S.isZero()||S.normalize()},a.prototype.getFaceNormal=function(P,k){var M=this.faces[P],S=this.vertices[M[0]],b=this.vertices[M[1]],N=this.vertices[M[2]];return a.computeNormal(S,b,N,k)};var u=new i;a.prototype.clipAgainstHull=function(P,k,M,S,b,N,j,$,O){for(var q=u,Q=-1,fe=-Number.MAX_VALUE,ue=0;ue<M.faces.length;ue++){q.copy(M.faceNormals[ue]),b.vmult(q,q);var he=q.dot(N);he>fe&&(fe=he,Q=ue)}for(var K=[],te=M.faces[Q],Se=te.length,ge=0;ge<Se;ge++){var Ne=M.vertices[te[ge]],pe=new i;pe.copy(Ne),b.vmult(pe,pe),S.vadd(pe,pe),K.push(pe)}Q>=0&&this.clipFaceAgainstHull(N,P,k,K,j,$,O)};var d=new i,p=new i,f=new i,v=new i,m=new i,y=new i;a.prototype.findSeparatingAxis=function(P,k,M,S,b,N,j,$){var O=d,q=p,Q=f,fe=v,ue=m,he=y,K=Number.MAX_VALUE,te=this;if(te.uniqueAxes)for(var ge=0;ge!==te.uniqueAxes.length;ge++){M.vmult(te.uniqueAxes[ge],O);var pe=te.testSepAxis(O,P,k,M,S,b);if(pe===!1)return!1;pe<K&&(K=pe,N.copy(O))}else for(var Se=j?j.length:te.faces.length,ge=0;ge<Se;ge++){var Ne=j?j[ge]:ge;O.copy(te.faceNormals[Ne]),M.vmult(O,O);var pe=te.testSepAxis(O,P,k,M,S,b);if(pe===!1)return!1;pe<K&&(K=pe,N.copy(O))}if(P.uniqueAxes)for(var ge=0;ge!==P.uniqueAxes.length;ge++){b.vmult(P.uniqueAxes[ge],q);var pe=te.testSepAxis(q,P,k,M,S,b);if(pe===!1)return!1;pe<K&&(K=pe,N.copy(q))}else for(var Fe=$?$.length:P.faces.length,ge=0;ge<Fe;ge++){var Ne=$?$[ge]:ge;q.copy(P.faceNormals[Ne]),b.vmult(q,q);var pe=te.testSepAxis(q,P,k,M,S,b);if(pe===!1)return!1;pe<K&&(K=pe,N.copy(q))}for(var ze=0;ze!==te.uniqueEdges.length;ze++){M.vmult(te.uniqueEdges[ze],fe);for(var Ie=0;Ie!==P.uniqueEdges.length;Ie++)if(b.vmult(P.uniqueEdges[Ie],ue),fe.cross(ue,he),!he.almostZero()){he.normalize();var De=te.testSepAxis(he,P,k,M,S,b);if(De===!1)return!1;De<K&&(K=De,N.copy(he))}}return S.vsub(k,Q),Q.dot(N)>0&&N.negate(N),!0};var _=[],w=[];a.prototype.testSepAxis=function(P,k,M,S,b,N){var j=this;a.project(j,P,M,S,_),a.project(k,P,b,N,w);var $=_[0],O=_[1],q=w[0],Q=w[1],fe=$-Q,ue=q-O,he=fe<ue?fe:ue;return he};var x=new i,E=new i;a.prototype.calculateLocalInertia=function(P,k){this.computeLocalAABB(x,E);var M=E.x-x.x,S=E.y-x.y,b=E.z-x.z;k.x=1/12*P*(2*S*2*S+2*b*2*b),k.y=1/12*P*(2*M*2*M+2*b*2*b),k.z=1/12*P*(2*S*2*S+2*M*2*M)},a.prototype.getPlaneConstantOfFace=function(P){var k=this.faces[P],M=this.faceNormals[P],S=this.vertices[k[0]],b=-M.dot(S);return b};var L=new i,A=new i,T=new i,R=new i,C=new i,F=new i,I=new i,D=new i;a.prototype.clipFaceAgainstHull=function(P,k,M,S,b,N,j){for(var $=L,O=A,q=T,Q=R,fe=C,ue=F,he=I,K=D,te=this,Se=[],ge=S,Ne=Se,pe=-1,Fe=Number.MAX_VALUE,ze=0;ze<te.faces.length;ze++){$.copy(te.faceNormals[ze]),M.vmult($,$);var Ie=$.dot(P);Ie<Fe&&(Fe=Ie,pe=ze)}if(!(pe<0)){var De=te.faces[pe];De.connectedFaces=[];for(var Re=0;Re<te.faces.length;Re++)for(var Ge=0;Ge<te.faces[Re].length;Ge++)De.indexOf(te.faces[Re][Ge])!==-1&&Re!==pe&&De.connectedFaces.indexOf(Re)===-1&&De.connectedFaces.push(Re);ge.length;for(var Pe=De.length,Je=0;Je<Pe;Je++){var gt=te.vertices[De[Je]],ci=te.vertices[De[(Je+1)%Pe]];gt.vsub(ci,O),q.copy(O),M.vmult(q,q),k.vadd(q,q),Q.copy(this.faceNormals[pe]),M.vmult(Q,Q),k.vadd(Q,Q),q.cross(Q,fe),fe.negate(fe),ue.copy(gt),M.vmult(ue,ue),k.vadd(ue,ue),-ue.dot(fe);var Vt;{var Ei=De.connectedFaces[Je];he.copy(this.faceNormals[Ei]);var hi=this.getPlaneConstantOfFace(Ei);K.copy(he),M.vmult(K,K);var Vt=hi-K.dot(k)}for(this.clipFaceAgainstPlane(ge,Ne,K,Vt);ge.length;)ge.shift();for(;Ne.length;)ge.push(Ne.shift())}he.copy(this.faceNormals[pe]);var hi=this.getPlaneConstantOfFace(pe);K.copy(he),M.vmult(K,K);for(var Vt=hi-K.dot(k),Re=0;Re<ge.length;Re++){var Dt=K.dot(ge[Re])+Vt;if(Dt<=b&&(console.log("clamped: depth="+Dt+" to minDist="+(b+"")),Dt=b),Dt<=N){var Di=ge[Re];if(Dt<=0){var Si={point:Di,normal:K,depth:Dt};j.push(Si)}}}}},a.prototype.clipFaceAgainstPlane=function(P,k,M,S){var b,N,j=P.length;if(j<2)return k;var $=P[P.length-1],O=P[0];b=M.dot($)+S;for(var q=0;q<j;q++){if(O=P[q],N=M.dot(O)+S,b<0)if(N<0){var Q=new i;Q.copy(O),k.push(Q)}else{var Q=new i;$.lerp(O,b/(b-N),Q),k.push(Q)}else if(N<0){var Q=new i;$.lerp(O,b/(b-N),Q),k.push(Q),k.push(O)}$=O,b=N}return k},a.prototype.computeWorldVertices=function(P,k){for(var M=this.vertices.length;this.worldVertices.length<M;)this.worldVertices.push(new i);for(var S=this.vertices,b=this.worldVertices,N=0;N!==M;N++)k.vmult(S[N],b[N]),P.vadd(b[N],b[N]);this.worldVerticesNeedsUpdate=!1},new i,a.prototype.computeLocalAABB=function(P,k){var M=this.vertices.length,S=this.vertices;P.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),k.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var b=0;b<M;b++){var N=S[b];N.x<P.x?P.x=N.x:N.x>k.x&&(k.x=N.x),N.y<P.y?P.y=N.y:N.y>k.y&&(k.y=N.y),N.z<P.z?P.z=N.z:N.z>k.z&&(k.z=N.z)}},a.prototype.computeWorldFaceNormals=function(P){for(var k=this.faceNormals.length;this.worldFaceNormals.length<k;)this.worldFaceNormals.push(new i);for(var M=this.faceNormals,S=this.worldFaceNormals,b=0;b!==k;b++)P.vmult(M[b],S[b]);this.worldFaceNormalsNeedsUpdate=!1},a.prototype.updateBoundingSphereRadius=function(){for(var P=0,k=this.vertices,M=0,S=k.length;M!==S;M++){var b=k[M].norm2();b>P&&(P=b)}this.boundingSphereRadius=Math.sqrt(P)};var G=new i;a.prototype.calculateWorldAABB=function(P,k,M,S){for(var b=this.vertices.length,N=this.vertices,j,$,O,q,Q,fe,ue=0;ue<b;ue++){G.copy(N[ue]),k.vmult(G,G),P.vadd(G,G);var he=G;he.x<j||j===void 0?j=he.x:(he.x>q||q===void 0)&&(q=he.x),he.y<$||$===void 0?$=he.y:(he.y>Q||Q===void 0)&&(Q=he.y),he.z<O||O===void 0?O=he.z:(he.z>fe||fe===void 0)&&(fe=he.z)}M.set(j,$,O),S.set(q,Q,fe)},a.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},a.prototype.getAveragePointLocal=function(P){P=P||new i;for(var k=this.vertices.length,M=this.vertices,S=0;S<k;S++)P.vadd(M[S],P);return P.mult(1/k,P),P},a.prototype.transformAllPoints=function(P,k){var M=this.vertices.length,S=this.vertices;if(k){for(var b=0;b<M;b++){var N=S[b];k.vmult(N,N)}for(var b=0;b<this.faceNormals.length;b++){var N=this.faceNormals[b];k.vmult(N,N)}}if(P)for(var b=0;b<M;b++){var N=S[b];N.vadd(P,N)}};var Y=new i,z=new i,B=new i;a.prototype.pointIsInside=function(P){var k=this.vertices.length,M=this.vertices,S=this.faces,b=this.faceNormals,N=null,j=this.faces.length,$=Y;this.getAveragePointLocal($);for(var O=0;O<j;O++){this.faces[O].length;var k=b[O],q=M[S[O][0]],Q=z;P.vsub(q,Q);var fe=k.dot(Q),ue=B;$.vsub(q,ue);var he=k.dot(ue);if(fe<0&&he>0||fe>0&&he<0)return!1}return N?1:-1},new i;var H=new i,W=new i;a.project=function(P,k,M,S,b){var N=P.vertices.length,j=H,$=0,O=0,q=W,Q=P.vertices;q.setZero(),o.vectorToLocalFrame(M,S,k,j),o.pointToLocalFrame(M,S,q,q);var fe=q.dot(j);O=$=Q[0].dot(j);for(var ue=1;ue<N;ue++){var he=Q[ue].dot(j);he>$&&($=he),he<O&&(O=he)}if(O-=fe,$-=fe,O>$){var K=O;O=$,$=K}b[0]=$,b[1]=O}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(t,n,r){n.exports=a;var s=t("./Shape"),i=t("../math/Vec3");t("../math/Quaternion");var o=t("./ConvexPolyhedron");function a(h,l,c,u){var d=u,p=[],f=[],v=[],m=[],y=[],_=Math.cos,w=Math.sin;p.push(new i(l*_(0),l*w(0),-c*.5)),m.push(0),p.push(new i(h*_(0),h*w(0),c*.5)),y.push(1);for(var x=0;x<d;x++){var E=2*Math.PI/d*(x+1),L=2*Math.PI/d*(x+.5);x<d-1?(p.push(new i(l*_(E),l*w(E),-c*.5)),m.push(2*x+2),p.push(new i(h*_(E),h*w(E),c*.5)),y.push(2*x+3),v.push([2*x+2,2*x+3,2*x+1,2*x])):v.push([0,1,2*x+1,2*x]),(d%2===1||x<d/2)&&f.push(new i(_(L),w(L),0))}v.push(y),f.push(new i(0,0,1));for(var A=[],x=0;x<m.length;x++)A.push(m[m.length-x-1]);v.push(A),this.type=s.types.CONVEXPOLYHEDRON,o.call(this,p,v,f)}a.prototype=new o},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(t,n,r){var s=t("./Shape"),i=t("./ConvexPolyhedron"),o=t("../math/Vec3"),a=t("../utils/Utils");n.exports=h;function h(l,c){c=a.defaults(c,{maxValue:null,minValue:null,elementSize:1}),this.data=l,this.maxValue=c.maxValue,this.minValue=c.minValue,this.elementSize=c.elementSize,c.minValue===null&&this.updateMinValue(),c.maxValue===null&&this.updateMaxValue(),this.cacheEnabled=!0,s.call(this),this.pillarConvex=new i,this.pillarOffset=new o,this.type=s.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}h.prototype=new s,h.prototype.update=function(){this._cachedPillars={}},h.prototype.updateMinValue=function(){for(var l=this.data,c=l[0][0],u=0;u!==l.length;u++)for(var d=0;d!==l[u].length;d++){var p=l[u][d];p<c&&(c=p)}this.minValue=c},h.prototype.updateMaxValue=function(){for(var l=this.data,c=l[0][0],u=0;u!==l.length;u++)for(var d=0;d!==l[u].length;d++){var p=l[u][d];p>c&&(c=p)}this.maxValue=c},h.prototype.setHeightValueAtIndex=function(l,c,u){var d=this.data;d[l][c]=u,this.clearCachedConvexTrianglePillar(l,c,!1),l>0&&(this.clearCachedConvexTrianglePillar(l-1,c,!0),this.clearCachedConvexTrianglePillar(l-1,c,!1)),c>0&&(this.clearCachedConvexTrianglePillar(l,c-1,!0),this.clearCachedConvexTrianglePillar(l,c-1,!1)),c>0&&l>0&&this.clearCachedConvexTrianglePillar(l-1,c-1,!0)},h.prototype.getRectMinMax=function(l,c,u,d,p){p=p||[];for(var f=this.data,v=this.minValue,m=l;m<=u;m++)for(var y=c;y<=d;y++){var _=f[m][y];_>v&&(v=_)}p[0]=this.minValue,p[1]=v},h.prototype.getIndexOfPosition=function(l,c,u,d){var p=this.elementSize,f=this.data,v=Math.floor(l/p),m=Math.floor(c/p);return u[0]=v,u[1]=m,d&&(v<0&&(v=0),m<0&&(m=0),v>=f.length-1&&(v=f.length-1),m>=f[0].length-1&&(m=f[0].length-1)),!(v<0||m<0||v>=f.length-1||m>=f[0].length-1)},h.prototype.getHeightAt=function(l,c,u){var d=[];this.getIndexOfPosition(l,c,d,u);var p=[];return this.getRectMinMax(d[0],d[1]+1,d[0],d[1]+1,p),(p[0]+p[1])/2},h.prototype.getCacheConvexTrianglePillarKey=function(l,c,u){return l+"_"+c+"_"+(u?1:0)},h.prototype.getCachedConvexTrianglePillar=function(l,c,u){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(l,c,u)]},h.prototype.setCachedConvexTrianglePillar=function(l,c,u,d,p){this._cachedPillars[this.getCacheConvexTrianglePillarKey(l,c,u)]={convex:d,offset:p}},h.prototype.clearCachedConvexTrianglePillar=function(l,c,u){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(l,c,u)]},h.prototype.getConvexTrianglePillar=function(l,c,u){var d=this.pillarConvex,p=this.pillarOffset;if(this.cacheEnabled){var f=this.getCachedConvexTrianglePillar(l,c,u);if(f){this.pillarConvex=f.convex,this.pillarOffset=f.offset;return}d=new i,p=new o,this.pillarConvex=d,this.pillarOffset=p}var f=this.data,v=this.elementSize,m=d.faces;d.vertices.length=6;for(var y=0;y<6;y++)d.vertices[y]||(d.vertices[y]=new o);m.length=5;for(var y=0;y<5;y++)m[y]||(m[y]=[]);var _=d.vertices,w=(Math.min(f[l][c],f[l+1][c],f[l][c+1],f[l+1][c+1])-this.minValue)/2+this.minValue;u?(p.set((l+.75)*v,(c+.75)*v,w),_[0].set(.25*v,.25*v,f[l+1][c+1]-w),_[1].set(-.75*v,.25*v,f[l][c+1]-w),_[2].set(.25*v,-.75*v,f[l+1][c]-w),_[3].set(.25*v,.25*v,-w-1),_[4].set(-.75*v,.25*v,-w-1),_[5].set(.25*v,-.75*v,-w-1),m[0][0]=0,m[0][1]=1,m[0][2]=2,m[1][0]=5,m[1][1]=4,m[1][2]=3,m[2][0]=2,m[2][1]=5,m[2][2]=3,m[2][3]=0,m[3][0]=3,m[3][1]=4,m[3][2]=1,m[3][3]=0,m[4][0]=1,m[4][1]=4,m[4][2]=5,m[4][3]=2):(p.set((l+.25)*v,(c+.25)*v,w),_[0].set(-.25*v,-.25*v,f[l][c]-w),_[1].set(.75*v,-.25*v,f[l+1][c]-w),_[2].set(-.25*v,.75*v,f[l][c+1]-w),_[3].set(-.25*v,-.25*v,-w-1),_[4].set(.75*v,-.25*v,-w-1),_[5].set(-.25*v,.75*v,-w-1),m[0][0]=0,m[0][1]=1,m[0][2]=2,m[1][0]=5,m[1][1]=4,m[1][2]=3,m[2][0]=0,m[2][1]=2,m[2][2]=5,m[2][3]=3,m[3][0]=1,m[3][1]=0,m[3][2]=3,m[3][3]=4,m[4][0]=4,m[4][1]=5,m[4][2]=2,m[4][3]=1),d.computeNormals(),d.computeEdges(),d.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(l,c,u,d,p)},h.prototype.calculateLocalInertia=function(l,c){return c=c||new o,c.set(0,0,0),c},h.prototype.volume=function(){return Number.MAX_VALUE},h.prototype.calculateWorldAABB=function(l,c,u,d){u.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),d.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},h.prototype.updateBoundingSphereRadius=function(){var l=this.data,c=this.elementSize;this.boundingSphereRadius=new o(l.length*c,l[0].length*c,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(t,n,r){n.exports=o;var s=t("./Shape"),i=t("../math/Vec3");function o(){s.call(this),this.type=s.types.PARTICLE}o.prototype=new s,o.prototype.constructor=o,o.prototype.calculateLocalInertia=function(a,h){return h=h||new i,h.set(0,0,0),h},o.prototype.volume=function(){return 0},o.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},o.prototype.calculateWorldAABB=function(a,h,l,c){l.copy(a),c.copy(a)}},{"../math/Vec3":30,"./Shape":43}],42:[function(t,n,r){n.exports=o;var s=t("./Shape"),i=t("../math/Vec3");function o(){s.call(this),this.type=s.types.PLANE,this.worldNormal=new i,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}o.prototype=new s,o.prototype.constructor=o,o.prototype.computeWorldNormal=function(h){var l=this.worldNormal;l.set(0,0,1),h.vmult(l,l),this.worldNormalNeedsUpdate=!1},o.prototype.calculateLocalInertia=function(h,l){return l=l||new i,l},o.prototype.volume=function(){return Number.MAX_VALUE};var a=new i;o.prototype.calculateWorldAABB=function(h,l,c,u){a.set(0,0,1),l.vmult(a,a);var d=Number.MAX_VALUE;c.set(-d,-d,-d),u.set(d,d,d),a.x===1&&(u.x=h.x),a.y===1&&(u.y=h.y),a.z===1&&(u.z=h.z),a.x===-1&&(c.x=h.x),a.y===-1&&(c.y=h.y),a.z===-1&&(c.z=h.z)},o.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(t,n,r){n.exports=s;var s=t("./Shape");t("../math/Vec3"),t("../math/Quaternion"),t("../material/Material");function s(){this.id=s.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}s.prototype.constructor=s,s.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},s.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},s.prototype.calculateLocalInertia=function(i,o){throw"calculateLocalInertia() not implemented for shape type "+this.type},s.idCounter=0,s.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(t,n,r){n.exports=o;var s=t("./Shape"),i=t("../math/Vec3");function o(a){if(s.call(this),this.radius=a!==void 0?Number(a):1,this.type=s.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}o.prototype=new s,o.prototype.constructor=o,o.prototype.calculateLocalInertia=function(a,h){h=h||new i;var l=2*a*this.radius*this.radius/5;return h.x=l,h.y=l,h.z=l,h},o.prototype.volume=function(){return 4*Math.PI*this.radius/3},o.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},o.prototype.calculateWorldAABB=function(a,h,l,c){for(var u=this.radius,d=["x","y","z"],p=0;p<d.length;p++){var f=d[p];l[f]=a[f]-u,c[f]=a[f]+u}}},{"../math/Vec3":30,"./Shape":43}],45:[function(t,n,r){n.exports=l;var s=t("./Shape"),i=t("../math/Vec3");t("../math/Quaternion");var o=t("../math/Transform"),a=t("../collision/AABB"),h=t("../utils/Octree");function l(A,T){s.call(this),this.type=s.types.TRIMESH,this.vertices=new Float32Array(A),this.indices=new Int16Array(T),this.normals=new Float32Array(T.length),this.aabb=new a,this.edges=null,this.scale=new i(1,1,1),this.tree=new h,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}l.prototype=new s,l.prototype.constructor=l;var c=new i;l.prototype.updateTree=function(){var A=this.tree;A.reset(),A.aabb.copy(this.aabb);var T=this.scale;A.aabb.lowerBound.x*=1/T.x,A.aabb.lowerBound.y*=1/T.y,A.aabb.lowerBound.z*=1/T.z,A.aabb.upperBound.x*=1/T.x,A.aabb.upperBound.y*=1/T.y,A.aabb.upperBound.z*=1/T.z;for(var R=new a,C=new i,F=new i,I=new i,D=[C,F,I],G=0;G<this.indices.length/3;G++){var Y=G*3;this._getUnscaledVertex(this.indices[Y],C),this._getUnscaledVertex(this.indices[Y+1],F),this._getUnscaledVertex(this.indices[Y+2],I),R.setFromPoints(D),A.insert(R,G)}A.removeEmptyNodes()};var u=new a;l.prototype.getTrianglesInAABB=function(A,T){u.copy(A);var R=this.scale,C=R.x,F=R.y,I=R.z,D=u.lowerBound,G=u.upperBound;return D.x/=C,D.y/=F,D.z/=I,G.x/=C,G.y/=F,G.z/=I,this.tree.aabbQuery(u,T)},l.prototype.setScale=function(A){var T=this.scale.x===this.scale.y===this.scale.z,R=A.x===A.y===A.z;T&&R||this.updateNormals(),this.scale.copy(A),this.updateAABB(),this.updateBoundingSphereRadius()},l.prototype.updateNormals=function(){for(var A=c,T=this.normals,R=0;R<this.indices.length/3;R++){var C=R*3,F=this.indices[C],I=this.indices[C+1],D=this.indices[C+2];this.getVertex(F,m),this.getVertex(I,y),this.getVertex(D,_),l.computeNormal(y,m,_,A),T[C]=A.x,T[C+1]=A.y,T[C+2]=A.z}},l.prototype.updateEdges=function(){for(var A={},T=function(Y,z){var B=F<I?F+"_"+I:I+"_"+F;A[B]=!0},R=0;R<this.indices.length/3;R++){var C=R*3,F=this.indices[C],I=this.indices[C+1];this.indices[C+2],T(),T(),T()}var D=Object.keys(A);this.edges=new Int16Array(D.length*2);for(var R=0;R<D.length;R++){var G=D[R].split("_");this.edges[2*R]=parseInt(G[0],10),this.edges[2*R+1]=parseInt(G[1],10)}},l.prototype.getEdgeVertex=function(A,T,R){var C=this.edges[A*2+(T?1:0)];this.getVertex(C,R)};var d=new i,p=new i;l.prototype.getEdgeVector=function(A,T){var R=d,C=p;this.getEdgeVertex(A,0,R),this.getEdgeVertex(A,1,C),C.vsub(R,T)};var f=new i,v=new i;l.computeNormal=function(A,T,R,C){T.vsub(A,v),R.vsub(T,f),f.cross(v,C),C.isZero()||C.normalize()};var m=new i,y=new i,_=new i;l.prototype.getVertex=function(A,T){var R=this.scale;return this._getUnscaledVertex(A,T),T.x*=R.x,T.y*=R.y,T.z*=R.z,T},l.prototype._getUnscaledVertex=function(A,T){var R=A*3,C=this.vertices;return T.set(C[R],C[R+1],C[R+2])},l.prototype.getWorldVertex=function(A,T,R,C){return this.getVertex(A,C),o.pointToWorldFrame(T,R,C,C),C},l.prototype.getTriangleVertices=function(A,T,R,C){var F=A*3;this.getVertex(this.indices[F],T),this.getVertex(this.indices[F+1],R),this.getVertex(this.indices[F+2],C)},l.prototype.getNormal=function(A,T){var R=A*3;return T.set(this.normals[R],this.normals[R+1],this.normals[R+2])};var w=new a;l.prototype.calculateLocalInertia=function(A,T){this.computeLocalAABB(w);var R=w.upperBound.x-w.lowerBound.x,C=w.upperBound.y-w.lowerBound.y,F=w.upperBound.z-w.lowerBound.z;return T.set(1/12*A*(2*C*2*C+2*F*2*F),1/12*A*(2*R*2*R+2*F*2*F),1/12*A*(2*C*2*C+2*R*2*R))};var x=new i;l.prototype.computeLocalAABB=function(A){var T=A.lowerBound,R=A.upperBound,C=this.vertices.length;this.vertices;var F=x;this.getVertex(0,F),T.copy(F),R.copy(F);for(var I=0;I!==C;I++)this.getVertex(I,F),F.x<T.x?T.x=F.x:F.x>R.x&&(R.x=F.x),F.y<T.y?T.y=F.y:F.y>R.y&&(R.y=F.y),F.z<T.z?T.z=F.z:F.z>R.z&&(R.z=F.z)},l.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},l.prototype.updateBoundingSphereRadius=function(){for(var A=0,T=this.vertices,R=new i,C=0,F=T.length/3;C!==F;C++){this.getVertex(C,R);var I=R.norm2();I>A&&(A=I)}this.boundingSphereRadius=Math.sqrt(A)},new i;var E=new o,L=new a;l.prototype.calculateWorldAABB=function(A,T,R,C){var F=E,I=L;F.position=A,F.quaternion=T,this.aabb.toWorldFrame(F,I),R.copy(I.lowerBound),C.copy(I.upperBound)},l.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},l.createTorus=function(A,T,R,C,F){A=A||1,T=T||.5,R=R||8,C=C||6,F=F||Math.PI*2;for(var I=[],D=[],G=0;G<=R;G++)for(var Y=0;Y<=C;Y++){var z=Y/C*F,B=G/R*Math.PI*2,H=(A+T*Math.cos(B))*Math.cos(z),W=(A+T*Math.cos(B))*Math.sin(z),P=T*Math.sin(B);I.push(H,W,P)}for(var G=1;G<=R;G++)for(var Y=1;Y<=C;Y++){var k=(C+1)*G+Y-1,M=(C+1)*(G-1)+Y-1,S=(C+1)*(G-1)+Y,b=(C+1)*G+Y;D.push(k,M,b),D.push(M,S,b)}return new l(I,D)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(t,n,r){n.exports=i,t("../math/Vec3"),t("../math/Quaternion");var s=t("./Solver");function i(){s.call(this),this.iterations=10,this.tolerance=1e-7}i.prototype=new s;var o=[],a=[],h=[];i.prototype.solve=function(l,c){var u=0,d=this.iterations,p=this.tolerance*this.tolerance,f=this.equations,v=f.length,m=c.bodies,y=m.length,_=l,w,x,E,L,A,T;if(v!==0)for(var R=0;R!==y;R++)m[R].updateSolveMassProperties();var C=a,F=h,I=o;C.length=v,F.length=v,I.length=v;for(var R=0;R!==v;R++){var D=f[R];I[R]=0,F[R]=D.computeB(_),C[R]=1/D.computeC()}if(v!==0){for(var R=0;R!==y;R++){var G=m[R],Y=G.vlambda,z=G.wlambda;Y.set(0,0,0),z&&z.set(0,0,0)}for(u=0;u!==d;u++){L=0;for(var B=0;B!==v;B++){var D=f[B];w=F[B],x=C[B],T=I[B],A=D.computeGWlambda(),E=x*(w-A-D.eps*T),T+E<D.minForce?E=D.minForce-T:T+E>D.maxForce&&(E=D.maxForce-T),I[B]+=E,L+=E>0?E:-E,D.addToWlambda(E)}if(L*L<p)break}for(var R=0;R!==y;R++){var G=m[R],H=G.velocity,W=G.angularVelocity;H.vadd(G.vlambda,H),W&&W.vadd(G.wlambda,W)}}return u}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(t,n,r){n.exports=s;function s(){this.equations=[]}s.prototype.solve=function(i,o){return 0},s.prototype.addEquation=function(i){i.enabled&&this.equations.push(i)},s.prototype.removeEquation=function(i){var o=this.equations,a=o.indexOf(i);a!==-1&&o.splice(a,1)},s.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(t,n,r){n.exports=o,t("../math/Vec3"),t("../math/Quaternion");var s=t("./Solver"),i=t("../objects/Body");function o(m){for(s.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=m,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}o.prototype=new s;var a=[],h=[],l={bodies:[]},c=i.STATIC;function u(m){for(var y=m.length,_=0;_!==y;_++){var w=m[_];if(!w.visited&&!(w.body.type&c))return w}return!1}var d=[];function p(m,y,_,w){for(d.push(m),m.visited=!0,y(m,_,w);d.length;)for(var x=d.pop(),E;E=u(x.children);)E.visited=!0,y(E,_,w),d.push(E)}function f(m,y,_){y.push(m.body);for(var w=m.eqs.length,x=0;x!==w;x++){var E=m.eqs[x];_.indexOf(E)===-1&&_.push(E)}}o.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},o.prototype.solve=function(m,y){for(var _=a,w=this.nodePool,x=y.bodies,E=this.equations,L=E.length,A=x.length,T=this.subsolver;w.length<A;)w.push(this.createNode());_.length=A;for(var R=0;R<A;R++)_[R]=w[R];for(var R=0;R!==A;R++){var C=_[R];C.body=x[R],C.children.length=0,C.eqs.length=0,C.visited=!1}for(var F=0;F!==L;F++){var I=E[F],R=x.indexOf(I.bi),D=x.indexOf(I.bj),G=_[R],Y=_[D];G.children.push(Y),G.eqs.push(I),Y.children.push(G),Y.eqs.push(I)}var z,B=0,H=h;T.tolerance=this.tolerance,T.iterations=this.iterations;for(var W=l;z=u(_);){H.length=0,W.bodies.length=0,p(z,f,W.bodies,H);var P=H.length;H=H.sort(v);for(var R=0;R!==P;R++)T.addEquation(H[R]);T.solve(m,W),T.removeAllEquations(),B++}return B};function v(m,y){return y.id-m.id}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(t,n,r){var s=function(){};n.exports=s,s.prototype={constructor:s,addEventListener:function(i,o){this._listeners===void 0&&(this._listeners={});var a=this._listeners;return a[i]===void 0&&(a[i]=[]),a[i].indexOf(o)===-1&&a[i].push(o),this},hasEventListener:function(i,o){if(this._listeners===void 0)return!1;var a=this._listeners;return a[i]!==void 0&&a[i].indexOf(o)!==-1},removeEventListener:function(i,o){if(this._listeners===void 0)return this;var a=this._listeners;if(a[i]===void 0)return this;var h=a[i].indexOf(o);return h!==-1&&a[i].splice(h,1),this},dispatchEvent:function(i){if(this._listeners===void 0)return this;var o=this._listeners,a=o[i.type];if(a!==void 0){i.target=this;for(var h=0,l=a.length;h<l;h++)a[h].call(this,i)}return this}}},{}],50:[function(t,n,r){var s=t("../collision/AABB"),i=t("../math/Vec3");n.exports=a;function o(c){c=c||{},this.root=c.root||null,this.aabb=c.aabb?c.aabb.clone():new s,this.data=[],this.children=[]}function a(c,u){u=u||{},u.root=null,u.aabb=c,o.call(this,u),this.maxDepth=typeof u.maxDepth<"u"?u.maxDepth:8}a.prototype=new o,o.prototype.reset=function(c,u){this.children.length=this.data.length=0},o.prototype.insert=function(c,u,d){var p=this.data;if(d=d||0,!this.aabb.contains(c))return!1;var f=this.children;if(d<(this.maxDepth||this.root.maxDepth)){var v=!1;f.length||(this.subdivide(),v=!0);for(var m=0;m!==8;m++)if(f[m].insert(c,u,d+1))return!0;v&&(f.length=0)}return p.push(u),!0};var h=new i;o.prototype.subdivide=function(){var c=this.aabb,u=c.lowerBound,d=c.upperBound,p=this.children;p.push(new o({aabb:new s({lowerBound:new i(0,0,0)})}),new o({aabb:new s({lowerBound:new i(1,0,0)})}),new o({aabb:new s({lowerBound:new i(1,1,0)})}),new o({aabb:new s({lowerBound:new i(1,1,1)})}),new o({aabb:new s({lowerBound:new i(0,1,1)})}),new o({aabb:new s({lowerBound:new i(0,0,1)})}),new o({aabb:new s({lowerBound:new i(1,0,1)})}),new o({aabb:new s({lowerBound:new i(0,1,0)})})),d.vsub(u,h),h.scale(.5,h);for(var f=this.root||this,v=0;v!==8;v++){var m=p[v];m.root=f;var y=m.aabb.lowerBound;y.x*=h.x,y.y*=h.y,y.z*=h.z,y.vadd(u,y),y.vadd(h,m.aabb.upperBound)}},o.prototype.aabbQuery=function(c,u){this.data,this.children;for(var d=[this];d.length;){var p=d.pop();p.aabb.overlaps(c)&&Array.prototype.push.apply(u,p.data),Array.prototype.push.apply(d,p.children)}return u};var l=new s;o.prototype.rayQuery=function(c,u,d){return c.getAABB(l),l.toLocalFrame(u,l),this.aabbQuery(l,d),d},o.prototype.removeEmptyNodes=function(){for(var c=[this];c.length;){for(var u=c.pop(),d=u.children.length-1;d>=0;d--)u.children[d].data.length||u.children.splice(d,1);Array.prototype.push.apply(c,u.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(t,n,r){n.exports=s;function s(){this.objects=[],this.type=Object}s.prototype.release=function(){for(var i=arguments.length,o=0;o!==i;o++)this.objects.push(arguments[o])},s.prototype.get=function(){return this.objects.length===0?this.constructObject():this.objects.pop()},s.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(t,n,r){n.exports=s;function s(){this.data={keys:[]}}s.prototype.get=function(i,o){if(i>o){var a=o;o=i,i=a}return this.data[i+"-"+o]},s.prototype.set=function(i,o,a){if(i>o){var h=o;o=i,i=h}var l=i+"-"+o;this.get(i,o)||this.data.keys.push(l),this.data[l]=a},s.prototype.reset=function(){for(var i=this.data,o=i.keys;o.length>0;){var a=o.pop();delete i[a]}}},{}],53:[function(t,n,r){function s(){}n.exports=s,s.defaults=function(i,o){i=i||{};for(var a in o)a in i||(i[a]=o[a]);return i}},{}],54:[function(t,n,r){n.exports=o;var s=t("../math/Vec3"),i=t("./Pool");function o(){i.call(this),this.type=s}o.prototype=new i,o.prototype.constructObject=function(){return new s}},{"../math/Vec3":30,"./Pool":51}],55:[function(t,n,r){n.exports=p;var s=t("../collision/AABB"),i=t("../shapes/Shape"),o=t("../collision/Ray"),a=t("../math/Vec3"),h=t("../math/Transform");t("../shapes/ConvexPolyhedron");var l=t("../math/Quaternion");t("../solver/Solver");var c=t("../utils/Vec3Pool"),u=t("../equations/ContactEquation"),d=t("../equations/FrictionEquation");function p(U){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new c,this.world=U,this.currentContactMaterial=null,this.enableFrictionReduction=!1}p.prototype.createContactEquation=function(U,X,Z,J,ye,ce){var ne;this.contactPointPool.length?(ne=this.contactPointPool.pop(),ne.bi=U,ne.bj=X):ne=new u(U,X),ne.enabled=U.collisionResponse&&X.collisionResponse&&Z.collisionResponse&&J.collisionResponse;var ae=this.currentContactMaterial;ne.restitution=ae.restitution,ne.setSpookParams(ae.contactEquationStiffness,ae.contactEquationRelaxation,this.world.dt);var V=Z.material||U.material,re=J.material||X.material;return V&&re&&V.restitution>=0&&re.restitution>=0&&(ne.restitution=V.restitution*re.restitution),ne.si=ye||Z,ne.sj=ce||J,ne},p.prototype.createFrictionEquationsFromContact=function(U,X){var Z=U.bi,J=U.bj,ye=U.si,ce=U.sj,ne=this.world,ae=this.currentContactMaterial,V=ae.friction,re=ye.material||Z.material,le=ce.material||J.material;if(re&&le&&re.friction>=0&&le.friction>=0&&(V=re.friction*le.friction),V>0){var de=V*ne.gravity.length(),se=Z.invMass+J.invMass;se>0&&(se=1/se);var ie=this.frictionEquationPool,oe=ie.length?ie.pop():new d(Z,J,de*se),ve=ie.length?ie.pop():new d(Z,J,de*se);return oe.bi=ve.bi=Z,oe.bj=ve.bj=J,oe.minForce=ve.minForce=-de*se,oe.maxForce=ve.maxForce=de*se,oe.ri.copy(U.ri),oe.rj.copy(U.rj),ve.ri.copy(U.ri),ve.rj.copy(U.rj),U.ni.tangents(oe.t,ve.t),oe.setSpookParams(ae.frictionEquationStiffness,ae.frictionEquationRelaxation,ne.dt),ve.setSpookParams(ae.frictionEquationStiffness,ae.frictionEquationRelaxation,ne.dt),oe.enabled=ve.enabled=U.enabled,X.push(oe,ve),!0}return!1};var f=new a,v=new a,m=new a;p.prototype.createFrictionFromAverage=function(U){var X=this.result[this.result.length-1];if(!(!this.createFrictionEquationsFromContact(X,this.frictionResult)||U===1)){var Z=this.frictionResult[this.frictionResult.length-2],J=this.frictionResult[this.frictionResult.length-1];f.setZero(),v.setZero(),m.setZero();var ye=X.bi;X.bj;for(var ce=0;ce!==U;ce++)X=this.result[this.result.length-1-ce],X.bodyA!==ye?(f.vadd(X.ni,f),v.vadd(X.ri,v),m.vadd(X.rj,m)):(f.vsub(X.ni,f),v.vadd(X.rj,v),m.vadd(X.ri,m));var ne=1/U;v.scale(ne,Z.ri),m.scale(ne,Z.rj),J.ri.copy(Z.ri),J.rj.copy(Z.rj),f.normalize(),f.tangents(Z.t,J.t)}};var y=new a,_=new a,w=new l,x=new l;p.prototype.getContacts=function(U,X,Z,J,ye,ce,ne){this.contactPointPool=ye,this.frictionEquationPool=ne,this.result=J,this.frictionResult=ce;for(var ae=w,V=x,re=y,le=_,de=0,se=U.length;de!==se;de++){var ie=U[de],oe=X[de],ve=null;ie.material&&oe.material&&(ve=Z.getContactMaterial(ie.material,oe.material)||null);for(var _e=0;_e<ie.shapes.length;_e++){ie.quaternion.mult(ie.shapeOrientations[_e],ae),ie.quaternion.vmult(ie.shapeOffsets[_e],re),re.vadd(ie.position,re);for(var ee=ie.shapes[_e],xe=0;xe<oe.shapes.length;xe++){oe.quaternion.mult(oe.shapeOrientations[xe],V),oe.quaternion.vmult(oe.shapeOffsets[xe],le),le.vadd(oe.position,le);var Ae=oe.shapes[xe];if(!(re.distanceTo(le)>ee.boundingSphereRadius+Ae.boundingSphereRadius)){var Ye=null;ee.material&&Ae.material&&(Ye=Z.getContactMaterial(ee.material,Ae.material)||null),this.currentContactMaterial=Ye||ve||Z.defaultContactMaterial;var be=this[ee.type|Ae.type];be&&(ee.type<Ae.type?be.call(this,ee,Ae,re,le,ae,V,ie,oe,ee,Ae):be.call(this,Ae,ee,le,re,V,ae,oe,ie,ee,Ae))}}}}},p.prototype[i.types.BOX|i.types.BOX]=p.prototype.boxBox=function(U,X,Z,J,ye,ce,ne,ae){U.convexPolyhedronRepresentation.material=U.material,X.convexPolyhedronRepresentation.material=X.material,U.convexPolyhedronRepresentation.collisionResponse=U.collisionResponse,X.convexPolyhedronRepresentation.collisionResponse=X.collisionResponse,this.convexConvex(U.convexPolyhedronRepresentation,X.convexPolyhedronRepresentation,Z,J,ye,ce,ne,ae,U,X)},p.prototype[i.types.BOX|i.types.CONVEXPOLYHEDRON]=p.prototype.boxConvex=function(U,X,Z,J,ye,ce,ne,ae){U.convexPolyhedronRepresentation.material=U.material,U.convexPolyhedronRepresentation.collisionResponse=U.collisionResponse,this.convexConvex(U.convexPolyhedronRepresentation,X,Z,J,ye,ce,ne,ae,U,X)},p.prototype[i.types.BOX|i.types.PARTICLE]=p.prototype.boxParticle=function(U,X,Z,J,ye,ce,ne,ae){U.convexPolyhedronRepresentation.material=U.material,U.convexPolyhedronRepresentation.collisionResponse=U.collisionResponse,this.convexParticle(U.convexPolyhedronRepresentation,X,Z,J,ye,ce,ne,ae,U,X)},p.prototype[i.types.SPHERE]=p.prototype.sphereSphere=function(U,X,Z,J,ye,ce,ne,ae){var V=this.createContactEquation(ne,ae,U,X);J.vsub(Z,V.ni),V.ni.normalize(),V.ri.copy(V.ni),V.rj.copy(V.ni),V.ri.mult(U.radius,V.ri),V.rj.mult(-X.radius,V.rj),V.ri.vadd(Z,V.ri),V.ri.vsub(ne.position,V.ri),V.rj.vadd(J,V.rj),V.rj.vsub(ae.position,V.rj),this.result.push(V),this.createFrictionEquationsFromContact(V,this.frictionResult)};var E=new a,L=new a,A=new a;p.prototype[i.types.PLANE|i.types.TRIMESH]=p.prototype.planeTrimesh=function(U,X,Z,J,ye,ce,ne,ae){var V=new a,re=E;re.set(0,0,1),ye.vmult(re,re);for(var le=0;le<X.vertices.length/3;le++){X.getVertex(le,V);var de=new a;de.copy(V),h.pointToWorldFrame(J,ce,de,V);var se=L;V.vsub(Z,se);var ie=re.dot(se);if(ie<=0){var oe=this.createContactEquation(ne,ae,U,X);oe.ni.copy(re);var ve=A;re.scale(se.dot(re),ve),V.vsub(ve,ve),oe.ri.copy(ve),oe.ri.vsub(ne.position,oe.ri),oe.rj.copy(V),oe.rj.vsub(ae.position,oe.rj),this.result.push(oe),this.createFrictionEquationsFromContact(oe,this.frictionResult)}}};var T=new a,R=new a;new a;var C=new a,F=new a,I=new a,D=new a,G=new a,Y=new a,z=new a,B=new a,H=new a,W=new a,P=new a,k=new s,M=[];p.prototype[i.types.SPHERE|i.types.TRIMESH]=p.prototype.sphereTrimesh=function(U,X,Z,J,ye,ce,ne,ae){var V=I,re=D,le=G,de=Y,se=z,ie=B,oe=k,ve=F,_e=R,ee=M;h.pointToLocalFrame(J,ce,Z,se);var xe=U.radius;oe.lowerBound.set(se.x-xe,se.y-xe,se.z-xe),oe.upperBound.set(se.x+xe,se.y+xe,se.z+xe),X.getTrianglesInAABB(oe,ee);for(var Ae=C,Ye=U.radius*U.radius,be=0;be<ee.length;be++)for(var Be=0;Be<3;Be++)if(X.getVertex(X.indices[ee[be]*3+Be],Ae),Ae.vsub(se,_e),_e.norm2()<=Ye){ve.copy(Ae),h.pointToWorldFrame(J,ce,ve,Ae),Ae.vsub(Z,_e);var me=this.createContactEquation(ne,ae,U,X);me.ni.copy(_e),me.ni.normalize(),me.ri.copy(me.ni),me.ri.scale(U.radius,me.ri),me.ri.vadd(Z,me.ri),me.ri.vsub(ne.position,me.ri),me.rj.copy(Ae),me.rj.vsub(ae.position,me.rj),this.result.push(me),this.createFrictionEquationsFromContact(me,this.frictionResult)}for(var be=0;be<ee.length;be++)for(var Be=0;Be<3;Be++){X.getVertex(X.indices[ee[be]*3+Be],V),X.getVertex(X.indices[ee[be]*3+(Be+1)%3],re),re.vsub(V,le),se.vsub(re,ie);var Wt=ie.dot(le);se.vsub(V,ie);var Gt=ie.dot(le);if(Gt>0&&Wt<0){se.vsub(V,ie),de.copy(le),de.normalize(),Gt=ie.dot(de),de.scale(Gt,ie),ie.vadd(V,ie);var yt=ie.distanceTo(se);if(yt<U.radius){var me=this.createContactEquation(ne,ae,U,X);ie.vsub(se,me.ni),me.ni.normalize(),me.ni.scale(U.radius,me.ri),h.pointToWorldFrame(J,ce,ie,ie),ie.vsub(ae.position,me.rj),h.vectorToWorldFrame(ce,me.ni,me.ni),h.vectorToWorldFrame(ce,me.ri,me.ri),this.result.push(me),this.createFrictionEquationsFromContact(me,this.frictionResult)}}}for(var ui=H,wt=W,Oe=P,di=T,be=0,He=ee.length;be!==He;be++){X.getTriangleVertices(ee[be],ui,wt,Oe),X.getNormal(ee[be],di),se.vsub(ui,ie);var yt=ie.dot(di);if(di.scale(yt,ie),se.vsub(ie,ie),yt=ie.distanceTo(se),o.pointInTriangle(ie,ui,wt,Oe)&&yt<U.radius){var me=this.createContactEquation(ne,ae,U,X);ie.vsub(se,me.ni),me.ni.normalize(),me.ni.scale(U.radius,me.ri),h.pointToWorldFrame(J,ce,ie,ie),ie.vsub(ae.position,me.rj),h.vectorToWorldFrame(ce,me.ni,me.ni),h.vectorToWorldFrame(ce,me.ri,me.ri),this.result.push(me),this.createFrictionEquationsFromContact(me,this.frictionResult)}}ee.length=0};var S=new a,b=new a;p.prototype[i.types.SPHERE|i.types.PLANE]=p.prototype.spherePlane=function(U,X,Z,J,ye,ce,ne,ae){var V=this.createContactEquation(ne,ae,U,X);if(V.ni.set(0,0,1),ce.vmult(V.ni,V.ni),V.ni.negate(V.ni),V.ni.normalize(),V.ni.mult(U.radius,V.ri),Z.vsub(J,S),V.ni.mult(V.ni.dot(S),b),S.vsub(b,V.rj),-S.dot(V.ni)<=U.radius){var re=V.ri,le=V.rj;re.vadd(Z,re),re.vsub(ne.position,re),le.vadd(J,le),le.vsub(ae.position,le),this.result.push(V),this.createFrictionEquationsFromContact(V,this.frictionResult)}};var N=new a,j=new a,$=new a;function O(U,X,Z){for(var J=null,ye=U.length,ce=0;ce!==ye;ce++){var ne=U[ce],ae=N;U[(ce+1)%ye].vsub(ne,ae);var V=j;ae.cross(X,V);var re=$;Z.vsub(ne,re);var le=V.dot(re);if(J===null||le>0&&J===!0||le<=0&&J===!1){J===null&&(J=le>0);continue}else return!1}return!0}var q=new a,Q=new a,fe=new a,ue=new a,he=[new a,new a,new a,new a,new a,new a],K=new a,te=new a,Se=new a,ge=new a;p.prototype[i.types.SPHERE|i.types.BOX]=p.prototype.sphereBox=function(U,X,Z,J,ye,ce,ne,ae){var V=this.v3pool,re=he;Z.vsub(J,q),X.getSideNormals(re,ce);for(var le=U.radius,de=!1,se=te,ie=Se,oe=ge,ve=null,_e=0,ee=0,xe=0,Ae=null,Ye=0,be=re.length;Ye!==be&&de===!1;Ye++){var Be=Q;Be.copy(re[Ye]);var me=Be.norm();Be.normalize();var Wt=q.dot(Be);if(Wt<me+le&&Wt>0){var Gt=fe,yt=ue;Gt.copy(re[(Ye+1)%3]),yt.copy(re[(Ye+2)%3]);var ui=Gt.norm(),wt=yt.norm();Gt.normalize(),yt.normalize();var Oe=q.dot(Gt),di=q.dot(yt);if(Oe<ui&&Oe>-ui&&di<wt&&di>-wt){var tt=Math.abs(Wt-me-le);(Ae===null||tt<Ae)&&(Ae=tt,ee=Oe,xe=di,ve=me,se.copy(Be),ie.copy(Gt),oe.copy(yt),_e++)}}}if(_e){de=!0;var we=this.createContactEquation(ne,ae,U,X);se.mult(-le,we.ri),we.ni.copy(se),we.ni.negate(we.ni),se.mult(ve,se),ie.mult(ee,ie),se.vadd(ie,se),oe.mult(xe,oe),se.vadd(oe,we.rj),we.ri.vadd(Z,we.ri),we.ri.vsub(ne.position,we.ri),we.rj.vadd(J,we.rj),we.rj.vsub(ae.position,we.rj),this.result.push(we),this.createFrictionEquationsFromContact(we,this.frictionResult)}for(var He=V.get(),pi=K,_t=0;_t!==2&&!de;_t++)for(var ot=0;ot!==2&&!de;ot++)for(var rt=0;rt!==2&&!de;rt++)if(He.set(0,0,0),_t?He.vadd(re[0],He):He.vsub(re[0],He),ot?He.vadd(re[1],He):He.vsub(re[1],He),rt?He.vadd(re[2],He):He.vsub(re[2],He),J.vadd(He,pi),pi.vsub(Z,pi),pi.norm2()<le*le){de=!0;var we=this.createContactEquation(ne,ae,U,X);we.ri.copy(pi),we.ri.normalize(),we.ni.copy(we.ri),we.ri.mult(le,we.ri),we.rj.copy(He),we.ri.vadd(Z,we.ri),we.ri.vsub(ne.position,we.ri),we.rj.vadd(J,we.rj),we.rj.vsub(ae.position,we.rj),this.result.push(we),this.createFrictionEquationsFromContact(we,this.frictionResult)}V.release(He),He=null;for(var Ht=V.get(),fi=V.get(),we=V.get(),Pt=V.get(),tt=V.get(),Ui=re.length,_t=0;_t!==Ui&&!de;_t++)for(var ot=0;ot!==Ui&&!de;ot++)if(_t%3!==ot%3){re[ot].cross(re[_t],Ht),Ht.normalize(),re[_t].vadd(re[ot],fi),we.copy(Z),we.vsub(fi,we),we.vsub(J,we);var qi=we.dot(Ht);Ht.mult(qi,Pt);for(var rt=0;rt===_t%3||rt===ot%3;)rt++;tt.copy(Z),tt.vsub(Pt,tt),tt.vsub(fi,tt),tt.vsub(J,tt);var oa=Math.abs(qi),aa=tt.norm();if(oa<re[rt].norm()&&aa<le){de=!0;var Ue=this.createContactEquation(ne,ae,U,X);fi.vadd(Pt,Ue.rj),Ue.rj.copy(Ue.rj),tt.negate(Ue.ni),Ue.ni.normalize(),Ue.ri.copy(Ue.rj),Ue.ri.vadd(J,Ue.ri),Ue.ri.vsub(Z,Ue.ri),Ue.ri.normalize(),Ue.ri.mult(le,Ue.ri),Ue.ri.vadd(Z,Ue.ri),Ue.ri.vsub(ne.position,Ue.ri),Ue.rj.vadd(J,Ue.rj),Ue.rj.vsub(ae.position,Ue.rj),this.result.push(Ue),this.createFrictionEquationsFromContact(Ue,this.frictionResult)}}V.release(Ht,fi,we,Pt,tt)};var Ne=new a,pe=new a,Fe=new a,ze=new a,Ie=new a,De=new a,Re=new a,Ge=new a,Pe=new a,Je=new a;p.prototype[i.types.SPHERE|i.types.CONVEXPOLYHEDRON]=p.prototype.sphereConvex=function(U,X,Z,J,ye,ce,ne,ae){var V=this.v3pool;Z.vsub(J,Ne);for(var re=X.faceNormals,le=X.faces,de=X.vertices,se=U.radius,ie=0;ie!==de.length;ie++){var oe=de[ie],ve=Ie;ce.vmult(oe,ve),J.vadd(ve,ve);var _e=ze;if(ve.vsub(Z,_e),_e.norm2()<se*se){xe=!0;var ee=this.createContactEquation(ne,ae,U,X);ee.ri.copy(_e),ee.ri.normalize(),ee.ni.copy(ee.ri),ee.ri.mult(se,ee.ri),ve.vsub(J,ee.rj),ee.ri.vadd(Z,ee.ri),ee.ri.vsub(ne.position,ee.ri),ee.rj.vadd(J,ee.rj),ee.rj.vsub(ae.position,ee.rj),this.result.push(ee),this.createFrictionEquationsFromContact(ee,this.frictionResult);return}}for(var xe=!1,ie=0,Ae=le.length;ie!==Ae&&xe===!1;ie++){var Ye=re[ie],be=le[ie],Be=De;ce.vmult(Ye,Be);var me=Re;ce.vmult(de[be[0]],me),me.vadd(J,me);var Wt=Ge;Be.mult(-se,Wt),Z.vadd(Wt,Wt);var Gt=Pe;Wt.vsub(me,Gt);var yt=Gt.dot(Be),ui=Je;if(Z.vsub(me,ui),yt<0&&ui.dot(Be)>0){for(var wt=[],Oe=0,di=be.length;Oe!==di;Oe++){var He=V.get();ce.vmult(de[be[Oe]],He),J.vadd(He,He),wt.push(He)}if(O(wt,Be,Z)){xe=!0;var ee=this.createContactEquation(ne,ae,U,X);Be.mult(-se,ee.ri),Be.negate(ee.ni);var pi=V.get();Be.mult(-yt,pi);var _t=V.get();Be.mult(-se,_t),Z.vsub(J,ee.rj),ee.rj.vadd(_t,ee.rj),ee.rj.vadd(pi,ee.rj),ee.rj.vadd(J,ee.rj),ee.rj.vsub(ae.position,ee.rj),ee.ri.vadd(Z,ee.ri),ee.ri.vsub(ne.position,ee.ri),V.release(pi),V.release(_t),this.result.push(ee),this.createFrictionEquationsFromContact(ee,this.frictionResult);for(var Oe=0,ot=wt.length;Oe!==ot;Oe++)V.release(wt[Oe]);return}else for(var Oe=0;Oe!==be.length;Oe++){var rt=V.get(),Ht=V.get();ce.vmult(de[be[(Oe+1)%be.length]],rt),ce.vmult(de[be[(Oe+2)%be.length]],Ht),J.vadd(rt,rt),J.vadd(Ht,Ht);var fi=pe;Ht.vsub(rt,fi);var we=Fe;fi.unit(we);var Pt=V.get(),tt=V.get();Z.vsub(rt,tt);var Ui=tt.dot(we);we.mult(Ui,Pt),Pt.vadd(rt,Pt);var qi=V.get();if(Pt.vsub(Z,qi),Ui>0&&Ui*Ui<fi.norm2()&&qi.norm2()<se*se){var ee=this.createContactEquation(ne,ae,U,X);Pt.vsub(J,ee.rj),Pt.vsub(Z,ee.ni),ee.ni.normalize(),ee.ni.mult(se,ee.ri),ee.rj.vadd(J,ee.rj),ee.rj.vsub(ae.position,ee.rj),ee.ri.vadd(Z,ee.ri),ee.ri.vsub(ne.position,ee.ri),this.result.push(ee),this.createFrictionEquationsFromContact(ee,this.frictionResult);for(var Oe=0,ot=wt.length;Oe!==ot;Oe++)V.release(wt[Oe]);V.release(rt),V.release(Ht),V.release(Pt),V.release(qi),V.release(tt);return}V.release(rt),V.release(Ht),V.release(Pt),V.release(qi),V.release(tt)}for(var Oe=0,ot=wt.length;Oe!==ot;Oe++)V.release(wt[Oe])}}},new a,new a,p.prototype[i.types.PLANE|i.types.BOX]=p.prototype.planeBox=function(U,X,Z,J,ye,ce,ne,ae){X.convexPolyhedronRepresentation.material=X.material,X.convexPolyhedronRepresentation.collisionResponse=X.collisionResponse,this.planeConvex(U,X.convexPolyhedronRepresentation,Z,J,ye,ce,ne,ae)};var gt=new a,ci=new a,Ei=new a,hi=new a;p.prototype[i.types.PLANE|i.types.CONVEXPOLYHEDRON]=p.prototype.planeConvex=function(U,X,Z,J,ye,ce,ne,ae){var V=gt,re=ci;re.set(0,0,1),ye.vmult(re,re);for(var le=0,de=Ei,se=0;se!==X.vertices.length;se++){V.copy(X.vertices[se]),ce.vmult(V,V),J.vadd(V,V),V.vsub(Z,de);var ie=re.dot(de);if(ie<=0){var oe=this.createContactEquation(ne,ae,U,X),ve=hi;re.mult(re.dot(de),ve),V.vsub(ve,ve),ve.vsub(Z,oe.ri),oe.ni.copy(re),V.vsub(J,oe.rj),oe.ri.vadd(Z,oe.ri),oe.ri.vsub(ne.position,oe.ri),oe.rj.vadd(J,oe.rj),oe.rj.vsub(ae.position,oe.rj),this.result.push(oe),le++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(oe,this.frictionResult)}}this.enableFrictionReduction&&le&&this.createFrictionFromAverage(le)};var Vt=new a,Dt=new a;p.prototype[i.types.CONVEXPOLYHEDRON]=p.prototype.convexConvex=function(U,X,Z,J,ye,ce,ne,ae,V,re,le,de){var se=Vt;if(!(Z.distanceTo(J)>U.boundingSphereRadius+X.boundingSphereRadius)&&U.findSeparatingAxis(X,Z,ye,J,ce,se,le,de)){var ie=[],oe=Dt;U.clipAgainstHull(Z,ye,X,J,ce,se,-100,100,ie);for(var ve=0,_e=0;_e!==ie.length;_e++){var ee=this.createContactEquation(ne,ae,U,X,V,re),xe=ee.ri,Ae=ee.rj;se.negate(ee.ni),ie[_e].normal.negate(oe),oe.mult(ie[_e].depth,oe),ie[_e].point.vadd(oe,xe),Ae.copy(ie[_e].point),xe.vsub(Z,xe),Ae.vsub(J,Ae),xe.vadd(Z,xe),xe.vsub(ne.position,xe),Ae.vadd(J,Ae),Ae.vsub(ae.position,Ae),this.result.push(ee),ve++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(ee,this.frictionResult)}this.enableFrictionReduction&&ve&&this.createFrictionFromAverage(ve)}};var Di=new a,Si=new a,ti=new a;p.prototype[i.types.PLANE|i.types.PARTICLE]=p.prototype.planeParticle=function(U,X,Z,J,ye,ce,ne,ae){var V=Di;V.set(0,0,1),ne.quaternion.vmult(V,V);var re=Si;J.vsub(ne.position,re);var le=V.dot(re);if(le<=0){var de=this.createContactEquation(ae,ne,X,U);de.ni.copy(V),de.ni.negate(de.ni),de.ri.set(0,0,0);var se=ti;V.mult(V.dot(J),se),J.vsub(se,se),de.rj.copy(se),this.result.push(de),this.createFrictionEquationsFromContact(de,this.frictionResult)}};var Qt=new a;p.prototype[i.types.PARTICLE|i.types.SPHERE]=p.prototype.sphereParticle=function(U,X,Z,J,ye,ce,ne,ae){var V=Qt;V.set(0,0,1),J.vsub(Z,V);var re=V.norm2();if(re<=U.radius*U.radius){var le=this.createContactEquation(ae,ne,X,U);V.normalize(),le.rj.copy(V),le.rj.mult(U.radius,le.rj),le.ni.copy(V),le.ni.negate(le.ni),le.ri.set(0,0,0),this.result.push(le),this.createFrictionEquationsFromContact(le,this.frictionResult)}};var Rt=new l,ii=new a;new a;var Zt=new a,pt=new a,Wi=new a;p.prototype[i.types.PARTICLE|i.types.CONVEXPOLYHEDRON]=p.prototype.convexParticle=function(U,X,Z,J,ye,ce,ne,ae){var V=-1,re=Zt,le=Wi,de=null,se=ii;if(se.copy(J),se.vsub(Z,se),ye.conjugate(Rt),Rt.vmult(se,se),U.pointIsInside(se)){U.worldVerticesNeedsUpdate&&U.computeWorldVertices(Z,ye),U.worldFaceNormalsNeedsUpdate&&U.computeWorldFaceNormals(ye);for(var ie=0,oe=U.faces.length;ie!==oe;ie++){var ve=[U.worldVertices[U.faces[ie][0]]],_e=U.worldFaceNormals[ie];J.vsub(ve[0],pt);var ee=-_e.dot(pt);(de===null||Math.abs(ee)<Math.abs(de))&&(de=ee,V=ie,re.copy(_e))}if(V!==-1){var xe=this.createContactEquation(ae,ne,X,U);re.mult(de,le),le.vadd(J,le),le.vsub(Z,le),xe.rj.copy(le),re.negate(xe.ni),xe.ri.set(0,0,0);var Ae=xe.ri,Ye=xe.rj;Ae.vadd(J,Ae),Ae.vsub(ae.position,Ae),Ye.vadd(Z,Ye),Ye.vsub(ne.position,Ye),this.result.push(xe),this.createFrictionEquationsFromContact(xe,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},p.prototype[i.types.BOX|i.types.HEIGHTFIELD]=p.prototype.boxHeightfield=function(U,X,Z,J,ye,ce,ne,ae){U.convexPolyhedronRepresentation.material=U.material,U.convexPolyhedronRepresentation.collisionResponse=U.collisionResponse,this.convexHeightfield(U.convexPolyhedronRepresentation,X,Z,J,ye,ce,ne,ae)};var Gi=new a,Hi=new a,ln=[0];p.prototype[i.types.CONVEXPOLYHEDRON|i.types.HEIGHTFIELD]=p.prototype.convexHeightfield=function(U,X,Z,J,ye,ce,ne,ae){var V=X.data,re=X.elementSize,le=U.boundingSphereRadius,de=Hi,se=ln,ie=Gi;h.pointToLocalFrame(J,ce,Z,ie);var oe=Math.floor((ie.x-le)/re)-1,ve=Math.ceil((ie.x+le)/re)+1,_e=Math.floor((ie.y-le)/re)-1,ee=Math.ceil((ie.y+le)/re)+1;if(!(ve<0||ee<0||oe>V.length||_e>V[0].length)){oe<0&&(oe=0),ve<0&&(ve=0),_e<0&&(_e=0),ee<0&&(ee=0),oe>=V.length&&(oe=V.length-1),ve>=V.length&&(ve=V.length-1),ee>=V[0].length&&(ee=V[0].length-1),_e>=V[0].length&&(_e=V[0].length-1);var xe=[];X.getRectMinMax(oe,_e,ve,ee,xe);var Ae=xe[0],Ye=xe[1];if(!(ie.z-le>Ye||ie.z+le<Ae))for(var be=oe;be<ve;be++)for(var Be=_e;Be<ee;Be++)X.getConvexTrianglePillar(be,Be,!1),h.pointToWorldFrame(J,ce,X.pillarOffset,de),Z.distanceTo(de)<X.pillarConvex.boundingSphereRadius+U.boundingSphereRadius&&this.convexConvex(U,X.pillarConvex,Z,de,ye,ce,ne,ae,null,null,se,null),X.getConvexTrianglePillar(be,Be,!0),h.pointToWorldFrame(J,ce,X.pillarOffset,de),Z.distanceTo(de)<X.pillarConvex.boundingSphereRadius+U.boundingSphereRadius&&this.convexConvex(U,X.pillarConvex,Z,de,ye,ce,ne,ae,null,null,se,null)}};var cn=new a,et=new a;p.prototype[i.types.SPHERE|i.types.HEIGHTFIELD]=p.prototype.sphereHeightfield=function(U,X,Z,J,ye,ce,ne,ae){var V=X.data,re=U.radius,le=X.elementSize,de=et,se=cn;h.pointToLocalFrame(J,ce,Z,se);var ie=Math.floor((se.x-re)/le)-1,oe=Math.ceil((se.x+re)/le)+1,ve=Math.floor((se.y-re)/le)-1,_e=Math.ceil((se.y+re)/le)+1;if(!(oe<0||_e<0||ie>V.length||_e>V[0].length)){ie<0&&(ie=0),oe<0&&(oe=0),ve<0&&(ve=0),_e<0&&(_e=0),ie>=V.length&&(ie=V.length-1),oe>=V.length&&(oe=V.length-1),_e>=V[0].length&&(_e=V[0].length-1),ve>=V[0].length&&(ve=V[0].length-1);var ee=[];X.getRectMinMax(ie,ve,oe,_e,ee);var xe=ee[0],Ae=ee[1];if(!(se.z-re>Ae||se.z+re<xe))for(var Ye=this.result,be=ie;be<oe;be++)for(var Be=ve;Be<_e;Be++){var me=Ye.length;X.getConvexTrianglePillar(be,Be,!1),h.pointToWorldFrame(J,ce,X.pillarOffset,de),Z.distanceTo(de)<X.pillarConvex.boundingSphereRadius+U.boundingSphereRadius&&this.sphereConvex(U,X.pillarConvex,Z,de,ye,ce,ne,ae),X.getConvexTrianglePillar(be,Be,!0),h.pointToWorldFrame(J,ce,X.pillarOffset,de),Z.distanceTo(de)<X.pillarConvex.boundingSphereRadius+U.boundingSphereRadius&&this.sphereConvex(U,X.pillarConvex,Z,de,ye,ce,ne,ae);var Wt=Ye.length-me;if(Wt>2)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(t,n,r){n.exports=w;var s=t("../shapes/Shape"),i=t("../math/Vec3"),o=t("../math/Quaternion"),a=t("../solver/GSSolver");t("../utils/Vec3Pool"),t("../equations/ContactEquation"),t("../equations/FrictionEquation");var h=t("./Narrowphase"),l=t("../utils/EventTarget"),c=t("../collision/ArrayCollisionMatrix"),u=t("../material/Material"),d=t("../material/ContactMaterial"),p=t("../objects/Body"),f=t("../utils/TupleDictionary"),v=t("../collision/RaycastResult"),m=t("../collision/AABB"),y=t("../collision/Ray"),_=t("../collision/NaiveBroadphase");function w(){l.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new i,this.broadphase=new _,this.bodies=[],this.solver=new a,this.constraints=[],this.narrowphase=new h(this),this.collisionMatrix=new c,this.collisionMatrixPrevious=new c,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new f,this.defaultMaterial=new u("default"),this.defaultContactMaterial=new d(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}w.prototype=new l,new m;var x=new y;if(w.prototype.getContactMaterial=function(B,H){return this.contactMaterialTable.get(B.id,H.id)},w.prototype.numObjects=function(){return this.bodies.length},w.prototype.collisionMatrixTick=function(){var B=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=B,this.collisionMatrix.reset()},w.prototype.add=w.prototype.addBody=function(B){this.bodies.indexOf(B)===-1&&(B.index=this.bodies.length,this.bodies.push(B),B.world=this,B.initPosition.copy(B.position),B.initVelocity.copy(B.velocity),B.timeLastSleepy=this.time,B instanceof p&&(B.initAngularVelocity.copy(B.angularVelocity),B.initQuaternion.copy(B.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=B,this.dispatchEvent(this.addBodyEvent))},w.prototype.addConstraint=function(B){this.constraints.push(B)},w.prototype.removeConstraint=function(B){var H=this.constraints.indexOf(B);H!==-1&&this.constraints.splice(H,1)},w.prototype.rayTest=function(B,H,W){W instanceof v?this.raycastClosest(B,H,{skipBackfaces:!0},W):this.raycastAll(B,H,{skipBackfaces:!0},W)},w.prototype.raycastAll=function(B,H,W,P){return W.mode=y.ALL,W.from=B,W.to=H,W.callback=P,x.intersectWorld(this,W)},w.prototype.raycastAny=function(B,H,W,P){return W.mode=y.ANY,W.from=B,W.to=H,W.result=P,x.intersectWorld(this,W)},w.prototype.raycastClosest=function(B,H,W,P){return W.mode=y.CLOSEST,W.from=B,W.to=H,W.result=P,x.intersectWorld(this,W)},w.prototype.remove=function(B){B.world=null;var H=this.bodies.length-1,W=this.bodies,P=W.indexOf(B);if(P!==-1){W.splice(P,1);for(var k=0;k!==W.length;k++)W[k].index=k;this.collisionMatrix.setNumObjects(H),this.removeBodyEvent.body=B,this.dispatchEvent(this.removeBodyEvent)}},w.prototype.removeBody=w.prototype.remove,w.prototype.addMaterial=function(B){this.materials.push(B)},w.prototype.addContactMaterial=function(B){this.contactmaterials.push(B),this.contactMaterialTable.set(B.materials[0].id,B.materials[1].id,B)},typeof performance>"u"&&(performance={}),!performance.now){var E=Date.now();performance.timing&&performance.timing.navigationStart&&(E=performance.timing.navigationStart),performance.now=function(){return Date.now()-E}}var L=new i;w.prototype.step=function(B,H,W){if(W=W||10,H=H||0,H===0)this.internalStep(B),this.time+=B;else{var P=Math.floor((this.time+H)/B)-Math.floor(this.time/B);P=Math.min(P,W);for(var k=performance.now(),M=0;M!==P&&(this.internalStep(B),!(performance.now()-k>B*1e3));M++);this.time+=H;for(var S=this.time%B,b=S/B,N=L,j=this.bodies,$=0;$!==j.length;$++){var O=j[$];O.type!==p.STATIC&&O.sleepState!==p.SLEEPING?(O.position.vsub(O.previousPosition,N),N.scale(b,N),O.position.vadd(N,O.interpolatedPosition)):(O.interpolatedPosition.copy(O.position),O.interpolatedQuaternion.copy(O.quaternion))}}};var A={type:"postStep"},T={type:"preStep"},R={type:"collide",body:null,contact:null},C=[],F=[],I=[],D=[];new i,new i,new i,new i,new i,new i,new i,new i,new i,new o;var G=new o,Y=new o,z=new i;w.prototype.internalStep=function(B){this.dt=B;var H=this.contacts,W=I,P=D,k=this.numObjects(),M=this.bodies,S=this.solver,b=this.gravity,N=this.doProfiling,j=this.profile,$=p.DYNAMIC,O,q=this.constraints,Q=F;b.norm();var fe=b.x,ue=b.y,he=b.z,K=0;for(N&&(O=performance.now()),K=0;K!==k;K++){var te=M[K];if(te.type&$){var Se=te.force,ge=te.mass;Se.x+=ge*fe,Se.y+=ge*ue,Se.z+=ge*he}}for(var K=0,Ne=this.subsystems.length;K!==Ne;K++)this.subsystems[K].update();N&&(O=performance.now()),W.length=0,P.length=0,this.broadphase.collisionPairs(this,W,P),N&&(j.broadphase=performance.now()-O);var Vt=q.length;for(K=0;K!==Vt;K++){var pe=q[K];if(!pe.collideConnected)for(var Fe=W.length-1;Fe>=0;Fe-=1)(pe.bodyA===W[Fe]&&pe.bodyB===P[Fe]||pe.bodyB===W[Fe]&&pe.bodyA===P[Fe])&&(W.splice(Fe,1),P.splice(Fe,1))}this.collisionMatrixTick(),N&&(O=performance.now());var ze=C,Ie=H.length;for(K=0;K!==Ie;K++)ze.push(H[K]);H.length=0;var De=this.frictionEquations.length;for(K=0;K!==De;K++)Q.push(this.frictionEquations[K]);this.frictionEquations.length=0,this.narrowphase.getContacts(W,P,this,H,ze,this.frictionEquations,Q),N&&(j.narrowphase=performance.now()-O),N&&(O=performance.now());for(var K=0;K<this.frictionEquations.length;K++)S.addEquation(this.frictionEquations[K]);for(var Re=H.length,Ge=0;Ge!==Re;Ge++){var pe=H[Ge],te=pe.bi,Pe=pe.bj;pe.si,pe.sj;var Je;if(te.material&&Pe.material?Je=this.getContactMaterial(te.material,Pe.material)||this.defaultContactMaterial:Je=this.defaultContactMaterial,Je.friction,te.material&&Pe.material&&(te.material.friction>=0&&Pe.material.friction>=0&&te.material.friction*Pe.material.friction,te.material.restitution>=0&&Pe.material.restitution>=0&&(pe.restitution=te.material.restitution*Pe.material.restitution)),S.addEquation(pe),te.allowSleep&&te.type===p.DYNAMIC&&te.sleepState===p.SLEEPING&&Pe.sleepState===p.AWAKE&&Pe.type!==p.STATIC){var gt=Pe.velocity.norm2()+Pe.angularVelocity.norm2(),ci=Math.pow(Pe.sleepSpeedLimit,2);gt>=ci*2&&(te._wakeUpAfterNarrowphase=!0)}if(Pe.allowSleep&&Pe.type===p.DYNAMIC&&Pe.sleepState===p.SLEEPING&&te.sleepState===p.AWAKE&&te.type!==p.STATIC){var Ei=te.velocity.norm2()+te.angularVelocity.norm2(),hi=Math.pow(te.sleepSpeedLimit,2);Ei>=hi*2&&(Pe._wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(te,Pe,!0),this.collisionMatrixPrevious.get(te,Pe)||(R.body=Pe,R.contact=pe,te.dispatchEvent(R),R.body=te,Pe.dispatchEvent(R))}for(N&&(j.makeContactConstraints=performance.now()-O,O=performance.now()),K=0;K!==k;K++){var te=M[K];te._wakeUpAfterNarrowphase&&(te.wakeUp(),te._wakeUpAfterNarrowphase=!1)}var Vt=q.length;for(K=0;K!==Vt;K++){var pe=q[K];pe.update();for(var Fe=0,Dt=pe.equations.length;Fe!==Dt;Fe++){var Di=pe.equations[Fe];S.addEquation(Di)}}S.solve(B,this),N&&(j.solve=performance.now()-O),S.removeAllEquations();var Si=Math.pow;for(K=0;K!==k;K++){var te=M[K];if(te.type&$){var ti=Si(1-te.linearDamping,B),Qt=te.velocity;Qt.mult(ti,Qt);var Rt=te.angularVelocity;if(Rt){var ii=Si(1-te.angularDamping,B);Rt.mult(ii,Rt)}}}for(this.dispatchEvent(T),K=0;K!==k;K++){var te=M[K];te.preStep&&te.preStep.call(te)}N&&(O=performance.now());var Zt=G,pt=Y,Wi=this.stepnumber,Gi=p.DYNAMIC|p.KINEMATIC,Hi=Wi%(this.quatNormalizeSkip+1)===0,ln=this.quatNormalizeFast,cn=B*.5;for(s.types.PLANE,s.types.CONVEXPOLYHEDRON,K=0;K!==k;K++){var et=M[K],U=et.force,X=et.torque;if(et.type&Gi&&et.sleepState!==p.SLEEPING){var Z=et.velocity,J=et.angularVelocity,ye=et.position,ce=et.quaternion,ne=et.invMass,ae=et.invInertiaWorld;Z.x+=U.x*ne*B,Z.y+=U.y*ne*B,Z.z+=U.z*ne*B,et.angularVelocity&&(ae.vmult(X,z),z.mult(B,z),z.vadd(J,J)),ye.x+=Z.x*B,ye.y+=Z.y*B,ye.z+=Z.z*B,et.angularVelocity&&(Zt.set(J.x,J.y,J.z,0),Zt.mult(ce,pt),ce.x+=cn*pt.x,ce.y+=cn*pt.y,ce.z+=cn*pt.z,ce.w+=cn*pt.w,Hi&&(ln?ce.normalizeFast():ce.normalize())),et.aabb&&(et.aabbNeedsUpdate=!0),et.updateInertiaWorld&&et.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,N&&(j.integrate=performance.now()-O),this.time+=B,this.stepnumber+=1,this.dispatchEvent(A),K=0;K!==k;K++){var te=M[K],V=te.postStep;V&&V.call(te)}if(this.allowSleep)for(K=0;K!==k;K++)M[K].sleepTick(this.time)},w.prototype.clearForces=function(){for(var B=this.bodies,H=B.length,W=0;W!==H;W++){var P=B[W];P.force,P.torque,P.force.set(0,0,0),P.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)})})(ia);var uh=ia.exports;const Ut=la(uh),dh={class:"wcp-demo-container"},ph={__name:"ThreePhysics",setup(g){const e=Le(null),t=Le(null),n=new Ti;return ht(()=>{const r=new vt,s=new Audio("/sounds/glass-hitting.wav");function i(B){const H=B.contact.getImpactVelocityAlongNormal();H>1.5&&(s.volume=Math.min(H/10,1),s.currentTime=0,s.play())}const a=new qs().load(["/textures/matcap1.png","/textures/matcap1.png","/textures/matcap1.png","/textures/matcap1.png","/textures/matcap1.png","/textures/matcap1.png"]),l=new Ai().load("/textures/Plastic013A/Plastic013A_1K-PNG_Color.png");l.wrapS=Ft,l.wrapT=Ft,l.repeat.set(2,2);const c=new Te(new rn(10,10),new Ke({color:"#eee",side:zi}));c.rotation.x=-Math.PI/2,r.add(c),c.receiveShadow=!0,console.log(Ut);const u=new Ut.World;u.gravity.set(0,-9.8,0);const d=new Ut.Material("ballMaterial"),p=new Ut.ContactMaterial(d,{friction:.1,restitution:.7});u.addContactMaterial(p),u.defaultContactMaterial=p;const f=new Ut.Plane,v=new Ut.Body;v.mass=0,v.addShape(f),v.quaternion.setFromAxisAngle(new Ut.Vec3(-1,0,0),Math.PI/2),u.addBody(v);const m=new An("#ffffff",.5);r.add(m);const y=new bn("#ffffff",.5);y.position.set(1,3,-3),y.castShadow=!0,r.add(y);const _={width:+getComputedStyle(e.value).width.split("px")[0],height:+getComputedStyle(e.value).height.split("px")[0]},w=new dt(75,_.width/_.height,.1,1e3);w.position.z=6,w.position.y=6,w.position.x=6,r.add(w);const x=new Kt(w,t.value);x.enableDamping=!0;const E={};E.createSphere=function(){C(Math.random()*.5,{x:(Math.random()-.5)*3,y:3,z:(Math.random()-.5)*3})},E.createBox=function(){D(Math.random()*.5,Math.random()*.5,Math.random()*.5,{x:(Math.random()-.5)*3,y:3,z:(Math.random()-.5)*3})},E.reset=()=>{A.forEach(B=>{B.body.removeEventListener("collide",i),u.removeBody(B.body),r.remove(B.mesh)}),A.length=0},n.add(E,"createSphere"),n.add(E,"createBox"),n.add(E,"reset");const L=new mt({canvas:t.value});L.setSize(_.width,_.height),L.setPixelRatio(Math.min(window.devicePixelRatio,2)),L.shadowMap.enabled=!0;const A=[],T=new yi(1,32,32),R=new Ke({metalness:.3,roughness:.4,envMap:a});function C(B,H){const W=new Te(T,R);W.scale.set(B,B,B),W.castShadow=!0,W.position.copy(H),r.add(W);const P=new Ut.Sphere(B),k=new Ut.Body({mass:1,position:H,shape:P,material:d});k.position.copy(H),k.addEventListener("collide",i),u.addBody(k),A.push({mesh:W,body:k})}const F=new Jt(1,1,1),I=new Ke({metalness:1,roughness:.4,envMap:a});function D(B,H,W,P){const k=new Te(F,I);k.scale.set(B,H,W),k.castShadow=!0,k.position.copy(P),r.add(k);const M=new Ut.Box(new Ut.Vec3(B/2,H/2,W/2)),S=new Ut.Body({mass:1,position:P,shape:M,material:d});S.position.copy(P),S.addEventListener("collide",i),u.addBody(S),A.push({mesh:k,body:S})}C(.5,{x:0,y:3,z:0});const G=new xi;let Y=0;function z(){requestAnimationFrame(z);const B=G.getElapsedTime(),H=B-Y;Y=B,u.step(1/60,H,3),A.forEach(W=>{W.mesh.position.copy(W.body.position),W.mesh.quaternion.copy(W.body.quaternion)}),x.update(),L.render(r,w)}z(),window.addEventListener("resize",B=>{_.width=+getComputedStyle(e.value).width.split("px")[0],_.height=+getComputedStyle(e.value).height.split("px")[0],w.aspect=_.width/_.height,w.updateProjectionMatrix(),L.setSize(_.width,_.height),L.setPixelRatio(Math.min(window.devicePixelRatio,2))}),t.value.addEventListener("dblclick",B=>{document.fullscreenElement?document.exitFullscreen():e.value.requestFullscreen()})}),Mt(()=>{n.destroy(),console.log("unmounted")}),(r,s)=>(ke(),st("div",dh,[Ce("div",{ref_key:"canvasContainer",ref:e,class:"canvas-container"},[Ce("canvas",{ref_key:"canvas",ref:t},null,512)],512)]))}},fh=ut(ph,[["__scopeId","data-v-6cdabade"]]);function zs(g,e){if(e===Ea)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),g;if(e===Mr||e===Qs){let t=g.getIndex();if(t===null){const i=[],o=g.getAttribute("position");if(o!==void 0){for(let a=0;a<o.count;a++)i.push(a);g.setIndex(i),t=g.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),g}const n=t.count-2,r=[];if(e===Mr)for(let i=1;i<=n;i++)r.push(t.getX(0)),r.push(t.getX(i)),r.push(t.getX(i+1));else for(let i=0;i<n;i++)i%2===0?(r.push(t.getX(i)),r.push(t.getX(i+1)),r.push(t.getX(i+2))):(r.push(t.getX(i+2)),r.push(t.getX(i+1)),r.push(t.getX(i)));r.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=g.clone();return s.setIndex(r),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),g}class na extends Yr{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new wh(t)}),this.register(function(t){return new Mh(t)}),this.register(function(t){return new Rh(t)}),this.register(function(t){return new Ph(t)}),this.register(function(t){return new xh(t)}),this.register(function(t){return new Ah(t)}),this.register(function(t){return new bh(t)}),this.register(function(t){return new Th(t)}),this.register(function(t){return new yh(t)}),this.register(function(t){return new Eh(t)}),this.register(function(t){return new _h(t)}),this.register(function(t){return new Ch(t)}),this.register(function(t){return new Sh(t)}),this.register(function(t){return new mh(t)}),this.register(function(t){return new Bh(t)}),this.register(function(t){return new Lh(t)})}load(e,t,n,r){const s=this;let i;if(this.resourcePath!=="")i=this.resourcePath;else if(this.path!==""){const h=Mn.extractUrlBase(e);i=Mn.resolveURL(h,this.path)}else i=Mn.extractUrlBase(e);this.manager.itemStart(e);const o=function(h){r?r(h):console.error(h),s.manager.itemError(e),s.manager.itemEnd(e)},a=new Ln(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(h){try{s.parse(h,i,function(l){t(l),s.manager.itemEnd(e)},o)}catch(l){o(l)}},n,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let s;const i={},o={},a=new TextDecoder;if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(a.decode(new Uint8Array(e,0,4))===ra){try{i[Ee.KHR_BINARY_GLTF]=new Fh(e)}catch(c){r&&r(c);return}s=JSON.parse(i[Ee.KHR_BINARY_GLTF].content)}else s=JSON.parse(a.decode(e));else s=e;if(s.asset===void 0||s.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const h=new $h(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let l=0;l<this.pluginCallbacks.length;l++){const c=this.pluginCallbacks[l](h);c.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[c.name]=c,i[c.name]=!0}if(s.extensionsUsed)for(let l=0;l<s.extensionsUsed.length;++l){const c=s.extensionsUsed[l],u=s.extensionsRequired||[];switch(c){case Ee.KHR_MATERIALS_UNLIT:i[c]=new gh;break;case Ee.KHR_DRACO_MESH_COMPRESSION:i[c]=new Ih(s,this.dracoLoader);break;case Ee.KHR_TEXTURE_TRANSFORM:i[c]=new kh;break;case Ee.KHR_MESH_QUANTIZATION:i[c]=new zh;break;default:u.indexOf(c)>=0&&o[c]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+c+'".')}}h.setExtensions(i),h.setPlugins(o),h.parse(n,r)}parseAsync(e,t){const n=this;return new Promise(function(r,s){n.parse(e,t,r,s)})}}function vh(){let g={};return{get:function(e){return g[e]},add:function(e,t){g[e]=t},remove:function(e){delete g[e]},removeAll:function(){g={}}}}const Ee={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class mh{constructor(e){this.parser=e,this.name=Ee.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const s=t[n];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;const s=t.json,a=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let h;const l=new At(16777215);a.color!==void 0&&l.setRGB(a.color[0],a.color[1],a.color[2],ei);const c=a.range!==void 0?a.range:0;switch(a.type){case"directional":h=new bn(l),h.target.position.set(0,0,-1),h.add(h.target);break;case"point":h=new Ki(l),h.distance=c;break;case"spot":h=new $s(l),h.distance=c,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,h.angle=a.spot.outerConeAngle,h.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,h.target.position.set(0,0,-1),h.add(h.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return h.position.set(0,0,0),h.decay=2,Mi(h,a),a.intensity!==void 0&&(h.intensity=a.intensity),h.name=t.createUniqueName(a.name||"light_"+e),r=Promise.resolve(h),t.cache.add(n,r),r}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,s=n.json.nodes[e],o=(s.extensions&&s.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(a){return n._getNodeRef(t.cache,o,a)})}}class gh{constructor(){this.name=Ee.KHR_MATERIALS_UNLIT}getMaterialType(){return kt}extendParams(e,t,n){const r=[];e.color=new At(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const i=s.baseColorFactor;e.color.setRGB(i[0],i[1],i[2],ei),e.opacity=i[3]}s.baseColorTexture!==void 0&&r.push(n.assignTexture(e,"map",s.baseColorTexture,ki))}return Promise.all(r)}}class yh{constructor(e){this.parser=e,this.name=Ee.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class wh{constructor(e){this.parser=e,this.name=Ee.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:bi}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],i=r.extensions[this.name];if(i.clearcoatFactor!==void 0&&(t.clearcoat=i.clearcoatFactor),i.clearcoatTexture!==void 0&&s.push(n.assignTexture(t,"clearcoatMap",i.clearcoatTexture)),i.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=i.clearcoatRoughnessFactor),i.clearcoatRoughnessTexture!==void 0&&s.push(n.assignTexture(t,"clearcoatRoughnessMap",i.clearcoatRoughnessTexture)),i.clearcoatNormalTexture!==void 0&&(s.push(n.assignTexture(t,"clearcoatNormalMap",i.clearcoatNormalTexture)),i.clearcoatNormalTexture.scale!==void 0)){const o=i.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new jr(o,o)}return Promise.all(s)}}class _h{constructor(e){this.parser=e,this.name=Ee.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:bi}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],i=r.extensions[this.name];return i.iridescenceFactor!==void 0&&(t.iridescence=i.iridescenceFactor),i.iridescenceTexture!==void 0&&s.push(n.assignTexture(t,"iridescenceMap",i.iridescenceTexture)),i.iridescenceIor!==void 0&&(t.iridescenceIOR=i.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),i.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=i.iridescenceThicknessMinimum),i.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=i.iridescenceThicknessMaximum),i.iridescenceThicknessTexture!==void 0&&s.push(n.assignTexture(t,"iridescenceThicknessMap",i.iridescenceThicknessTexture)),Promise.all(s)}}class xh{constructor(e){this.parser=e,this.name=Ee.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:bi}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new At(0,0,0),t.sheenRoughness=0,t.sheen=1;const i=r.extensions[this.name];if(i.sheenColorFactor!==void 0){const o=i.sheenColorFactor;t.sheenColor.setRGB(o[0],o[1],o[2],ei)}return i.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=i.sheenRoughnessFactor),i.sheenColorTexture!==void 0&&s.push(n.assignTexture(t,"sheenColorMap",i.sheenColorTexture,ki)),i.sheenRoughnessTexture!==void 0&&s.push(n.assignTexture(t,"sheenRoughnessMap",i.sheenRoughnessTexture)),Promise.all(s)}}class Ah{constructor(e){this.parser=e,this.name=Ee.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:bi}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],i=r.extensions[this.name];return i.transmissionFactor!==void 0&&(t.transmission=i.transmissionFactor),i.transmissionTexture!==void 0&&s.push(n.assignTexture(t,"transmissionMap",i.transmissionTexture)),Promise.all(s)}}class bh{constructor(e){this.parser=e,this.name=Ee.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:bi}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],i=r.extensions[this.name];t.thickness=i.thicknessFactor!==void 0?i.thicknessFactor:0,i.thicknessTexture!==void 0&&s.push(n.assignTexture(t,"thicknessMap",i.thicknessTexture)),t.attenuationDistance=i.attenuationDistance||1/0;const o=i.attenuationColor||[1,1,1];return t.attenuationColor=new At().setRGB(o[0],o[1],o[2],ei),Promise.all(s)}}class Th{constructor(e){this.parser=e,this.name=Ee.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:bi}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class Eh{constructor(e){this.parser=e,this.name=Ee.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:bi}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],i=r.extensions[this.name];t.specularIntensity=i.specularFactor!==void 0?i.specularFactor:1,i.specularTexture!==void 0&&s.push(n.assignTexture(t,"specularIntensityMap",i.specularTexture));const o=i.specularColorFactor||[1,1,1];return t.specularColor=new At().setRGB(o[0],o[1],o[2],ei),i.specularColorTexture!==void 0&&s.push(n.assignTexture(t,"specularColorMap",i.specularColorTexture,ki)),Promise.all(s)}}class Sh{constructor(e){this.parser=e,this.name=Ee.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:bi}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],i=r.extensions[this.name];return t.bumpScale=i.bumpFactor!==void 0?i.bumpFactor:1,i.bumpTexture!==void 0&&s.push(n.assignTexture(t,"bumpMap",i.bumpTexture)),Promise.all(s)}}class Ch{constructor(e){this.parser=e,this.name=Ee.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:bi}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],i=r.extensions[this.name];return i.anisotropyStrength!==void 0&&(t.anisotropy=i.anisotropyStrength),i.anisotropyRotation!==void 0&&(t.anisotropyRotation=i.anisotropyRotation),i.anisotropyTexture!==void 0&&s.push(n.assignTexture(t,"anisotropyMap",i.anisotropyTexture)),Promise.all(s)}}class Mh{constructor(e){this.parser=e,this.name=Ee.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],i=t.options.ktx2Loader;if(!i){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,i)}}class Rh{constructor(e){this.parser=e,this.name=Ee.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const i=s.extensions[t],o=r.images[i.source];let a=n.textureLoader;if(o.uri){const h=n.options.manager.getHandler(o.uri);h!==null&&(a=h)}return this.detectSupport().then(function(h){if(h)return n.loadTextureImage(e,i.source,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Ph{constructor(e){this.parser=e,this.name=Ee.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const i=s.extensions[t],o=r.images[i.source];let a=n.textureLoader;if(o.uri){const h=n.options.manager.getHandler(o.uri);h!==null&&(a=h)}return this.detectSupport().then(function(h){if(h)return n.loadTextureImage(e,i.source,a);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Bh{constructor(e){this.name=Ee.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const r=n.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(o){const a=r.byteOffset||0,h=r.byteLength||0,l=r.count,c=r.byteStride,u=new Uint8Array(o,a,h);return i.decodeGltfBufferAsync?i.decodeGltfBufferAsync(l,c,u,r.mode,r.filter).then(function(d){return d.buffer}):i.ready.then(function(){const d=new ArrayBuffer(l*c);return i.decodeGltfBuffer(new Uint8Array(d),l,c,u,r.mode,r.filter),d})})}else return null}}class Lh{constructor(e){this.name=Ee.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const r=t.meshes[n.mesh];for(const h of r.primitives)if(h.mode!==$t.TRIANGLES&&h.mode!==$t.TRIANGLE_STRIP&&h.mode!==$t.TRIANGLE_FAN&&h.mode!==void 0)return null;const i=n.extensions[this.name].attributes,o=[],a={};for(const h in i)o.push(this.parser.getDependency("accessor",i[h]).then(l=>(a[h]=l,a[h])));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then(h=>{const l=h.pop(),c=l.isGroup?l.children:[l],u=h[0].count,d=[];for(const p of c){const f=new Jn,v=new gi,m=new to,y=new gi(1,1,1),_=new Sa(p.geometry,p.material,u);for(let w=0;w<u;w++)a.TRANSLATION&&v.fromBufferAttribute(a.TRANSLATION,w),a.ROTATION&&m.fromBufferAttribute(a.ROTATION,w),a.SCALE&&y.fromBufferAttribute(a.SCALE,w),_.setMatrixAt(w,f.compose(v,m,y));for(const w in a)if(w==="_COLOR_0"){const x=a[w];_.instanceColor=new Ca(x.array,x.itemSize,x.normalized)}else w!=="TRANSLATION"&&w!=="ROTATION"&&w!=="SCALE"&&p.geometry.setAttribute(w,a[w]);Zs.prototype.copy.call(_,p),this.parser.assignFinalMaterial(_),d.push(_)}return l.isGroup?(l.clear(),l.add(...d),l):d[0]}))}}const ra="glTF",En=12,Ns={JSON:1313821514,BIN:5130562};class Fh{constructor(e){this.name=Ee.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,En),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==ra)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-En,s=new DataView(e,En);let i=0;for(;i<r;){const o=s.getUint32(i,!0);i+=4;const a=s.getUint32(i,!0);if(i+=4,a===Ns.JSON){const h=new Uint8Array(e,En+i,o);this.content=n.decode(h)}else if(a===Ns.BIN){const h=En+i;this.body=e.slice(h,h+o)}i+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ih{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ee.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes,o={},a={},h={};for(const l in i){const c=qr[l]||l.toLowerCase();o[c]=i[l]}for(const l in e.attributes){const c=qr[l]||l.toLowerCase();if(i[l]!==void 0){const u=n.accessors[e.attributes[l]],d=mn[u.componentType];h[c]=d.name,a[c]=u.normalized===!0}}return t.getDependency("bufferView",s).then(function(l){return new Promise(function(c,u){r.decodeDracoFile(l,function(d){for(const p in d.attributes){const f=d.attributes[p],v=a[p];v!==void 0&&(f.normalized=v)}c(d)},o,h,ei,u)})})}}class kh{constructor(){this.name=Ee.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class zh{constructor(){this.name=Ee.KHR_MESH_QUANTIZATION}}class sa extends Ya{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let i=0;i!==r;i++)t[i]=n[s+i];return t}interpolate_(e,t,n,r){const s=this.resultBuffer,i=this.sampleValues,o=this.valueSize,a=o*2,h=o*3,l=r-t,c=(n-t)/l,u=c*c,d=u*c,p=e*h,f=p-h,v=-2*d+3*u,m=d-u,y=1-v,_=m-u+c;for(let w=0;w!==o;w++){const x=i[f+w+o],E=i[f+w+a]*l,L=i[p+w+o],A=i[p+w]*l;s[w]=y*x+_*E+v*L+m*A}return s}}const Nh=new to;class Oh extends sa{interpolate_(e,t,n,r){const s=super.interpolate_(e,t,n,r);return Nh.fromArray(s).normalize().toArray(s),s}}const $t={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},mn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Os={9728:Us,9729:Zn,9984:Oa,9985:Va,9986:Da,9987:Js},Vs={33071:Wa,33648:Ga,10497:Ft},Tr={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},qr={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ci={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Vh={CUBICSPLINE:void 0,LINEAR:eo,STEP:Ha},Er={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Dh(g){return g.DefaultMaterial===void 0&&(g.DefaultMaterial=new Ke({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Ua})),g.DefaultMaterial}function Yi(g,e,t){for(const n in t.extensions)g[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function Mi(g,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(g.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Wh(g,e,t){let n=!1,r=!1,s=!1;for(let h=0,l=e.length;h<l;h++){const c=e[h];if(c.POSITION!==void 0&&(n=!0),c.NORMAL!==void 0&&(r=!0),c.COLOR_0!==void 0&&(s=!0),n&&r&&s)break}if(!n&&!r&&!s)return Promise.resolve(g);const i=[],o=[],a=[];for(let h=0,l=e.length;h<l;h++){const c=e[h];if(n){const u=c.POSITION!==void 0?t.getDependency("accessor",c.POSITION):g.attributes.position;i.push(u)}if(r){const u=c.NORMAL!==void 0?t.getDependency("accessor",c.NORMAL):g.attributes.normal;o.push(u)}if(s){const u=c.COLOR_0!==void 0?t.getDependency("accessor",c.COLOR_0):g.attributes.color;a.push(u)}}return Promise.all([Promise.all(i),Promise.all(o),Promise.all(a)]).then(function(h){const l=h[0],c=h[1],u=h[2];return n&&(g.morphAttributes.position=l),r&&(g.morphAttributes.normal=c),s&&(g.morphAttributes.color=u),g.morphTargetsRelative=!0,g})}function Gh(g,e){if(g.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)g.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(g.morphTargetInfluences.length===t.length){g.morphTargetDictionary={};for(let n=0,r=t.length;n<r;n++)g.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Hh(g){let e;const t=g.extensions&&g.extensions[Ee.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+Sr(t.attributes):e=g.indices+":"+Sr(g.attributes)+":"+g.mode,g.targets!==void 0)for(let n=0,r=g.targets.length;n<r;n++)e+=":"+Sr(g.targets[n]);return e}function Sr(g){let e="";const t=Object.keys(g).sort();for(let n=0,r=t.length;n<r;n++)e+=t[n]+":"+g[t[n]]+";";return e}function $r(g){switch(g){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Uh(g){return g.search(/\.jpe?g($|\?)/i)>0||g.search(/^data\:image\/jpeg/)===0?"image/jpeg":g.search(/\.webp($|\?)/i)>0||g.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const qh=new Jn;class $h{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new vh,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,r=!1,s=-1;typeof navigator<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,s=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||r&&s<98?this.textureLoader=new Ai(this.options.manager):this.textureLoader=new Ma(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Ln(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(i){return i._markDefs&&i._markDefs()}),Promise.all(this._invokeAll(function(i){return i.beforeRoot&&i.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(i){const o={scene:i[0][r.scene||0],scenes:i[0],animations:i[1],cameras:i[2],asset:r.asset,parser:n,userData:{}};return Yi(s,o,r),Mi(o,r),Promise.all(n._invokeAll(function(a){return a.afterRoot&&a.afterRoot(o)})).then(function(){for(const a of o.scenes)a.updateMatrixWorld();e(o)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let r=0,s=t.length;r<s;r++){const i=t[r].joints;for(let o=0,a=i.length;o<a;o++)e[i[o]].isBone=!0}for(let r=0,s=e.length;r<s;r++){const i=e[r];i.mesh!==void 0&&(this._addNodeRef(this.meshCache,i.mesh),i.skin!==void 0&&(n[i.mesh].isSkinnedMesh=!0)),i.camera!==void 0&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone(),s=(i,o)=>{const a=this.associations.get(i);a!=null&&this.associations.set(o,a);for(const[h,l]of i.children.entries())s(l,o.children[h])};return s(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const s=e(t[r]);s&&n.push(s)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(s,i){return n.getDependency(e,i)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Ee.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,i){n.load(Mn.resolveURL(t.uri,r.path),s,void 0,function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const r=t.byteLength||0,s=t.byteOffset||0;return n.slice(s,s+r)})}loadAccessor(e){const t=this,n=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const i=Tr[r.type],o=mn[r.componentType],a=r.normalized===!0,h=new o(r.count*i);return Promise.resolve(new Li(h,i,a))}const s=[];return r.bufferView!==void 0?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),r.sparse!==void 0&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(i){const o=i[0],a=Tr[r.type],h=mn[r.componentType],l=h.BYTES_PER_ELEMENT,c=l*a,u=r.byteOffset||0,d=r.bufferView!==void 0?n.bufferViews[r.bufferView].byteStride:void 0,p=r.normalized===!0;let f,v;if(d&&d!==c){const m=Math.floor(u/d),y="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+m+":"+r.count;let _=t.cache.get(y);_||(f=new h(o,m*d,r.count*d/l),_=new Ra(f,d/l),t.cache.add(y,_)),v=new qa(_,a,u%d/l,p)}else o===null?f=new h(r.count*a):f=new h(o,u,r.count*a),v=new Li(f,a,p);if(r.sparse!==void 0){const m=Tr.SCALAR,y=mn[r.sparse.indices.componentType],_=r.sparse.indices.byteOffset||0,w=r.sparse.values.byteOffset||0,x=new y(i[1],_,r.sparse.count*m),E=new h(i[2],w,r.sparse.count*a);o!==null&&(v=new Li(v.array.slice(),v.itemSize,v.normalized));for(let L=0,A=x.length;L<A;L++){const T=x[L];if(v.setX(T,E[L*a]),a>=2&&v.setY(T,E[L*a+1]),a>=3&&v.setZ(T,E[L*a+2]),a>=4&&v.setW(T,E[L*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return v})}loadTexture(e){const t=this.json,n=this.options,s=t.textures[e].source,i=t.images[s];let o=this.textureLoader;if(i.uri){const a=n.manager.getHandler(i.uri);a!==null&&(o=a)}return this.loadTextureImage(e,s,o)}loadTextureImage(e,t,n){const r=this,s=this.json,i=s.textures[e],o=s.images[t],a=(o.uri||o.bufferView)+":"+i.sampler;if(this.textureCache[a])return this.textureCache[a];const h=this.loadImageSource(t,n).then(function(l){l.flipY=!1,l.name=i.name||o.name||"",l.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(l.name=o.uri);const u=(s.samplers||{})[i.sampler]||{};return l.magFilter=Os[u.magFilter]||Zn,l.minFilter=Os[u.minFilter]||Js,l.wrapS=Vs[u.wrapS]||Ft,l.wrapT=Vs[u.wrapT]||Ft,r.associations.set(l,{textures:e}),l}).catch(function(){return null});return this.textureCache[a]=h,h}loadImageSource(e,t){const n=this,r=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(c=>c.clone());const i=r.images[e],o=self.URL||self.webkitURL;let a=i.uri||"",h=!1;if(i.bufferView!==void 0)a=n.getDependency("bufferView",i.bufferView).then(function(c){h=!0;const u=new Blob([c],{type:i.mimeType});return a=o.createObjectURL(u),a});else if(i.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const l=Promise.resolve(a).then(function(c){return new Promise(function(u,d){let p=u;t.isImageBitmapLoader===!0&&(p=function(f){const v=new fs(f);v.needsUpdate=!0,u(v)}),t.load(Mn.resolveURL(c,s.path),p,void 0,d)})}).then(function(c){return h===!0&&o.revokeObjectURL(a),c.userData.mimeType=i.mimeType||Uh(i.uri),c}).catch(function(c){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),c});return this.sourceCache[e]=l,l}assignTexture(e,t,n,r){const s=this;return this.getDependency("texture",n.index).then(function(i){if(!i)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(i=i.clone(),i.channel=n.texCoord),s.extensions[Ee.KHR_TEXTURE_TRANSFORM]){const o=n.extensions!==void 0?n.extensions[Ee.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const a=s.associations.get(i);i=s.extensions[Ee.KHR_TEXTURE_TRANSFORM].extendTexture(i,o),s.associations.set(i,a)}}return r!==void 0&&(i.colorSpace=r),e[t]=i,i})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const r=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,i=t.attributes.normal===void 0;if(e.isPoints){const o="PointsMaterial:"+n.uuid;let a=this.cache.get(o);a||(a=new js,pr.prototype.copy.call(a,n),a.color.copy(n.color),a.map=n.map,a.sizeAttenuation=!1,this.cache.add(o,a)),n=a}else if(e.isLine){const o="LineBasicMaterial:"+n.uuid;let a=this.cache.get(o);a||(a=new Hs,pr.prototype.copy.call(a,n),a.color.copy(n.color),a.map=n.map,this.cache.add(o,a)),n=a}if(r||s||i){let o="ClonedMaterial:"+n.uuid+":";r&&(o+="derivative-tangents:"),s&&(o+="vertex-colors:"),i&&(o+="flat-shading:");let a=this.cache.get(o);a||(a=n.clone(),s&&(a.vertexColors=!0),i&&(a.flatShading=!0),r&&(a.normalScale&&(a.normalScale.y*=-1),a.clearcoatNormalScale&&(a.clearcoatNormalScale.y*=-1)),this.cache.add(o,a),this.associations.set(a,this.associations.get(n))),n=a}e.material=n}getMaterialType(){return Ke}loadMaterial(e){const t=this,n=this.json,r=this.extensions,s=n.materials[e];let i;const o={},a=s.extensions||{},h=[];if(a[Ee.KHR_MATERIALS_UNLIT]){const c=r[Ee.KHR_MATERIALS_UNLIT];i=c.getMaterialType(),h.push(c.extendParams(o,s,t))}else{const c=s.pbrMetallicRoughness||{};if(o.color=new At(1,1,1),o.opacity=1,Array.isArray(c.baseColorFactor)){const u=c.baseColorFactor;o.color.setRGB(u[0],u[1],u[2],ei),o.opacity=u[3]}c.baseColorTexture!==void 0&&h.push(t.assignTexture(o,"map",c.baseColorTexture,ki)),o.metalness=c.metallicFactor!==void 0?c.metallicFactor:1,o.roughness=c.roughnessFactor!==void 0?c.roughnessFactor:1,c.metallicRoughnessTexture!==void 0&&(h.push(t.assignTexture(o,"metalnessMap",c.metallicRoughnessTexture)),h.push(t.assignTexture(o,"roughnessMap",c.metallicRoughnessTexture))),i=this._invokeOne(function(u){return u.getMaterialType&&u.getMaterialType(e)}),h.push(Promise.all(this._invokeAll(function(u){return u.extendMaterialParams&&u.extendMaterialParams(e,o)})))}s.doubleSided===!0&&(o.side=zi);const l=s.alphaMode||Er.OPAQUE;if(l===Er.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,l===Er.MASK&&(o.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&i!==kt&&(h.push(t.assignTexture(o,"normalMap",s.normalTexture)),o.normalScale=new jr(1,1),s.normalTexture.scale!==void 0)){const c=s.normalTexture.scale;o.normalScale.set(c,c)}if(s.occlusionTexture!==void 0&&i!==kt&&(h.push(t.assignTexture(o,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&i!==kt){const c=s.emissiveFactor;o.emissive=new At().setRGB(c[0],c[1],c[2],ei)}return s.emissiveTexture!==void 0&&i!==kt&&h.push(t.assignTexture(o,"emissiveMap",s.emissiveTexture,ki)),Promise.all(h).then(function(){const c=new i(o);return s.name&&(c.name=s.name),Mi(c,s),t.associations.set(c,{materials:e}),s.extensions&&Yi(r,c,s),c})}createUniqueName(e){const t=Pa.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,r=this.primitiveCache;function s(o){return n[Ee.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,t).then(function(a){return Ds(a,o,t)})}const i=[];for(let o=0,a=e.length;o<a;o++){const h=e[o],l=Hh(h),c=r[l];if(c)i.push(c.promise);else{let u;h.extensions&&h.extensions[Ee.KHR_DRACO_MESH_COMPRESSION]?u=s(h):u=Ds(new Wn,h,t),r[l]={primitive:h,promise:u},i.push(u)}}return Promise.all(i)}loadMesh(e){const t=this,n=this.json,r=this.extensions,s=n.meshes[e],i=s.primitives,o=[];for(let a=0,h=i.length;a<h;a++){const l=i[a].material===void 0?Dh(this.cache):this.getDependency("material",i[a].material);o.push(l)}return o.push(t.loadGeometries(i)),Promise.all(o).then(function(a){const h=a.slice(0,a.length-1),l=a[a.length-1],c=[];for(let d=0,p=l.length;d<p;d++){const f=l[d],v=i[d];let m;const y=h[d];if(v.mode===$t.TRIANGLES||v.mode===$t.TRIANGLE_STRIP||v.mode===$t.TRIANGLE_FAN||v.mode===void 0)m=s.isSkinnedMesh===!0?new Ba(f,y):new Te(f,y),m.isSkinnedMesh===!0&&m.normalizeSkinWeights(),v.mode===$t.TRIANGLE_STRIP?m.geometry=zs(m.geometry,Qs):v.mode===$t.TRIANGLE_FAN&&(m.geometry=zs(m.geometry,Mr));else if(v.mode===$t.LINES)m=new La(f,y);else if(v.mode===$t.LINE_STRIP)m=new Gs(f,y);else if(v.mode===$t.LINE_LOOP)m=new Fa(f,y);else if(v.mode===$t.POINTS)m=new Ks(f,y);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);Object.keys(m.geometry.morphAttributes).length>0&&Gh(m,s),m.name=t.createUniqueName(s.name||"mesh_"+e),Mi(m,s),v.extensions&&Yi(r,m,v),t.assignFinalMaterial(m),c.push(m)}for(let d=0,p=c.length;d<p;d++)t.associations.set(c[d],{meshes:e,primitives:d});if(c.length===1)return s.extensions&&Yi(r,c[0],s),c[0];const u=new Zi;s.extensions&&Yi(r,u,s),t.associations.set(u,{meshes:e});for(let d=0,p=c.length;d<p;d++)u.add(c[d]);return u})}loadCamera(e){let t;const n=this.json.cameras[e],r=n[n.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new dt(Yn.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):n.type==="orthographic"&&(t=new Ia(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Mi(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let r=0,s=t.joints.length;r<s;r++)n.push(this._loadNodeShallow(t.joints[r]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(r){const s=r.pop(),i=r,o=[],a=[];for(let h=0,l=i.length;h<l;h++){const c=i[h];if(c){o.push(c);const u=new Jn;s!==null&&u.fromArray(s.array,h*16),a.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[h])}return new ka(o,a)})}loadAnimation(e){const t=this.json,n=this,r=t.animations[e],s=r.name?r.name:"animation_"+e,i=[],o=[],a=[],h=[],l=[];for(let c=0,u=r.channels.length;c<u;c++){const d=r.channels[c],p=r.samplers[d.sampler],f=d.target,v=f.node,m=r.parameters!==void 0?r.parameters[p.input]:p.input,y=r.parameters!==void 0?r.parameters[p.output]:p.output;f.node!==void 0&&(i.push(this.getDependency("node",v)),o.push(this.getDependency("accessor",m)),a.push(this.getDependency("accessor",y)),h.push(p),l.push(f))}return Promise.all([Promise.all(i),Promise.all(o),Promise.all(a),Promise.all(h),Promise.all(l)]).then(function(c){const u=c[0],d=c[1],p=c[2],f=c[3],v=c[4],m=[];for(let y=0,_=u.length;y<_;y++){const w=u[y],x=d[y],E=p[y],L=f[y],A=v[y];if(w===void 0)continue;w.updateMatrix&&w.updateMatrix();const T=n._createAnimationTracks(w,x,E,L,A);if(T)for(let R=0;R<T.length;R++)m.push(T[R])}return new za(s,void 0,m)})}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return r.mesh===void 0?null:n.getDependency("mesh",r.mesh).then(function(s){const i=n._getNodeRef(n.meshCache,r.mesh,s);return r.weights!==void 0&&i.traverse(function(o){if(o.isMesh)for(let a=0,h=r.weights.length;a<h;a++)o.morphTargetInfluences[a]=r.weights[a]}),i})}loadNode(e){const t=this.json,n=this,r=t.nodes[e],s=n._loadNodeShallow(e),i=[],o=r.children||[];for(let h=0,l=o.length;h<l;h++)i.push(n.getDependency("node",o[h]));const a=r.skin===void 0?Promise.resolve(null):n.getDependency("skin",r.skin);return Promise.all([s,Promise.all(i),a]).then(function(h){const l=h[0],c=h[1],u=h[2];u!==null&&l.traverse(function(d){d.isSkinnedMesh&&d.bind(u,qh)});for(let d=0,p=c.length;d<p;d++)l.add(c[d]);return l})}_loadNodeShallow(e){const t=this.json,n=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],i=s.name?r.createUniqueName(s.name):"",o=[],a=r._invokeOne(function(h){return h.createNodeMesh&&h.createNodeMesh(e)});return a&&o.push(a),s.camera!==void 0&&o.push(r.getDependency("camera",s.camera).then(function(h){return r._getNodeRef(r.cameraCache,s.camera,h)})),r._invokeAll(function(h){return h.createNodeAttachment&&h.createNodeAttachment(e)}).forEach(function(h){o.push(h)}),this.nodeCache[e]=Promise.all(o).then(function(h){let l;if(s.isBone===!0?l=new Na:h.length>1?l=new Zi:h.length===1?l=h[0]:l=new Zs,l!==h[0])for(let c=0,u=h.length;c<u;c++)l.add(h[c]);if(s.name&&(l.userData.name=s.name,l.name=i),Mi(l,s),s.extensions&&Yi(n,l,s),s.matrix!==void 0){const c=new Jn;c.fromArray(s.matrix),l.applyMatrix4(c)}else s.translation!==void 0&&l.position.fromArray(s.translation),s.rotation!==void 0&&l.quaternion.fromArray(s.rotation),s.scale!==void 0&&l.scale.fromArray(s.scale);return r.associations.has(l)||r.associations.set(l,{}),r.associations.get(l).nodes=e,l}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],r=this,s=new Zi;n.name&&(s.name=r.createUniqueName(n.name)),Mi(s,n),n.extensions&&Yi(t,s,n);const i=n.nodes||[],o=[];for(let a=0,h=i.length;a<h;a++)o.push(r.getDependency("node",i[a]));return Promise.all(o).then(function(a){for(let l=0,c=a.length;l<c;l++)s.add(a[l]);const h=l=>{const c=new Map;for(const[u,d]of r.associations)(u instanceof pr||u instanceof fs)&&c.set(u,d);return l.traverse(u=>{const d=r.associations.get(u);d!=null&&c.set(u,d)}),c};return r.associations=h(s),s})}_createAnimationTracks(e,t,n,r,s){const i=[],o=e.name?e.name:e.uuid,a=[];Ci[s.path]===Ci.weights?e.traverse(function(u){u.morphTargetInfluences&&a.push(u.name?u.name:u.uuid)}):a.push(o);let h;switch(Ci[s.path]){case Ci.weights:h=ms;break;case Ci.rotation:h=gs;break;case Ci.position:case Ci.scale:h=vs;break;default:switch(n.itemSize){case 1:h=ms;break;case 2:case 3:default:h=vs;break}break}const l=r.interpolation!==void 0?Vh[r.interpolation]:eo,c=this._getArrayFromAccessor(n);for(let u=0,d=a.length;u<d;u++){const p=new h(a[u]+"."+Ci[s.path],t.array,c,l);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(p),i.push(p)}return i}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const n=$r(t.constructor),r=new Float32Array(t.length);for(let s=0,i=t.length;s<i;s++)r[s]=t[s]*n;t=r}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const r=this instanceof gs?Oh:sa;return new r(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Xh(g,e,t){const n=e.attributes,r=new $a;if(n.POSITION!==void 0){const o=t.json.accessors[n.POSITION],a=o.min,h=o.max;if(a!==void 0&&h!==void 0){if(r.set(new gi(a[0],a[1],a[2]),new gi(h[0],h[1],h[2])),o.normalized){const l=$r(mn[o.componentType]);r.min.multiplyScalar(l),r.max.multiplyScalar(l)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const o=new gi,a=new gi;for(let h=0,l=s.length;h<l;h++){const c=s[h];if(c.POSITION!==void 0){const u=t.json.accessors[c.POSITION],d=u.min,p=u.max;if(d!==void 0&&p!==void 0){if(a.setX(Math.max(Math.abs(d[0]),Math.abs(p[0]))),a.setY(Math.max(Math.abs(d[1]),Math.abs(p[1]))),a.setZ(Math.max(Math.abs(d[2]),Math.abs(p[2]))),u.normalized){const f=$r(mn[u.componentType]);a.multiplyScalar(f)}o.max(a)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(o)}g.boundingBox=r;const i=new Xa;r.getCenter(i.center),i.radius=r.min.distanceTo(r.max)/2,g.boundingSphere=i}function Ds(g,e,t){const n=e.attributes,r=[];function s(i,o){return t.getDependency("accessor",i).then(function(a){g.setAttribute(o,a)})}for(const i in n){const o=qr[i]||i.toLowerCase();o in g.attributes||r.push(s(n[i],o))}if(e.indices!==void 0&&!g.index){const i=t.getDependency("accessor",e.indices).then(function(o){g.setIndex(o)});r.push(i)}return ps.workingColorSpace!==ei&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${ps.workingColorSpace}" not supported.`),Mi(g,e),Xh(g,e,t),Promise.all(r).then(function(){return e.targets!==void 0?Wh(g,e.targets,t):g})}const Cr=new WeakMap;class Yh extends Yr{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,r){const s=new Ln(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,i=>{this.parse(i,t,r)},n,r)}parse(e,t,n=()=>{}){this.decodeDracoFile(e,t,null,null,ki).catch(n)}decodeDracoFile(e,t,n,r,s=ei,i=()=>{}){const o={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!n,vertexColorSpace:s};return this.decodeGeometry(e,o).then(t).catch(i)}decodeGeometry(e,t){const n=JSON.stringify(t);if(Cr.has(e)){const a=Cr.get(e);if(a.key===n)return a.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r;const s=this.workerNextTaskID++,i=e.byteLength,o=this._getWorker(s,i).then(a=>(r=a,new Promise((h,l)=>{r._callbacks[s]={resolve:h,reject:l},r.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(a=>this._createGeometry(a.geometry));return o.catch(()=>!0).then(()=>{r&&s&&this._releaseTask(r,s)}),Cr.set(e,{key:n,promise:o}),o}_createGeometry(e){const t=new Wn;e.index&&t.setIndex(new Li(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const r=e.attributes[n],s=r.name,i=r.array,o=r.itemSize,a=new Li(i,o);s==="color"&&(this._assignVertexColorSpace(a,r.vertexColorSpace),a.normalized=!(i instanceof Float32Array)),t.setAttribute(s,a)}return t}_assignVertexColorSpace(e,t){if(t!==ki)return;const n=new At;for(let r=0,s=e.count;r<s;r++)n.fromBufferAttribute(e,r).convertSRGBToLinear(),e.setXYZ(r,n.r,n.g,n.b)}_loadLibrary(e,t){const n=new Ln(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((r,s)=>{n.load(e,r,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const r=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const s=jh.toString(),i=["/* draco decoder */",r,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([i]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(s){const i=s.data;switch(i.type){case"decode":r._callbacks[i.id].resolve(i);break;case"error":r._callbacks[i.id].reject(i);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,s){return r._taskLoad>s._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function jh(){let g,e;onmessage=function(i){const o=i.data;switch(o.type){case"init":g=o.decoderConfig,e=new Promise(function(l){g.onModuleLoaded=function(c){l({draco:c})},DracoDecoderModule(g)});break;case"decode":const a=o.buffer,h=o.taskConfig;e.then(l=>{const c=l.draco,u=new c.Decoder;try{const d=t(c,u,new Int8Array(a),h),p=d.attributes.map(f=>f.array.buffer);d.index&&p.push(d.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:d},p)}catch(d){console.error(d),self.postMessage({type:"error",id:o.id,error:d.message})}finally{c.destroy(u)}});break}};function t(i,o,a,h){const l=h.attributeIDs,c=h.attributeTypes;let u,d;const p=o.GetEncodedGeometryType(a);if(p===i.TRIANGULAR_MESH)u=new i.Mesh,d=o.DecodeArrayToMesh(a,a.byteLength,u);else if(p===i.POINT_CLOUD)u=new i.PointCloud,d=o.DecodeArrayToPointCloud(a,a.byteLength,u);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!d.ok()||u.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+d.error_msg());const f={index:null,attributes:[]};for(const v in l){const m=self[c[v]];let y,_;if(h.useUniqueIDs)_=l[v],y=o.GetAttributeByUniqueId(u,_);else{if(_=o.GetAttributeId(u,i[l[v]]),_===-1)continue;y=o.GetAttribute(u,_)}const w=r(i,o,u,v,m,y);v==="color"&&(w.vertexColorSpace=h.vertexColorSpace),f.attributes.push(w)}return p===i.TRIANGULAR_MESH&&(f.index=n(i,o,u)),i.destroy(u),f}function n(i,o,a){const l=a.num_faces()*3,c=l*4,u=i._malloc(c);o.GetTrianglesUInt32Array(a,c,u);const d=new Uint32Array(i.HEAPF32.buffer,u,l).slice();return i._free(u),{array:d,itemSize:1}}function r(i,o,a,h,l,c){const u=c.num_components(),p=a.num_points()*u,f=p*l.BYTES_PER_ELEMENT,v=s(i,l),m=i._malloc(f);o.GetAttributeDataArrayForAllPoints(a,c,v,f,m);const y=new l(i.HEAPF32.buffer,m,p).slice();return i._free(m),{name:h,array:y,itemSize:u}}function s(i,o){switch(o){case Float32Array:return i.DT_FLOAT32;case Int8Array:return i.DT_INT8;case Int16Array:return i.DT_INT16;case Int32Array:return i.DT_INT32;case Uint8Array:return i.DT_UINT8;case Uint16Array:return i.DT_UINT16;case Uint32Array:return i.DT_UINT32}}}const Kh={class:"wcp-demo-container"},Qh={__name:"ThreeModels",setup(g){const e=Le(null),t=Le(null),n=new Ti;return ht(()=>{const r=new vt,s=new na,i=new Yh;i.setDecoderPath("/js/three/examples/js/libs/draco/"),s.setDRACOLoader(i);let o=null;s.load("/models/Fox/glTF/Fox.gltf",w=>{o=new ja(w.scene);const x=o.clipAction(w.animations[0]);console.log(x),x.play(),w.scene.scale.set(.06,.06,.06),r.add(w.scene)},w=>{console.log(w.loaded/w.total*100+"% loaded")},w=>{console.log(w)});const h=new Ai().load("/textures/Plastic013A/Plastic013A_1K-PNG_Color.png");h.wrapS=Ft,h.wrapT=Ft,h.repeat.set(2,2);const l=new Te(new rn(10,10),new Ke({color:"#eee",side:zi}));l.rotation.x=-Math.PI/2,r.add(l),l.receiveShadow=!0;const c=new An("#ffffff",.5);r.add(c);const u=new bn("#ffffff",.5);u.position.set(1,3,-3),u.castShadow=!0,r.add(u);const d={width:+getComputedStyle(e.value).width.split("px")[0],height:+getComputedStyle(e.value).height.split("px")[0]},p=new dt(75,d.width/d.height,.1,1e3);p.position.z=6,p.position.y=6,p.position.x=6,r.add(p);const f=new Kt(p,t.value);f.enableDamping=!0;const v=new mt({canvas:t.value});v.setSize(d.width,d.height),v.setPixelRatio(Math.min(window.devicePixelRatio,2)),v.shadowMap.enabled=!0;const m=new xi;let y=0;function _(){requestAnimationFrame(_);const w=m.getElapsedTime(),x=w-y;y=w,o!==null&&o.update(x),f.update(),v.render(r,p)}_(),window.addEventListener("resize",w=>{d.width=+getComputedStyle(e.value).width.split("px")[0],d.height=+getComputedStyle(e.value).height.split("px")[0],p.aspect=d.width/d.height,p.updateProjectionMatrix(),v.setSize(d.width,d.height),v.setPixelRatio(Math.min(window.devicePixelRatio,2))}),t.value.addEventListener("dblclick",w=>{document.fullscreenElement?document.exitFullscreen():e.value.requestFullscreen()})}),Mt(()=>{n.destroy(),console.log("unmounted")}),(r,s)=>(ke(),st("div",Kh,[Ce("div",{ref_key:"canvasContainer",ref:e,class:"canvas-container"},[Ce("canvas",{ref_key:"canvas",ref:t},null,512)],512)]))}},Zh=ut(Qh,[["__scopeId","data-v-bd58f5b7"]]),Jh={class:"wcp-demo-container"},eu={__name:"ThreeMouseEvent",setup(g){const e=Le(null),t=Le(null);return ht(()=>{new Ai().load("/textures/matcap1.png");const r=new vt,s=new Te(new yi(.5,16,16),new Ke);s.position.x=-1.5;const i=new Te(new yi(.5,16,16),new Ke),o=new Te(new yi(.5,16,16),new Ke);o.position.x=1.5,r.add(s),r.add(i),r.add(o);const a={width:+getComputedStyle(e.value).width.split("px")[0],height:+getComputedStyle(e.value).height.split("px")[0]},h=new dt(75,a.width/a.height,.1,1e3);h.position.z=5,r.add(h);const l=new Kt(h,t.value);l.enableDamping=!0;const c=new An(16777215,.5);r.add(c);const u=new mt({canvas:t.value});u.setSize(a.width,a.height),u.setPixelRatio(Math.min(window.devicePixelRatio,2));let d=null;new na().load("/models/Fox/glTF/Fox.gltf",w=>{d=w.scene,w.scene.scale.set(.01,.01,.01),r.add(w.scene)},w=>{console.log(w.loaded/w.total*100+"% loaded")},w=>{console.log(w)}),window.addEventListener("resize",w=>{a.width=+getComputedStyle(e.value).width.split("px")[0],a.height=+getComputedStyle(e.value).height.split("px")[0],h.aspect=a.width/a.height,h.updateProjectionMatrix(),u.setSize(a.width,a.height),u.setPixelRatio(Math.min(window.devicePixelRatio,2))});const f=new Ka,v=new jr;let m=null;window.addEventListener("pointermove",w=>{v.x=w.clientX/window.innerWidth*2-1,v.y=-(w.clientY/window.innerHeight)*2+1}),t.value.addEventListener("dblclick",w=>{document.fullscreenElement?document.exitFullscreen():e.value.requestFullscreen()}),t.value.addEventListener("click",w=>{if(m)switch(m.object){case s:console.log("sphere1 clicked");break;case i:console.log("sphere2 clicked");break;case o:console.log("sphere3 clicked");break}});const y=new xi;function _(){const w=y.getElapsedTime();s.position.y=Math.sin(w*.3)*1.5,i.position.y=Math.sin(w*1.4)*1.5,o.position.y=Math.sin(w*.8)*1.5,f.setFromCamera(v,h);const x=[s,i,o],E=f.intersectObjects(x);x.forEach(L=>{L.material.color.set("pink")});for(let L=0;L<E.length;L++)E[L].object.material.color.set("#abcdef");E.length>0?m=E[0]:m=null,d&&(f.intersectObject(d).length>0?d.scale.set(.02,.02,.02):d.scale.set(.01,.01,.01)),l.update(),u.render(r,h),requestAnimationFrame(_)}_()}),Mt(()=>{}),(n,r)=>(ke(),st("div",Jh,[Ce("div",{ref_key:"canvasContainer",ref:e,class:"canvas-container"},[Ce("canvas",{ref_key:"canvas",ref:t},null,512)],512)]))}},tu=ut(eu,[["__scopeId","data-v-f87a115a"]]),iu={class:"wrap"},nu={class:"content"},ru={style:{"overflow-x":"auto","scrollbar-width":"none"}},su=["value"],ou=ha('<w-tab value="basic" data-v-66b4a713>basic</w-tab><w-tab value="transform" data-v-66b4a713>transform</w-tab><w-tab value="camera" data-v-66b4a713>camera</w-tab><w-tab value="geometries" data-v-66b4a713>geometries</w-tab><w-tab value="debug ui" data-v-66b4a713>debug ui</w-tab><w-tab value="materials" data-v-66b4a713>materials</w-tab><w-tab value="light" data-v-66b4a713>light</w-tab><w-tab value="shadows" data-v-66b4a713>shadows</w-tab><w-tab value="house" data-v-66b4a713>house</w-tab><w-tab value="particles" data-v-66b4a713>particles</w-tab><w-tab value="physics" data-v-66b4a713>physics</w-tab><w-tab value="models" data-v-66b4a713>models</w-tab><w-tab value="mouse event" data-v-66b4a713>mouse event</w-tab><w-tab value="panoramic" data-v-66b4a713>panoramic</w-tab>',14),au=[ou],lu={__name:"DemoThree",setup(g){Ws();const e=Le(null),t=Le({demo:"basic"});return ht(n=>{}),(n,r)=>(ke(),st("div",{class:"wcp-container",onClick:r[1]||(r[1]=(...s)=>{var i,o;return((i=e.value)==null?void 0:i.hideMenu)&&((o=e.value)==null?void 0:o.hideMenu(...s))})},[Hn(ua,{ref_key:"headerRef",ref:e},null,512),Ce("div",iu,[Ce("div",nu,[Ce("div",ru,[Ce("w-tabs",{style:{width:"max-content",display:"block"},value:t.value.demo,onChange:r[0]||(r[0]=s=>{t.value.demo=s.detail.value})},au,40,su)]),Ce("div",null,[t.value.demo=="basic"?(ke(),Bt(Wc,{key:0})):xt("",!0),t.value.demo=="transform"?(ke(),Bt(Oc,{key:1})):xt("",!0),t.value.demo=="camera"?(ke(),Bt(kc,{key:2})):xt("",!0),t.value.demo=="geometries"?(ke(),Bt(Lc,{key:3})):xt("",!0),t.value.demo=="debug ui"?(ke(),Bt(Rc,{key:4})):xt("",!0),t.value.demo=="materials"?(ke(),st(ca,{key:5},[Hn(Qa),Hn(Uc),Hn(Zc)],64)):xt("",!0),t.value.demo=="light"?(ke(),Bt(th,{key:6})):xt("",!0),t.value.demo=="shadows"?(ke(),Bt(rh,{key:7})):xt("",!0),t.value.demo=="house"?(ke(),Bt(ah,{key:8})):xt("",!0),t.value.demo=="particles"?(ke(),Bt(hh,{key:9})):xt("",!0),t.value.demo=="physics"?(ke(),Bt(fh,{key:10})):xt("",!0),t.value.demo=="models"?(ke(),Bt(Zh,{key:11})):xt("",!0),t.value.demo=="mouse event"?(ke(),Bt(tu,{key:12})):xt("",!0),t.value.demo=="panoramic"?(ke(),Bt(el,{key:13})):xt("",!0)])])])]))}},du=ut(lu,[["__scopeId","data-v-66b4a713"]]);export{du as default};
