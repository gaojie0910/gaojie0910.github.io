import{x as _,y as t,j as w,r as g,o as b,a as m,c as v,d as r,t as f,e as P,F as h,h as U}from"./index-g0ZtEW70.js";import{_ as j}from"./_plugin-vue_export-helper-x3n3nnut.js";const c=_();t.setOptions({headers:{"X-Auth-Key":"0540d722179ac63b1ff1d8a523464b1890963","X-Auth-Email":"471089443@qq.com"}});function k(s){var o;if(!((o=c.getUser())!=null&&o.user_id))return new Promise((l,d)=>{l({errors:[{message:"user not login"}]})});if(!s.name||!s.password)return new Promise((l,d)=>{l({errors:[{message:"name or password cannot be empty"}]})});let e=self.crypto.randomUUID();return t.post({url:"/api",data:{params:[e,s.name,s.password],sql:"Insert INTO users VALUES ( ?, ?, ?);"}}).then(l=>l.json())}function T(s){return console.log(s,c.getUser()),!s.name||!s.password||!s.id?new Promise((e,o)=>{e({errors:[{message:"id, name or password cannot be empty"}]})}):s.id==c.getUser().user_id?new Promise((e,o)=>{e({errors:[{message:"cannot delete yourself"}]})}):t.post({url:"/api",data:{params:[s.id,s.name,s.password],sql:"DELETE FROM users WHERE user_id = ? AND user_name = ? AND user_password = ?;"}}).then(e=>e.json())}function x(s){return!s.name||!s.password?new Promise((e,o)=>{e({errors:[{message:"id, name or password cannot be empty"}]})}):t.post({url:"/api",data:{params:[s.name,s.password,s.id],sql:"UPDATE users SET user_name = ? , user_password = ?  WHERE user_id = ?;"}}).then(e=>e.json())}function N(s){return!s.name||!s.password?new Promise((e,o)=>{e({errors:[{message:"name or password cannot be empty"}]})}):t.post({url:"/api",data:{params:[s.name,s.password],sql:"SELECT * FROM users WHERE user_name = ? AND user_password = ?;"}}).then(e=>e.json())}function L(s){return s?t.post({url:"/api",data:{params:[s],sql:"SELECT * FROM users WHERE user_id = ?;"}}).then(e=>e.json()):new Promise((e,o)=>{e({errors:[{message:"id cannot be empty"}]})})}function O(s){return w.typeof(s.currentPage)!=="number"||w.typeof(s.pageSize)!=="number"?new Promise((e,o)=>{e({errors:[{message:"currentPage or pageSize type error"}]})}):t.post({url:"/api",data:{params:["%"+s.name+"%",s.currentPage,s.pageSize],sql:"SELECT * FROM users WHERE user_name LIKE ? LIMIT ?, ? ;"}}).then(e=>e.json())}const i={add:k,remove:T,update:x,login:N,findById:L,find:O},R={style:{display:"flex","flex-wrap":"wrap",gap:"10px",padding:"10px"}},q={class:"item"},z=["value"],A=["value"],I={class:"item"},D=["value"],F=["value"],M=["value"],H={class:"item"},W=["value"],B=["value"],J=["value"],K={class:"item"},V=["value"],X=["value"],G=["value"],Q={class:"item"},Y=["value"],Z=["value"],$={style:{margin:"0 10px",padding:"10px","background-color":"#fff"}},ee={style:{margin:"0 10px",padding:"10px","background-color":"#f2f2f2"}},se={__name:"Test",setup(s){const e=g({userList:[],id:"",name:"",password:"",searchName:"",currentPage:1,pageSize:10}),o=g(null),l=_();function d(){i.add({name:e.value.name,password:e.value.password}).then(n=>{n.success===!0?(o.value.show("add user success"),p()):o.value.show(n.errors[0].message)})}function E(){i.remove({id:e.value.id,name:e.value.name,password:e.value.password}).then(n=>{n.success===!0?(n.result[0].meta.changes>0?o.value.show("remove user success"):o.value.show("user not exist"),p()):o.value.show(n.errors[0].message)})}function y(){i.update({id:e.value.id,name:e.value.name,password:e.value.password}).then(n=>{n.success===!0?(o.value.show("update user success"),p()):o.value.show(n.errors[0].message)})}function C(){i.login({name:e.value.name,password:e.value.password}).then(n=>{n.success===!0?n.result[0].results[0]?(o.value.show("login success"),l.setUser(n.result[0].results[0]),l.setToken(JSON.stringify(n.result[0].results[0]))):o.value.show("name or password not correct"):o.value.show(n.errors[0].message)})}function S(){l.reset(),o.value.show("logout success")}function p(){e.value.currentPage<=1&&(e.value.currentPage=1),i.find({currentPage:e.value.currentPage-1,pageSize:e.value.pageSize,name:e.value.searchName}).then(n=>{n.success===!0?e.value.userList=n.result[0].results:o.value.show(n.errors[0].message)})}return b(()=>{if(p(),l.getToken())try{l.setUser(JSON.parse(l.getToken())),i.login({name:l.getUser().user_name,password:l.getUser().user_password}).then(n=>{n.success===!0?n.result[0].results[0]?(o.value.show("login success"),l.setUser(n.result[0].results[0]),l.setToken(JSON.stringify(n.result[0].results[0]))):(o.value.show("name or password not correct please login again"),l.reset()):(o.value.show(n.errors[0].message),l.reset())})}catch{l.reset()}else l.reset()}),(n,a)=>(m(),v(h,null,[r("div",R,[r("w-msg",{ref_key:"msg",ref:o},null,512),r("div",q,[r("w-input",{value:e.value.name,placeholder:"name",onChange:a[0]||(a[0]=u=>{e.value.name=u.detail.value})},null,40,z),r("w-input",{value:e.value.password,placeholder:"password",onChange:a[1]||(a[1]=u=>{e.value.password=u.detail.value})},null,40,A),r("w-btn",{onClick:d},"add user")]),r("div",I,[r("w-input",{value:e.value.id,placeholder:"id",onChange:a[2]||(a[2]=u=>{e.value.id=u.detail.value})},null,40,D),r("w-input",{value:e.value.name,placeholder:"name",onChange:a[3]||(a[3]=u=>{e.value.name=u.detail.value})},null,40,F),r("w-input",{value:e.value.password,placeholder:"password",onChange:a[4]||(a[4]=u=>{e.value.password=u.detail.value})},null,40,M),r("w-btn",{onClick:E},"remove user")]),r("div",H,[r("w-input",{value:e.value.id,placeholder:"id",onChange:a[5]||(a[5]=u=>{e.value.id=u.detail.value})},null,40,W),r("w-input",{value:e.value.name,placeholder:"name",onChange:a[6]||(a[6]=u=>{e.value.name=u.detail.value})},null,40,B),r("w-input",{value:e.value.password,placeholder:"password",onChange:a[7]||(a[7]=u=>{e.value.password=u.detail.value})},null,40,J),r("w-btn",{onClick:y},"update user")]),r("div",K,[r("w-input",{value:e.value.searchName,placeholder:"searchName",onChange:a[8]||(a[8]=u=>{e.value.searchName=u.detail.value})},null,40,V),r("w-input",{type:"number",min:"1",value:e.value.currentPage,onChange:a[9]||(a[9]=u=>{e.value.currentPage=u.detail.value})},null,40,X),r("w-input",{type:"number",value:e.value.pageSize,onChange:a[10]||(a[10]=u=>{e.value.pageSize=u.detail.value})},null,40,G),r("w-btn",{onClick:p},"find user")]),r("div",Q,[r("w-input",{value:e.value.name,placeholder:"name",onChange:a[11]||(a[11]=u=>{e.value.name=u.detail.value})},null,40,Y),r("w-input",{value:e.value.password,placeholder:"password",onChange:a[12]||(a[12]=u=>{e.value.password=u.detail.value})},null,40,Z),r("w-btn",{onClick:C},"login"),r("w-btn",{onClick:S},"logout")])]),r("div",$," 当前登录用户："+f(P(l).getUser()),1),r("div",ee,[(m(!0),v(h,null,U(e.value.userList,u=>(m(),v("div",null,f(u),1))),256))])],64))}},ue=j(se,[["__scopeId","data-v-7790a97d"]]);export{ue as default};
