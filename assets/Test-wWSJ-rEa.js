import{y as _,e as t,k as w,r as g,o as P,b as m,c as v,f as r,t as f,g as S,F as h,i as j}from"./index-yv1adnWi.js";import{_ as U}from"./_plugin-vue_export-helper-x3n3nnut.js";const c=_();t.setOptions({headers:{"X-Auth-Key":"0540d722179ac63b1ff1d8a523464b1890963","X-Auth-Email":"471089443@qq.com"}});function k(s){var a;if(!((a=c.getUser())!=null&&a.user_id))return new Promise((l,p)=>{l({errors:[{message:"user not login"}]})});if(!s.name||!s.password)return new Promise((l,p)=>{l({errors:[{message:"name or password cannot be empty"}]})});let e=self.crypto.randomUUID();return t.post({url:"/api",data:{params:[e,s.name,s.password],sql:"Insert INTO users VALUES ( ?, ?, ?);"}}).then(l=>l.json())}function x(s){return console.log(s,c.getUser()),!s.name||!s.password||!s.id?new Promise((e,a)=>{e({errors:[{message:"id, name or password cannot be empty"}]})}):s.id==c.getUser().user_id?new Promise((e,a)=>{e({errors:[{message:"cannot delete yourself"}]})}):t.post({url:"/api",data:{params:[s.id,s.name,s.password],sql:"DELETE FROM users WHERE user_id = ? AND user_name = ? AND user_password = ?;"}}).then(e=>e.json())}function L(s){return!s.name||!s.password?new Promise((e,a)=>{e({errors:[{message:"id, name or password cannot be empty"}]})}):t.post({url:"/api",data:{params:[s.name,s.password,s.id],sql:"UPDATE users SET user_name = ? , user_password = ?  WHERE user_id = ?;"}}).then(e=>e.json())}function N(s){return!s.name||!s.password?new Promise((e,a)=>{e({errors:[{message:"name or password cannot be empty"}]})}):t.post({url:"/api",data:{params:[s.name,s.password],sql:"SELECT * FROM users WHERE user_name = ? AND user_password = ?;"}}).then(e=>e.json())}function T(s){return s?t.post({url:"/api",data:{params:[s],sql:"SELECT * FROM users WHERE user_id = ?;"}}).then(e=>e.json()):new Promise((e,a)=>{e({errors:[{message:"id cannot be empty"}]})})}function R(s){return w.typeof(s.currentPage)!=="number"||w.typeof(s.pageSize)!=="number"?new Promise((e,a)=>{e({errors:[{message:"currentPage or pageSize type error"}]})}):t.post({url:"/api",data:{params:["%"+s.name+"%",s.currentPage,s.pageSize],sql:"SELECT * FROM users WHERE user_name LIKE ? LIMIT ?, ? ;"}}).then(e=>e.json())}const i={add:k,remove:x,update:L,login:N,findById:T,find:R},q={style:{display:"flex","flex-wrap":"wrap",gap:"10px",padding:"10px"}},z={class:"item"},A=["value"],I=["value"],D={class:"item"},O=["value"],F=["value"],M=["value"],H={class:"item"},W=["value"],B=["value"],K=["value"],V={class:"item"},X=["value"],J=["value"],G=["value"],Q={class:"item"},Y=["value"],Z=["value"],$={style:{margin:"0 10px",padding:"10px","background-color":"#fff"}},ee={style:{margin:"0 10px",padding:"10px","background-color":"#f2f2f2"}},se={__name:"Test",setup(s){const e=g({userList:[],id:"",name:"",password:"",searchName:"",currentPage:1,pageSize:10}),a=g(null),l=_();function p(){i.add({name:e.value.name,password:e.value.password}).then(o=>{o.success===!0?(a.value.show("add user success"),d()):a.value.show(o.errors[0].message)})}function E(){i.remove({id:e.value.id,name:e.value.name,password:e.value.password}).then(o=>{o.success===!0?(o.result[0].meta.changes>0?a.value.show("remove user success"):a.value.show("user not exist"),d()):a.value.show(o.errors[0].message)})}function y(){i.update({id:e.value.id,name:e.value.name,password:e.value.password}).then(o=>{o.success===!0?(a.value.show("update user success"),d()):a.value.show(o.errors[0].message)})}function C(){i.login({name:e.value.name,password:e.value.password}).then(o=>{o.success===!0?o.result[0].results[0]?(a.value.show("login success"),l.setUser(o.result[0].results[0]),l.setToken(JSON.stringify(o.result[0].results[0]))):a.value.show("name or password not correct"):a.value.show(o.errors[0].message)})}function b(){l.reset(),a.value.show("logout success")}function d(){e.value.currentPage<=1&&(e.value.currentPage=1),i.find({currentPage:e.value.currentPage-1,pageSize:e.value.pageSize,name:e.value.searchName}).then(o=>{o.success===!0?e.value.userList=o.result[0].results:a.value.show(o.errors[0].message)})}return P(()=>{}),(o,u)=>(m(),v(h,null,[r("div",q,[r("w-msg",{ref_key:"msg",ref:a},null,512),r("div",z,[r("w-input",{value:e.value.name,placeholder:"name",onChange:u[0]||(u[0]=n=>{e.value.name=n.detail.value})},null,40,A),r("w-input",{value:e.value.password,placeholder:"password",onChange:u[1]||(u[1]=n=>{e.value.password=n.detail.value})},null,40,I),r("w-btn",{onClick:p},"add user")]),r("div",D,[r("w-input",{value:e.value.id,placeholder:"id",onChange:u[2]||(u[2]=n=>{e.value.id=n.detail.value})},null,40,O),r("w-input",{value:e.value.name,placeholder:"name",onChange:u[3]||(u[3]=n=>{e.value.name=n.detail.value})},null,40,F),r("w-input",{value:e.value.password,placeholder:"password",onChange:u[4]||(u[4]=n=>{e.value.password=n.detail.value})},null,40,M),r("w-btn",{onClick:E},"remove user")]),r("div",H,[r("w-input",{value:e.value.id,placeholder:"id",onChange:u[5]||(u[5]=n=>{e.value.id=n.detail.value})},null,40,W),r("w-input",{value:e.value.name,placeholder:"name",onChange:u[6]||(u[6]=n=>{e.value.name=n.detail.value})},null,40,B),r("w-input",{value:e.value.password,placeholder:"password",onChange:u[7]||(u[7]=n=>{e.value.password=n.detail.value})},null,40,K),r("w-btn",{onClick:y},"update user")]),r("div",V,[r("w-input",{value:e.value.searchName,placeholder:"searchName",onChange:u[8]||(u[8]=n=>{e.value.searchName=n.detail.value})},null,40,X),r("w-input",{type:"number",min:"1",value:e.value.currentPage,onChange:u[9]||(u[9]=n=>{e.value.currentPage=n.detail.value})},null,40,J),r("w-input",{type:"number",value:e.value.pageSize,onChange:u[10]||(u[10]=n=>{e.value.pageSize=n.detail.value})},null,40,G),r("w-btn",{onClick:d},"find user")]),r("div",Q,[r("w-input",{value:e.value.name,placeholder:"name",onChange:u[11]||(u[11]=n=>{e.value.name=n.detail.value})},null,40,Y),r("w-input",{value:e.value.password,placeholder:"password",onChange:u[12]||(u[12]=n=>{e.value.password=n.detail.value})},null,40,Z),r("w-btn",{onClick:C},"login"),r("w-btn",{onClick:b},"logout")])]),r("div",$," 当前登录用户："+f(S(l).getUser()),1),r("div",ee,[(m(!0),v(h,null,j(e.value.userList,n=>(m(),v("div",null,f(n),1))),256))])],64))}},ue=U(se,[["__scopeId","data-v-48689821"]]);export{ue as default};
